<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict//EN">
<html>
<head>
<title>OpenSSH FAQ</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="the OpenSSH project portable version upgrading issues page">
<meta name="keywords" content="openbsd,portable version,upgrading">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1999 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<img alt="[OpenSSH]" height=30 width=141 SRC="images/smalltitle.gif">
<p>
<h2><font color=#e00000>OpenSSH FAQ</font><hr></h2>

<P>
OpenSSH is almost completely compatible with the commercial SSH 1.2.x.
There are, however, a few exceptions that you will need to bear in
mind while upgrading from the commercial version, or trying to add
OpenSSH to a system that does not ship with it by default.

<ol>
<li><strong>Why does ssh/scp make connections from low-numbered ports. My
	firewall blocks these.
	</strong><p>

	The OpenSSH client uses low numbered ports for rhosts and rhosts-rsa 
	authentication because the server needs to trust the username 
	provided by the client. 
	<p>
	To prevent ssh from using low-numbered ports, add 
	<pre>UsePrivilegedPort no</pre> to your <i>ssh_config</I> or 
	<i>~/.ssh/config</i> files, remove the setuid bit from the ssh 
	executable or use add <pre>-o "UsePrivilegedPort no"</pre> to your
	ssh or scp commandline.
	<p>

<li><strong>Why is the ssh client setuid root?
	</strong><p>

	The ssh client need to bind to a low-numbered port for rhosts and
	rhosts-rsa authentication. You can safely remove the setuid bit from
	the ssh executable if you don't want to use these authentication 
	methods.
	<p>
	
<li><strong>Does OpenSSH implement SFTP?
	</strong><p>
        In OpenSSH 2.3.0 Markus Friedl added support for a SFTP
        server that implements the SFTP protocol used by serveral
        commercial SSH clients.  For more information see
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd">sshd</a>
	manpage for the <b>Subsystem</b> option.
	SFTP is documented in the 
	<a href="txt/draft-ietf-secsh-filexfer-00.txt">secsh-filexfer</a>
	IETF draft.
	<p>

<li><strong>Why does SSH 2.3 have problems interoperating with OpenSSH 2.1.1?
	</strong><p>
	SSH 2.3 and earlier versions contain a flaw in their HMAC implementation.
	Their code was not supplying the full data block output from the digest,
	and instead always provided 128 bits.  For longer digests, this caused
	SSH 2.3 to not interoperate with OpenSSH.
	<p>
	OpenSSH 2.2.0 detects that SSH 2.3 has this flaw.  Future versions of
	SSH will have this bug fixed.
	<p>

<li><strong>Why does my connection freeze when I use SSH 2.3?
	</strong><p>
	OpenSSH does not yet support rekeying, but SSH 2.3 tries
	to negotiate this feature.
	<p>
	<b><i>Solution:</i></b>
	Upgrade your commercial SSH version to SSH 2.4 or disable
	rekeying by adding <b>RekeyIntervalSeconds 0</b> to the
	configuration file of SSH 2.3.
	<p>

<li><strong>Why does OpenSSH print "Dispatch protocol error: type 20"
	</strong><p>
	See the previous question.
	<p>

<li><strong>OpenSSH does not support any patented transport algorithms.
	</strong><p>
	In SSH1 mode, only 3DES and Blowfish can be selected.
	In SSH2 mode, only 3DES, Blowfish, CAST128 or Arcfour can be selected
	at the current time.  The patented and dated IDEA algorithm is
	not supported.
	<p>
	This difference may manifest
	itself in the
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh">ssh</a>
	command refusing to read configuration files left over from a previous
	installation of commercial SSH.
	<p>

	<b><i>Solution:</i></b>
	Edit <i>/etc/ssh/ssh_config</i> and select a different 
	<b>Cipher</b> option ("3des" or "blowfish").
	<p>

<li><strong>Old versions of commercial SSH encrypt host keys with IDEA.
	</strong><p>
	The old versions of SSH used a patented algorithm to encrypt their
	<i>/etc/ssh/ssh_host_key</i>.  This problem will manifest as
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd">sshd</a>
	not being able to read its host key.
	<p>

	<b><i>Solution:</i></b>
	You will need to run the <u>commercial</u> version of
	ssh-keygen on the host's private key:
	<p>

	<pre>
	# ssh-keygen -u -f /etc/ssh/ssh_host_key
	</pre>
	This will "upgrade" the key to 3DES.
	<p>

<li><strong>Incompatible changes to <i>/etc/sshd_config</i> format.
	</strong><p>
	OpenSSH extends the <I>sshd_config</I> file format in a number of 
	ways.
	Currently, one change is incompatible with commercial SSH.
	<p>

	Commercial SSH controlled logging using the <b>QuietMode</b> and
	<b>FascistLogging</b> directives. OpenSSH introduces a more 
	general set of logging options <b>SyslogFacility</b> and 
	<b>LogLevel</b>. See the
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd">sshd</a>
	manual page for details.

<p>
<li><strong>Warning messages about key lengths.</strong><p>
	Commercial SSH's ssh-keygen program contained a bug which caused it 
	to occasionally generate RSA keys which had their Most Significant 
	Bit (MSB) unset. Such keys were advertised as being full-length, 
	but are actually, half the time, half as long as advertised.
	<p>

	OpenSSH will print warning messages when it encounters such keys. To
	rid yourself of these message, edit you known_hosts files and replace
	the incorrect key length (usually "1024") with the correct key length
	(usually "1023").  However, as previously stated, these keys are usually
	less secure, so it is best to just make new ones.

<p>
<li><strong>Portable OpenSSH: Spurious PAM authentication messages in logfiles.</strong><p>

	The portable version of OpenSSH will generate spurious authentication
	failures at every login, similar to:

	<pre>"authentication failure; (uid=0) -> root for sshd service"</pre>

	These are generated because OpenSSH first tries to determine whether a
	user needs authentication to login (e.g. empty password). Unfortunatly
	PAM likes to log all authentication events, this one included.
	<p>

	If it annoys you too much, set <b>PermitEmptyPasswords</b> to "no" in 
	<i>sshd_config</i>. This will quiet the error message at the expense of
	disabling logins to accounts with no password set. This is the 
	default if you use the supplied <i>sshd_config</i> file.

<p>
<li><strong>Portable OpenSSH: Empty passwords not allowed with PAM authentication</strong><p>

	To enable empty passwords with a version of OpenSSH built with PAM you
	must add the flag <B>nullok</B> to the end of the password checking 
	module in the <I>/etc/pam.d/sshd</I> file. For example:

	<PRE>auth required/lib/security/pam_unix.so shadow nodelay nullok</PRE>

	This must be done in addtion to setting <B>PermitEmptyPasswords</B> to 
	"yes" in the <I>sshd_config</I> file.
	<P>

	There is one caveat when using empty passwords with PAM
	authentication: PAM will allow <U>any</U> password when authenticating
	an account with an empty password. This breaks the check that sshd
	uses to determined whether an account has no password set and grant
	users access to the account regardless of the policy specified by
	<B>PermitEmptyPasswords</B>. For this reason, it is recommended that
	you do not add the <B>nullok</B> directive to your PAM configuration 
	file unless you specifically wish to allow empty passwords.

<p>
<li><strong>X11 and/or agent forwarding does not work</strong><p>
	Check your <I>ssh_config</I> and <I>sshd_config</I>. The default 
	configuration files disable authentication agent and X11 forwarding.

	<p>
	Mandrake Linux 7.2 also modifies the XAUTHORITY environment variable
	in /etc/skel/.bashrc, and thus any bash user's home directory. 
	This will break X11 forwarding unless the following line is 
	commented out: "export XAUTHORITY=$HOME/.Xauthority"

<p>
<li><strong><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh">ssh</a>
    takes a long time to connect with Linux/glibc 2.1</strong><p>

	The glibc shipped with Redhat 6.1 appears to take a long time to 
	resolve "IPv6 or IPv4" addresses from domain names. This can be 
	kludged around with the <B>--with-ipv4-default</B> configure option. 
	This instructs OpenSSH to use IPv4-only address resolution. (IPv6
	lookups may still be made by specifying the -6 option).

<p>
<li><strong>Logins from commercial ssh generate the error:
	<pre>Selected cipher type idea not supported by server</pre>
	</strong><p>

	This error is generated when a commercial ssh which has been 
	configured to use the 'idea' cipher attempts to connect to an 
	OpenSSH server. To rectify this, select a different cipher in
	<I>ssh_config</I> or <I>~/.ssh/config</I> (3des for security or
	blowfish for speed).

<p>
<li><strong>Portable OpenSSH: "Can't locate module net-pf-10" messages in log under Linux</strong><p>
	The Linux kernel is looking (via modprobe) for protocol family 10
	(IPv6). Either load the appropriate kernel module, enter the correct
	alias in <I>/etc/modules.conf</I> or disable IPv6 in 
	<I>/etc/modules.conf</I>.
	<p>

	For some silly reason <I>/etc/modules.conf</I> may also be named
	<I>/etc/conf.modules</I>

<p>
<li><strong>Portable OpenSSH: Password authentication doesn't work on Slackware 7.0</strong><p>

	Link OpenSSH with libcrypt:

	<pre>LIBS=-lcrypt ./configure [options]</pre>

<p>
<li><strong>Portable OpenSSH: Configure or sshd complain about lack of RSA support</strong><p>

	Ensure that your OpenSSL libraries have been built to include RSA
	support either internally or through RSAref.<p>

<p>
<li><strong>Portable OpenSSH: "scp: command not found" errors</strong><p>

	scp must be in the default PATH on both the client and the server. 
	You may need to use the <B>--with-default-path</B> option to specify a 
	custom path to search on the server. This option replaces the 
	default path, so you need to specify all the current directories on
	your path as well as where you have installed scp. For example: 

	<pre>./configure --with-default-path=/bin:/usr/bin:/usr/local/bin:/path/to/scp</pre>

<p>
<li><strong>Portable OpenSSH: Unable to read passphrase</strong><p>

   Some operating systems set /dev/tty with incorrect modes, causing 
   the reading of passwords to fail with the following error:

   <pre>You have no controlling tty.  Cannot read passphrase.</pre>

   The solution to this is to reset the permissions on /dev/tty to 
   mode 0666 and report the error as a bug to your OS vendor.

<p>
<li><strong>Portable OpenSSH: 'configure' missing or make fails</strong><p>

	If there is no 'configure' file in the tar.gz file that you downloaded
	or <em>make</em> fails with "missing separator" errors, you have 
	probably downloaded the OpenBSD distribution of OpenSSH and are 
	attempting to compile it on another platform. Please refer to the 
	information on the <a href="portable.html">portable</a> version.

<p>
<li><strong>As an American, I am very confused about the patent issues.
	</strong><p>

	OpenSSH provides support for both SSH1 and SSH2 protocols.
	<p>
	SSH1 protocol uses the RSA algorithm, which was under patent till
	September 21, 2000 inside the USA.  Outside the USA, none of these
	issues ever applied.
	<p>
	The SSH2 protocol uses DH and DSA, two other algorithms which
	have no nasty patent issues.  If you avoid use of the SSH1 protocol,
	and use only the SSH2 protocol, you have nothing to worry about.
	However, you will need to find SSH2-compatible clients and servers
	for your other machines.
	<p>
	Since the RSA patent has expired, there are no restrictions on the
	use of RSA algorithm using software, including OpenBSD.

</ol>
<p>

<hr>
<a href=index.html><img height=24 width=24 src=back.gif border=0 alt=OpenSSH></a>
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br>
<small>$OpenBSD: faq.html,v 1.24 2001/01/27 19:18:38 markus Exp $</small>

</body>
</html>
