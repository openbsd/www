<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="document">
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<meta name="description"   content="the OpenSSH FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 1999-2004 OpenBSD">
<title>OpenSSH FAQ</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238E">
<img alt="[OpenSSH]" height="30" width="141" src="../images/smalltitle.gif">
<p>

<h1>OpenSSH FAQ (よくある質問と答え)</h1>

<strong>Date: 2004/02/27</strong>

<hr>


<blockquote>
<h3><a href="#1.0">1.0 - OpenSSH ってなに? どこで手に入るの?</a></h3>
	<ul>
	<li><a href="#1.1">1.1 - OpenSSH ってなに?</a>
	<li><a href="#1.2">1.2 - OpenSSH を使うと何がうれしいの?</a>
	<li><a href="#1.3">1.3 - どんなオペレーティングシステムに対応しているの?</a>
	<li><a href="#1.4">1.4 - 著作権や取り扱い、特許についてはどうなってるの?</a>
	<li><a href="#1.5">1.5 - 困ったらどこに質問すればいい?</a>
	</ul>
<h3><a href="#2.0">2.0 - 一般的な質問</a></h3>
	<ul>
	<li><a href="#2.1">2.1 - なぜ ssh/scp は小さい番号のポートからコネクションを張ろうとするの。ファイヤウォールにはねられるんだけど。</a>
	<li><a href="#2.2">2.2 - なんで ssh クライアントは setuid root されているの?</a>
	<li><a href="#2.3">2.3 - なぜ SSH 2.3 は OpenSSH 2.1.1 と相互運用するときに問題が生じるの?</a>
	<li><a href="#2.4">2.4 - OpenSSH で「Dispatch protocol error: type 20」と怒られた。なぜ?</a>
	<li><a href="#2.5">2.5 - 古いバージョンの商用 SSH では、ホスト鍵を IDEA で暗号化してるんだけど。</a>
	<li><a href="#2.6">2.6 - キーの長さで警告メッセージが出る。</a>
	<li><a href="#2.7">2.7 - X11 転送やエージェント転送がきかない。</a>
	<li><a href="#2.8">2.8 - OpenSSH をアップグレードしたら、SSH2 が使えなくなった。</a>
	<li><a href="#2.9">2.9 - ssh は問題ないのに、sftp/scp が接続に失敗する。</a>
	<li><a href="#2.10">2.10 - scp に (なにかの機能) を追加してくれない?</a>
	</ul>
<h3><a href="#3.0">3.0 - 移植版 OpenSSH に関する質問</a></h3>
	<ul>
	<li><a href="#3.1">3.1 - 偽の PAM 認証メッセージがログに残るんだけど。</a>
	<li><a href="#3.2">3.2 - PAM 認証では、空のパスワードは許されないの?</a>
	<li><a href="#3.3">3.3 - Linux/glibc 2.1 で、 ssh(1) が接続するのに時間がかかる。</a>
	<li><a href="#3.4">3.4 - Linux で、ログに "Can't locate module net-pf-10" というメッセージが残るんだけど。</a>
	<li><a href="#3.5">3.5 - Slackware 7.0 で、パスワード認証がうまくいかない。</a>
	<li><a href="#3.6">3.6 - Configure や sshd に、 RSA あるいは DSA がサポートされていない、と文句を言われるんだけど。</a>
	<li><a href="#3.7">3.7 - "scp: command not found" エラーがでる。</a>
	<li><a href="#3.8">3.8 - パスフレーズが入力できない。</a>
	<li><a href="#3.9">3.9 - 'configure' がない、あるいは make に失敗する。</a>
	<li><a href="#3.10">3.10 - ssh が終了時に固まって(ハングして)しまう。</a>
	<li><a href="#3.11">3.11 - なぜ ssh は終了時に固まる(ハングする)の?</a>
	<li><a href="#3.12">3.12 - OpenSSH 3.1 にアップグレードしたら、X11 転送が効かなくなった。</a>
	</ul>
</blockquote>

<hr>

<h2><u><a name="1.0">1.0 - OpenSSH ってなに? どこで手に入るの?</a></u></h2>

<h2><a name="1.1">1.1 - OpenSSH ってなに?</a></h2>

<p>
OpenSSH は、ネットワーク接続ツールである SSH プロトコルを
<b>フリーで</b> 実装したものです。OpenSSH は
インターネット上の多くの人々にますます信頼されるようになってきています。
Telnet, rlogin, ftp などのプログラムを使っている多くのユーザは、
自分のパスワードがネット上を暗号化されないままで流れていることに
気づいていないかもしれません。でも、実際にはそうなんです。
OpenSSH は (パスワードを含む) すべての通信を暗号化し、
盗聴や接続ハイジャック、およびその他の
ネットワークレベルの攻撃を効率よく排除します。

<p>
OpenSSH 一式は、以下のものを含んでいます。
rlogin および telnet に代わる
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a>
プログラムと、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a>、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rcp&amp;sektion=1">rcp(1)</a>
に代わる
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=scp&amp;sektion=1">scp(1)</a>。
最近では
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sftp&amp;sektion=1">sftp(1)</a>
と
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sftp-server&amp;sektion=8">sftp-server(8)</a>
が OpenSSH に加わりました。これはより簡単にファイル転送を行う
機構を提供するもので、 IETF ドラフト
<a href="../txt/draft-ietf-secsh-filexfer-02.txt">secsh-filexfer (英語)</a>
に基づいています。

<p><strong>OpenSSH はいくつものプログラムからなっています。</strong>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a> -
これはサーバマシン上で動く
サーバプログラムです。クライアントマシンからの接続を待ち、
接続されると認証を行ってクライアントにサービスします。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a> - 
別のマシンにログインしたり、
別のマシン上でコマンドを実行するのに使うクライアントプログラムです。
<i>slogin</i> はこのプログラムの別名です。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=scp&amp;sektion=1">scp(1)</a> - 
あるマシンから別のマシン上へ安全にファイルをコピーします。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keygen&amp;sektion=1">ssh-keygen(1)</a> - 
公開鍵認証 (RSA または DSA 認証) 用の鍵を (ホスト鍵およびユーザ鍵ともに)
作成するのに使います。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-agent&amp;sektion=1">ssh-agent(1)</a> - 
認証エージェントです。RSA 認証用の鍵を保持させるのに使います。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-add&amp;sektion=1">ssh-add(1)</a> - 
認証エージェントに新しい鍵を記憶させるときに使います。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sftp-server&amp;sektion=8">sftp-server(8)</a> - 
SFTP サーバサブシステムです。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sftp&amp;sektion=1">sftp(1)</a> - 
安全なファイル転送プログラムです。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keyscan&amp;sektion=1">ssh-keyscan(1)</a> - 
ssh 用の公開鍵を集めます。
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keysign&amp;sektion=8">ssh-keysign(8)</a> -
ssh でホストベース認証を使うための補助プログラムです。
</ul>

<h2><a name="1.2">1.2 - OpenSSH を使うと何がうれしいの?</a></h2>

<p>
OpenSSH は、安全なネットワーク接続を支援する
ツールの一式で、以下のような機能をもっています:

<ul>
<li>強力な認証。いくつものセキュリティーホール
(IP アドレス偽装、転送経路の偽装、および DNS 偽装など) を塞ぎます。
<li>プライバシーの改善。すべての通信は自動的かつ透過的に暗号化されます。
<li>安全な X11 のセッション。サーバマシン上では DISPLAY が自動的に
設定され、X11 接続は安全な経路を通して転送されます。
<li>どちらの方向からも任意の TCP/IP ポートを、
(たとえば e-cash のトランザクション用などに) 
暗号化された経路に振り向けることができます。
<li>一般ユーザが新しく覚え直すことはありません。
<li>OpenSSH は、ネットワークというものをまったく信用していません。
リモート側の接続を信用するのは最小限にとどめています。
ドメイン・ネーム・サーバを信用するのも最小限にとどめています。
純粋な RSA 認証では秘密鍵以外は一切信用していません。
<li>(経路偽装や DNS 偽装による) なりすましやトロイの木馬を防ぐため、
クライアントは毎回の接続ごとにサーバマシンを RSA 認証します。
またサーバ側も <i>.rhosts</i> や <i>/etc/hosts.equiv</i> 認証を
行う前にクライアント側を RSA 認証します。 (経路偽装、DNS偽装、
および IP アドレス偽装を防ぐためです。)
<li>各ホストの認証鍵は、そのホストへ最初に接続したときに
自動的に収集され、一括管理されます。
<li>ユーザはだれでも自分で使用する RSA 認証鍵を好きなだけ
作ることができます。
<li>サーバプログラムはそれ自身のサーバ RSA 鍵をもっており、
これは毎時間ごとに自動的に作り直されます。
<li>ユーザはノートパソコンやローカルなマシン上で
認証エージェントを走らせることができます。これはユーザの
RSA 認証鍵を保持させるのに使います。
<li>このソフトウエアは (限られた機能ならば) root 権限なしでも
インストールして使うことができます。
<li>クライアントはカスタマイズ可能であり、
システム全体における設定と、各ユーザごとの設定ファイルが使えます。
<li>オプションとして、転送するデータを gzip で圧縮することが
できます (X11転送や TCP/IP ポート転送を含む)。これは
遅いネットワーク接続で飛躍的なスピードアップをもたらします。
<li>rlogin, rsh そして rcp は完全に OpenSSH で置きかえることが
できます。
</ul>

<p>
現在、コンピュータネットワークにおけるほとんどの通信は
暗号化されていません。その結果、あるネットワークに接続されている
マシンのどれかにアクセスできる人物は誰でもその通信を盗聴できて
しまいます。これはクラッカーや、詮策好きな管理者や、雇用者、
犯罪者、産業スパイ、そして政府などによって行われていることです。
ネットワークによっては、遠距離からでも十分盗聴できてしまうような
電磁波を放射していることもあります。

<p>
あなたがログインするとき、あなたが入力したパスワードはそのままの
形でネットワーク上を流れます。よって、盗聴者は誰でもあなたの
アカウントを使って悪いことがなんでもできてしまいます。
このような事件は世界中で多く起きています。知識がない所有者の
ワークステーション上で、クラッカーがネットワークを盗聴し
パスワードを収集するプログラムを走らせているのです。
このようなプログラムはインターネット上で手に入りますし、
有能なプログラマなら数時間で作ることができるものです。

<p>
ビジネスの世界ではさまざまな秘密があります。取り引き上の機密や
準備段階の特許、価格情報や下請けの情報、顧客情報に人事データ、
財務情報などなど。現在、ネットワーク (そのネットワーク上のいずれかの
マシン) にアクセスできる人間は、誰でもそのネットワークに流れる
データを盗聴できます。通常のアクセス制限に関係なくです。

<p>
多くの企業は、情報がこのように、いとも簡単にネットワークから
復元できてしまうということに気づいていません。彼らは自分たちのデータが
安全であると信じています。なぜなら誰もそんな重要な情報が
ネットワーク上を流れているとは知らないだろうし、あるいはネットワーク上には
それ以外のデータだって大量に流れていると思っているからです。
これは、安全な考え方とはいえません。

<h2><a name="1.3">1.3 - どんなオペレーティングシステムに対応しているの?</a></h2>

<p>
OpenSSH は <a href="http://www.openbsd.org/ja/">OpenBSD</a> 用に
開発されたにもかかわず、実に多様なオペレーティングシステム用の
移植版が存在しています。移植版の OpenSSH は
<a href="mailto:djm@openbsd.org">Damien
Miller</a> によって開発が統括されています。移植版 OpenSSH についての
簡単な概要は
<a href="./portable.html">http://www.openssh.com/portable.html</a> を
見てください。現在サポートされている OS の一覧は以下のとおりです:

<ul>
	<li>OpenBSD
	<li>NetBSD
	<li>FreeBSD
	<li>AIX 
	<li>HP-UX 
	<li>IRIX 
	<li>Linux 
	<li>NeXT 
	<li>SCO 
	<li>SNI/Reliant Unix 
	<li>Solaris 
	<li>Digital Unix/Tru64/OSF 
	<li>Mac OS X 
</ul>

<p>
OpenSSH をディストリビューションに含んでいるベンダーの一覧は、
<a href="./users.html">www.openssh.com/users.html</a> にあります。


<h2><a name="1.4">1.4 - 著作権や取り扱い、特許についてはどうなってるの?</a></h2>

<p>
OpenSSH の開発者たちは、OpenSSH をいかなる特許や著作権問題からも
自由でありつづけるようにするために、多大な努力を払ってきました。
このため、いくつかのオプション、特許のあるアルゴリズムを
使うためのオプションは、OpenSSH から削除されています。

<p>
OpenSSH は特許のある転送アルゴリズムはまったくサポートしていません。
SSH1 モードでは、3DES および Blowfish だけが使用可能なオプションです。
SSH2 モードでは、3DES, Blowfish, CAST128, Arcfour および AES を
選ぶことができます。特許がある IDEA アルゴリズムはサポートされていません。

<p>
OpenSSH は SSH1 および SSH2 両方のプロトコルをサポートしています。

<p>
RSA の特許が切れたので、RSA アルゴリズムを使った
ソフトウエアを使用するのはもうまったく問題がなくなりました。
OpenSSH も含めて。

<h2><a name="1.5">1.5 - 困ったらどこで質問すればいい?</a></h2>

<p>
助けを得るための場所はたくさんあります。
OpenSSH ウェブサイト: 
<a href="http://www.openssh.com">http://www.openssh.com</a> のほかにも、
参加する価値のあるメーリングリスト(英語)が沢山あります。しかし
どのメーリングリストで尋く前にも、まずすべてのメーリングリストで
アーカイブを探してみてください。あなたの質問は、すでに誰かが
答えているかもしれません。OpenSSH のメーリングリストは
アーカイブに収集されており、それらは検索できるような形で
<a href="http://marc.theaimsgroup.com/?l=openssh-unix-dev&amp;r=1&amp;w=2">theaimsgroup.com (英語)</a> に記録されています。

<p>
OpenSSH 関連のメーリングリストに参加するための
より詳しい情報については <a href="./list.html">www.openssh.com/list.html</a>
を見てください。

<h2><u><a name="2.0">2.0 - 一般的な質問</a></u></h2>

<h2><a name="2.1">2.1 - なぜ ssh/scp は小さい番号のポートからコネクションを張ろうとするの。ファイヤウォールにはねられるんだけど。</a></h2>

<p>
Rhosts 認証や rhosts-RSA 認証を使う場合、OpenSSH クライアントは
小さい (1024未満の) 番号のポートを使います。
これはサーバがクライアントによって送られてきたユーザ名を信用する
必要があるからです。小さい番号のポートを使わないようにするには、
<i>ssh_config</i> か <i>~/.ssh/config</i> に以下の行を追加してください:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>UsePrivilegedPort no</b>
                </td>
        </tr>
</table>
</blockquote>

<p>
あるいは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a>
のコマンドラインに
<b>-o</b> オプションをくわえてもいいでしょう:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
$ <b>ssh -o "UsePrivilegedPort no" host.com</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.2">2.2 - なんで ssh クライアントは setuid root されているの?</a></h2>

<p>
前の質問 (<a href="#2.1">2.1</a>) と関連することですが、
OpenSSH は <i>rhosts 認証</i> を使うときに特権ポート (1024番未満のポート) を
bind する必要があります。このため root 権限が必要なのです。
特権ポートはまた、古い SSH リリースで
rhosts-rsa 認証を使うときにも必要です。

<p>
加えて <i>rhosts-rsa 認証</i> (プロトコル バージョン 1) や
<i>hostbased 認証</i> (プロトコル バージョン 2) を使うさいには、
ssh クライアントはサーバに対して自分のマシンを認証するため
<i>ホスト秘密鍵</i> にアクセスする必要があります。
<p>
OpenSSH バージョン 3.3 以前は、これを利用するためには
<code>ssh</code> 実行ファイルに setuid ビットが必要でした。
これらの認証方法を使わないのなら setuid ビットはなくても問題ありません。

<p>
OpenSSH バージョン 3.3 から、<code>ssh</code> はデフォルトでは
setuid されなくなりました。特権を必要とするホスト鍵の読み込みには
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keysign">ssh-keysign</a> が使われ、
<code>ssh</code> はデフォルトでは特権ポートを送信元として使わないようになりました。
現在では特権ポートを送信元として使いたい場合、手で <code>ssh</code> を
setuid する必要があります。

<h2><a name="2.3">2.3 - なぜ SSH 2.3 は OpenSSH 2.1.1 と相互運用するときに問題が生じるの?</a></h2>

<p>
SSH 2.3 およびそれ以前のバージョンは、HMAC の実装に欠陥が
あるのです。これらのコードはダイジェストからのデータブロックを
フルで渡さずに、いつも 128ビットを渡しています。もっと長い
ダイジェストでは、SSH 2.3 では OpenSSH と相互運用できなくなって
しまいます。

<p>
OpenSSH 2.2.0 は SSH 2.3 がこの欠陥を持っていることを検出します。
このバグは、SSH の最近のバージョンでは直っています。
あるいは、SSH 2.3 の <i>sshd2_config</i> にこう加えることでも
対処できます:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>Mac hmac-md5</b>
               </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.4">2.4 - OpenSSH で「Dispatch protocol error: type 20」と怒られた。なぜ?</a></h2>

<p>
このような相互運用の問題が起こるのは、古いバージョンの OpenSSH が
rekeying をサポートしていないためです。
しかし 商用 SSH 2.3 はこの機能を使おうとするので、
接続が止まってしまったり、
&quot;<b>Dispatch protocol error: type 20</b>&quot;
というエラーメッセージが表示されるという経験をお持ちかもしれません。
この問題を解決するには、最近の OpenSSH リリースにアップグレードするか、
商用 SSH 2.3 の <i>sshd_config</i> にrekeying を禁止する以下の行を
追加します:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>RekeyIntervalSeconds 0</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.5">2.5 - 古いバージョンの商用 SSH では、ホスト鍵を IDEA で暗号化してるんだけど。</a></h2>

<p>
古いバージョンの SSH では <i>/etc/ssh/ssh_host_key</i> を
暗号化するのに特許のあるアルゴリズムを使っています。これにより
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a> 
でホスト鍵が読めないという問題が発生します。これを解決するには、
以下のコマンドでお使いの ssh_host_key を、3DES を使用したものに
変換します。
<b>注意:</b> 
商用 SSH の
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keygen&amp;sektion=1">ssh-keygen(1)</a>
プログラムを使ってください。以下の例は OpenSSH 用では *ありません*。

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
# <b>ssh-keygen -u -f /etc/ssh/ssh_host_key</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.6">2.6 - キーの長さで警告メッセージが出る。</a></h2>

<p>
商用 SSH の
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-keygen&amp;sektion=1">ssh-keygen(1)</a>
プログラムにはバグがあって、
ときどき Most Significant Bit (MSB) がセットされていない
Pubkey (RSA または DSA) 認証鍵を生成してしまいます。
こういう鍵は、フルの長さを持っているかのように見せかけられてはいますが、
実際には公称の長さよりも半分短くなっています。

<p>
OpenSSH はこういった鍵を見つけると警告メッセージを出力します。
これが出ないようにするには、自分の known_hosts ファイルを
編集して、違っている鍵の長さ (ふつうは "1024") を正しい長さ
(ふつうは "1023") に直します。

<h2><a name="2.7">2.7 - X11 転送やエージェント転送がきかない。</a></h2>

<p>
<I>ssh_config</I> と <I>sshd_config</I> を確認してください。
デフォルトの設定ファイルでは、認証エージェントや X11 の
転送は禁止されています。これを許可するには、
まず以下の行を<i>sshd_config</i>に加えます:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>X11Forwarding yes</b>
                </td>
        </tr>
</table>
</blockquote>

<p>
次に、以下の行を<i>ssh_config</i>のほうに加えます:

<blockquote>
<table border="0" width="800">
       <tr>
               <td nowrap bgcolor="#EEEEEE">
<b>ForwardAgent yes</b><br>
<b>ForwardX11 yes</b>
               </td>
       </tr>
</table>
</blockquote>

<p>
<b>注意:</b>
Linux Mandrake 7.2 のユーザへ。
Mandrake では <i>/etc/skel/.bashrc</i> 内で
<i>XAUTHORITY</i> 環境変数を変更してから bash ユーザの
ホームディレクトリを変更します。でもこの変数は OpenSSH が
使用するので、上のオプションがうまく動作するためには以下の行を
コメントアウトする必要があります:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b># export XAUTHORITY=$HOME/.Xauthority</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.8">2.8 - OpenSSH をアップグレードしたら、SSH2 が使えなくなった。</a></h2>

<p>
このバージョンアップのとき、デフォルトの <i>sshd_config</i> や
<i>ssh_config</i> も変更されたからです。OpenSSH のバージョンを
アップグレードしたときは、必ずこれらの設定ファイルの違いも
チェックするようにしてください。OpenSSH 2.3.0 以降では、
次の項目を <i>sshd_config</i> に追加する必要があります。

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>HostKey /etc/ssh_host_dsa_key</b><br>
<b>HostKey /etc/ssh_host_rsa_key</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="2.9">2.9 - ssh は問題ないのに、sftp/scp が接続に失敗する。</a></h2>

<p>
シェルの初期化ファイル (.profile, .bashrc, .chsrc など) が、
対話的でないセッションのときに何か出力すると
sftp や scp は失敗します。このような出力は sftp/scp クライアントを
混乱させてしまうのです (訳注: sftp や scp はファイルの受け渡しに
標準入出力を使っているため)。お使いのシェルがそうなっているか
どうかは、以下のコマンドを実行することで確かめることができます:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<b>ssh yourhost /usr/bin/true</b>
                </td>
        </tr>
</table>
</blockquote>

<p>
もし上のコマンドを実行してみて何らかの出力がされるようなら、
お使いのシェルの初期化ファイルを修正する必要があります。

<h2><a name= "2.10">2.10 - scp に (なにかの機能) を追加してくれない?</a></h2>

<p>
短い答え: だめです。

<p>
長めの答え: scp は標準化されていないのです。それにもっとも近いものは「rcp が何をやるか」という
仕様だけです。これは接続の両側で同じコマンドが使われるため、機能やオプションを追加すると
異なる実装の間で相互運用できなくなる危険性があります。

<p>

新しい機能は sftp のほうが追加されやすいでしょう。なぜならこのプロトコルは
標準化されていますし (まあ、
<a href="http://www.ietf.org/internet-drafts/draft-ietf-secsh-filexfer-05.txt">ドラフト標準</a>ですが)、
クライアントとサーバが別々になっているからです。

<h2><a name="3.0"><u>3.0 - 移植版 OpenSSH に関する質問</u></a></h2>

<h2><a name="3.1">3.1 - 偽の PAM 認証メッセージがログに残るんだけど。</a></h2>

<p>
移植版 OpenSSH は、ログインするたびに偽の認証失敗メッセージを
生成します。たとえばこんな感じです:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
&quot;<b>authentication failure; (uid=0) -&gt; root for sshd service</b>&quot;
                </td>
        </tr>
</table>
</blockquote>

<p>
これは OpenSSH が、まずそのユーザのログインに認証が必要かどうかを
調べるためです (例: パスワードをつけていないなど)。不幸にも
PAM は認証関係のイベントをとにかくぜんぶ残したがるので、
これもそのひとつです。

<p>
もし、これがかなりイラつくようなら <i>sshd_config</i> で
&quot;<b>PermitEmptyPasswords no</b>&quot; を指定してください。
これでエラーは出なくなりますが、かわりにパスワードが設定されていない
アカウントではログインできなくなります。OpenSSH に付属の
<i>sshd_config</i> を使っている場合、これはデフォルトになっています。

<h2><a name="3.2">3.2 - PAM 認証では、空のパスワードは許されないの?</a></h2>

<p>
PAM つきで作成した OpenSSH のバージョンで、空のパスワードを
許可するには、<I>/etc/pam.d/sshd</I> ファイルにある
パスワード検査モジュールの最後に nullok フラグを追加する
必要があります。たとえば:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
auth required/lib/security/pam_unix.so shadow nodelay nullok
                </td>
        </tr>
</table>
</blockquote>

<p>
これに加えて、<I>sshd_config</I> ファイルで
&quot;<B>PermitEmptyPasswords yes</B>&quot;
を指定しておかなければいけません。

<p>
PAM 認証で空のパスワードを使うときに、ひとつ注意しておくことが
あります:
パスワードが空の場合、PAM は <U>どんな</U> パスワードでも
認証を通してしまいます。これは、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a>
がこのアカウントに
パスワード設定がついているかどうか調べるチェックを突破してしまい、
<B>PermitEmptyPasswords</B> で指定されているポリシーにかかわらず
そのアカウントにアクセスしてきたユーザすべてを通してしまうことに
なります。
このため、PAM の設定ファイルに <B>nullok</B> 指令を
つけ加えるのはやめたほうがいいでしょう。
空のパスワードを通したいという特別な理由がないかぎり。

<h2><a name="3.3">3.3 - Linux/glibc 2.1 で、 ssh(1) が接続するのに時間がかかる。</a></h2>

<p>
Redhat 6.1 に付いている glibc は、ドメイン名から
"IPv6 あるいは IPv4 の" アドレスを解決するのに時間がかかります。
これは configure オプションに <B>--with-ipv4-default</B> を
つけることで、とりあえずはしのぐことができます。
こうすると OpenSSH は
IPv4 のアドレス解決のみを行うようになります (この状態でも、
-6 オプションを指定すれば IPv6 のアドレス解決は使えます)。

<h2><a name="3.4">3.4 - Linux で、ログに "Can't locate module net-pf-10" というメッセージが残るんだけど。</a></h2>

<p>
Linux カーネルは (modprobe を介して) 
プロトコルファミリー 10 (IPv6) を使うモジュールを検索します。
適切なカーネルモジュールを読み込むか、 <I>/etc/modules.conf</I> に
正しい alias を入力するか、あるいは <I>/etc/modules.conf</I> で
IPv6 を禁止するかのいずれかを行ってください。

<p>
いくつかのおバカな理由により、 <I>/etc/modules.conf</I> は
<I>/etc/conf.modules</I> という名前になっていることもあり得ます。

<h2><a name="3.5">3.5 - Slackware 7.0 で、パスワード認証がうまくいかない。</a></h2>

<p>
Slackware 7.0 では、OpenSSH を libcrypt とリンクする必要があります:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
LIBS=-lcrypt ./configure [options]
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="3.6">3.6 - Configure や sshd に、 RSA あるいは DSA がサポートされていない、と文句を言われるんだけど。</a></h2>

<p>
OpenSSL が内部で、あるいは RSAref 経由で RSA あるいは DSA を
サポートした状態で作成されていることを確認してください。

<h2><a name="3.7">3.7 - "scp: command not found" エラーがでる。</a></h2>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=scp&amp;sektion=1">scp(1)</a>
は、クライアント側、サーバ側の両方でデフォルトの PATH に含まれている
必要があります。場合によっては、(Configure 時に)
<B>--with-default-path</B> オプションを使ってサーバが scp を探す
カスタムパスを指定する必要があるかもしれません。
このオプションはデフォルトのパスを置き換えるので、scp が
インストールされるディレクトリも含めて、現在のすべての
パスを指定する必要があります。たとえば:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
$ <b>./configure --with-default-path=/bin:/usr/bin:/usr/local/bin:/path/to/scp</b>
                </td>
        </tr>
</table>
</blockquote>

<h2><a name="3.8">3.8 - パスフレーズが入力できない。</a></h2>

<p>
オペレーティングシステムによっては、<i>/dev/tty</i> が不適切な
モードに設定されています。このためパスワードの読み取りが失敗し、
以下のようなエラーが出ることがあります:

<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
You have no controlling tty.  Cannot read passphrase.<br>
(制御できる tty がありません。パスフレーズが読み取れません。)
                </td>
        </tr>
</table>
</blockquote>

<p>
これに対する解決法は、まず <i>/dev/tty</i> のパーミッションを 0666 に
設定しなおして、つぎにお使いの OS ベンダーにこのエラーをバグとして
報告することです。

<h2><a name="3.9">3.9 - 'configure' がない、あるいは make に失敗する。</a></h2>

<p>
ダウンロードした tar.gz ファイル中に「configure」ファイルがなかったり、
あるいは "missing separator" エラーが出て make できなかったりした
場合は、おそらく OpenBSD 用の OpenSSH を別のプラットフォーム上で
コンパイルしようとしたためでしょう。そのような場合は、
<a href="./portable.html">移植版 リリース</a> の情報を見てください。

<h2><a name="3.10">3.10 - ssh が終了時に固まって(ハングして)しまう。</a></h2>

<p>
OpenSSH では、終了時に固まってしまうことがあります。
これはバックグラウンドでアクティブなプロセスが走っているときに
起こることがあり、今のところ Linux と HP-UX 上で発生することが
知られています。これが発生するかどうかは、次のコマンドを
実行させて確かめることができます:

<blockquote>
<table border="0" width="800">
	<tr>
		<td nowrap bgcolor="#EEEEEE">
$ <b>sleep 20 &amp; exit</b>
		</td>
	</tr>
</table>
</blockquote>

このようなことが起こる場合は、次のようにして対処してください:
<blockquote>
<table border="0" width="800">
	<tr>
		<td nowrap bgcolor="#EEEEEE">
$ <b> sleep 20 &lt; /dev/null &gt; /dev/null 2&gt;&amp;1</b>
		</td>
	</tr>
</table>
</blockquote>

<p>
Bash ユーザなら、/etc/bashrc か ~/.bashrc のどちらかに
つぎの一行 <b>「shopt -s huponexit」</b>を入れておくことで
問題を解決できます。それ以外の方はお使いのシェルのマニュアルを参照して、
アクティブなジョブが終了するときに HUP シグナルを発行するようなオプションを
設定してください。

<h2><a name="3.11">3.11 - なぜ ssh は終了時に固まる(ハングする)の?</a></h2>

<p>
<blockquote>
<table border="0" width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
$ <b>ssh host command</b>
                </td>
        </tr>
</table>
</blockquote>
を実行したとき、ssh はハングする <b>必要があります</b>。
なぜなら ssh は以下のことを待つ必要があるからです:
<ul>
<li>
その <code>command</code> がこれ以上入力を必要としないと確信できること。
<li>
その <code>command</code> がこれ以上なにも出力しないと確信できること。
<li>
その <code>command</code> が終了すること。
なぜなら sshd はその <code>command</code> の終了状態を
ssh に送らなければいけないからです。
</ul>
<p>

<h2><a name="3.12">3.12 - OpenSSH 3.1 にアップグレードしたら、
X11 転送が効かなくなった。</a></h2>

OpenSSH 3.1 以降、sshd の X11 転送サーバはデフォルトで
localhost のみを listen する (訳注: localhost からの接続しか受けつけない)
ようになりました。もしこの設定で古い X11 クライアントが動かず、
以前のふるまいに戻したければ、sshd の <b>X11UseLocalhost</b>
オプションを見てください。<p>

一般的に X11 R6 を使っている X11 クライアントは、
このデフォルトの設定で動くはずです。HP を含むいくつかのベンダは
X11 クライアントを R6 および R5 のライブラリとともに出荷しています。
なのでいくつかのクライアントは動くが、別のクライアントは
動かないといった事態が発生します。この現象は HP-UX 11.X で起こります。<p>

<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenSSH"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq.html,v 1.61 ]
<br>
$Translation: faq.html,v 1.29 2004/03/02 06:34:35 euske Exp $
<br>
</small>
<small>$OpenBSD: faq.html,v 1.30 2004/03/02 14:06:14 jufi Exp $</small>
</body>
</html>
