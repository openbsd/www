<!DOCTYPE HTML PUBLIC  "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>CTM</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD/CTM page">
<meta name="keywords" content="openbsd,ctm">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-2004 by OpenBSD.">
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">

<center>
<img alt="CTM pro OpenBSD" src="../images/bsdctm.gif" width="401" height="126">
</center>

<h3><font color="#0000e0">Co je CTM?</font></h3>

<p>
CTM je systém navr¾ený Poul-Henning Kampem, který slou¾í
ke zveøejòování zmìn v source tree pomocí pravidelnì posílaných mailù.
Je to dobrý zpùsob, jak mít aktualní source tree nebo CVS repository,
pokud máte pomalé pøipojení k Internetu, napøíklad modemem.

<p>
OpenBSD CTM distribuuje v¹echny moduly z OpenBSD CVS repository
plus checkout verze nìkterých z tìchto modulù.
CTM potøebuje velmi nízkou pøenosovou rychlost k distribuci zmìn 
v source tree a komprimuje je pomocí <tt><b>gzip -9</b></tt>.
Na rozdíl od <a href="cvsup.html">CVSup</a>, CTM je napsáno
v prostém jazyku C, a je tedy dostupné na v¹ech platformách podporovaných
OpenBSD. CTM implementuje tzv. push system, zatímco ostatní metody slou¾ící
pro pøístup do OpenBSD CVS repository jsou tzv. pull systémy.

<p>
S <b>jakýmkoliv</b> problémem, návrhem, oznámením nebo otázkou ohlednì
CTM se obra»te na správce CTM,
<a href="mailto:hgw@d1906.inka.de">Hanse G&amp;uuml;nter Weiganda</a>.
<small>(Neptejte se, prosím, ostatních lidí z OpenBSD na vìci týkající
se CTM, proto¾e jsou velmi zaneprázdnìni jinými vìcmi. Dìkujeme.)</small>

<h3><font color="#0000e0">Jak to funguje?</font></h3>


<p>
Základní my¹lenkou CTM je, ¾e se pøihlásíte do speciální mailové konference
pro konkrétní CVS modul nebo source tree. Ka¾dý den obdr¾íte email obsahující 
v¹echny zmìny v tomto source tree za daný den. Jedna sada takových zmìn se nazývá
<b>delta</b>. CTM server generuje nové delty ka¾dých dvanáct hodin.

<p>
Zaènete se základní sadou, proti ní¾ jsou následující delty patchovány.
Kdy¾ zaènete pou¾ívat CTM, stáhnete si poslední základní sadu a v¹echny
následující delty. Jakmile je aplikujete, mù¾ete aplikovat dal¹í
delty, které obdr¾íte z konference. Základní sady jsou rozdìleny
do èástí po 1400kB, aby se usnadnilo stahování na nekvalitních linkách.

<p>
Základní sady jsou generovány po ka¾dých 50 deltách, tak¾e nemusíte
nikdy stahovat více ne¾ 50 delt, kdy¾ se zapojíte do CTM.

<p>
V souèasnosti existují dva typy souborù základních sad. Nìjakou dobu jsme
ruènì dìlali soubory <tt><b>tar.gz</b></tt>, ale vracíme se zpìt
ke skuteèným CTM deltám. Ty obsahují
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=md5&amp;sektion=1">md5(1)</a>
checksumy a jsou generovány automaticky, tudí¾ jsou trochu jistìj¹í.
Tyto dva typy souborù poznáte podle jejich názvu. Pøikladem souboru
<tt><b>tar.gz</b></tt> je <tt><b>OpenBSD-cvs.1450.tar.gz</b></tt>,
zatímco CTM delta se jmenuje <tt><b>OpenBSD-cvs.1500A.gz</b></tt>.
Detailní instrukce najdete ní¾e.

<h3><font color="#0000e0">Jakou ¹íøku pásma CTM pou¾ívá?</font></h3>

<p>
Základní sady a v¹echny delty a¾ po souèasnou získáte pomocí
ftp z ní¾e uvedených stránek. Jejich velikosti jsou:

<ul>
<li>Pøibli¾nì 215MB pro OpenBSD-cvs.
<li>Pøibli¾nì 40MB pro OpenBSD-cvs-x11.
<li>Pøibli¾nì 65MB pro OpenBSD-cvs-xf4.
<li>Pøibli¾nì 83MB pro OpenBSD-src.
<li>Pøibli¾nì 36MB pro OpenBSD-src-x11.
<li>Pøibli¾nì 4MB pro OpenBSD-ports.
<br>Uvìdomte si, ¾e toto jsou velikosti komprimovaných souborù.  Nekomprimované soubory
    jsou pøibli¾nì pìtkrát vìt¹í.
<li>Relativní delty mívají 10kb a¾ 500kB a pøíle¾itostnì nìkolik megabajtù.
<li>CTM v¾dy rozdìlí delty do 100kB mailù, které jsou automaticky spojeny.
<li>Pokud je delta vìt¹í ne¾ 5MB není poslána mailem. Místo toho
    obdr¾íte upozornìní, abyste si ji stáhli pomocí ftp. Velké CTM aktualizace
    jsou výjimeèné, obvykle se vyskytnou pouze po velkém importu nìèeho jako
    binutils, perl, gcc, XFree86, atd. nebo aplikování CVS tagu na CVS repository.
</ul>

<h3><font color="#0000e0">Jak pou¾ívat CTM?</font></h3>

<UL>
<li>Pøihla¹te se do mailové konference CTM pro sadu zdrojových kódù, které chcete.
<p>
   Existuje nìkolik konferencí vztahujících se k CTM. Existuje konference
   pro aktualizaci CVS repository, konference pro source tree, konference pro
   X11 èást obojího, jedna pro ports tree plus konference pro logy z generování
   CTM delt.
   <p>
   Následující pøíkazy vás pøihlásí do pøíslu¹né konference:
<p>
Pro CVS repository (CVSROOT, ports, src a www moduly,
ale bez modulù X11 a XF4):
<pre>
	echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org
</pre>
Pro CVS repository modulu X11:
<pre>
	echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org
</pre>
Pro XF4 modul z CVS repository:
<pre>
       echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org
</pre>
Pro check out kopii src modulu: 
<pre>
	echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org
</pre>
Pro check out kopii X11 modulu:
<pre>
	echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org
</pre>
Pro check out kopii ports modulu:
<pre>
	echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org
</pre>
Pro logy CTM:
<pre>
	echo subscribe ctm-log | mail majordomo@OpenBSD.org
</pre>

<p>
<li>Nainstalujte program CTM z balíèku nebo z kolekce portù. Port najdete v
<tt><b>/usr/ports/devel/ctm</b></tt>.

</ul>
<b>Poznámka:</b> Následující pøíklady se pro jednoduchost zabývají pouze OpenBSD-cvs.
Ostatní sady zdrojových kódù se pou¾ívají stejnì.

<p><ul>

<li>Stáhnìte si základní sadu z FTP. Najdete je v podadresáøi 
<tt><b>base/OpenBSD-cvs</b></tt>. Stáhnìte v¹echny soubory
v tomto adresáøi. Jakmile je máte v¹echny, mù¾ete vytvoøit soubor
se základní sadou a rozbalit ho následujícími pøíkazy, podle toho
jaký typ souboru máte: 

<pre>
	cat split/OpenBSD-cvs.1500A.gz.* &amp;gt; OpenBSD-cvs.1500A.gz
	cd target
	ctm -v -v -v .../OpenBSD-cvs.1500A.gz
</pre>
<p>
nebo

<pre>
	cat split/OpenBSD-cvs.1450.tar.gz.* &amp;gt; OpenBSD-cvs.1450.tar.gz
	cd target
	tar -xzvf .../OpenBSD-cvs.1450.tar.gz
</pre>

<p>
kde <tt><b>split</b></tt> je adresáø, do kterého jste umístili sta¾ené soubory
a <tt><b>target</b></tt> je místo, které jste stanovili pro rozbalení sady 
zdrojových kódù.

<p> Není nutné schovat si soubory se základní sadou, pokud jste si jisti, ¾e 
máte kompletní adresáøovou strukturu. Mù¾e te je ale schovat jako zálohu. Nicménì
se ujistìte, ¾e jste si poznamenali èíslo základní sady, døíve ne¾ budete
pokraèovat.

<p>
<li>Nyní potøebujete získat delty, které byly vygenerovány od 
základní sady. Jdìte do podadresáøe <tt><b>OpenBSD-cvs</b></tt>
na jednom z FTP serverù uvedených ní¾e a stáhnìte v¹echny soubory, jejich¾ 
èíslo je <em>vìt¹í</em> ne¾ èíslo základní sady, které jste pou¾ili. 
Potom aplikujte tyto delty:

<pre>
	cd target
	ctm -v -v -v deltas/OpenBSD-cvs.*
</pre>

<p>
kde <tt><b>target</b></tt> je adresáø kde jsou rozbalené zdrojové kódy
a do <tt><b>deltas</b></tt> jste ulo¾ili delty.

<p>
<li>Poèkejte, dokud nezískáte první deltu z konference.
<p>
<li>Rozbalte, spojte a aplikujte CTM deltu pomocí <tt><b>ctm_rmail</b></tt>.
<p>

<pre>
	ctm_rmail -p /tmp -d deltas -b target folder
</pre>

<p>
kde <tt><b>folder</b></tt> je mail folder obsahující delta
maily.  Tím se dekódují CTM delty a ulo¾í se do adresáøe
<tt><b>deltas</b></tt>. Delta bude soubor tvaru
<tt><b>OpenBSD-cvs.<var>XXXX</var>.gz</b></tt>, kde <var>XXXX</var>
je èíslo delty.  Delta bude potom aplikována na adresáøovou strukturu umístìnou
v <tt><b>target</b></tt>, místì, do kterého jste rozbalili základní sadu.

<p>
Opakujte pøedchozí krok poka¾dé, kdy¾ obdr¾íte deltu z konference.
Pokud chcete, mù¾ete automatizovat tento krok pomocí procmailu, 
maildrop nebo podobného programu z <a href="ports.html">portù</a>.
</ul>

<p>
Zde je seznam FTP serverù poskytujících CTM delty:

<ul>
<li>Primární FTP server je na adrese:
<p>
<a href="ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/">
     ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/
</a>.
<p>
Tento server je automaticky aktualizován procesem generujícím CTM delty.
Základní sady jsou k dispozici jako jedny velké soubory
v adresáøi <tt><b>base</b></tt>.
Rozdìlené soubory jsou v <tt><b>base-split</b></tt>.
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
Tento server je aktualizován CTM deltami pøijatými z konference.
Navíc obsahuje rozdìlené základní delty v podadresáøi
<tt><b>base</b></tt>, který je mirrorován z 
<a href="ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/">
     ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/
</a>.
</ul>

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
je identický s
<p>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
je zrcadlem
<a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org
</a>
.
</ul>

<p>
<b>Poznámka:</b> Velice <a href="mailto:hgw@d1906.inka.de">mì</a> zajímá,
   jestli jsou nìjaké dal¹í servery ve svìtì, které by chtìly zrcadlit
   tyto delty.
<p>

<h3><font color="#0000e0">Mám si vybrat source tree nebo CVS repository?</font></h3>

<p>
Zále¾í na velikosti va¹eho disku, mimo jiné. Vzhledem
k tomu, ¾e CTM se pøíli¹ nezabývá tím, které soubory byly lokálnì zmìnìny,
"lep¹í" volbou je urèitì <a href="anoncvs.html">CVS</a>
repository. Mù¾ete zkontrolovat svou pracovní kopii source tree
z va¹eho CVS repository, mù¾ete sledovat stable branch, a ponechat své lokální 
modifikace ve svém source tree. CVS je dostateènì chytré na to, aby
se slouèilo s va¹imi lokálními zmìnami. Mù¾ete také pou¾ít
v¹echny CVS pøíkazy s výjimkou <tt><b>cvs commit</b></tt> a <tt><b>cvs tag</b></tt>. 

<p>
Nicménì vás asi odradí potøebné místo na disku. Sta¾ený source tree
zábírá kolem 370MB nebo tak nìjak, ale pokud máte vlastní CVS
repository, potøebujete na nìj více ne¾ 1Gb <b>plus</b> dal¹ích
370MB na source tree. V tom není zapoèítáno 100MB nebo víc (podle
architektury), které potøebujete pro vygenerované soubory nutné ke 
zkompilovaní zdrojových kódù.

<p>
Pokud máte pouze source tree, potøebujete nìjak zpracovat lokální
zmìny. Jedna z mo¾ností je pou¾ít <b>union</b> filesystém,
(viz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&amp;sektion=8">mount_union(8)</a>),
i kdy¾ byly zprávy, ¾e <b>union</b> filesystém mù¾e být
nestabilní, pokud horní i dolní vrstva spoèívá na stejném fyzickém
filesystému. Pokud umístíte horní i dolní vrstvu na oddìlené
filesystémy, nemìli byste mít problémy. Napøíklad:

<p>
Pøedpokládejme, ¾e vá¹ source tree aktualizovaný CTM je v
<tt><b>/usr/src-ctm</b></tt>, a vá¹ reálný source tree, ve kterém
dìláte zmìny a z kterého komplilujete, je v <tt><b>/usr/src</b></tt>.
<tt><b>/usr/src</b></tt> by zpoèátku mìl být prázdný. Následující pøíkaz
nastaví union mount:

<pre>
	mount -t union -o -b /usr/src-ctm /usr/src
<pre>

<p>
Zmìny provedené v souborech v <tt><b>/usr/src</b></tt> se stanou
soubory v <tt><b>/usr/src</b></tt>, skrývaje ty v <tt><b>src-ctm</b></tt>.
Pokud jsou pomocí CTM provedeny zmìny v <tt><b>src-ctm</b></tt>,
tyto zmìny <b>nebudou</b> vidìt, pokud existuje soubor v horní
vrstvì, který je zakryje.

<p>
Mìli byste periodicky odpojit union a hledat soubory,
které jsou lokální pro union filesystém.

<pre>
	umount /usr/src
	find /usr/src -type f
</pre>

<p>
Pøíkazy <tt><b>ls -W</b></tt> a <tt><b>rm -W</b></tt> budou také u¾iteèné,
nebo» objekty zvané "whiteouts" v <tt><b>/usr/src</b></tt> také zakryjí
soubory v <tt><b>src-ctm</b></tt>.

<p>
Pokud máte CVS repository, mù¾ete pou¾ít pøíkaz <tt><b>cvs checkout</b></tt>,
kterým získáte source tree z CVS. Poka¾dé, kdy¾ aktualizujete pomocí
CTM, mù¾ete pou¾ít pøíkaz <tt><b>cvs update</b></tt> k aktualizaci
svého source repository.

<p>
Prvotní src repository získáte pomocí:
<pre>
	cd /usr
	cvs -qd YOUR_CVS_REPOSITORY checkout -P src
</pre>
<p>
a po ka¾dé aktualizaci pøes CTM:
<pre>
	cd /usr/src
	cvs -q update -Pd
</pre>

<h3><font color="#0000e0">Jak stabilní je CTM pro OpenBSD?</font></h3>

CTM je v provozu více ne¾ ètyøi roky u OpenBSD a po je¹tì del¹í
dobu u FreeBSD. CTM je velmi spolehlivé a stabilní.

<h3><font color="#0000e0">Co èeká CTM v budoucnosti?</font></h3>

Je nìkolik mo¾ných (malých) zmìn a optimalizací.
Mezi nimi:

<ul>
<li> 
    CTM nikdy neposílá delty vìt¹í ne¾ 5MB mailem. To mù¾e být zmìnìno
    dvìma zpùsoby: Zvìt¹í se maximální velikost delty nebo se nainstaluje
    fronta, ze které bude dennì odesláno pouze urèité mno¾ství zpráv.
    Napø. pokud velikost delty je 6MB, rozdìlí se do 96 mailových zpráv.
    Ty jsou vlo¾eny do fronty. První den je posláno prvních 50 mailù,
    druhý den zbývajících 46 plus první 4 z následující delty.
<li> Software CTM by mìl být pøepsán nebo alespoò opraven lep¹ím
     zpùsobem. Implementace C není zrovna ukázkou dobrého programování.
     To by také byla dobrá pøíle¾itost k pøidání nových vlastností, jako
     podepisování CTM delt pomocí PGP.
</ul>

Mailujte <a href="mailto:hgw@d1906.inka.de">mi</a> va¹e návrhy a pøipomínky! 

<h3><font color="#0000e0">More information</font></h3>

Pokud se chcete dozvìdìt více o CTM, dobré místo pro zaèátek je
FreeBSD Handbook:

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

Existují také manuálové stránky pro v¹echny utility CTM.

<h3><font color="#0000e0">Shrnutí:</font></h3>

<p>

<ul>
<li> Mailové konference:

   <ul>
   <li><tt>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe ctm-log | mail majordomo@OpenBSD.org</tt>
   </ul>
<p>
<li> FTP (pro základní sady a relativní delty):

   <ul>
   <li> <a href="ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/">
        ftp://openbsd.rug.ac.be:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm</a>
   </ul>
</ul>

<p>
Dùle¾ité poznámky a oznámení o CTM budou poslány do
mailing listu announce@OpenBSD.org

<p>

<h3><font color="#0000e0">Podìkování</font></h3>

<ul>
<li> Poul-Henning Kampovi (phk@FreeBSD.org) za uskuteènìní CTM a pomoc pøi uvádìní
     generování delt do provozu

<li> Theo de Raadtovi (deraadt@theos.com) za uskuteènìní OpenBSD  a
     prvotní poskytnutí zdrojù k vytváøení CTM delt na cvs.OpenBSD.org
     (nyní jsou generovány jinde) a za magii s nameserverem

<li> Todd C. Millerovi (millert@OpenBSD.org) za vytvoøení a správu konferencí CTM

<li> Bob Beckovi (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmbergovi (mho@OpenBSD.org) a
     Wolfram Schneiderovi (wosch@FreeBSD.org) za ftp místo pro základní sady a delty
     na ctm.*OpenBSD.org

<li> Thomas Graichenovi (graichen@OpenBSD.org) za spu¹tìní CTM pro
     OpenBSD a administraci po ty v¹echny roky

<li> Wim Vandeputtovi (wvdputte@OpenBSD.org) za nynìj¹í hostování CTM 

<li> ... a v¹em dal¹ím, kteøí pøispìli nepøímo
</ul>


<p>
OpenBSD/CTM logo designed for the OpenBSD Project by 
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD" /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<br>
Originally [OpenBSD: ctm.html,v 1.26 ]
<br>
$Translation: ctm.html,v 1.12 2004/05/04 08:56:40 certik Exp $
<br>
$OpenBSD: ctm.html,v 1.11 2004/05/07 01:25:32 saad Exp $
</small>

</body>
</html>
