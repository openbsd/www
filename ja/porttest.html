<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-2022-JP">
    <meta name="resource-type" content="document">
    <meta name="description" content="The OpenBSD Port Testing Guide">
    <meta name="keywords" content="openbsd,ports, test">
    <meta name="distribution" content="global">
    <meta name="copyright" content="copyright 2002-2004 by OpenBSD.">
    <title>OpenBSD Port Testing Guide</title>
  </head>

  <body text="#000000" bgcolor="#FFFFFF" link="#23238E">
    <a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src=
    "../images/smalltitle.gif" border="0"></a> 

    <h2><font color="#e00000">Ports のテストガイド</font></h2>
    <hr>

    <h2><font color="#0000e0">目次</font></h2>

    <ul>
      <li><a href="#Introduction">はじめに</a></li>

      <li><a href="#How">どのように</a></li>

      <li><a href="#First">まず最初に</a></li>

      <li><a href="#Testing">テスト</a></li>

      <li><a href="#Commenting">コメント</a></li>

      <li><a href="#More">さらにテスト</a></li>
    </ul>
    <hr>

    <h2><a name="Introduction"><font color=
    "#0000e0">はじめに</font></a></h2>

    <p><a href="ports.html">ports ツリー</a>は、OpenBSD のユーザが、サード
    パーティープログラムを個別にパッチを当て、構成し、インストールしなくても
    良いようにするための作業の集大成です。この作業は、さまざまな OpenBSD
    プラットフォームへのアプリケーションの移植およびテストを、自分の時間を
    使って行ってくれるボランティアのグループによって行われているものです。
    多くの人々は、十分な知識を持っていないがために、この作業を助けることが
    できないものと考えているようですが、移植者の作業をより良く、より早いもの
    にすることもできるので、そのように考えることはないのです。</p>

    <h2><a name="How"><font color="#0000e0">どのように</font></a></h2>

    <p>投入された更新や、<a href="mail.html">ports メーリングリスト</a>に投稿された
    新しい ports をテストします。これを行うことによって、コミットの遅延を減少させる
    ことが可能になりますし、コミットされた ports の数を増加させることもできるのです
    (多数の ports がテスト不十分のためにコミットされていないのです !)。</p>

    <h2><a name="First"><font color="#0000e0">まず最初に</font></a></h2>

    <p>ports ツリーは <a href="plus.html">OpenBSD-current</a> を対象として
    開発されています。ですので、新しい ports が他のブランチ上でも正しく動く
    という保証はありません。これはまた、あなたは、あなたのシステムおよび
    ports ツリーを -current にアップグレード (これを行うための作業手順は、
    <a href="anoncvs.html">anoncvs</a> および
    <a href="../faq/ja/current.html">「current を追いかける」</a>のページに記載されています) すべきで
    あるということも意味するものなのです。また、ports ならびに ports-changes
    の各<a href="mail.html">メーリングリスト</a>への subscribe も推奨されています。
    この方法で、あなたは、新しい、あるいは更新された ports および ports ツリーの
    変更について通知を受けることができるようになります。</p>
    
    <h2><a name="Testing"><font color="#0000e0">テスト</font></a></h2>

    <p>メーリングリストへの投稿には、ふたつのタイプがあります。それは、新しい ports
    と更新です。新しい ports は、一般的に tar ボール形式の添付ファイルか、URL として
    投稿されます。これらを <tt>/usr/ports/mystuff/</tt> ディレクトリに展開して、
    ここからテストするのが良いでしょう。
    更新は、一般的に -current の ports ツリーに対する diff の形を取りますので、ツリーの
    破損を防止するため、やはり <tt>mystuff/</tt> に ports をコピーして diff を適用する
    のが最も良い方法でしょう。</p>

    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ports&amp;sektion=7&amp;">ports(7)</a>
    に記載された、それぞれの make のターゲットが正しく動作するかどうかを検証するため、
    以下のような段階的なビルドが必要となります。</p>

    <ul>
      <li><i>fetch</i>
        <ul>
         <li>配布ファイルが正しくダウンロードされたかどうかを検証するのに必要です。
             <tt>MASTER_SITES</tt> に指定されたサイトがすべて有効な配布元であることを確認するため、
             そのすべてのテストを試みてください。</li>
        </ul>

      <li><i>checksum</i>
        <ul>
         <li>ダウンロードされた配布ファイルが <tt>distinfo</tt>
             ファイルに記録されたチェックサムと一致するか検証します。</li>
        </ul>

      <li><i>extract</i>
        <ul><li>それぞれの配布ファイルは、事前に (bzip2 のような)
                いかなる依存プログラムでもインストールすべきです。</li></ul>

      <li><i>patch</i>
        <ul>
         <li>パッチは一切の警告メッセージなしにクリーンに適用されるべきです。
         <li>いかなる <tt>.orig</tt> ファイルも、<tt>patches/</tt> ディレクトリの下に
             残されるべきではありません。
         <li>もうひとつの共通的なミスは、パッチ中に RCS タグを含んでしまうことです。
             これは、ports がリポジトリにチェックインされて RCS タグが拡張された場合に、
             失敗の原因となるでしょう。
        </ul>

      <li><i>configure</i>
        <ul>
         <li>configure スクリプトがあなたのプラットフォーム上の機能を
             正確に検出できるかチェックしてください。
         <li>OpenBSD 上で GNU libtool は望まれない「機能」として悪名高きものですので、
             あなたのアーキテクチャの正しいライブラリを生成する最近のバージョンを、
             ports が使用しているかチェックしてください。
         <li>ports が明示的に依存関係を設定していない場合、configure スクリプトは
             あなたのシステム上に既にインストールされている関係のないアプリケーションを
             勝手に検出すべきではありません。
        </ul>

      <li><i>build</i>
        <ul>
         <li>ビルド時のエラーや不審な警告メッセージをチェックしてください。
         <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tmpnam&amp;sektion=3&amp;">tmpnam(3)</a>
             問題に関する警告は、
             <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkstemp&amp;sektion=3&amp;">mkstemp(3)</a>
             を使用して
             解決すべきです。
         <li>「並行処理」のための <tt>SEPARATE_BUILD</tt> 変数をセットしてみて、
             それでもビルドが動作するかどうかをテストしてください。
         <li>GNU make 依存が本当に必要なのかどうかを確認してください。
        </ul>

      <li><i>regress</i>
        <ul>
          <li>エラーをチェックします (空のテストも OK を意味します)。
        </ul>


      <li><i>fake</i>
        <ul>
         <li>このターゲットは、アプリケーションを模擬作業ディレクトリにインストールするので、
             ベースのシステムに影響を及ぼすことなく、すべてのファイルが簡単にパッケージ可能
             になるよう、確実にしておいてください。
         <li>ports は、(<tt>/usr/local</tt> などのような) 模擬作業ディレクトリの外部に
             <b>決して</b>ファイルをインストールすべきではありません。
         <li>GNU libtool は、場合によっては、いくつかのアーキテクチャ上で、模擬プロセスの間に
             ライブラリを再リンクしてしまう問題があります。
        </ul>

      <li><i>package</i>
        <ul>
         <li>pkg/PLIST* および/または pkg/PFRAG* が正しくない場合には、packages の生成が
             失敗してしまうかも知れません。
        </ul>

      <li><i>install</i>
        <ul>
         <li>packages は、そのパッケージリストからのすべてのファイルのインストールが
             正しいファイルパーミッションで成功すべきです。setuid ビットがセットされた
             ファイルには特に注意してください。
         <li>パッケージの <tt>INSTALL</tt> スクリプトが正しく動作することと、
             <tt>/etc</tt> の下のいかなるファイルも上書きしないことを確認してください。
        </ul>

      <li><i>deinstall</i>
        <ul>
         <li>これは、<tt>/etc</tt> の下のファイルを除いて、パッケージがインストールした
             すべてのファイルを削除すべきものです。
         <li><tt>DEINSTALL</tt> スクリプトが期待どおりに動作することを確認してください。
        </ul>
    </ul>

    <p>残る DESCR や MESSAGE のような <tt>pkg/</tt> ディレクトリ下のファイルについても、文法やタイポをチェックすべきです。また、
       <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fmt&amp;sektion=1&amp;format=html">fmt(1)</a>
       を用いて段落を整形し、70 文字で折り返すようにしてください。</p>

    <h2><a name="Commenting"><font color="#0000e0">コメント</font></a></h2>

    <p>テストの最後になりますが、本当に重要なものはコメントです。
    ports がすべて順調に動作していても、コメントは必要なものです。もし、10 回投稿して、
    人々が異なるアーキテクチャ上で ports が順調に動作したと言ってくれれば、
    commit はより早くなります。また、もし、それがうまく動作しなかった場合には、
    何らかの情報を提供しなければなりません。
    このような仕事を助けてくれる、
    出力をログファイルにリダイレクトする「インテリジェントな tee」のような、
    <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/infrastructure/build/portslogger">portslogger</a>
    などのツールがあります。

    <p>使用例 :<br>
    </p>

    <div style="margin-left: 2em">
      <table border="0" cellpadding="3" width="90%">
        <tr>
          <td nowrap bgcolor="#EEEEEE">
<pre>
    # make install 2&gt;&amp;1 | /usr/ports/infrastructure/build/portslogger .
</pre>
          </td>
        </tr>
      </table>
    </div>
    <br>
     <br>
     

    <p>これは、カレントディレクトリ上のログファイルに、出力を
    リダイレクトします。</p>

    <h2><a name="More"><font color="#0000e0">さらにテスト</font></a></h2>

    <p>ports の Makefile のタイポ、不正なリンク、不要な、あるいは
    欠落した変数、正しいライセンス条項とカテゴリをチェックしてください。
    <i>lib-depends-check</i> のようなより高度なターゲットや、パッチの試験、
    同様にバグを修正するために用意された差分、フレーバの追加、あるいは
    その他の拡張もテスト可能です。</p>
    <p>このような diff は、 <tt>-uNr --exclude=CVS</tt> オプションを
    使用して行うべきです。また、CVS リポジトリに対するパッチを生成するのに、
    <tt>cvs diff -uN</tt> を使用することも可能です。</p>
<hr>
<a href="index.html"><img src="../back.gif" height="24" width="24" alt="OpenBSD" border="0"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a><br>
<small>
<!-- 
Originally [OpenBSD: porttest.html,v 1.19 ]
$Translation: porttest.html,v 1.9 2005/09/08 21:26:39 kimitake Exp $
-->
$OpenBSD: porttest.html,v 1.12 2005/09/20 07:30:01 saad Exp $
</small>
</body>
</html>
