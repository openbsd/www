<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide de mise à niveau d'OpenBSD 4.5</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="OpenBSD Upgrade Process for 4.4 -> 4.5">
<meta name="keywords"      content="openbsd,faq,upgrade,4.5">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2009 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    
</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<br>
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade42.html">[4.1 -> 4.2]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="upgrade44.html">[4.3 -> 4.4]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<h1><font color="#e00000">
Guide de Mise à niveau : 4.4 vers 4.5
</font></h1>
<hr>

<i>Remarque : Les mises à niveau ne sont supportées que d'une release à
la suivante.
Ne sautez pas les releases.</i>

<p><i>
Il est hautement recommandé de lire entièrement la présente page et de
bien comprendre la procédure de mise à jour avant de l'appliquer.
Si vous comptez mettre à jour une machine critique ou physiquement
distante, il est recommandé d'essayer d'abord la procédure ci-après sur un
système local afin d'en vérifier le succès.
</i>

<p>
La mise à niveau est un moyen commode afin d'avoir votre système à jour
avec la version la plus récente de OpenBSD.
Cependant, les résultats escomptés ne sont pas censés être précisément
ceux d'une installation de zéro.
Les fichiers d'anciennes bibliothèques en particulier ne sont pas
supprimés lors du processus de mise à niveau, car ils pourraient être
requis par de plus anciennes applications pouvant être ou non mises à
jour à ce moment précis.
Si vous voulez VRAIMENT vous débarrasser de ces anciens fichiers, vous
feriez probablement mieux de réinstaller complètement votre système.

<p>
Table des matières :
<ul>
<li><a href="#before">Avant de mettre à jour</a>
  <ul>
  <li><a href="#newInstReboot">Nouvelle séquence d'installation/redémarrage</a>
  <li><a href="#newPerl">Mise à jour vers Perl 5.10</a>
  <li><a href="#ifconfig">Changements des options dans ifconfig(8)</a>
  <li><a href="#Xchanges">Changements dans X</a>
  <li><a href="#mixerctl">Changements de valeurs dans mixerctl(1)</a>
  <li><a href="#pfsync">Changement de numéro de version pour pfsync</a>
  <li><a href="#newsysmerge">Nouvel outil sysmerge</a>
  <li><a href="#rc.conf">rc.conf</a>
  <li><a href="#kern">Noyau modifié</a>
  </ul>
<li><a href="#upgrade">Procédure de mise à jour</a>
<li><a href="#final">Etapes finales</a>
  <ul>
  <li><a href="#UsersGroups">Ajout et modification des Utilisateurs et des Groupes</a>
  <li><a href="#etcUpgrade">Mise à jour de <tt>/etc</tt></a>
  <li><a href="#patchfile">Fusionner localement des changements de fichiers
  via un fichier correctif</a>
  <li><a href="#sysmerge">Fusionner localement des changements de fichiers
  via sysmerge(8)</a>
  <li><a href="#Kernchk">Vérification du noyau</a>
  <li><a href="#Pkgup">Mise à jour des paquetages</a>
  </ul> 
</ul>

<hr>
<p>
<a name="before"></a>
<h2>Avant de mettre à jour : Les éléments à savoir et dont il faut être
 conscient</h2>
Ceci n'est <i>pas</i> une liste complète des modifications qui ont été
effectuées depuis la version 4.4 jusqu'à la version 4.5, mais plutôt un
ensemble des éléments importants qui devraient concerner un grand nombre
d'utilisateurs durant le processus de mise à jour.
Pour une liste plus exhaustive de ces modifications, veuillez prendre
connaissance de <a href="../../plus45.html">plus45.html</a> et des
journaux des modifications CVS.

<a name="newInstReboot"></a>
<ul> 
<li><b>Nouvelle séquence d'installation/redémarrage (processus de
non-installation du noyau)</b><br>
Les processus de mise à jour précédent utilisaient une étape
d'installation de noyau, redémarrage et installation du "userland".
Pour OpenBSD 4.5, nous suggerons un processus différent -- installez tout
PUIS redémarrez.
Cela doit être fait trés prudemment, sinon on peut se retrouver avec un
système dont la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&amp;sektion=1">reboot(1)</a>
est inopérante.
Comprenez et suivez les directions suivantes avant de faire votre mise à
jour à distance.

<p>
<a name="newPerl"></a>
<li><b>Mise à jour de Perl 5.10.0</b><br>
Le nouveau Perl 5.10.0 inclut un nombre de modules qui étaient dans les
ports par le passé.
Vous avez besoin de supprimer ces paquetages, nous allons l'expliquer avec
d'autres mises à jour de paquetages <a href="#Pkgup">plus loin</a>.

<p>
<li><a name="ifconfig"></a>
<b>Certaines options de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
ont été modifiées.</b><br>
Pour scanner un réseau sans-fil, vous devez maintenant utiliser :
<blockquote><pre>
ifconfig <i>interface</i> scan
</pre></blockquote>

Pour afficher les types de média supportés, vous devez maintenant utiliser :
<blockquote><pre>
ifconfig <i>interface</i> media
</pre></blockquote>

<p>
<a name="Xchanges"></a>
<li><b>Changements dans X</b><br>
<tt>RgbPath</tt> n'est plus un mot clé valide dans la section <b>Files</b>
du fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorg.conf&amp;sektion=5">xorg.conf</a>
, et doit être supprimé des fichiers de configuration existants.

<p>
Le pilote i810(4) a été complétement remplacé par le pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=intel&amp;sektion=4">intel(4)</a>
, donc votre fichier xorg.conf(5) doit être mis à jour en accord avec ces
changements.

<p>
Plusieurs modules xserver et pilotes sont devenus obsolétes.
Pour être sur que <tt>X -configure</tt> n'essaye pas de configurer les
modules obsolétes, vous devez supprimer le contenu de
<tt>/usr/X11R6/lib/modules/</tt>
avant la mise à jour.

<p>
<a name="mixerctl"></a>
<li><b>changements de valeurs pour mixerctl(1)</b><br>
Le nom de certaines variables de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>
comme <tt>headphones</tt> a été raccourci en <tt>hp</tt> et <tt>speaker</tt> 
a été raccourci en <tt>spkr</tt>.
Vous devez mettre à jour votre fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=5">mixerctl.conf(5)</a>
avec les nouveaux noms.

<p>
<a name="pfsync"></a>
<li><b>numéro de version de pfsync(4) incrémenté</b><br>
A cause de changements dans le protocole et l'implémentation de l'interface
pfsync(4), le numéro de protocole pfsync(4) a été incrémenté.
Les pare-feu avec différentes versions ne seront pas capables de
synchroniser la table des états et les connexions existantes finiront en
basculant.

<p>
<a name="newsysmerge"></a>
<li><b>Utilitaire 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysmerge&amp;sektion=8">sysmerge(8)</a>
 :</b><br>
OpenBSD 4.5 inclut l'utilitaire 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysmerge&amp;sektion=8">sysmerge(8)</a>
, qui aidera les administrateurs à mettre à jour les fichiers de configuration aprés la mise
 à jour de leur systéme.
Sysmerge(8) compare les fichiers courants de votre système avec les fichiers qui vont être 
 installés avec le nouveau systéme, et vous donne la possibilité de garder les anciens fichiers, 
installer les nouveaux ou vous assister dans la fusion des anciens et des nouveaux fichiers, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sdiff&amp;sektion=1">sdiff</a>.
Pour les mises à jour précédentes, nous avons fourni une liste de fichiers qui 
sont normalement copiés "tels quels", une liste de fichiers qui doivent être 
modifiés et un fichier de correctif qui applique ces changements qui doivent être 
effectués sur votre systéme.
Pour la mises à jour de 4.4 vers 4.5, à la place d'utiliser un fichier de
correctif, vous pouvez prendre l'option d'utiliser sysmerge pour faire vos 
changement, ou vous pouvez utiliser le fichier de correctif en premier puis 
continuer avec un session sysmerge pour nettoyer ce qui reste non finalisé.

<p>
<b>Qui doit utiliser sysmerge(8) :</b><br>
Les personnes utilisant des systémes trés modifiés ou qui ne demarrent 
pas avec une version précédente (par exemple, un snapshot entre deux 
versions), qui ont mis à jour vers un snapshot ou qui n'ont pas bien 
mis à jour leur systéme dans le passé trouveront l'utilisation de 
sysmerge trés supérieure à l'utilisation des patchs, car il fonctionne 
avec ce qu'il y a actuellement sur votre systéme, à la place de ce nous 
aimerions trouver sur votre systéme.
Il vous donnera aussi un bien plus grand contrôle sur votre processus 
de mise à jour, et vous y serez bien plus intégré.

<p>
<b>Qui NE doit pas utiliser sysmerge(8) :</b><br>
Les personnes qui possédent un parc de machines à mettre à jour dans une 
configuration simple et qui utilise la derniére version stable préféreront 
plutot utiliser l'ancien systéme de correctif qui est plus simple.

<p>
Bien que sysmerge peut prendre en compte TOUS les changements de <tt>/etc</tt>,
<tt>/dev</tt>, <tt>/root</tt> et <tt>/var</tt>, nous recommandons vivement 
de faire certains changements manuellement avant, cela vous fera gagner du 
temps et réduira la possibilité d'erreurs humaines.
En particulier, il est hautement recommandé de ne pas utiliser sysmerge 
pour mettre à jour les comptes utilisateurs et les groupes, comme il est 
trés simple de choisir la mauvaise option entrainant l'effacement complet 
de vos comptes utilisateurs et configurer le mot de passe root à une valeur 
nulle, en prévision de connexions distantes qui pourraient corriger le 
probléme.

<p>
<a name="rc.conf"></a>
<li><b>rc.conf :</b><br>
Il est convenu que 
<tt>/etc/rc.conf</tt> n'est pas un fichier qui doit être modifié par 
l'utilisateur.
Si vous avez fait des changements dans votre fichier <tt>/etc/rc.conf</tt>, 
fusionnez ces changements dans <tt>/etc/rc.conf.local</tt>.
Si vous NE possédez PAS de <tt>/etc/rc.conf.local</tt>, copiez simplement
votre fichier <tt>/etc/rc.conf</tt> existant vers <tt>/etc/rc.conf.local</tt> 
et <i>supprimez la derniére ligne de votre script !</i>
Sinon, insérez votre <tt>rc.conf</tt> existant dans le haut de votre 
fichier <tt>rc.conf.local</tt> existant <i>et supprimez la derniére ligne</i>
avant de continuer la suite du processus.

<p>
<a name="kern"></a>
<li><b>Noyau modifié :</b><br>
Vérifiez si vous avez apporté des modifications à votre noyau.
Par exemple, vous avez pu modifier votre périphérique réseau pour
utiliser un paramètrage différent du paramétrage par défaut à l'aide de
config(8).
Notez vos modifications afin que vous puissiez les reproduire avec le
nouveau noyau 4.5.

</ul>

<p>
<hr>
<a name="upgrade"></a>
<h2>Procédure de mise à jour</h2>

<h3>Mise à niveau avec un noyau d'installation</h3>
Si vous avez accès à la console système, la manière la plus facile et la
plus sûre pour effectuer une mise à jour à partir de fichiers binaires
consiste à démarrer depuis un média d'installation ou depuis le noyau
<a href="faq4.html#bsd.rd">bsd.rd</a> et de suivre les étapes de mise à
jour ; étapes fortement similaires à celles décrites dans la
<a href="faq4.html">procédure d'installation</a>. 

<p>
AVANT de mettre à jour, cependant, faite ce qui suit si vous avez installé X :

<blockquote><pre>
<b>rm -rf /usr/X11R6/lib/modules/*</b>
</pre></blockquote>

Ensuite, terminez la mise à jour en suivant les <a href="#final">étapes finales</a>
ci-dessous.

<p>
Une solution simple pour démarrer sur le noyau d'installation est de
mettre le noyau <i>bsd.rd</i> de la version 4.5 à la racine de votre
lecteur de démarrage et de dire au chargeur de démarrage d'utiliser ce
nouveau fichier <i>bsd.rd</i>.
Sur amd64 et i386, vous pouvez entrer "<tt>boot bsd.rd</tt>" à l'invite
de commandes <tt>boot&gt;</tt>.

<h3>Mise à niveau sans noyau d'installation</h3>
<i>Ce n'est pas la solution recommandée. Utilisez le noyau
d'installation le plus souvent possible !</i>

<p>
De temps à autre, on peut avoir besoin de faire la mise à jour d'une
machine sans pouvoir utiliser le processus de mise à jour classique.
Le cas le plus courant est celui d'une machine distante dont on ne peut
accéder à la console système.
On peut alors réaliser une mise à niveau en faisant attention suivant cette
procédure :

<ul>
<li><b>Placez les fichiers d'installation dans un "bon" endroit</b>.
Assurez-vous d'avoir la place suffisante !

<p>
<li><b>Stoppez toutes les applications appropriées :</b>
Durant cette étape, toutes les applications "userland" seront remplacées
mais ne seront pas éxécutables et des choses étranges peuvent arriver
comme résultat. Si cela vous concerne, arrêtez les applications qui
peuvent être impactées.
Il pourrait également y avoir d'autres applications que vous devriez
suspendre immédiatement aprés la mise à jour, arrêtez et désactivez 
les de la même manière.

<p>
<li><b>Vérifiez le noyau :</b>
Bien que <b>la plupart des gens puissent sauter cette étape</b>, si vous
aviez un noyau modifié en 4.4, il est probable que vous devrez modifier
le noyau 4.5 de base. Surtout si vous effectuez une mise à jour à
distance, c'est maintenant le bon moment pour vérifier que le nouveau
noyau fonctionnera après le redémarrage de la machine. Si une
modification du noyau doit être effectuée, la façon la plus sûre est
de l'effectuer sur un système 4.5 local.
Cela peut être aussi simple que de modifier un périphérique spécifique
avec config(8), mais il peut aussi être nécessaire de recompiler le noyau si
l'option que vous souhaitez n'est pas incluse dans le noyau GENERIC.
Consultez la section <a href="faq5.html">FAQ 5 - Construire le Système à
partir des Sources</a> avant de décider une recompilation de votre
noyau.

<p>
<li><b>Installez le(s) nouveau(x) noyau(x)</b>
<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>   <i># où mettre les fichiers</i>
<b>cd ${RELEASEPATH}</b>
<b>rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
<b>cp bsd.rd bsd.mp /</b>
</pre></blockquote>

(si vous utilisez un noyau multiprocesseurs, utilisez<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>rm /obsd ;
ln /bsd /obsd && cp bsd.mp /nbsd && mv /nbsd /bsd</b></tt><br>
à la place)

<p>
Remarquez les étapes additionnelles pour copier par dessus un premier noyau
: celles-ci sont réalisées afin de s'assurer qu'il existe toujours une
copie valide du noyau sur le disque et que le système puisse redémarrer en
cas de coupure électrique ou de panne.

<p>
<li><b>Supprimez les anciens modules X :</b>  Il seront remplacés par les
nouveaux rapidement :
<blockquote><pre>
<b>rm -rf /usr/X11R6/lib/modules/*</b>
</pre></blockquote>


<p>
<li><b>Sauvegardez vous-même une copie de l'ancienne commande reboot(1) :</b>
Vous continuez d'utiliser l'ancien noyau, il est possible que la nouvelle
commande reboot ne fonctionne pas avec l'ancien noyau.

<blockquote><pre>
<b>cp /sbin/reboot /sbin/oreboot</b>
</pre></blockquote>

<p>
<li><b>Installez les nouvelles applications du "userland".</b>
<i>NE pas installer <tt>etc45.tgz</tt> et <tt>xetc45.tgz</tt> maintenant,
parce que cela écraserait vos fichiers de configuration actuels !</i>
Il faut remarquer que nous installons base45.tgz en DERNIER, parce qu'il
inclut un nouvel utilitaire 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&amp;sektion=1">tar(1)</a>
qui peut ou pas fonctionner sur un ancien noyau.
Nous redémarrons immédiatement car le système est normalement fonctionnel
maintenant.

<blockquote><pre>
<b>tar -C / -xzphf xserv45.tgz</b>
<b>tar -C / -xzphf xfont45.tgz</b>
<b>tar -C / -xzphf xshare45.tgz</b>
<b>tar -C / -xzphf xbase45.tgz</b>
<b>tar -C / -xzphf game45.tgz</b>
<b>tar -C / -xzphf misc45.tgz</b>
<b>tar -C / -xzphf comp45.tgz</b>
<b>tar -C / -xzphf man45.tgz</b>
<b>tar -C / -xzphf base45.tgz</b> # Installation en dernier !
<b>/sbin/oreboot</b>
</pre></blockquote>

Tous les jeux de fichiers ne seront pas à installer pour
toutes les applications, cependant, si vous aviez installé initialement
un jeu de fichiers, vous devrez certainement le mettre à niveau avec le
nouveau jeu de fichiers.

<p>
Encore une fois, les fichiers dans <tt>/etc</tt> sont traités séparement plus
loin, donc <tt>etc45.tgz</tt> et <tt>xetc45.tgz</tt> NE sont pas ouvert 
maintenant.


<p>
<li><b>Aprés un redémarrage complet, mise à jour de <tt>/dev</tt>.</b>
Le nouveau fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
a été copié dans /dev par l'installation de
<tt>base45.tgz</tt>, donc vous avez simplement à faire :
<blockquote><pre>
<b>cd /dev</b>
<b>./MAKEDEV all</b>
</pre></blockquote>

</ul>

<hr>
<a name="final"></a>
<h2>Etapes finales</h2>

Que vous mettiez à jour à partir d'un noyau d'installation et en
utilisant le processus de mise à jour formel, ou en faisant une mise à
jour binaire "sur place", vous aurez besoin d'effectuer un certain nombre
d'étapes manuelles.
  
<a name="UsersGroups"></a>
<h3>1. Nouveaux Utilisateurs et Groupes</h3>
Un nouvel utilisateur est nécessaire pour le
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bluetooth&amp;sektion=4">Bluetooth</a>.
Créez les utilisateurs et groupes en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
<blockquote><pre>
<b>useradd -u94 -g=uid -c"Bluetooth Daemon" -d/var/empty -s/sbin/nologin_btd</b>
</pre></blockquote>

<a name="etcUpgrade"></a>
<h3>2. Mise à jour de <tt>/etc</tt></h3>
<p>
Vous aurez besoin d'extraire les fichiers <tt>etc45.tgz</tt> dans un
endroit temporaire :
<blockquote><pre>
<b>export RELEASEPATH=/usr/rel</b>
<b>tar -C /tmp -xzphf ${RELEASEPATH}/etc45.tgz</b>
</pre></blockquote>


Les fichiers suivants peuvent être probablement copiés "tels quels" à
partir de <tt>etc45.tgz</tt> :

<blockquote><pre>
netstart
rc
rc.conf
services
afs/CellServDB
mail/README
mail/submit.cf
mtree/4.4BSD.dist
mtree/special
/var/named/etc/root.hint
/var/named/etc/named*
</pre></blockquote>

Remarquez qu'il EST possible de modifier localement ces fichiers. Si vous
l'avez fait, NE pas copier sur ces fichiers, et utilisez 
<a href="#sysmerge">sysmerge(8)</a> à la place.
<!-- Veuillez prêter une attention particulière à <tt>mail/*</tt> si vous
utilisez autre chose que la configuration Sendmail(8) par défaut. -->
Voici des lignes à copier/coller pour copier ces fichiers, en supposant
que vous avez extrait <tt>etc45.tgz</tt> à l'endroit précité :

<blockquote><pre>
<b>cd /tmp/etc
cp netstart rc rc.conf services /etc
cp afs/CellServDB /etc/afs
cp mtree/* /etc/mtree
cp mail/README mail/submit.cf /etc/mail
cp ../var/named/etc/root.hint ../var/named/etc/named-*.conf /var/named/etc
cp ../var/named/etc/named.conf /var/named/etc/</b>  # SI pas de changements locaux !
</pre></blockquote>

<p>
<a name="patchfile"></a>
<h3>3a.  Fusionner localement les changements de fichiers via une fichier
de correctif</h3>

<p>
Les fichiers suivants ont probablement été modifiés localement, mais
ils doivent être mis à jour pour 4.5. SI vous n'avez pas modifié
ces fichiers, vous pouvez copier directement la nouvelle version,
sinon vous devrez fusionner les modifications avec vos fichiers :

<blockquote><pre>
/etc/changelist
/etc/ftpusers
/etc/ksh.kshrc
/etc/lynx.cfg
/etc/mail/aliases
/etc/mail/trusted-users
/etc/shells
/etc/ssh/ssh_config
</pre></blockquote>

Les modifications apportées à ces fichiers se trouvent dans ce
<a href="../upgrade45.patch">fichier correctif</a>.
Vous pouvez tenter de l'utiliser en exécutant les commandes suivantes
sous l'identité root :
<blockquote><pre>
<b>cd /</b>
<b>patch -C -p0 &lt; upgrade45.patch</b>
</pre></blockquote>

Ceci aura pour effet de tester le correctif afin de voir s'il va bien
s'appliquer à VOTRE système. Si vous voulez l'appliquer, il suffit
d'omettre l'option "<tt>-C</tt>".
Il est probable que, si vous avez adapté ces fichiers à vos besoins ou si
vous ne les avez pas maintenus à jour de manière stricte, ou si vous avez
mis à jour à partir d'un snapshot de 4.4, le correctif ne se passera
pas de manière satisfaisante.
Dans ces cas, vous devrez appliquer manuellement les modifications.
Veuillez tester ce processus avant de vous y fier, notamment pour une
machine à laquelle vous ne pouvez pas accéder facilement.

<p>
Les fichiers suivants comportent des modifications dont vous devez
prendre connaissance, mais il est peu probable qu'ils puissent être
directement copiés ou fusionnés (i.e. si vous utilisez pf.conf, prenez
connaissance de la stratégie de mise à jour suggérée, et décidez si oui
ou non elle est appropriée dans votre cas).

<blockquote><pre>
etc/dhcpd.conf
etc/ntpd.conf
etc/pf.conf
</pre></blockquote>

<p>
Finalement, utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
pour mettre à jour la base des aliases,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
créera tout nouveau répertoire :

<blockquote><pre>
<b>newaliases</b>
<b>mtree -qdef /etc/mtree/4.4BSD.dist -p / -u</b>
</pre></blockquote>

<a name="sysmerge"></a>
<h3>3b. Fusionner localement les changements via sysmerge(8)</h3>

<p>
Le nouvel utilitaire
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysmerge&amp;sektion=8">sysmerge(8)</a>
comparera les fichiers qui sont actuellement sur votre système avec ceux
qui devront être installés pendant la nouvelle installation, et vous
assister dans la fusion des changements sur votre système.
Il est à noter que contrairement au fichier correctif, il n'y a pas 
d'hypothèses faites sur	ce qui est effectivement sur votre système,
donc vous pouvez utiliser sysmerge(8) pour changer de facon arbitraire
entre différentes <a href="faq5.html#Flavors">saveurs du processus de
développement</a>, comme d'une ancienne version <i>-current</i> vers la
<i>4.5-release</i> ou d'une <i>-current</i> vers la derniére.

<p>
Il est conseillé de lire la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysmerge&amp;sektion=8">sysmerge(8)</a>
avant de l'utiliser sur votre système.
Il serait aussi avisé de lire les pages de manuel suivantes 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=diff&amp;sektion=1">diff(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sdiff&amp;sektion=1">sdiff(1)</a>
et même revoir
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=more&amp;sektion=1">more(1)</a>
avant de continuer.

<p>
En supposant que les fichiers <tt>etc45.tgz</tt> et <tt>xetc45.tgz</tt>
existent dans votre $RELEASEPATH, l'executer avec :

<blockquote><pre>
# <b>sudo sysmerge -as $RELEASEPATH/etc45.tgz -x $RELEASEPATH/xetc45.tgz</b>
</pre></blockquote>

Sysmerge(8) va vous présenter un
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=diff&amp;sektion=1">diff(1)</a>,
unifié à travers votre $PAGER favori (i.e.,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=more&amp;sektion=1">more(1)</a>)
et va vous demander, pour la plupart des changements de fichiers, si vous
souhaitez :
<blockquote><pre>
  Use 'd' to delete the temporary ./var/www/htdocs/index.html
  Use 'i' to install the temporary ./var/www/htdocs/index.html
  Use 'm' to merge the temporary and installed versions
  Use 'v' to view the diff results again

  Default is to leave the temporary file to deal with by hand
</pre></blockquote>

<p>
Si vous souhaitez garder vos fichiers existants, supprimez le fichier 
temporaire, si vous souhaitez remplacer votre fichier existant par la
nouvelle version, installez le fichier temporaire.
Si vous souhaitez fusionner les deux ensemble, choississez 'm' qui va
vous mettre sous
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sdiff&amp;sektion=1">sdiff(1)</a>,
ou vous pourrez manuellement fusionner le fichier.
La valeur par défaut est de revenir et de traiter le fichier plus tard,
manuellement.

<p>
Tant qu'il peut travailler, nous ne vous recommandons pas d'utiliser 
sysmerge à intégrer de nouveaux utilisateurs dans le système, mais plutôt
d'utiliser la ligne useradd(8) <a href="#UsersGroups">plus haut</a>.
Nous pensons qu'il est beaucoup moins sensibles aux erreurs.
(conseil: <i>ne</i> pas <b>i</b>nstaller le fichier temporaire
master.passwd sur votre existant !).

<p>
Sysmerge(8) sauvegardera tous vos fichiers remplacés dans un répertoire
temporaire, similaire à <tt>/var/tmp/sysmerge.24959/backups</tt>, 
donc si vous avez accidentellement supprimé quelque chose, ce qui n'était
probablement pas une bonne idée, vous avez une chance de le récupérer.
Il est à noter que 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=daily&amp;sektion=8">daily(8)</a>
effacera les anciens fichiers de ce répertoire.

<a name="Kernchk"></a>
<h3>4. Vérification du noyau</h3>
Remarque : <b>la plupart des personnes peuvent sauter cette étape !</b>
<p>
Si vous avez suivi les instructions de mise à niveau sans noyau
d'installation, vous avez déjà accompli cette étape.
En revanche, si vous utilisez le média d'installation et si vous aviez
un noyau modifié en 4.4, il est probable que vous devrez modifier le
noyau 4.5 de base. Cela peut être aussi simple que de modifier un
périphérique spécifique avec config(8), mais il peut aussi être nécessaire
de recompiler le noyau si l'option que vous souhaitez n'est pas incluse
dans le noyau GENERIC.
Consultez la section <a href="faq5.html">FAQ 5 - Construire le Système à
partir des Sources</a> avant d'envisager une recompilation de votre
noyau.

<a name="Pkgup"></a>
<h3>5. Mise à jour des paquetages</h3>
Si vous avez installé des paquetages sur votre machine vous devriez les
mettre à jour après la mise à niveau de votre système de base.
Attention cependant car de nombreux paquetages nécessiteront une
manipulation supplémentaire avant et/ou après avoir été mis à jour.
Référez-vous au guide de mise à niveau de l'application pour de plus
amples informations.

<p>
Les paquetages suivants sont connus pour avoir des interrogations sur la mise
à jour qui aura un impact sur un grand nombre d'utilisateurs.
Le fait qu'un paquetage n'est pas sur cette liste ne signifie pas qu'il aura
une mise à jour triviale.
Vous devez faire des travaux personnels sur les applications que VOUS 
utilisez.

<ul>
<li>
<li><b>subversion :</b> Nouvelles fonctionnalités (par exemple merge-tracking) 
qui requierent que le repository soit mis à jour manuellement en utilisant la 
commande 'svnadmin upgrade'. Voir les
<a href="http://subversion.tigris.org/svn_1.5_releasenotes.html#repos-upgrades">
commentaires sur la version</a>.

<li><b>kqemu :</b> Doit rester synchronisé avec le noyau. pkg_delete avant
la mise à jour, puis un pkg_add du nouveau paquetage aprés que la mise à
jour est terminée.

</ul>

<p>
Les utilitaires de gestion des paquetages supportent la
mise à jour avec la commande <tt>pkg_add -u</tt>.
Par exemple, pour mettre à jour tous vos paquetages, soyez certains que
<tt>PKG_PATH</tt> pointe bien vers le répertoire contenant les paquetages
4.5 sur votre CD ou un miroir FTP proche et utilisez une commande du type
 
<blockquote><pre>
#<b> pkg_add -ui -F update -F updatedepends</b>
</pre></blockquote>

où <tt>-u</tt> indique le mode mise à jour et <tt>-i</tt> le mode
interactif, ainsi pkg_add vous demandera ce que vous souhaitez faire
lorsque celui-ci rencontrera une ambiguïté. Lisez le manuel de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.5">pkg_add(1)</a>
et le chapitre de la FAQ sur la <a href="faq15.html#PkgMgmt">gestion
des paquetages</a> pour de plus amples informations.

<p>
Un nombre de modules Perl qui étaient auparavant en paquetages sont
maintenant inclus avec Perl 5.10.0 dans le système de base, donc <b>aprés</b>
la mise à jour des autres paquetages, ces paquetages doivent être supprimés.
En plus,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xcompmgr&amp;sektion=1">xcompmgr(1)</a>
fait maintenant parti de xbase45.tgz, et n'est plus un paquetage donc il
doit être aussi supprimé.

<blockquote><pre>
<b>pkg_delete p5-Archive-Tar p5-Compress-Raw-Zlib p5-Compress-Zlib \
p5-IO-Compress-Base p5-IO-Compress-Zlib p5-IO-Zlib p5-Module-Build \
p5-Module-CoreList p5-Module-Load p5-version p5-Digest-SHA \
p5-Locale-Maketext-Simple p5-Pod-Escapes p5-Pod-Simple \
p5-ExtUtils-ParseXS p5-ExtUtils-CBuilder p5-Module-Pluggable \
p5-Time-Piece p5-Module-Loaded xcompmgr</b>
</pre></blockquote>

Il faut remarquer que si vous faites un copier-coller de cette commande sur
votre système, vous aurez surement un nombre important de messages d'erreurs
de paquetages que vous n'avez pas installé.
C'est ok.



<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<br>
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade42.html">[4.1 -> 4.2]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="upgrade44.html">[4.3 -> 4.4]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade45.html,v 1.17 ]<br>
$Translation: upgrade45.html,v 1.8 2009/06/16 09:59:25 benoit Exp $<br>
-->
$OpenBSD: upgrade45.html,v 1.4 2009/06/22 11:36:25 ajacoutot Exp $
</small>

</body>
</html>
