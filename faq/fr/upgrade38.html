<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide de Mise à Niveau d'OpenBSD</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2005 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    
</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="index.html">[Index de la FAQ]</a>
</font>

<h1><font color="#e00000">Guide de Mise à niveau : 3.7 à 3.8</font></h1>
<hr>

<i>Remarque : Les mises à niveau ne sont supportées que d'une release à
la suivante.
Ne sautez pas les releases.</i>

<p>
La mise à niveau est un moyen commode afin d'avoir votre système à jour
avec la version la plus récente.
Cependant, les résultats escomptés ne sont pas censés être précisément
ceux d'une installation de zéro.
Les fichiers d'anciennes librairies en particulier ne sont pas supprimés
lors du processus de mise à niveau, car ils pourraient être requis par
de plus anciennes applications pouvant être ou non mises à jour à ce
moment précis.
Si vous voulez vraiment vous débarrasser de ces anciens fichiers, vous
feriez probablement mieux de réinstaller complètement votre système.

<h2>Before upgrading...</h2>
Avant de mettre à niveau, certains utilisateurs choisissent de supprimer
tous les <a href="faq8.html#Packages">packages</a>, et d'installer de
nouvelles versions après la mise à niveau.
<p>
Pour supprimer rapidement tous les packages de votre système :
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Après la mise à niveau, installez les nouvelles versions de ces
applications.

<p>

Notez qu'avec OpenBSD 3.8, les pkg tools supportent à présent la mise à
jour "sur place" en utilisant <code>pkg_add -r</code>. Le fonctionnement
a été vérifié avec la plupart des packages, en particulier avec les
packages des CDs de 3.6 ou 3.7.
Quelques points importants :
<ul>
<li><code>pkg_add -r</code> ne gère pas les mises à jour globales, et il
faut lui indiquer les noms de packages à mettre à jour. <code>pkg_add
-u</code>, une nouvelle option, peut être utilisée pour trouver la liste
exacte des packages à transmettre à <code>pkg_add -r</code>.
<li><code>pkg_add -r -F update -F updatedepends -q list_of_new_pkgs</code>
devrait fonctionner dans la plupart des cas.
<li>Les packages Mozilla de 3.7 peuvent être mis à jour en toute
sécurité vers la version 3.8.
</ul>

<h2>Mise à niveau sans media d'installation</h2>
La manière la plus facile et la plus sûre pour effectuer une mise à jour
à partir de fichiers binaires consiste à démarrer depuis un média
d'installation et de suivre les étapes de mise à jour; étapes fortement
similaires à celles décrites dans la <a href="faq4.html">procédure
d'installation</a>. Ensuite, il ne vous restera plus que <a
href="#etcUpdates">la mise à jour</a>
de <tt>/etc</tt> à faire comme indiqué plus loin.

<h2>Mise à niveau sans media d'installation</h2>
<i>Ce n'est pas la solution recommandée. Utilisez le media
d'installation le plus souvent possible !</i>

<p>
On a parfois besoin de mettre à niveau une machine mais on ne peut pas
utiliser le processus classique de mise à niveau. On peut alors réaliser
une mise à niveau depuis les sources :

<ul>
<li><b>Placez les fichiers d'installation dans un "bon" endroit</b>.
Assurez vous d'avoir la place suffisante !

<li><b>Installez le(s) nouveau(x) noyau(x)</b>
<blockquote><pre>
cd /<i>path</i>
rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /
</pre></blockquote>

Notez les étapes additionnelles pour copier par dessus un premier noyau
: celles-ci sont réalisées afin de s'assurer qu'il y ai toujours une
copie valide du noyau sur le disque que le système puisse booter sans
quoi il pourrait y avoir un problème de synchronisation ou une panne
vraiment désagréable.

<li><b>Installez les nouveaux fichiers <tt>/etc/firmware</tt> :</b>
A cause du fait que certains "firmware" ajoutés ont été déplacés du
noyau vers des fichiers dans le répertoire <tt>/etc/firmware</tt>, il y
a quelques drivers qui seront inutilisables s'il n'y a pas de fichier
firmware pouvant être chargés lorsque le nouveau noyau démarre. Ceci
concerne les utilisateurs de certains périphériques, bien que tout
utilisateur devrait considérer cette étape.
Afin d'extraire les fichiers firmware de <tt>base38.tgz</tt>, faites en
étant root les commandes suivantes :

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base38.tgz "*etc/firmware/*"
</pre></blockquote>

avant la prochaine étape.

<li><b>Redémarrez votre système avec le nouveau noyau</b><br>
Il peut être tentant de sauter cette étape, mais ceci devrait être fait
dès à présent, ou le nouveau noyau lancera d'anciennes applications
utilisateur (tel que la commande <tt>reboot</tt> ! qui sera importante
pour la suite). Signalons qu'un nouveau "userland" ne marchera PAS sur
un ancien noyau dans la plupart des cas.

<li><b>Arrêtez toutes les applications qui pourraient causer des
       problèmes lors des étapes suivantes.</b>

<li><b>Installez les nouvelles applications du userland</b>

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base38.tgz
tar xzpf /<i>path</i>/comp38.tgz
tar xzpf /<i>path</i>/game38.tgz
tar xzpf /<i>path</i>/man38.tgz
tar xzpf /<i>path</i>/misc38.tgz
tar xzpf /<i>path</i>/xbase38.tgz
tar xzpf /<i>path</i>/xfont38.tgz
tar xzpf /<i>path</i>/xserv38.tgz
tar xzpf /<i>path</i>/xshare38.tgz
</pre></blockquote>
Remarque : tous les jeux de fichiers ne devront pas être installés pour
toutes les applications, cependant, si vous aviez installé originalement
un jeu de fichiers, vous devrez certainement le mettre à niveau avec le
nouveau jeu de fichiers.
Notez également que <tt>etc38.tgz</tt> N'EST pas décompressé ici, étant
gérés séparément.
Notez aussi que les fichiers dans <tt>/etc</tt> sont gérés séparemment,
<tt>etc38.tgz</tt> et <tt>xetc38.tgz</tt> ne sont pas extraits ici.

<li><b>Mettre à jour <tt>/dev</tt>.</b>
Le nouveau fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
sera copié dans /dev par l'installation de <tt>base37.tgz</tt>, vous
n'avez ainsi qu'a faire ce qui suit :
<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>
Consultez aussi les notes ci-dessous qui sont spécifiques aux versions.

<li><b>Mise à niveau de <tt>/etc</tt> comme ci-dessous</b>.

<li><b>Redémarrez</b>

</ul>

Pendant ce processus,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
pourrait produire des messages d'erreur comme :
<pre>
        Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such
        file or directory, fs=., avail=-1, blocksize=380204
</pre>
Ces messages peuvent être ignorés sans risque, mais vous pourriez
vouloir arrêter sendmail(8) pendant la mise à niveau.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Mises à Jour de <tt>/etc</tt></h2>

Si vous mettez à niveau en utilisant un media d'installation et
faites une "mise à niveau" formelle, ou faites une mise à niveau
binaire "sur place", il y a certaines étapes manuelles qui doivent
être réalisées.

<a name="users"></a>
<h4>Nouveaux utilisateurs et groupes</h4>
Le démon FTP a été retravaillé afin d'abandonner ses privilèges, et le
démon OSPF a été ajouté, de nouveaux utilisateurs et groupes sont ainsi
requis.

En étant <i>root</i>, ajoutez les utilisateurs et groupes suivants,
en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
useradd -u86 -g=uid -c"HOSTAP Daemon" -d/var/empty -s/sbin/nologin _hostapd
</pre></blockquote>

Ces étapes ajouteront à la fois les nouveaux utilisateurs et leurs
groupes correspondant. Votre environnement pourrait vous autoriser à
copier/coller ces commandes.

<a name="apps"></a>
<h4>Applications du Userland</h4>

<a name="etcfiles"></a>
<h4>Changement de fichiers dans <tt>/etc</tt></h4>
Vous voudrez extraire <tt>etc38.tgz</tt> dans un répertoire temporaire :
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc38.tgz
</pre></blockquote>


Fichiers pouvant probablement être copiés de <tt>etc38.tgz</tt> "en
l'état" :

<!--
<blockquote><pre>
changelist
daily
fbtab
moduli
netstart
ospfd.conf
rc
security
services
mtree/*
</pre></blockquote>

Notez qu'il est possible de modifier ces fichiers localement, si ceci a
été fait, une fusion manuelle pourrait être nécessaire.
Voici les lignes copiées/collées pour copier ces fichiers, à la
condition que vous ayez extrait <tt>etc38.tgz</tt> dans le répertoire
conseillé ci-dessus :

<blockquote><pre>
cd /tmp/etc
cp changelist daily fbtab moduli netstart ospfd.conf rc security services /etc
cp mtree/* /etc/mtree/
</pre></blockquote>

<p>
Fichiers devant être fusionnés manuellement, en respectant tout
changement local effectué sur ceux-ci :

<blockquote><pre>
ftpusers
rc.conf
spamd.conf
sysctl.conf
mail/aliases
skel/.cshrc
skel/.profile
</pre></blockquote>
-->

Enfin, utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
pour créer les nouveaux répertoires :
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="index.html">[Index de la FAQ]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade38.html,v 1.6 ]<br>
$Translation: upgrade38.html,v 1.2 2005/10/25 14:49:10 saad Exp $<br>
-->
$OpenBSD: upgrade38.html,v 1.1 2005/10/25 15:02:18 saad Exp $
</small>

</body>
</html>
