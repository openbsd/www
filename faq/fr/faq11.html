<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>11 - Le système X Window</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1998-2006 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">

<a href="../../fr/index.html">
<img alt="[OpenBSD]" src="../../images/smalltitle.gif" border="0" height="30" width="141"> 
</a>
<p>
<font color="#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq10.html">[Section 10 - Gestion du Système]</a>
<a href= "faq12.html">[Section 12 - Questions Spécifiques Aux
Plates-Formes Et Au Matériel]</a>
</font>

<h1><font color="#e00000">11 - Le système X Window</font></h1>
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC

<hr>
<p>
<b><font color="#e00000">Remarque Importante :</font></b> Le contenu de
   ce fichier est obsolète. Consultez la version anglaise 
   <a href="../faq11.html">ici</a> pour des informations à jour.

<p>
Si vous souhaitez contribuez à l'effort de traduction,
prière de consulter
<a href="../../fr/translation.html">la page de traduction</a>.

-->
<hr>

<p>
<h3>Table des matières</h3>
<ul>
<li><a href="#Intro">11.1 - Introduction à X</a>
<li><a href="#ConfigX">11.2 - Configurer X</a>
<li><a href="#amd64i386">11.3 - Configurer X sur amd64 et i386</a>
<li><a href="#StartingX">11.4 - Démarrer X</a>
<!-- li><a href="#TuningRes">11.9 - Optimiser la résolution de votre écran
sous X</a -->
</li>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>11.1 - Introduction à X</h2>

Le système X Window (parfois dénommé simplement "X" ou, incorrectement
"X Windows") est l'environnement qui fourni les services graphiques à
OpenBSD et les autres systèmes de type Unix.
Cependant, seul, X n'apporte que très peu de fonctionnalités : il faut
également avoir un gestionnaire de fenêtres afin d'offrir une interface
utilisateur.
La plupart de ce que l'on percevra de X viendra du gestionnaire de
fenêtres et non de X lui-même.
OpenBSD fourni une version libre du gestionnaire de fenêtres
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fvwm&amp;sektion=1">fvwm(1)</a>,
bien que vous puissiez utiliser également un des autres gestionnaires
présents dans les <a href="../fr/faq15.html">paquetages</a>.
Effectuez une recherche avec le mot-clef "<tt>window manager</tt>" afin
d'obtenir une liste des gestionnaires de fenêtres disponibles.

<p>
X est considéré comme un protocole fonctionnant sur le mode
"client-server" mais cette terminologie peut parfois prêter à confusion.
L'ordinateur avec l'affichage graphique à l'écran est le "serveur X".
L'application qui défini ce que le serveur X doit afficher à l'écran est
le "client X" même s'il s'agit d'une machine bien plus puissante dans
un centre d'hébergement.
Ce modèle peut être utilisé afin d'avoir des applications gourmandes en
ressources processeur (clients X) tournant sur une machine très
puissante mais utilisant un serveur X tournant sur une petite machine de
faible puissance sur votre bureau pour afficher leurs interfaces.

<p>
Il est possible de faire tourner des clients X sur un système sans
support graphique.
Ainsi, on pourrait avoir une application (le client X) tournant sur un
mvme88k et affichant son interface sur un alpha (le serveur X).
Puisque X est un protocole bien défini et multiplate-forme il est même
possible d'avoir une application X tournant (par exemple) sur une
machine Solaris et utiliser une machine OpenBSD pour l'afficher.

<p>
Le client et le serveur peuvent également tourner sur la même machine et
pour la majorité de cette documentation, c'est ce que nous supposerons.

<h3>11.1.1 - Quelle puissance d'ordinateur est nécessaire pour faire
tourner X ?</h3>
X en lui-même est un programme très lourd et un ordinateur rapide sera
idéal si vous le lancez et l'arrêtez régulièrement.
Cependant, une fois démarré, il reste très réactif même sur une machine
modeste.
Afin d'avoir une meilleure réactivité sur certaines plates-formes même si
vous ne travaillez qu'avec du texte, il vous sera nécessaire de faire
tourner X.
Ces plates-formes telles que <a href="../../fr/sparc.html">sparc</a> et
<a href="../../fr/sparc64.html">sparc64</a> ont été prévues pour
fonctionner avec une interface graphique et le mode console est très
lent.

<p>
Ceci dit, l'utilité de faire tourner X est généralement d'utiliser des
applications X.
Certaines de ces applications sont très peu gourmandes, d'autres vous
sembleront utiliser tout le processeur et la RAM que vous leur
octroierez.
Evidemment, certains utilisateurs n'utilisent X qu'afin de bénéficier de
nombreux
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>s,
ce qui reste possible même sur du matériel modeste.

<h3>11.1.2 - Puis-je bénéficier d'une interface graphique sans X ?</h3>
Si l'on considère que les
<a href="http://en.wikipedia.org/wiki/ASCII_Art">graphiques ASCII</a>
ne sont pas satisfaisants, cela nécessiterait un pilote framebuffer pour
console.
Quelques systèmes d'exploitation offrent un tel pilote ce qui n'est pas
le cas pour OpenBSD et il n'y a pas vraiment d'intérêt pour cela parmi
les développeurs.

<a name="ConfigX"></a>
<h2>11.2 - Configurer X</h2>
La configuration de X varie considérablement d'une plate-forme à l'autre.
Dans tous les cas, il y aura des instructions et des informations
propres à la plate-forme dans le fichier <tt>/usr/X11R6/README</tt> du
système sur lequel il est installé.

<p>
Plusieurs plates-formes requièrent le pilote d'aperture
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xf86&amp;sektion=4">xf86(4)</a>
qui offre un accès à la mémoire et aux ports d'entrée/sortie de la carte
VGA ainsi qu'aux registres de configuration PCI nécessaires.
Ce pilote doit être activé avant d'être utilisé soit en répondant "yes"
à la question suivante posée durant l'installation du système :

<blockquote><pre>
Do you expect to run the X window System [no]
</pre></blockquote>

soit en changeant la valeur de <tt>machdep.allowaperture</tt> en une
valeur non nulle appropriée à votre plate-forme dans le fichier
<tt>/etc/sysctl.conf</tt> et en redémarrant la machine (pour raisons de
sécurité, cette valeur sysctl ne peut pas être changée après le
lancement de la machine).
Il existe des conséquences sur la sécurité, ne le faites pas si vous
n'en avez pas vraiment besoin.


<h3>11.2.1 - alpha</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.alpha"
>/usr/X11R6/README</a> pour alpha.

<p>
Mettez <tt>machdep.allowaperture=1</tt> dans <tt>/etc/sysctl.conf</tt>.

<p>
Les cartes TGA ainsi que certaines VGA sont supportées. Aucune
configuration supplémentaire ne devrait être nécessaire.

<h3>11.2.2 - amd64</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.amd64"
>/usr/X11R6/README</a> pour amd64.

<p>
Mettez <tt>machdep.allowaperture=2</tt> dans <tt>/etc/sysctl.conf</tt>.

<p>
Dans la plupart des cas, X sous amd64 se configure automatiquement et
aucune manipulation supplémentaire ne devrait être nécessaire.
Si une configuration spécifique est nécessaire, utilisez la procédure
<a href="#amd64i386">X&nbsp;-configure</a> comme expliquée
<a href="#amd64i386example">plus bas</a>.

<h3>11.2.3 - armish</h3>
Pas de serveur X, seulement des clients.

<h3>11.2.4 - hp300</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.hp300"
>/usr/X11R6/README</a> pour hp300.

<h3>11.2.5 - hppa</h3>
Pas de serveur X, seulement des clients.

<h3>11.2.6 - i386</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.i386"
>/usr/X11R6/README</a> pour i386.

<p>
Mettez <tt>machdep.allowaperture=2</tt> dans <tt>/etc/sysctl.conf</tt>.

<p>
Du fait du choix énorme de cartes vidéos, souris, claviers et autres
matériels pour cette plate-forme, configurer X sous un système i386 peut
s'avérer excitant. Suffisamment excitant d'ailleurs pour qu'une
<a href="#amd64i386">section séparée</a> soit proposée.

<p>
Fort heureusement, les choses ne sont pas toujours aussi noires qu'elles
le semblent ; dans la plupart des cas, X "fonctionne tout simplement" en
tapant "startx".
Dans ce cas, votre matériel sera détecté et interrogé sur ses capacités
ce qui permettra à X de très bien fonctionner.

<h3>11.2.7 - landisk</h3>
Pas de serveur X, seulement les clients.

<h3>11.2.8 - luna88k</h3>
Pas de serveur X, seulement les clients.

<h3>11.2.9 - mac68k</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.mac68k"
>/usr/X11R6/README</a> pour mac68k.

<p>
Les systèmes Mac68k "fonctionneront tout simplement", aucune
configuration n'est nécessaire.

<p>
La souris : la souris Macintosh standard ne possède qu'un seul bouton ce
qui est un problème puisque X s'attend à une souris 3-boutons.
Certaines souris de vendeurs tiers auront un deuxième bouton qui
fonctionnera sous X.
Sinon, vous devrez vous référer au manuel Xmac68k(1) afin d'obtenir des
informations sur l'émulation pour les souris à un bouton.


<h3>11.2.10 - macppc</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.macppc"
>/usr/X11R6/README</a> pour macppc.

<p>
Mettez <tt>machdep.allowaperture=2</tt> dans <tt>/etc/sysctl.conf</tt>.

<p>
Les systèmes PPC Macintosh peuvent fonctionner sous deux modes
différents : "accéléré" et "framebuffer" (non accéléré).

<p>
En mode "framebuffer", le système tournera avec 8 bits par pixel et la
résolution vidéo sera contrôlée par l'environnement Macintosh, vous
devrez donc garder une petite partition sous MacOS sur votre disque afin
de pouvoir changer la configuration.
Ce mode à l'avantage de "fonctionner tout simplement" mais il peut
apparaître comme statique et frustrant (par exemple, changer la
résolution peut demander un redémarrage sous MacOS).

<p>
Si votre Macintosh possède un système vidéo basé sur de l'ATI il peut
tourner en mode X accéléré ce qui offre de meilleures performances et
plus de contrôle sous l'environnement OpenBSD.
Les cartes vidéo NVIDIA présentes dans certains systèmes macppc
devraient également fonctionner dans la plupart des cas.
Le fichier README contient des détails sur la configuration du pilote
accéléré, basez-vous sur l'exemple qu'il fourni.

<p>
Bien que le fichier README contienne des détails pour utiliser une
souris Apple standard à un bouton sous X, à moins d'utiliser un
portable, il vous est vivement recommandé d'acheter une souris tierce
plus moderne.


<h3>11.2.11 - mvme68k</h3>
Pas de serveur X, seulement les clients.

<h3>11.2.12 - mvme88k</h3>
Pas de serveur X, seulement les clients.

<h3>11.2.13 - sgi</h3>
Pas de serveur X, seulement les clients.

<h3>11.2.14 - sparc</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.sparc"
>/usr/X11R6/README</a> pour sparc.

<p>
Avec un seul framebuffer supporté il n'y a pas besoin de configuration.
Si vous souhaitez utiliser une configuration multi-affichage, lisez le
README ci-dessous pour plus de détails.

<p>
La résolution est contrôlée par le firmware avant de démarrer OpenBSD.

<h3>11.2.15 - sparc64</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.sparc64"
>/usr/X11R6/README</a> pour sparc64.

<p>
Il existe de nombreuses variations de ces machines et vous aurez besoin
de connaître quel type de bus votre système utilise (PCI ou SBus), à
quel port votre souris est branchée (zstty, com, ou USB/PS2) et quel
type de carte vidéo vous possédez.
Démarrez avec le fichier d'exemple <tt>xorg.conf</tt> présent dans le
<tt>README</tt> et modifiez les valeurs indiquées en fonction de votre
matériel et de vos besoins.
<i>N'espérez pas que le fichier d'exemple fonctionne sans modification
sur votre machine !</i>

<h3>11.2.16 - vax</h3>
Lisez
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.vax"
>/usr/X11R6/README</a> pour vax.

<p>
Le serveur X ne fonctionne pour l'instant que sur les models VAXstation
4000 en utilisant soit le framebuffer
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lcg&amp;sektion=4&amp;arch=vax">lcg(4)</a>
soit le framebuffer
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lcspx&amp;sektion=4&amp;arch=vax">lcspx(4)</a>.

<h3>11.2.17 - zaurus</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.zaurus"
>/usr/X11R6/README</a> pour zaurus.

<p>
Pas de configuration nécessaire, X "fonctionne tout simplement".

<p>
<a name="amd64i386"></a>
<h2>11.3 - Configurer X sur amd64 et i386</h2>
La variété de matériel présent sur ces plates-formes rend la configuration
de X assez "laborieuse".

<h3>11.3.1 - Configuration de X.Org</h3>
X.Org a fait de gros progrès pour permettre à leurs serveurs de
"fonctionner tout simplement". Dans la plupart des cas tout fonctionne
sans fichier <tt>/etc/X11/xorg.conf</tt>.
Mais pas toujours et parfois vous aurez besoin de configurer quelque
chose qui ne fonctionnne pas.

<p>
Il existe deux programmes permettant de créer un fichier configuration
pour les serveurs X.Org i386 de façon semi-automatique.
Malheureusement, aucun d'entre eux ne garantit la création d'un fichier
xorg.conf utilisable.

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Xorg&amp;sektion=1">Xorg(1)</a>
lancé avec le mode "X -configure" chargera tous les pilotes vidéo
disponibles, détectera le matériel et se basant sur ce qu'il trouve,
écrira un fichier xorg.conf qui pourra ou non fonctionner, mais même
s'il ne fonctionne pas il représentera un bon point de départ à une
configuration manuelle.

<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorgconfig&amp;sektion=1">xorgconfig</a>
est un autre programme qui tente de créer un fichier xorg.conf de façon
interactive, il s'agit d'une application en mode texte uniquement.

</ul>

En plus des exemple précédents, une autre façon de configurer X mais qui
demande du temps est d'utiliser votre moteur de recherche favori afin de
trouver quelqu'un d'autre qui aurait rencontré et résolu votre problème.
Bien que cette méthode ne soit pas mauvaise, nous ne nous y attarderons
pas plus.

<p>

<a name="amd64i386example"></a>
<h3>11.3.2 - Notre machine d'exemple</h3>
Pour une démonstration de configuration X, nous utiliserons un vieux
système équipé d'un Celeron 400MHz et d'un port AGP.
La carte vidéo sera une ancienne carte AGP visible dans le dmesg à la
ligne :

<blockquote><pre>
vga1 at pci1 dev 0 function 0 "3DFX Interactive Banshee" rev 0x03
</pre></blockquote>

Il s'agit d'une ancienne carte haut-de-gamme qui n'est à présent plus
vraiment supportée par les nouvelles versions des systèmes
d'exploitation "principaux".
L'écran relié au système est un moniteur CRT "Sony Multiscan G400 19" et
il serait plaisant de pouvoir afficher une résolution de 1280x1024 sur
celui-ci avec une fréquence de rafraîchissement décente et des couleurs
24 bit.

<p>
En premier lieu, après avoir installé OpenBSD avec X (et être certain
que le pilote d'aperture est activé dans le noyau), voyons ce que la
détection et la configurarion automatique de X.Org nous propose, après
tout nous pourrions être chanceux.
Nous allons nous identifiez puis utiliserons donc la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=startx&amp;sektion=1">startx(1)</a>.
L'écran devient blanc quelques secondes puis nous obtenons le fond
d'écran en "échiquier" de X, le curseur X et une fenêtre xterm.

<p>
Ca marche !

<p>
Plus ou moins.
Bien que le système soit pleinement fonctionnel, il ne paraît pas avoir
détecté une quelconque des fonctionnalités de l'écran et tourne à très
basse résolution (640x480).
Nous espérons pouvoir faire mieux que cela.
Bien mieux en fait.
Cependant, cela signifie que nous aurons besoin de créer notre propre
fichier de configurarion xorg.conf.

<p>
Servons-nous de la commande "X -configure" afin de créer un fichier
<tt>xorg.conf</tt> de base.
Vous devrez lancer la commande suivante en tant qu'utilisateur root :
<blockquote><pre>
# <b>X -configure</b>
 [...]
Your xorg.conf file is /root/xorg.conf.new

To test the server, run 'X -config /root/xorg.conf.new'
</pre></blockquote>

Au fait, ce message est sérieux ; utilisez le chemin complet vers votre
fichier <tt>xorg.conf.new</tt> même s'il repose dans votre répertoire
actuel par défaut.
Sinon,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=X&amp;sektion=7">X(7)</a>
ne trouvera pas le fichier et il utilisera la configuration par défaut
qui peut n'avoir aucun rapport avec le fichier sur lequel vous affiner
actuellement la configuration.
Cela permettra de vous éviter de déboguer le pourquoi cela ne fonctionne
pas.
Faites-nous confiance là-dessus.


<p>
Donc, faisons comme il dit et voyons ce que nous obtenons :
<blockquote><pre>
# <b>X -config /root/xorg.conf.new</b>
</pre></blockquote>

A présent, tout ce que nous avons est un écran noir.
Les choses avaient pourtant si bien commencées...

<p>
Le moment est peut-être venu de vous parler des différentes manières de
sortir de X lorsqu'il démarre de cette façon.
Par ordre de préférence :
<ul>
<li><b>CTRL-ALT-Backspace</b> : cette combinaison devrait à priori
terminer X ainsi que toutes les applications X immédiatement. Bien
entendu, durant la procédure de configuration vous n'avez aucune
application qui tourne et donc, ce n'est pas un problème (et en fait,
actuellement, il s'agit de votre <i>meilleur</i> moyen de sortir de X).
<li>Connectez vous en <b>SSH vers votre machine</b>, et tapez 
"<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkill&amp;sektion=1">pkill</a>
Xorg", ce qui devrait terminer X et vous ramener sur une console
utilisable.
<li>Connectez vous en <b>SSH vers votre machine</b>, et redémarrez-la.
<li><b>Reset du bouton d'alimentation.</b> Parfois, les choses se
passent vraiment mal.
Oui, il est généralement important de configurer X avant de charger des
applications critiques dans le système.
Parfois une mauvaise configuration de X fera planter totalement la
machine au point que seul un reset matériel résoudra le problème.
</ul>

Heureusement pour nous, CTRL-ALT-Backspace fonctionne bien et nous
voici revenu à l'invite de commandes.
Bien, à présent nous devons regarder si nous pouvons comprendre ce qui
s'est mal passé.
Tout d'abord, nous devrions jetez un oeil sur ce à quoi X s'imagine et
qui est enregistré dans le fichier <tt>/var/log/Xorg.0.log</tt>.
Dans ce cas, il semble que X pense que tout tourne bien et il n'y a pas
d'erreurs flagrantes dans le journal d'événements (les lignes
commençant par "<tt>(EE)</tt>" sont des erreurs).

<p>
Maintenant, il est utile de connaître votre matériel.
Brancher ce système sur un moniteur différent alors que l'écran noir est
toujours présent affiche le message "Sync. Out of Range" sur l'écran.
Apparemment donc, la configuration que X nous a fourni ne fonctionnera
pas sur ce moniteur et peut-être même sur AUCUN si le mode sélectionné
ne fonctionne pas avec cette carte particulière (souvenez-vous que X
détecte la puce sur la carte et ce qu'elle est potentiellement capable
de faire, pas la façon dont le fabricant a intégré tous les éléments).
Différents moniteurs réagiront différemment lorsque le rafraîchissement
est mauvais, certains tenteront tout de même d'afficher ce qu'ils
peuvent, d'autres passeront en mode de conservation d'énergie alors que
d'autres émettront d'horribles bruits ou afficheront des messages
informatifs à l'écran.
Ce moniteur ne semble rien faire de tout cela.
On notera de ne PAS utiliser cet écran pour une configuration initiale
de X dans le futur.

<p>
En jetant un oeil au fichier xorg.conf.new l'on peut voir ceci :
<blockquote><pre>
Section "Monitor"
        #DisplaySize      370   270     # mm
        Identifier   "Monitor0"
        VendorName   "SNY"
        ModelName    "SONY CPD-G400"
 ### Comment all HorizSync and VertSync values to use DDC:
        HorizSync    30.0 - 107.0
        VertRefresh  48.0 - 120.0
        Option      "DPMS"
EndSection
</pre></blockquote>

Pour le test, essayons d'utiliser DDC ("Data Display Channel", une façon
que possède le moniteur de renseigner l'ordinateur et la carte vidéo sur
ses capacités) et voyons ce qu'il se passe.
Cette fois, nous obtenons le maillage X et un curseur de souris mobile
ce qui est tout ce à quoi nous pouvons nous attendre lorsque nous
démarrons X de cette façon (nous quittons X en utilisant
CTRL-ALT-Backspace comme expliqué plus haut).
Cela reste (encore) dans une très basse résolution, mais cela fonctionne
ce qui signifie certainement que la résolution et la fréquence de
rafraîchissement posent problème.
Nous restaurons "HorizSync" et "VertRefresh" à leur valeur précédente
car nous avons vérifié les spécifications de ce moniteur en recherchant
sur Internet.

<p>
Essayons de forcer Xorg à une résolution spécifique et voyons si nous
avons de la chance.
Dans la partie <tt>Section "Screen"</tt> du fichier xorg.conf, nous
ajouterons deux lignes.
Celles-ci sont montrées en gras :

<blockquote><pre>
Section "Screen"
        Identifier "Screen0"
        Device     "Card0"
        Monitor    "Monitor0"
<b>        DefaultDepth   24</b>
        SubSection "Display"
                Viewport   0 0
                Depth     1
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     4
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     8
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     15
        EndSubSection
        SubSection "Display"
                Viewport   0 0 
                Depth     16
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     24
<b>                Modes	"1280x1024"</b>
        EndSubSection
EndSection
</pre></blockquote>

Ces deux changements indiquent que nous souhaitons faire tourner X à
une profondeur d'affichage de 24 bit et, pour cette profondeur,
bénéficier d'une résolution de 1280x1024.
Puisqu'aucune autre résolution n'est précisée pour le mode "Depth 24",
le système sera forcé de l'utiliser.

<p>
Nous testons nos changements et... SUCCES !
Nous obtenons ce qui semble être un très bel affichage en haute
résolution.
Notez bien que TOUT ce à quoi vous devez vous attendre est un maillage
X (appelé
"<a href="http://www.openbsd.org/cgi-bin/cvsweb/xenocara/xc/include/bitmaps/root_weave">rootweave</a>",
il est parfait pour voir la qualité de votre moniteur et pour calibrer
les écrans LCD, ) et un curseur mobile.
A ce point, rien ne se doit d'être fonctionnel.

<p>
A présent, installons ce fichier xorg.conf afin de voir comment cela
fonctionne avec un X fonctionnel qui tourne.

<blockquote><pre>
# cp xorg.conf.new /etc/X11/xorg.conf
</pre></blockquote>

Nous pouvons maintenant utiliser la commande normale startx(1).
Ca marche !

<p>
Il serait probablement bon de vérifier que nous sommes bien à la
résolution et à la profondeur que nous désirons et que nous tournons à
une fréquence de rafraîchissement correcte.
Nous pouvons le vérifier avec les commandes
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xrandr&amp;sektion=1">xrandr(1)</a>
et 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdpyinfo&amp;sektion=1">xdpyinfo(1)</a>.
Entre autres, xdpyinfo(1) nous dit :
<blockquote><pre>
    [...]
screen #0:
  print screen:    no
  dimensions:    1280x1024 pixels (433x347 millimeters)
  resolution:    75x75 dots per inch
  depths (7):    24, 1, 4, 8, 15, 16, 32
  root window id:    0x44
  depth of root window:    24 planes
    [...]
</pre></blockquote>

Donc oui, nous tournons bien à 1280x1024 avec une profondeur de 24
planes (bits).

<p>
xrandr(4) nous dit :
<blockquote><pre>
 SZ:    Pixels          Physical       Refresh
*0   1280 x 1024   ( 433mm x 347mm )  *85   75   60  
 1   1280 x 960    ( 433mm x 347mm )   85   60  
    [...]
</pre></blockquote>

ce qui signifie que nous tournons avec une fréquence de rafraîchissement
de 85Hz, ce qui devrait être confortable pour la plupart des
utilisateurs.


<p>
<h3>11.3.3 - Et si ce n'est pas si "facile" ?</h3>
Parfois, les choses ne vont pas de soi.
Voici quelques conseils.

<ul>
<li>Référez-vous à la page de manuel du serveur X que vous utilisez.
Dans notre exemple, nous pouvons voir dans le fichier
<tt>/var/log/Xorg.0.log</tt> que X utilise le pilote TDFX et donc notre
manuel sera
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tdfx&amp;sektion=4">tdfx(4)</a>.
Vous trouverez souvent des astuces, limitations et options pour
configurer votre carte vidéo.
Celles-ci varient selon les pilotes donc n'imaginez pas que vous n'avez
pas besoin de lire la page de manuel de votre pilote actuel sous
prétexte d'en avoir lu une différente avant.

<li>Testez des écrans différents.
Comme nous l'avons vu dans notre exemple précédent, différents moniteurs
donnent souvent des indices différents sur les problèmes que vous pouvez
rencontrer.

<li>Essayez le pilote X
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vesa&amp;sektion=4">vesa(4)</a>.
Pour des raisons de performance, il s'agit de votre "dernier choix",
mais il fonctionne avec presque toutes les cartes vidéo même celles dont
aucun des "meilleurs" pilotes pour serveur X ne fonctionne.

<li>Utilisez un autre matériel.
Si vous avez le choix du type de carte vidéo à utiliser, essayez-en
d'autres.


</ul>

<a name="StartingX"></a>
<h2>11.4 - Démarrer X</h2>
Il existe deux méthodes génériques pour démarrer X :

<h3>11.4.1 - A la demande :</h3>
Identifiez-vous sous une console en tant qu'utilisateur puis lancez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=startx&amp;sektion=1">startx(1)</a>.

<h3>11.4.2 - Démarrer directement sous X :</h3>
Cela se fait en utilisant le gestionnaire de connexion graphique ("X
Display Manager")
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdm&amp;sektion=1">xdm(1)</a>.
Normalement, xdm(1) est démarré tant que root par
<a href="faq10.html#rc">rc</a> et présente une invite d'identification.
En cas d'identification correcte, il démarre une session X pour cet
utilisateur.
Si, ou lorsque cette session X doit se terminer (cela inclu
l'enchaînement CTRL-ALT-Backspace), xdm(1) réapparaîtra avec son invite
d'identification.
C'est pour cette raison que vous ne devez PAS démarrer xdm(1) à partir
du fichier <tt>/etc/rc.conf.local</tt> avant d'être certain d'avoir
vérifié que X fonctionne comme vous le souhaitez sinon votre machine
risque de devenir difficile à gérer !
(dans le pire des cas : démarrez en mode "single user" comme si vous
aviez <a href="faq8.html#LostPW">perdu votre mot de passe</a> et
commentez la ligne xdm_flags de votre fichier
<tt>/etc/rc.conf.local</tt>).

<p>
Sur certaines plates-formes, vous aurez besoin de désactiver la console
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=getty&amp;sektion=8">getty(8)</a>
pour utiliser xdm(1).


<p>
<!-- a name= "TuningRes"></a>
<h2>11.9 - Optimiser la résolution de votre écran sous X</h2>

<i>Remarque : La plupart des utilisateurs n'ont pas à se soucier
de la création manuelle du ModeLine avec les versions récentes de X.
CEPENDANT, cette opération est parfois nécessaire dans des situations
unusuelles.</i>

<p>
Avec plusieurs moniteurs multi-sync, il est possible de configurer un
serveur X avec une résolution acceptable. Si quelqu'un a déjà essayé de
faire ceci avec les utilitaires standards xorgconfig ou XF86Setup, il
est fort probable qu'il n'aie pas obtenu les meilleurs résultats
possibles. Un des aspects les plus difficiles est de simplement
configurer votre moniteur avec votre résolution préférée, puis de
paramétrer la vitesse de balayage vertical à une valeur d'au moins 72-75
Hz, une valeur où le scintillement de l'écran est beaucoup moins visible
à l'oeil humain. Inversement, qu'en est t'il quand vous essayez de
positionner la vitesse de balayage vertical à une vitesse très faible ?
Vous pouvez le positionner à 50 Hz de telle manière à pouvoir en
capturer le contenu sur une vidéo sans scintillement, mais les méthodes
pour effectuer cette opération ne sont pas évidentes avec les outils et
la documentation standards de X.

<p>
Enfin, il est possible (avec les nouveaux moniteurs du moins) d'utiliser
des vitesses de balayage vertical de 85 Hz et plus, afin d'obtenir une
image très propre et agréable à des résolutions normalement utilisées
par beaucoup de gens sur des moniteurs VGA à faible coût (800x600,
1024x768, 1152x900, 1280x1024). Le serveur X possède un mécanismequi
vous permet de décrire en détail le mode vidéo que vous voulez utiliser
: C'est le ModeLine. Un ModeLine a quatre sections. Un chiffre pour la
dotclock (bande passante), quatre chiffres pour les temporisations
horizontales, quatre chiffres pour les temporisations verticales, et une
section optionnelle contenant une liste de drapeaux spécifiant d'autres
caractéristiques du mode (telles que l'interlaçage, DoubleScan, ... Voir
la page xorg.conf(5) du manuel pour plus de détails concernant
ModeLine).

<p>
La génération d'un ModeLine s'apparente à de la magie noire...
Heureusement, il existe plusieurs scripts qui peuvent vous en générer
un. Un de ces scripts est
<a href="http://koala.ilog.fr/cgi-bin/nph-colas-modelines">Colas XFree86
ModeLine Generator</a>. Un autre est 
<a href="http://xtiming.sourceforge.net/">The XFree86 ModeLine Generator</a> 
hébergé par SourceForge et plusieurs autres sont disponibles sur
<a href="http://freshmeat.net/search/?q=modeline">Freshmeat</a>.
Avant de pouvoir utiliser ces générateurs ModeLine, vous devez trouver
les limites de synchronisation verticale et horizontale de votre
moniteur. C'est souvent documenté dans le manuel ou sur le site Web du
constructeur. Si ne vous trouvez ni l'un ni l'autre, faites une
recherche sur le Web avec le modèle et la marque du moniteur. Plusieurs
personnes sympathiques ont rassemblé des listes avec ce type
d'informations.

<p>
Par exemple, supposons que vous avez un moniteur Dell D1226H. Vous avez
effectué des recherches en agonisant sur le site Web de Dell pour savoir
qu'il a une plage de balayage horizontal de 30-95 kHz et 50-160 Hz en
balayage vertical. Visitez la page du générateur de ModeLine et
saisissez ces informations. La prochaine étape consiste à saisir la
vitesse minimale de balayage vertical que vous voulez. N'importe quelle
vitesse de 72 Hz et au delà devrait permettre d'obtenir un scintillement
peu visible. Plus vous montez la vitesse, plus votre image est claire et
précise.

<p>
Avec toutes ces informations, le script va générer un ModeLine pour
toutes les résolutions 4x3 possibles que votre moniteur peut supporter,
et au-dessus de la vitesse minimale de balayage verticale que vous avez
saisi. Si quelqu'un avait saisi les spécifications de ce moniteur Dell
avec une vitesse minimale de balayage verticale de 75 Hz, le script
donnera quelque chose comme :

<pre>
ModeLine "320x240" 20.07 320 336 416 448 240 242 254 280 #160Hz
ModeLine "328x246" 20.86 328 344 424 456 246 248 260 286 #160Hz
...
ModeLine "816x612" 107.39 816 856 1056 1136 612 614 626 652 #145Hz
ModeLine "824x618" 108.39 824 864 1064 1144 618 620 632 658 #144Hz
ModeLine "832x624" 109.38 832 872 1072 1152 624 626 638 664 #143Hz
...
ModeLine "840x630" 109.58 840 880 1080 1160 630 632 644 670 #141Hz
ModeLine "848x636" 110.54 848 888 1088 1168 636 638 650 676 #140Hz
...
ModeLine "1048x786" 136.02 1048 1096 1336 1432 786 788 800 826 #115Hz
ModeLine "1056x792" 136.58 1056 1104 1344 1440 792 794 806 832 #114Hz
ModeLine "1064x798" 137.11 1064 1112 1352 1448 798 800 812 838 #113Hz
...
ModeLine "1432x1074" 184.07 1432 1496 1816 1944 1074 1076 1088 1114 #85Hz
ModeLine "1576x1182" 199.86 1576 1648 2008 2152 1182 1184 1196 1222 #76Hz
ModeLine "1584x1188" 198.93 1584 1656 2016 2160 1188 1190 1202 1228 #75Hz
</pre>

<p>
Bien que ce moniteur prétend atteindre 1600x1200 @ 75 Hz, le script ne
dit pas que cette résolution peut être atteinte à 75 Hz. Si vous voulez
précisément avoir 1600x1200, abaissez un peu votre vitesse minimale ...
(Dans l'exemple qui suit, nous fixons cette vitesse à 70 Hz)

<pre>
ModeLine "1592x1194" 197.97 1592 1664 2024 2168 1194 1196 1208 1234 #74Hz
ModeLine "1600x1200" 199.67 1600 1672 2032 2176 1200 1202 1214 1240 #74Hz
ModeLine "1608x1206" 198.65 1608 1680 2040 2184 1206 1208 1220 1246 #73Hz
ModeLine "1616x1212" 197.59 1616 1688 2048 2192 1212 1214 1226 1252 #72Hz
ModeLine "1624x1218" 199.26 1624 1696 2056 2200 1218 1220 1232 1258 #72Hz
ModeLine "1632x1224" 198.15 1632 1704 2064 2208 1224 1226 1238 1264 #71Hz
ModeLine "1640x1230" 199.81 1640 1712 2072 2216 1230 1232 1244 1270 #71Hz
ModeLine "1648x1236" 198.64 1648 1720 2080 2224 1236 1238 1250 1276 #70Hz
</pre>

<p>
Comme on peut le voir, ce moniteur peut faire 1600x1200 @ 74 Hz quand la
vitesse de point (bande passante) est limitée à 200 Mhz. Positionnez la
bande passante par rapport aux limites définies par le moniteur.

<p>
Une fois que vous avez vos ModeLines, mettez les dans le fichier
/etc/X11/xorg.conf. Mettez en commentaire les anciens ModeLines de
telle façon à pouvoir les utiliser par la suite si les nouveaux ne
fonctionnent pas. Ensuite choisissez votre résolution. D'abord vous
devez déterminer si X tourne en mode accéléré (ce qui est le cas avec la
plupart des cartes graphiques) afin de savoir quelle section
<tt>"Screen"</tt> modifier dans le fichier xorg.conf. Sinon, modifiez
toutes les sections Screen.

<pre>
Section "Screen"
   Driver          "Accel"
   Device          "Primary Card"
   Monitor         "Primary Monitor"
   DefaultColorDepth 32
   SubSection "Display"
      Depth        32
      Modes        "1280x1024" "1024x768"
   EndSubSection
</pre>

<p>
La première fréquence que vous voyez après la ligne &quot;Modes&quot;
est la fréquence avec laquelle X va démarrer. En appuyant sur les
touches CTRL-ALT-MOINS DU PAVE NUMERIQUE, ou CTRL-ALT-PLUS DU PAVE
NUMERIQUE, vous pouvez commuter entre les fréquences que vous avez
spécifié sur cette ligne. Selon la section ci-dessus, X va essayer de
démarrer en mode couleur 32 bits (via la directive DefaultColorDepth
sans laquelle X va démarrer en mode couleur 8 bits). La première
résolution qu'il essayera de charger est 1280x1024 (il suit l'ordre
précisé dans la ligne Modes). Notez que &quot;1280x1024&quot; est
simplement un label des valeurs du ModeLine.

<p>
Il est à noter que le script de génération du ModeLine possède des
options qui permettent de rendre ces temporisations plus flexibles pour
les vieux ou petits moniteurs. De même, il a la capacité de fournir des
ModeLines pour des résolutions spécifiques. Selon le type de matériel
que vous avez, il ne sera peut-être pas facile de l'utiliser avec les
options par défaut. Si l'image est trop grande, trop large, ou trop
petite, ou elle est décalée horizontalement ou verticalement, et les
contrôles du moniteur ne sont pas suffisants pour corriger son
apparence, vous pouvez utiliser xvidtune(1) afin d'ajuster le ModeLine
pour mieux respecter les temporisations du moniteur.

<p>
Sur la plupart des moniteurs modernes, il n'y a pas de limite fixée sur
la bande passante. C'est pourquoi elles ne sont plus listées dans les
spécifications. Mais plus vous augmentez la bande passante, plus l'image
devient floue. Ainsi, vous pouvez commencer par la bande passante
(appelée aussi &quot;dotclock&quot;) de votre carte pour tester (vous ne
pouvez pas abimer votre moniteur comme ça) et diminuer la bande passante
au fur et à mesure jusqu'à ce que vous obteniez une image précise.

<p>
Cette procédure est inutilement complexe. X.Org améliore nettement ce
processus puisque cette version possède des modes internes et est
capable de découvrir les capacités des moniteurs &quot;plug and
play&quot; à travers DCC et DCC2.

5A
<p>
Vous pouvez télécharger le script Colas XFree86 ModeLine
Generator à l'adresse 
<a href="http://koala.ilog.fr/ftp/pub/Klone/">http://koala.ilog.fr/ftp/pub/Klone/</a>. 
Vous aurez besoin de télécharger et de compiler l'interpréteur Klone.
Cet interpréteur se trouve dans la collection de ports sous
<tt>lang/klone</tt>. Les scripts sont dans le répertoire scripts de la
distribution Klone (la collection de ports les installe dans
/usr/local/klone/scripts).

<p> 
Deux versions du script sont incluses. La première est une version CGI
identique à la page Web ci-dessus. La seconde est une version non-CGI
qui va lire votre fichier xorg.conf dans sa totalité, décoder les
spécifications du moniteur que vous avez saisi dans xorgconfig/XF86Setup
(Réfléchissez, avez-vous réellement renseigné le fichier avec les
spécifications de votre moniteur ou avez-vous gardé les valeurs
génériques ?), et corriger les ModeLines existants en conséquence.

<p -->
<font color= "#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq10.html">[Section 10 - Gestion du Système]</a>
<a href= "faq12.html">[Section 12 - Questions Spécifiques Aux
Plates-Formes Et Au Matériel]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq11.html,v 1.74 ]<br>
$Translation: faq11.html,v 1.40 2008/01/25 09:33:55 saad Exp $<br>
-->
$OpenBSD: faq11.html,v 1.34 2008/01/27 20:00:53 saad Exp $
</small>

</body>
</html>
