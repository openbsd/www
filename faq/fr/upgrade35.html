<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide de Mise à Niveau d'OpenBSD</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2004 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif"
border="0">
</a>
<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="upgrade36.html">[3.5 -> 3.6]</a>
</font>

<h1><font color="#e00000">Guide de Mise à Niveau : 3.4 vers
3.5</font></h1>
<hr>

<i>Note : Les mises à niveau sont uniquement supportées d'une révision à
   l'autre, il est recommandé de NE PAS sauter les révisions.</i>

<h2>Avant de mettre à niveau...</h2>
Avant de mettre à niveau, certains utilisateurs choisissent de supprimer
tous les <a href="faq8.html#Packages">packages</a>, et d'installer de
nouvelles versions après la mise à niveau.

<p>
Pour supprimer rapidement tous les packages de votre système :
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Après la mise à niveau, installez les nouvelles versions de ces
applications.

<p>
Le processus de mise à niveau pourrait écraser des fichiers de
configuration de X, il serait souhaitable de sauvegarder votre
répertoire <tt>/etc/X11</tt> avant de mettre à niveau.

<h2>Mise à niveau avec media d'installation</h2>
Le plus facile et le plus sur moyen de mettre à niveau grâce à des
fichiers binaires est de booter depuis un media d'installation et de
suivre les étapes de mise à niveau, qui sont très similaires à celles du
<a href="faq4.html">processus d'installation</a>. Après cela, faites
les <a href="#etcUpdates">mises à jour de <tt>/etc</tt></a> ci-dessous.

<p>
<h2>Mise à niveau sans media d'installation</h2>
<i>Ce n'est pas la solution recommandée. Utilisez le media
d'installation le plus souvent possible !</i>

<p>
On a parfois besoin de mettre à niveau une machine mais on ne peut pas
utiliser le processus classique de mise à niveau. On peut alors réaliser
une mise à niveau basée sur les sources :

<ul>
<li><b>Placez les fichiers d'installation dans un "bon" endroit</b>.
Assurez vous d'avoir la place suffisante !

<li><b>Installez le(s) nouveau(x) noyau(x)</b>
<blockquote><pre>
cd /<i>path</i>
rm /obsd && ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /····
</pre></blockquote>

Notez les étapes additionnelles pour copier par dessus un premier noyau
: celles-ci sont réalisées afin de s'assurer qu'il y ai toujours une
copie valide du noyau sur le disque que le système puisse booter sans
quoi il pourrait y avoir un problème de synchronisation ou une panne
vraiment désagréable.

<li><b>Redémarrez votre système avec le nouveau noyau</b><br>
Il peut être tentant de sauter cette étape, mais ceci devrait être fait
dès à présent, ou le nouveau noyau lancera d'anciennes applications
utilisateur (tel que la commande <tt>reboot</tt> ! qui sera importante
pour la suite). Signalons qu'un nouveau "userland" ne marchera PAS sur
un ancien noyau dans la plupart des cas.

<li><b>Arrêtez toutes les applications qui pourraient causer des
    problèmes lors des étapes suivantes.</b>

<li><b>Installez les nouvelles applications du userland</b>
<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base35.tgz
tar xzpf /<i>path</i>/comp35.tgz
tar xzpf /<i>path</i>/game35.tgz
tar xzpf /<i>path</i>/man35.tgz
tar xzpf /<i>path</i>/misc35.tgz
tar xzpf /<i>path</i>/xbase35.tgz
tar xzpf /<i>path</i>/xfont35.tgz
tar xzpf /<i>path</i>/xserv35.tgz
tar xzpf /<i>path</i>/xshare35.tgz
</pre></blockquote>
Remarque : tous les jeux de fichiers ne devront pas être installés pour
toutes les applications, cependant, si vous aviez installé originalement
un jeu de fichiers, vous devrez certainement le mettre à niveau avec le
nouveau jeu de fichiers.
Notez également que <tt>etc35.tgz</tt> N'est pas décompressé ici, étant
géré séparément.

<li><b>Mettre à jour <tt>/dev</tt>.</b>
Le nouveau fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
sera copié dans /dev par l'installation de <tt>base35.tgz</tt>, vous
n'avez ainsi qu'a faire ce qui suit :
<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>
Consultez aussi les notes ci-dessous qui sont spécifiques aux versions.

<li><b>Mise à niveau de <tt>/etc</tt> comme ci-dessous</b>.

<li><b>Redémarrez</b>
</ul>

Pendant ce processus,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
pourrait produire des messages d'erreur comme :
<pre>
	Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such
	file or directory, fs=., avail=-1, blocksize=380204
</pre>
Ces messages peuvent être ignorés sans risque, mais vous pourriez
vouloir arrêter sendmail(8) pendant la mise à niveau.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Mises à Jour de <tt>/etc</tt></h2>

Si vous mettez à niveau en utilisant un media d'installation et faites
une "mise à niveau" formelle, ou faites une mise à niveau binaire "sur
place", il y a certaines étapes manuelles qui doivent être réalisées.

<a name="users"></a>
<h4>Nouveaux utilisateurs et groupes</h4>
Un certain nombre de démons ont été retravaillés pour abandonner leurs
privilèges ou utiliser la séparation des privilèges, de nouveaux
utilisateurs et groupes sont ainsi requis.

En étant <i>root</i>, ajoutez les utilisateurs et groupes suivants, en
utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a> :

<blockquote><pre>
useradd -u74 -g=uid -c"pflogd privsep" -d/var/empty -s/sbin/nologin _pflogd
useradd -u75 -g=uid -c"BGP Daemon" -d/var/empty -s/sbin/nologin _bgpd
useradd -u76 -g=uid -c"tcpdump" -d/var/empty -s/sbin/nologin _tcpdump
</pre></blockquote>

Ces étapes ajouteront à la fois les nouveaux utilisateurs et leurs
groupes correspondant. Votre environnement pourrait vous autoriser à
couper/coller ces commandes.

<a name="etcfiles"></a>
<h4>Changement de fichiers dans <tt>/etc</tt></h4>
Vous voudrez extraire <tt>etc35.tgz</tt> dans un répertoire temporaire :
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc35.tgz
</pre></blockquote>


Fichiers pouvant probablement être copiés de <tt>etc35.tgz</tt> "en
l'état" :

<blockquote><pre>
bgpd.conf
changelist
locate.rc
moduli
netstart
pf.os
protocols
rc
security
sensorsd.conf
services
var/named/standard/root.hint
mtree/*
</pre></blockquote>

Notez qu'il est possible de modifier ces fichiers localement, si ceci a
été fait, une fusion manuelle pourrait être nécessaire. Voici les lignes
copiées/collées pour copier ces fichiers, à la condition que vous ayez
extrait <tt>etc35.tgz</tt> dans les répertoires conseillés ci-dessous :

<blockquote><pre>
cd /tmp/etc
cp bgpd.conf changelist locate.rc moduli netstart pf.os \
 protocols rc security sensorsd.conf services /etc
cp mtree/* /etc/mtree/
cp ../var/named/standard/root.hint /var/named/standard
</pre></blockquote>

<p>
Fichiers devant être fusionnés manuellement, en respectant tout
changement local effectué sur ceux-ci :
<blockquote><pre>
ftpusers
inetd.conf
login.conf
lynx.cfg
newsyslog.conf
rc.conf
rc.local
remote
sysctl.conf
ttys
mail/*
</pre></blockquote>

Enfin, utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
pour créer les nouveaux répertoires :
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

Après le redémarrage final, vous devriez avoir un système 3.5 pleinement
fonctionnel. Ainsi, vous pouvez <a href="upgrade36.html">mettre à niveau
vers 3.6</a> si vous le souhaitez.

<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="upgrade36.html">[3.5 -> 3.6]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24"
src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade35.html,v 1.1 ]<br>
$Translation: upgrade35.html,v 1.1 2005/04/28 18:41:05 aanriot Exp $
<br>
-->
$OpenBSD: upgrade35.html,v 1.2 2005/05/19 18:23:05 jufi Exp $
</small>

</body>
</html>
