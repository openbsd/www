<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide de Mise à Niveau d'OpenBSD</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2004 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif"
border="0"> </a>
<p>
<font color= "#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a>
<a href= "index.html">[Index De La FAQ]</a>
</font>

<h1><font color="#e00000">Guide de Mise à Niveau : 3.5 vers
    3.6</font></h1> <hr>

<i>Note : Les mises à niveau sont uniquement supportées d'une révision à
   l'autre, il est recommandé de NE PAS sauter les révisions.</i>

<h2>Avant de mettre à niveau...</h2>
Avant de mettre à niveau, certains utilisateurs choisissent de supprimer
tous les <a href="faq8.html#Packages">packages</a>, et d'installer de
nouvelles versions après la mise à niveau.

<p>
Pour supprimer rapidement tous les packages de votre système :
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Après la mise à niveau, installez les nouvelles versions de ces
applications.

<h2>Mise à niveau avec media d'installation</h2>
Le plus facile et le plus sur moyen de mettre à niveau grâce à des
fichiers binaires est de booter depuis un media d'installation et de
suivre les étapes de mise à niveau, qui sont très similaires à celles du
<a href="faq4.html">processus d'installation</a>. Après cela, faites les
<a href="#etcUpdates">mises à jour de <tt>/etc</tt></a> ci-dessous.

<p>
<h2>Mise à niveau sans media d'installation</h2>
<i>Ce n'est pas la solution recommandée. Utilisez le media
   d'installation le plus souvent possible !</i>

<p>
On a parfois besoin de mettre à niveau une machine mais on ne peut pas
utiliser le processus classique de mise à niveau. On peut alors réaliser
une mise à niveau basée sur les sources :

<ul>
<li><b>Placez les fichiers d'installation dans un "bon" endroit</b>.
Assurez vous d'avoir la place suffisante !

<li><b>Installez le(s) nouveau(x) noyau(x)</b>
<blockquote><pre>
cd /<i>path</i>
rm /obsd && ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /    
</pre></blockquote>

Notez les étapes additionnelles pour copier par dessus un premier noyau
: celles-ci sont réalisées afin de s'assurer qu'il y ai toujours une
copie valide du noyau sur le disque que le système puisse booter sans
quoi il pourrait y avoir un problème de synchronisation ou une panne
vraiment désagréable.

<li><b>Redémarrez votre système avec le nouveau noyau</b><br>
Il peut être tentant de sauter cette étape, mais ceci devrait être fait
dès à présent, ou le nouveau noyau lancera d'anciennes applications
utilisateur (tel que la commande <tt>reboot</tt> ! qui sera importante
pour la suite). Signalons qu'un nouveau "userland" ne marchera PAS sur
un ancien noyau dans la plupart des cas.

<li><b>Arrêtez toutes les applications qui pourraient causer des
       problèmes lors des étapes suivantes.</b>

<li><b>Installez les nouvelles applications du userland</b>
<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base36.tgz
tar xzpf /<i>path</i>/comp36.tgz
tar xzpf /<i>path</i>/games36.tgz
tar xzpf /<i>path</i>/man36.tgz
tar xzpf /<i>path</i>/misc36.tgz
tar xzpf /<i>path</i>/xbase36.tgz
tar xzpf /<i>path</i>/xfont36.tgz
tar xzpf /<i>path</i>/xserv36.tgz
tar xzpf /<i>path</i>/xshare36.tgz
</pre></blockquote>
Remarque : tous les jeux de fichiers ne devront pas être installés pour
toutes les applications, cependant, si vous aviez installé originalement
un jeu de fichiers, vous devrez certainement le mettre à niveau avec le
nouveau jeu de fichiers.
Notez également que <tt>etc36.tgz</tt> et <tt>xetc36.tgz</tt> NE sont
pas décompressés ici, étant gérés séparément.

<li><b>Mettre à jour <tt>/dev</tt>.</b>
Le nouveau fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
sera copié dans /dev par l'installation de <tt>base36.tgz</tt>, vous
n'avez ainsi qu'a faire ce qui suit :
<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>
Consultez aussi les notes ci-dessous qui sont spécifiques aux versions.

<li><b>Mise à niveau de <tt>/etc</tt> comme ci-dessous</b>.

<li><b>Redémarrez</b>
</ul>

Pendant ce processus,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
pourrait produire des messages d'erreur comme :
<pre>
	Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such
	file or directory, fs=., avail=-1, blocksize=380204
</pre>
Ces messages peuvent être ignorés sans risque, mais vous pourriez
vouloir arrêter sendmail(8) pendant la mise à niveau.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Mises à Jour de <tt>/etc</tt></h2>

Si vous mettez à niveau en utilisant un media d'installation et faites
une "mise à niveau" formelle, ou faites une mise à niveau binaire "sur
place", il y a certaines étapes manuelles qui doivent être réalisées.

<a name="users"></a>
<h4>Nouveaux utilisateurs et groupes</h4>
Un certain nombre de démons ont été retravaillés pour abandonner leurs
privilèges ou utiliser la séparation des privilèges, de nouveaux
utilisateurs et groupes sont ainsi requis.

En étant <i>root</i>, ajoutez les utilisateurs et groupes suivants, en
utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a> :

<blockquote><pre>
useradd -u77 -g=uid -c"DHCP programs" -d/var/empty -s/sbin/nologin _dhcp
useradd -u78 -g=uid -c"MOP Daemon" -d/var/empty -s/sbin/nologin _mopd
useradd -u79 -g=uid -c"TFTP Daemon" -d/var/empty -s/sbin/nologin _tftpd
useradd -u80 -g=uid -c"rbootd Daemon" -d/var/empty -s/sbin/nologin _rbootd
useradd -u81 -g=uid -c"AFS Daemon" -d/var/empty -s/sbin/nologin _afs
useradd -u82 -g=uid -c"PPP Daemon" -d/var/empty -s/sbin/nologin _ppp
useradd -u83 -g=uid -c"NTP Daemon" -d/var/empty -s/sbin/nologin _ntp
</pre></blockquote>

Ces étapes ajouteront à la fois les nouveaux utilisateurs et leurs
groupes correspondant. Votre environnement pourrait vous autoriser à
couper/coller ces commandes.

<a name="devices"></a>
<h4>Unités</h4>
A cause de la nouvelle gestion des
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pty&amp;sektion=4">pty(4)</a>
il y aura un certain nombre d'anciennes unités pouvant être supprimées :
<blockquote><pre>
cd /dev && rm -f [pt]ty[rq]*
</pre></blockquote>
ou sur les plateformes VAX :
<blockquote><pre>
cd /dev && rm -f [pt]tyr*
</pre></blockquote>

<a name="apps"></a>
<h4>Applications du Userland</h4>

L'utilitaire
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cksum&amp;sektion=1">cksum(1)</a>
n'est plus dans <tt>/usr/bin</tt> mais dans <tt>/bin</tt>.
<blockquote><pre>
rm -f /usr/bin/cksum /usr/bin/sum
</pre></blockquote>

<p>Les utilisateurs de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=">authpf(8)</a>
doivent changer leurs ancres de règles dans le jeu de règles principal de
<blockquote><pre>
anchor authpf
</pre></blockquote>
à
<blockquote><pre>
anchor "authpf/*"
</pre></blockquote>

<a name="etcfiles"></a>
<h4>Changement de fichiers dans <tt>/etc</tt></h4>
Vous voudrez extraire <tt>etc36.tgz</tt> dans un répertoire temporaire :
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc36.tgz
</pre></blockquote>


Fichiers pouvant probablement être copiés de <tt>etc36.tgz</tt> "en
l'état" :

<blockquote><pre>
changelist
magic
netstart
ntpd.conf
pf.os
protocols
rc
rc.securelevel
services
mtree/*
systrace/*
</pre></blockquote>

Notez qu'il est possible de modifier ces fichiers localement, si ceci a
été fait, une fusion manuelle pourrait être nécessaire.
Voici les lignes copiées/collées pour copier ces fichiers, à la
condition que vous ayez extrait <tt>etc36.tgz</tt> dans les répertoires
conseillés ci-dessous :

<blockquote><pre>
cd /tmp/etc
cp changelist magic netstart ntpd.conf pf.os protocols rc rc.securelevel services /etc
cp mtree/* /etc/mtree/
cp systrace/* /etc/systrace/
</pre></blockquote>

<p>
Fichiers devant être fusionnés manuellement, en respectant tout
changement local effectué sur ceux-ci :
<blockquote><pre>
bgpd.conf
ftpusers
inetd.conf
login.conf
lynx.cfg
rc.conf
rc.local
remote
sysctl.conf
ttys
</pre></blockquote>

Enfin, utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
pour créer les nouveaux répertoires :
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

<p>
<font color= "#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a>
<a href= "index.html">[Index De la FAQ]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24"
src="../../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade36.html,v 1.12 ]<br>
$Translation: upgrade36.html,v 1.21 2005/04/28 18:41:05 aanriot Exp $<br>
-->
$OpenBSD: upgrade36.html,v 1.14 2005/05/19 18:23:05 jufi Exp $
</small>

</body>
</html>
