
OpenBSD Frequently Asked Questions - Ver. 2.5
     _________________________________________________________________

   [2.5 logo]

   This FAQ is specifically designed for the 2.5 release of OpenBSD, but
   in some cases will work on earlier versions. This FAQ will take you
   through most critical steps to setting up your own OpenBSD system. The
   addressed questions will range from newbie to advanced users.
   Hopefully you will find this FAQ useful.

   This FAQ was recently updated to support the newest version of
   OpenBSD. To view information for previous versions, please refer to
   [1]FAQ section 11.0, or [2]errata.html.

   Text and PostScript Versions have been created for those of you
   without constant web access. These will be updated weekly.
     * [3]PostScript Version
     * [4]Text Version

   Any questions can be directed to: [5]faq@openbsd.org

   The Current FAQ maintainers are:
   [6]Eric Jackson
   [7]Wim Vandeputte
   [8]Chris Cappuccio
        _________________________________________________________________

  [9]1.0 - Introduction to OpenBSD

     * [10]1.1 - What is OpenBSD?
     * [11]1.2 - What platforms are supported?
     * [12]1.3 - Is OpenBSD really free?
     * [13]1.4 - Why might I want to use OpenBSD?
     * [14]1.5 - How can I help support OpenBSD?
     * [15]1.6 - Who maintains OpenBSD?

  [16]2.0 - Other OpenBSD information resources

     * [17]2.1 - Web Pages
     * [18]2.2 - Mailing Lists
     * [19]2.3 - Manual Pages
     * [20]2.4 - Reporting Bugs

  [21]3.0 - Obtaining OpenBSD

     * [22]3.1 - Buying an OpenBSD CD
     * [23]3.1.1 - Buying OpenBSD T-Shirts
     * [24]3.2 - Downloading via FTP or AFS
     * [25]3.3 - Obtaining Current Source Code

  [26]4.0 - Installation and Disk Setup

     * [27]4.1 - Installing from CD
     * [28]4.2 - Installing from FTP
     * [29]4.3 - Installing via DHCP
     * [30]4.3.1 - Upgrading from various versions of Openbsd
     * [31]4.4 - What files are needed for Installation?
     * [32]4.5 - Using the OpenBSD disklabel
     * [33]4.6 - Using fdisk
     * [34]4.7 - Adding extra disks in OpenBSD
     * [35]4.8 - How to swap to a file
     * [36]4.9 - Soft-updates
     * [37]4.10 - How much space do I need for an OpenBSD installation?
     * [38]4.11 - When I boot after installation of OpenBSD/i386, it says
       "partition 3 id 0".
     * [39]4.12 - How do I get a dmesg from a boot floppy?
     * [40]4.13 - I cannot boot OpenBSD. It just says: "reading boot..
       Bad magic" (i386 specific)
     * [41]4.14 - Multibooting OpenBSD

  [42]5.0 - Kernel Configuration and Setup

     * [43]5.1 - Why do I need a custom kernel?
     * [44]5.2 - Kernel configuration Options
     * [45]5.3 - Building your own kernel
     * [46]5.4 - Boot-time configuration

  [47]6.0 - Networking setup

     * [48]6.1 - Initial network setup
     * [49]6.2 - IP Filter and Network Address Translation
     * [50]6.3 - IPSec
     * [51]6.4 - Dynamic Host Configuration Protocol
     * [52]6.5 - Point to Point Protocol

  [53]7.0 - Keyboard controls

     * [54]7.1 - How do I remap the keyboard?
     * [55]7.2 - Is there gpm or the like in OpenBSD?

  [56]8.0 - General Questions

     * [57]8.1 - What are these kerberos warnings when I first login?
     * [58]8.2 - How do I change virtual terminals?
     * [59]8.3 - I forgot my root password..... What do I do!
     * [60]8.4 - X craps out when I startup.. what am I doing wrong?
     * [61]8.5 - What is CVS, and how do I use it?
     * [62]8.6 - What is the ports tree?
     * [63]8.7 - What are packages?
     * [64]8.8 - Is there any way to use my floppy drive if it's not
       attached during boot?
     * [65]8.9 - OpenBSD Bootloader (i386 specific)
     * [66]8.10 - Using S/Key on your OpenBSD system

  [67]9.0 - Migrating from Linux

     * [68]9.1 - Tips for Linux (and other free Unix-like OS) users
     * [69]9.2 - Dual boot of Linux and OpenBSD

  [70]10.0 - System Administration

     * [71]10.1 - When I try to su to root it says that I'm in the wrong
       group
     * [72]10.2 - How do I duplicate a filesystem?
     * [73]10.3 - How do I get daemons like httpd and sendmail to start
       up with the system?
     * [74]10.4 - Why do users get relaying access denied when they are
       remotely sending mail through my OpenBSD system?
     * [75]10.5 - I've set up POP, but I get errors when accessing my
       mail thru POP. What can i do?
     * [76]10.6 - Setting up a Secure HTTP Server using SSL(8)
     * [77]10.7 - I made changes to /etc/passwd with vi(1), but the
       changes didn't seem to take place. Why?
     * [78]10.8 - How do I add a user? or delete a user?
     * [79]10.9 - How do I create a ftp-only account?
     * [80]10.10 - Setting up user disk quotas
     * [81]10.11 - Setting up Kerberos Client/Server
     * [82]10.12 - Setting up an Anonymous FTP Server

  [83]11.0 - OpenBSD 2.4 Specific Information

     * [84]11.1 - Why do I get UserDir errors when running httpd(8)?
     * [85]11.2 - Installing at a partition 4GB or higher (i386 specific)
     * [86]Log24.txt - Specific OpenBSD 2.4 Install Example

  [87]12.0 - Performance Tuning

     * [88]12.1 - Networking
     * [89]12.2 - Disk I/O
     * [90]12.3 - Tuning kmem
     * [91]12.4 - Hardware Choices
     _________________________________________________________________

   [92][back] [93]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/faq24.html
   2. http://openbsd.org/errata.html
   3. http://openbsd.org/faq/obsd-faq.ps
   4. http://openbsd.org/faq/obsd-faq.txt
   5. mailto:faq@openbsd.org
   6. mailto:ericj@openbsd.org
   7. mailto:wvdputte@openbsd.org
   8. mailto:chris@dqc.org
   9. http://openbsd.org/faq/faq1.html
  10. http://openbsd.org/faq/faq1.html#1.1
  11. http://openbsd.org/faq/faq1.html#1.2
  12. http://openbsd.org/faq/faq1.html#1.3
  13. http://openbsd.org/faq/faq1.html#1.4
  14. http://openbsd.org/faq/faq1.html#1.5
  15. http://openbsd.org/faq/faq1.html#1.6
  16. http://openbsd.org/faq/faq2.html
  17. http://openbsd.org/faq/faq2.html#2.1
  18. http://openbsd.org/faq/faq2.html#2.2
  19. http://openbsd.org/faq/faq2.html#2.3
  20. http://openbsd.org/faq/faq2.html#2.4
  21. http://openbsd.org/faq/faq3.html
  22. http://openbsd.org/faq/faq3.html#3.1
  23. http://openbsd.org/faq/faq3.html#3.1.1
  24. http://openbsd.org/faq/faq3.html#3.2
  25. http://openbsd.org/faq/faq3.html#3.3
  26. http://openbsd.org/faq/faq4.html
  27. http://openbsd.org/faq/faq4.html#4.1
  28. http://openbsd.org/faq/faq4.html#4.2
  29. http://openbsd.org/faq/faq4.html#4.3
  30. http://openbsd.org/faq/upgrade-minifaq.html
  31. http://openbsd.org/faq/faq4.html#4.4
  32. http://openbsd.org/faq/faq4.html#4.5
  33. http://openbsd.org/faq/faq4.html#4.6
  34. http://openbsd.org/faq/faq4.html#4.7
  35. http://openbsd.org/faq/faq4.html#4.8
  36. http://openbsd.org/faq/faq4.html#4.9
  37. http://openbsd.org/faq/faq4.html#4.10
  38. http://openbsd.org/faq/faq4.html#4.11
  39. http://openbsd.org/faq/faq4.html#4.12
  40. http://openbsd.org/faq/faq4.html#4.13
  41. http://openbsd.org/faq/faq4.html#4.14
  42. http://openbsd.org/faq/faq5.html
  43. http://openbsd.org/faq/faq5.html#5.1
  44. http://openbsd.org/faq/faq5.html#5.2
  45. http://openbsd.org/faq/faq5.html#5.3
  46. http://openbsd.org/faq/faq5.html#5.4
  47. http://openbsd.org/faq/faq6.html
  48. http://openbsd.org/faq/faq6.html#6.1
  49. http://openbsd.org/faq/faq6.html#6.2
  50. http://openbsd.org/faq/faq6.html#6.3
  51. http://openbsd.org/faq/faq6.html#6.4
  52. http://openbsd.org/faq/faq6.html#6.5
  53. http://openbsd.org/faq/faq7.html
  54. http://openbsd.org/faq/faq7.html#7.1
  55. http://openbsd.org/faq/faq7.html#7.2
  56. http://openbsd.org/faq/faq8.html
  57. http://openbsd.org/faq/faq8.html#8.1
  58. http://openbsd.org/faq/faq8.html#8.2
  59. http://openbsd.org/faq/faq8.html#8.3
  60. http://openbsd.org/faq/faq8.html#8.4
  61. http://openbsd.org/faq/faq8.html#8.5
  62. http://openbsd.org/faq/faq8.html#8.6
  63. http://openbsd.org/faq/faq8.html#8.7
  64. http://openbsd.org/faq/faq8.html#8.8
  65. http://openbsd.org/faq/faq8.html#8.9
  66. http://openbsd.org/faq/faq8.html#8.10
  67. http://openbsd.org/faq/faq9.html
  68. http://openbsd.org/faq/faq9.html#9.1
  69. http://openbsd.org/faq/faq9.html#9.2
  70. http://openbsd.org/faq/faq10.html
  71. http://openbsd.org/faq/faq10.html#10.1
  72. http://openbsd.org/faq/faq10.html#10.2
  73. http://openbsd.org/faq/faq10.html#10.3
  74. http://openbsd.org/faq/faq10.html#10.4
  75. http://openbsd.org/faq/faq10.html#10.5
  76. http://openbsd.org/faq/faq10.html#10.6
  77. http://openbsd.org/faq/faq10.html#10.7
  78. http://openbsd.org/faq/faq10.html#10.8
  79. http://openbsd.org/faq/faq10.html#10.9
  80. http://openbsd.org/faq/faq10.html#10.10
  81. http://openbsd.org/faq/faq10.html#10.11
  82. http://openbsd.org/faq/faq10.html#10.12
  83. http://openbsd.org/faq/faq24.html
  84. http://openbsd.org/faq/faq24.html#11.1
  85. http://openbsd.org/faq/faq24.html#11.2
  86. http://openbsd.org/faq/log24.txt
  87. http://openbsd.org/faq/faq12.html
  88. http://openbsd.org/faq/faq12.html#12.1
  89. http://openbsd.org/faq/faq12.html#12.2
  90. http://openbsd.org/faq/faq12.html#12.3
  91. http://openbsd.org/faq/faq12.html#12.4
  92. http://openbsd.org/index.html
  93. mailto:www@openbsd.org


   [1][Back to Main Index]

                         1.0 - Introduction to OpenBSD
     _________________________________________________________________

1.1 - What is OpenBSD?

   The [2]OpenBSD project produces a freely available, multi-platform
   4.4BSD-based UNIX-like operating system. Our efforts place emphasis on
   portability, standardization, correctness, and security. [3]OpenBSD
   supports binary emulation of most binaries from SVR4 (Solaris),
   FreeBSD, Linux, BSDI, SunOS, and HPUX.

1.2 - On what systems does OpenBSD run?

   OpenBSD 2.5 will install and run on the following platforms:
     * [4]i386 - CD bootable
     * [5]sparc - CD bootable
     * [6]alpha - CD bootable
     * [7]hp300
     * [8]amiga
     * [9]mac68k
     * [10]powerpc
     * [11]pmax
     * [12]mvme88k

     * The ports for pmax and mvme88k are not included on the 2.5 CD.
       They can be downloaded from any of the OpenBSD ftp sites

   bootable means that OpenBSD will boot directly from the CD. The CD set
   will boot on several hardware platforms. See [13]section 3.0 of this
   FAQ for details of obtaining OpenBSD on CD.

   Previous releases of OpenBSD also had ports for:
     * [14]arc
     * [15]mvme68k

   These were removed from the 2.4 release, but were included in 2.3 if
   you are interested. If you have the proper equipment, bring them up to
   date! You can see updated information about specific platforms at
   [16]http://www.openbsd.org/plat.html

1.3 - Is OpenBSD really free?

   OpenBSD is all free. The binaries are free. The source is free. All
   parts of OpenBSD have reasonable copyright terms permitting free
   redistribution. This includes the ability to REUSE most parts of the
   OpenBSD source tree, either for personal or commercial purposes.
   OpenBSD includes NO further restrictions other than those implied by
   the original BSD license. Software which is written under stricter
   licenses cannot be included in the regular distribution of OpenBSD.
   This is intended to safeguard the free use of OpenBSD. For example,
   OpenBSD can be freely used for personal use, for academic use, by
   government institutions, by non-profit making organizations and by
   commercial organizations.

   For further reading on other popular licenses read:
   [17]http://www.openbsd.org/policy.html.

   The maintainers of OpenBSD support the project largely from their own
   pockets. This includes the time spent programming for the project,
   equipment used to support the many ports, the network resources used
   to distribute OpenBSD to you, and the time spent answering questions
   and investigating users' bug reports. The OpenBSD developers are not
   independently wealthy and even small contributions of time, equipment,
   and resources make a big difference.

1.4 - Why might I want to use OpenBSD?

   New users frequently want to know whether OpenBSD is superior to some
   other free UNIX-like operating system. That question is largely
   un-answerable and is the subject of countless (and useless) religious
   debates. Do not, under any circumstances, ask such a question on an
   OpenBSD mailing list.

   Below are some reasons why we think OpenBSD is a useful operating
   system. Whether OpenBSD is right for you is a question that only you
   can answer.

     * OpenBSD runs on many different hardware platforms.
     * OpenBSD is thought of by many security professionals to be the
       most secure UNIX-like operating system as the result of a
       10-member 1.5-year long comprehensive source code security audit.
     * OpenBSD is a full-featured UNIX-like operating system available in
       source form at no charge.
     * OpenBSD integrates cutting-edge security technology suitable for
       building firewalls and private network services in a distributed
       environment.
     * OpenBSD benefits from strong on-going development in many areas,
       offering opportunities to work with emerging technologies with an
       international community of programmers and end-users.
     * OpenBSD offers opportunities for ordinary people to participate in
       the development and testing of the product.

1.5 - How can I help support OpenBSD?

   We are greatly indebted to the people and organizations that have
   contributed to the OpenBSD project. They are acknowledged by name
   here:

   [18]http://www.openbsd.org/donations.html

   OpenBSD has a constant need for several types of support from the user
   community. If you find OpenBSD useful, you are strongly encouraged to
   find a way to contribute. If none of the suggestions below are right
   for you, feel free to propose an alternative by sending e-mail to
   [19]donations@openbsd.org.

     * Buy an OpenBSD CD. It includes the current full release of
       OpenBSD, and is bootable on many platforms. It also generates
       revenue to support the OpenBSD project, and reduces the strain on
       network resources used to deliver the distribution via the
       Internet. This inexpensive two-CD set includes full source.
       Remember, your friends need their own copy!
     * Donate money. The project has a constant need for cash to pay for
       equipment, network connectivity, and expenses relating to CD
       publishing. Manufacturing CDs requires an up-front out-of-pocket
       investment for the OpenBSD developers, without guaranteed return.
       Send e-mail to [20]donations@openbsd.org to find out how to
       contribute. Even small donations make a profound difference.
     * Donate equipment and parts. The project has a constant need for
       general and specific hardware. Items such as IDE and SCSI disks,
       and various types of RAM are always welcome. For other types of
       hardware such as computer systems and motherboards, you should
       inquire as to current need. Write to [21]donations@openbsd.org to
       arrange for shipment.
     * Donate your time and skills. Programmers who enjoy writing
       operating systems are naturally always welcome, but there are
       literally dozens of other ways that people can be useful. Follow
       mailing lists and help answer new-user questions.
     * Help maintain documentation by submitting new FAQ material (to
       [22]faq@openbsd.org). Form a local user group and get your friends
       hooked on OpenBSD. Make a case to your employer for using OpenBSD
       at work. If you're a student, talk to your professors about using
       OpenBSD as a learning tool for Computer Science or Engineering
       courses. It's also worth mentioning one of the most important ways
       you should not try to "help" The OpenBSD project: do not waste
       your time engaging in operating system flame wars on Usenet
       newsgroups. It does not help the project to find new users and can
       cause substantial harm to important relationships that developers
       have with other developers.

1.6 - Who maintains OpenBSD?

   OpenBSD is maintained by a development team spread across many
   different countries. The project is coordinated by Theo de Raadt,
   located in Canada.

   [23][To Section 2.0 - Other OpenBSD information resources]
     _________________________________________________________________

   [24][back] [25]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/index.html
   3. http://openbsd.org/index.html
   4. http://openbsd.org/i386.html
   5. http://openbsd.org/sparc.html
   6. http://openbsd.org/alpha.html
   7. http://openbsd.org/hp300.html
   8. http://openbsd.org/amiga.html
   9. http://openbsd.org/mac68k.html
  10. http://openbsd.org/powerpc.html
  11. http://openbsd.org/pmax.html
  12. http://openbsd.org/mvme88k.html
  13. http://openbsd.org/faq/faq3.html
  14. http://openbsd.org/arc.html
  15. http://openbsd.org/mvme68k.html
  16. http://openbsd.org/plat.html
  17. http://openbsd.org/policy.html
  18. http://openbsd.org/donations.html
  19. mailto:donations@openbsd.org
  20. mailto:donations@openbsd.org
  21. mailto:donations@openbsd.org
  22. mailto:faq@openbsd.org
  23. http://openbsd.org/faq/faq2.html
  24. http://openbsd.org/faq/index.html
  25. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 1.0 - Introduction to OpenBSD]
   [3][To Section 3.0 - Obtaining OpenBSD]

                   2.0 - Other OpenBSD information resources

2.1 - Web Pages of Interest

   The official website for the OpenBSD project is located at:
   [4]http://www.OpenBSD.org

   A lot of valuable information can be found here regarding about all
   aspects of the OpenBSD project.

   Additional information for laptop users can be found at:
   [5]http://www.monkey.org/openbsd-mobile/ and
   [6]http://www.cpio.net/openbsd/laptops/

2.2 - Mailing Lists

   The OpenBSD project maintains several popular mailing lists which
   users should subscribe to and follow. To subscribe to a mailing list,
   send an e-mail message to [7]majordomo@openbsd.org. That address is an
   automated subscription service. In the body of your message, on a
   single line, you should include a subscribe command for the list you
   wish to join. For example:
subscribe announce

   The list processor will reply to you, asking for confirmation of your
   intent to join the list. The confirmation you send back to the list
   processor will be included in its reply to you. It will look something
   like this:
auth 90855167 subscribe announce you@example.com

   Once you have confirmed your intent to join, you will be immediately
   added to the list, and the list processor will notify you that you
   were successfully added.

   To unsubscribe from a list, you will again send an e-mail message to
   [8]majordomo@openbsd.org. It might look like this:
unsubscribe announce

   If you have any difficulties with the mailing list system, please
   first read the instructions. They can be obtained by sending an e-mail
   message to [9]majordomo@openbsd.org with a message body of "help".
   These are the currently-available OpenBSD mailing lists:

     * announce - Important announcements. This is a low-volume list.
     * tech - General technical discussions
     * misc - User questions and answers
     * bugs - Bugs received via sendbug(1) and discussions about them.
     * source-changes - Automated mailing of CVS source tree changes.
     * ports - Automated mailing of CVS source tree changes.
     * advocacy - Discussion of advocating OpenBSD.

   Archives of the OpenBSD mailing lists can be found by visiting the
   mailing lists web page: [10]http://www.openbsd.org/mail.html
   You can also get mail archives from
   [11]http://www.monkey.org/cgi-bin/wilma ,here they have searchable
   archives of the OpenBSD mailing lists.

   Another mailing list that may be of interest is
   [12]openbsd-mobile@monkey.org. Which is a discussion of the use of
   OpenBSD in mobile computing.

   To subscribe to this list use:

   'echo subscribe | mail "openbsd-mobile-request@monkey.org"'

   The archives for that can be found at:
   [13]http://www.monkey.org/openbsd-mobile/archive/

2.3 - Manual Pages

   OpenBSD comes with extensive documentation in the form of manual
   pages, as well as longer documents relating to specific applications.
   To access the manual pages and other documentation, be sure that you
   installed the man, misc, and text distributions.

   Here is a list of some of the most useful manual pages for new users:

     * [14]afterboot(8) - things to check after the first complete boot
     * [15]boot(8) - system boot strapping procedures
     * [16]passwd.conf(5) - format of the password configuration file
     * [17]adduser_proc(8) - procedure for adding new users
     * [18]adduser(8) - command for adding new users
     * [19]vipw(8) - edit the pass word file
     * [20]man(1) - display the on-line manual pages
     * [21]sendbug(1) - send a problem report (PR) about OpenBSD to a
       central support site.
     * [22]disklabel(8) - Read and write disk pack label.
     * [23]ifconfig(8) - configure network interface parameters.
     * [24]route(8) - manualy manipulate the routing tables.
     * [25]netstat(1) - show network status.
     * [26]reboot, halt(8) - Stopping and restarting the system.
     * [27]shutdown(8) - close down the system at a given time.
     * [28]boot_config(8) - how to change kernel configuration at boot

   Also, If you are one of the people who didn't install the man*.tar.gz
   package, you can find all the OpenBSD man pages on the web at
   [29]http://www.openbsd.org/cgi-bin/man.cgi.

   In general, if you know the name of a command or a manual page, you
   can read it by executing `man command'. For example: `man vi' to read
   about the vi editor. If you don't know the name of the command, or if
   `man command' doesn't find the manual page, you can search the manual
   page database by executing `apropos something' or `man -k something'
   where something is a likely word that might appear in the title of the
   manual page you're looking for. For example:
bsd# apropos "time zone"
tzfile (5) - time zone information
zdump (8) - time zone dumper
zic (8) - time zone compiler

   The parenthetical numbers indicate the section of the manual in which
   that page can be found. In some cases, you may find manual pages with
   identical names living in separate sections of the manual. For
   example, assume that you want to know the format of the configuration
   files for the cron daemon. Once you know the section of the manual for
   the page you want, you would execute `man n command' where n is the
   manual section number.
bsd# man -k cron
cron (8) - daemon to execute scheduled commands (Vixie Cron)
crontab (1) - maintain crontab files for individual users (V3)
crontab (5) - tables for driving cron
bsd# man 5 crontab

   In addition to the UNIX manual pages, there is a typesettable document
   set (included in the misc distribution). It lives in the
   /usr/share/doc directory. If you also installed the text distribution,
   then you can format each document set with a `make' in the appropriate
   subdirectory. The psd subdirectory is the Programmer's Supplementary
   Documents distribution. The smm subdirectory is the System Manager's
   Manual. The usd subdirectory is the UNIX User's Supplementary
   Documents distribution. You can perform your `make' in the three
   distribution subdirectories, or you can select a specific section of a
   distribution and do a `make' in its subdirectory. Some of the
   subdirectories are empty. By default, formatting the documents will
   result in Postscript output, suitable for printing. The Postscript
   output can be quite large -- you should assume 250-300% increase in
   volume. If you do not have access to a Postscript printer or display,
   you may also format the documents for reading on a terminal display.
   In each Makefile you'll need to add the flag -Tascii to each instance
   of the groff commands (or execute it by hand). Some of the documents
   use the ms formatting macros, and some use the me macros. The Makefile
   in each document subdirectory (eg, /usr/share/doc/usd/04.csh/Makefile)
   will tell you which one to use. For example:
bsd# cd /usr/share/doc/usd/04.csh
bsd# groff -Tascii -ms tabs csh.1 csh.2 csh.3 csh.4 csh.a csh.g > csh.txt
bsd# more csh.txt

   The UNIX manual pages are generally more current and trustworthy than
   the typesettable documents. The typesettable documents sometimes
   explain complicated applications in more detail than the manual pages
   do.

   For many, having a hardcopy of the man page can be useful. Here are
   the guidelines to making a printable copy of a man page.

  How do I display a man page source file? (i.e., one whose filename ends in a
  number, like tcpdump.8).

   This is found throughout the src tree. The man pages are found in the
   tree unformatted, and many times thru the use of [30]CVS, they will be
   updated. To view these pages simply :
# nroff -mdoc <file> | more

  How do I get a plain man page with no formatting or control characters?

   This is helpful to get the man page straight, with no non-printable
   characters.
   Example:
# man <command> | col -b

  How can I get a PostScript copy of a man page that's print-ready?

   Note that must be the man page source file (probably a file that ends
   in a number; i.e., tcpdump.8). The PostScript versions of the man
   pages look very nice. They can be printed or viewed on-screen with a
   program like gv (GhostView). GhostView can be found in our [31]Ports
   Tree.
# groff -mdoc -Tps <man_src_file> > outfile.ps

2.4 - Reporting Bugs

   Proper bug reporting is one of the most important responsibilities of
   end users. Very detailed information is required to diagnose most
   serious bugs. Developers frequently get bugs reports via e-mail such
   as these:

   Before submitting any bug report, please ready
   [32]http://www.openbsd.org/report.html
From: joeuser@example.com
To: bugs@openbsd.org
Subject: HELP!!!

I have a PC and it won't boot!!!!! It's a 486!!!!!


   Hopefully most people understand why such reports get summarily
   deleted. All bug reports should contain detailed information. If Joe
   User had really wanted his bug investigated, his bug report would have
   looked something like this:
From: smartuser@example.com
To: bugs@openbsd.org
Subject: 2.5 panics on an i386

After installing OpenBSD 2.5 from the CD which I purchased via your outstanding
on-line ordering system, I find that the system halts before the kernel even
gets loaded. After booting with a bootdisk and escaping to a shell. This is the
dmesg output:

OpenBSD 2.5-current (OSHIBANA) #2: Fri Jun  4 11:11:41 EDT 1999
    shinobi@oshibana:/sys/arch/i386/compile/OSHIBANA
cpu0: F00F bug workaround installed
cpu0: Intel Pentium (P54C) ("GenuineIntel" 586-class) 120 MHz
cpu0: FPU,V86,DE,PSE,TSC,MSR,MCE,CX8
BIOS mem  = 654336 conventional, 15728640 extended
real mem  = 16384000
avail mem = 13725696
using 225 buffers containing 921600 bytes of memory
mainbus0 (root)
bios0 at mainbus0: AT/286+(63) BIOS, date 08/20/96
bios0: apminfo 0xf02dc00c diskinfo 0xf02dc034 cksumlen 1 memmap 0xf02dc0b0
apm0 at bios0: Power Management spec V1.1
apm0: battery life expectancy 96%
apm0: AC on, battery charge high, charging, estimated 1:28 minutes
pci0 at mainbus0 bus 0: configuration mode 1 (no bios)
"Toshiba (2nd ID) Host-PCI" rev 0x11 at pci0 dev 0 function 0 not configured
"Chips and Technologies 65550" rev 0x04 at pci0 dev 4 function 0 not configured
isa0 at mainbus0
isadma0 at isa0
wdc0 at isa0 port 0x1f0-0x1f7 irq 14
wd0 at wdc0 drive 0: <TOSHIBA MK2720FC>
wd0: 1296MB, 2633 cyl, 16 head, 63 sec, 512 bytes/sec, 2654280 sec total
wd0: using 16-sector 16-bit pio transfers, lba addressing (128KB cache)
sb0 at isa0 port 0x220-0x237 irq 7 drq 1: dsp v3.02
midi0 at sb0: <SB MIDI UART>
audio0 at sb0
opl0 at sb0: model OPL3
midi at opl0 not configured
pccom0 at isa0 port 0x3f8-0x3ff irq 4: ns16550a, 16 byte fifo
pccom1 at isa0 port 0x2f8-0x2ff irq 3: ns16550a, 16 byte fifo
pccom2 at isa0 port 0x3e8-0x3ef irq 5: ns16550a, 16 byte fifo
vt0 at isa0 port 0x60-0x6f irq 1: generic VGA, 80 col, color, 8 scr, mf2-kbd
pms0 at vt0 irq 12
fdc0 at isa0 port 0x3f0-0x3f5 irq 6 drq 2
fd0 at fdc0 drive 0: 1.44MB 80 cyl, 2 head, 18 sec
pcic0 at isa0 port 0x3e0-0x3e1 iomem 0xd0000-0xd3fff
pcic0: controller 0 (Intel 82365SL Revision 1) has sockets A and B
pcmcia0 at pcic0 controller 0 socket 0
pcmcia1 at pcic0 controller 0 socket 1
biomask 40c0 netmask 42c0 ttymask 56c2
root on wd0a
pctr: 586-class performance counters and user-level cycle counter enabled
rootdev=0x0 rrootdev=0x300 rawdev=0x302

Thank you!

   If Joe User had a working OpenBSD system from which he wanted to
   submit a bug report, he would have used the sendbug(1) utility to
   submit his bug report to the GNATS problem tracking system. Obviously
   you can't use sendbug(1) when your system won't boot, but you should
   use it whenever possible. You will still need to include detailed
   information about what happened, the exact configuration of your
   system, and how to reproduce the problem. The sendbug(1) command
   requires that your system be able to deliver electronic mail
   successfully on the Internet.

   If you have submitted a bug report and you want to check its current
   status without annoying anyone, the best ways are:

     * Visit the GNATS tracking system:
       [33]http://cvs.openbsd.org/cgi-bin/wwwgnats.pl.
     * Look in the [34]bugs@openbsd.org list archives:
       [35]http://www.openbsd.org/mail.html.

   [36][Back to Main Index] [37][To Section 1.0 - Introduction to
   OpenBSD] [38][To Section 3.0 - Obtaining OpenBSD]
     _________________________________________________________________

   [39][back] [40]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq1.html
   3. http://openbsd.org/faq/faq3.html
   4. http://www.openbsd.org/
   5. http://www.monkey.org/openbsd-mobile/
   6. http://www.cpio.net/openbsd/laptops/
   7. mailto:majordomo@openbsd.org
   8. mailto:majordomo@openbsd.org
   9. mailto:majordomo@openbsd.org
  10. http://openbsd.org/mail.html
  11. http://www.monkey.org/cgi-bin/wilma
  12. mailto:openbsd-mobile@monkey.org
  13. http://www.monkey.org/openbsd-mobile/archive/
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&apropos=0&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&apropos=0&sektion=5&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&apropos=0&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sendbug&apropos=0&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=route&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=reboot&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&apropos=0&sektion=8&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi
  30. http://openbsd.org/faq/faq8.html#8.5
  31. http://openbsd.org/ports.html
  32. http://openbsd.org/report.html
  33. http://cvs.openbsd.org/cgi-bin/wwwgnats.pl
  34. mailto:bugs@openbsd.org
  35. http://www.openbsd.org/mail.html
  36. http://openbsd.org/faq/index.html
  37. http://openbsd.org/faq/faq1.html
  38. http://openbsd.org/faq/faq3.html
  39. http://openbsd.org/faq/index.html
  40. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 2.0 - Other OpenBSD information
   resources] [3][To Section 4.0 - Installation and Disk Setup]

                            3.0 - Obtaining OpenBSD

3.1 - Buying an OpenBSD CD

   Purchasing an OpenBSD CD is generally the best way to get started.
   Visit the ordering page to purchase your copy:
   [4]http://www.openbsd.org/orders.html.

   There are many good reasons to own an OpenBSD CD:
     * CD sales support on-going development of OpenBSD.
     * Development of a multi-platform operating system requires constant
       investment in equipment.
     * Your support in the form of a CD purchase has a real impact on
       future development.
     * The CD contains binaries (and source) for all supported platforms.
     * The CD is bootable on several platforms, and can be used to
       bootstrap a machine without a pre-existing installed operating
       system.
     * The CD is useful for bootstrapping even if you choose to install a
       snapshot.
     * Installing from CD is faster! Installing from CD preserves network
       connectivity resources.
     * OpenBSD CD's always come with very nice stickers. You system isn't
       fully complete without these. You can only get these stickers by
       buying a CD set or donating hardware.

   If you're installing a release version of OpenBSD, you should use a
   CD. Snapshot releases can only be installed over the network.

3.1.1 - Buying OpenBSD T-Shirts

   Yes, OpenBSD now has t-shirts for your wearing enjoyment. You can view
   these at [5]http://www.OpenBSD.org/tshirts.html. Enjoy :)

3.2 - Downloading via FTP or AFS

   There are numerous international mirror sites offering FTP access to
   OpenBSD releases and snapshots. AFS access is also available. You
   should always use the site closest to you. Before you begin fetching a
   release or snapshot, you may wish to use ping and traceroute to
   determine which mirror site is nearest to you and whether that nearest
   mirror is performing adequately. Of course, your OpenBSD release CD is
   always closer than any mirror. Access information is here:

   [6]http://www.openbsd.org/ftp.html

3.3 - Obtaining Current Source Code

   Source to OpenBSD is freely redistributable and available at no
   charge. Generally the best way to get started with a current source
   tree is to install the source from the most recent CD and then
   configure AnonCVS to update it regularly. Information about AnonCVS,
   including how to set it up, is available here:

   [7]http://www.openbsd.org/anoncvs.html.

   or check [8]The OpenBSD FAQ

   If you don't have sufficient network bandwidth to support AnonCVS, or
   if your Internet access is via UUCP, you can still keep your source
   current by using CTM instead of AnonCVS. If that's your situation,
   then starting with a recent release CD is even more important.
   Information about CTM, including how to set it up, is available here:

   [9]http://www.openbsd.org/ctm.html.

   Yet another alternative is to get the source code from the web. You
   can do that thru cvsweb at:
   [10]Http://www.openbsd.org/cgi-bin/cvsweb/

   [11][Back to Main Index] [12][To Section 2.0 - Other OpenBSD
   information resources] [13][To Section 4.0 - Installation and Disk
   Setup]
     _________________________________________________________________

   [14][back] [15]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq2.html
   3. http://openbsd.org/faq/faq4.html
   4. http://openbsd.org/orders.html
   5. http://openbsd.org/tshirts.html
   6. http://openbsd.org/ftp.html
   7. http://openbsd.org/anoncvs.html
   8. http://openbsd.org/faq/faq8.html#8.5
   9. http://openbsd.org/ctm.html
  10. http://www.openbsd.org/cgi-bin/cvsweb/
  11. http://openbsd.org/faq/index.html
  12. http://openbsd.org/faq/faq2.html
  13. http://openbsd.org/faq/faq4.html
  14. http://openbsd.org/faq/index.html
  15. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 3.0 - Obtaining OpenBSD] [3][To
   Section 5.0 - Kernel configuration and Disk Setup]

                      4.0 - Installation and disk setup.

4.1 - Installing from the OpenBSD CD

   Installing from a CD is definitely the BEST choice, but first you must
   have purchased a CD. You can obtain a CD from
   [4]http://www.openbsd.org/orders.html. If you are using either the
   i386, sparc or alpha platforms, you can boot directly off the CD. If
   not, you will have to create a bootdisk. You can get the boot disk
   from ftp://ftp.openbsd.org/pub/OpenBSD/2.5/$ARCH/floppy25.fs

   To create this boot disk, use either the unix tool [5]dd(1) or from
   MS-DOS/Windows, use rawrite from the tools directory on the CD.
   Rawrite doesn't work if you are an NT user, so you can also use
   fdimage or ntrw.exe which are both also in the tools directory.

   To use dd, do the following:
# dd if=floppy25.fs of=/dev/fd0c bs=126b

   fd0c is usually your first floppy disk.

   After that is completed, boot from your media of choice, (cdrom or
   bootdisk) and answer the questions accordingly. Here is an example
   installation.

   [6]Example Install

4.2 - Installation via FTP

   The ftp installation is almost the same as the normal installation.
   The same bootdisk will be used.

   floppy25.fs

   Just like the CD install you will set up your disk, then when you
   specify install media you choose (f)tp. You must take care to give the
   proper settings when you are asked to configure your network. Have
   available your IP address, netmask, nameserver addresses, and default
   route. If you are using DHCP, don't worry, the boot disk knows how to
   talk to your DHCP server to get all of this (see next section below).
   Once your network is configured correctly, you must choose the (f)tp
   installation option. You will be asked a few simple questions about
   proxies and passive or active transfers, and the you will be presented
   with a list of ftp servers. Select the one closest to you, and you are
   on your way.

   Consult the [7]install text for help.

4.3 - Installation via DHCP

   Installation via DHCP is the same as ftp, except your system will use
   DHCP to configure your network. When you arrive at the network config
   option, it will ask for your IP address. Type "dhcp" (Without the
   quotes of course) and your IP address, netmask, gateway, and name
   servers will be setup from the values given by the DHCP server. Then
   all you have to do is follow the remainder of the directions from ftp
   install above and you will be set.

   Consult the [8]install text for help.

4.4 - What files are needed for Installation?

   There are many packages containing the OpenBSD binaries, but which
   ones do you need to get your system up and running? Here is an
   overview of each package.

     * base25.tar.gz - Has the BASE OpenBSD system *NEEDED*
     * etc25.tar.gz - Has all the files in /etc *NEEDED*
     * comp25.tar.gz - Has the compiler and its tools, libs. *STRONGLY
       SUGGESTED*
     * man25.tar.gz - Holds man pages *STRONGLY SUGGESTED*
     * misc25.tar.gz - Holds misc info, setup docs
     * game25.tar.gz - Has the Games for OpenBSD *FUN*
     * xbase25.tar.gz - Has the base install for X11
     * xfont25.tar.gz - Holds X11's font server and fonts
     * xlink25.tar.gz - Has the X servers link kit
     * xserv25.tar.gz - Has X11's X servers
     * xshare25.tar.gz - Has manpages, locale settings, includes, etc for
       X

4.5 - Using the OpenBSD disklabel

   Be sure to check the [9]disklabel(8) man page!

   Disklabel is used to identify disks and/or partitions. The main idea
   behind them is abstraction of disk hardware, since there exists
   several partitioning tables. A disklabel is a universal partitioning
   table. These labels tell the system everything about the disk, but
   most of it is irrelevant. The important parts of the label are both
   the part that tells the disk geometry and also the part that actually
   defines what partitions exist on your disk. This label resides on the
   beginning of the disk, this is to help bootstrap code use them (since
   most ROM based booting reads the first sectors of the first disk).
   Disklabel can, on some systems, be used to install bootstrap code.

   As an additional gain, using disklabel helps overcome architecture
   limitations on disk partitioning. For example, on i386, you can only
   have 4 primary partitions. (Partitions that other operating systems,
   such as Windows NT or DOS can see.) With disklabel, you use one of
   these 'primary' partitions to store *all* of your OpenBSD partitions
   (eg. 'swap', '/', '/usr' and '/var'). And you still have 3 more
   partitions available for other OSs!

   You can think of them as 'subpartitions' for installation purposes.
   But they are a necesity for kernel disk access based on geometry. And
   remember to use 'b' for the swap label, and 'a' for root filesystem
   (default names in kernel). (Note also that in other FAQ documents we
   usually refer to these OpenBSD 'subpartitions' as partitions. Most
   architectures do not have two layers of partitions like the i386
   does.)

   To just view the current disklabel for your disk just do:
# disklabel <disk-device name>

   This will give output similar to this:
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)

   In this example, there are 4 labels - A, B, C, J. A is one main
   partition, B is swap, and J is another partition. C in all cases
   represents the full disk. This is helpful in showing what valuses in
   size, cyl, etc you have to work with. But with this command you cannot
   change any values, you can just view.

   To be able to edit your label's interactivly you would use the -E
   flag.
   Example:
# disklabel -E wd0
# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)

Treating sectors 64-16777216 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> ?
Available commands:
        p [unit]  - print label.
        M         - show entire OpenBSD man page for disklabel.
        e         - edit drive parameters.
        a [part]  - add new partition.
        b         - set OpenBSD disk boundaries.
        c [part]  - change partition size.
        d [part]  - delete partition.
        m [part]  - modify existing partition.
        r         - recalculate free space.
        u         - undo last change.
        s [path]  - save label to file.
        w         - write label to disk.
        q         - quit and save changes.
        x         - exit without saving changes.
        ? [cmnd]  - this message or command specific help.
Numeric parameters may use suffixes to indicate units:
        'b' for bytes, 'c' for cylinders, 'k' for kilobytes, 'm' for megabytes,
        'g' for gigabytes or no suffix for sectors (usually 512 bytes).
        Non-sector units will be rounded to the nearest cylinder.
Entering '?' at most prompts will give you (simple) context sensitive help.
> p
device: /dev/rwd0c
type: ESDI
disk:
label: TOSHIBA MK2720FC
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
free sectors: 14193711
rpm: 3600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
> q
No changes.

   In this example we get into disklabel's interactive mode. From here we
   can issue the command "?" asking for help. This gives us many commands
   we can use to add, delete, edit existing labels.

   There is a new feature on disklabel, to help installation. The '-f'
   flag writes a 'fstab' like file, if given a mount point for a label.
   This is only used at installation.

   To see an example install involving disklabel check [10]log25.txt

4.6 - Using fdisk

   First be sure to check the fdisk main page. [11]fdisk(8)

   Fdisk is a program to help with the maintenance of your partitions.
   This program is used at install time to set up your OpenBSD partition
   (this partition can contain several labels, each with
   filesystems/swap/etc.). It can divide space on your drives and set one
   active. This program will usually be used in Single User Mode ( boot
   -s ). Fdisk also sets the MBR on your various hard disks.

   For installation purposes, most times you'll only need ONE Openbsd
   partition, and then using disklabel to put a swap and a filesystem on
   it.

   To just view your partition table using fdisk just use:
# fdisk fd0

   Which will give an output similar to this:
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused

   In this example we are viewing the fdisk output of floppy drive. We
   can see the OpenBSD partition (A6) and its size. The * tells us that
   the OpenBSD partition is a bootable partition.

   In the previous example we just viewed our information. What if we
   want to edit our partition table? Well, to do so we must use the -e
   flag. This will bring up a command line prompt to interact with fdisk.
# fdisk -e wd0
Enter 'help' for information
fdisk: 1> help
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1>

   It is perfectly safe in fdisk to go in and explore, just make sure to
   answer N to saving the changes and *DON'T* use the write command.

   Here is an overview of the commands you can use when you choose the -e
   flag.
     * help Display a list of commands that fdisk understands in the
       interactive edit mode.
     * reinit Initialize the currently selected, in-memory copy of the
       boot block.
     * disk Display the current drive geometry that fdisk has probed. You
       are given a chance to edit it if you wish.
     * edit Edit a given table entry in the memory copy of the current
       boot block. You may edit either in BIOS geometry mode, or in
       sector offsets and sizes.
     * flag Make the given partition table entry bootable. Only one entry
       can be marked bootable. If you wish to boot from an extended
       partition, you will need to mark the partition table entry for the
       extended partition as bootable.
     * update Update the machine code in the memory copy of the currently
       selected boot block.
     * select Select and load into memory the boot block pointed to by
       the extended partition table entry in the current boot block.
     * print Print the currently selected in-memory copy of the boot
       block and its MBR table to the terminal.
     * write Write the in-memory copy of the boot block to disk. You will
       be asked to confirm this operation.
     * exit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none.
     * quit Exit the current level of fdisk, either returning to the
       previously selected in-memory copy of a boot block, or exiting the
       program if there is none. Unlike exit it does write the modified
       block out.
     * abort Quit program without saving current changes.

4.7 - Adding new disks in OpenBSD

   Well once you get your disk installed PROPERLY you need to use
   [12]fdisk(8) (i386 only) and [13]disklabel(8) to set up your disk in
   OpenBSD.

   For i386 folks, start with fdisk. Other architectures can ignore this.
# fdisk -i sd2

   This will initialize the disk's "real" partition table for exclusive
   use by OpenBSD. Next you need to create a disklabel for it. This will
   seem confusing.
# disklabel -e sd2

(screen goes blank, your $EDITOR comes up)
type: SCSI
...bla...
sectors/track: 63
total sectors: 6185088
...bla...
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)

   First, ignore the 'c' partition, it's always there and is for programs
   like disklabel to function! For normal operations, fsize should always
   be 1024, bsize should always be 8192, and cpg should always be 16.
   Fstype is 4.2BSD. Total sectors is the total size of the disk. Say
   this is a 3 gigabyte disk. Three gigabytes in disk manufacturer terms
   is 3000 megabytes. So divide 6185088/3000 (use bc(1)). You get 2061.
   So to make up partition sizes for a, d, e, f, g, ... just multiply
   X*2061 to get X megabytes of space on that partition. The offset for
   your first new partition should be the same as the "sectors/track"
   reported earlier in disklabel's output. For us it is 63. The offset
   for each partition afterwards should be a combination of the size of
   each partition and the offset of each partition (Except the C
   partition, since it has no play into this equation.)

   Or, if you just want one partition on the disk, say you will use the
   whole thing for web storage or a home directory or something, just
   take the total size of the disk and subtract the sectors per track
   from it. 6185088-63 = 6185025. Your partition is
    d:  6185025       63    4.2BSD     1024  8192    16

   If all this seems needlessly complex, you can just use disklabel -E to
   get the same partitioning mode that you got on your install disk!
   There, you can just use "96M" to specify "96 megabytes". (Or, if you
   have a disk big enough, 96G for 96 gigs!) Unfortunately, the -E mode
   uses the BIOS disk geometry, not the real disk geometry, and often
   times the two are not the same. To get around this limitation, type 'g
   d' for 'geometry disk'. (Other options are 'g b' for 'geometry bios'
   and 'g u' for geometry user, or simply, what the label said before
   disklabel made any changes.)

   That was a lot. But you are not finished. Finally, you need to create
   the filesystem on that disk using [14]newfs(8).

bsd# newfs wd1a

   Or whatever your disk was named as per OpenBSD's disk numbering
   scheme. (Look at the output from dmesg(1) to see what your disk was
   named by OpenBSD.)

   Now figure out where you are going to mount this new partition you
   just created. Say you want to put it on /u. First, make the directory
   /u. Then, mount it.
mount /dev/wd1a /u

   Finally, add it to /etc/fstab
/dev/wd1a /u ffs rw 1 1

   What if you need to migrate an existing directory like /usr/local? You
   should mount the new drive in /mnt and use cpio -pdum to copy
   /usr/local to the /mnt directory. Edit the /etc/fstab file to show
   that the /usr/local partition is now /dev/wd1a (your freshly formatted
   partition.) Example:
   /dev/wd1a /usr/local ffs rw 1 1

   Reboot into single user mode..boot -s Move the existing /usr/local to
   /usr/local-backup (or delete it if you feel lucky) and create an empty
   directory /usr/local. Then reboot the system, and whala!! the files
   are there!

4.8 - How do I swap to a file?

   With OpenBSD 2.5 came the introduction of [15]swapctl(8), which made
   dealing with swap devices much easier. Swapping to a file doesn't
   require a custom built kernel, although that can still be done, this
   faq will show you how to add swap space both ways.

   To swap to a file permanently, first make a kernel with vnd0c as swap.
   If you have wd0a as root filesystem, wd0b is the previous swap, use
   this line in the kernel configuration file (refer to compiling a new
   kernel if in doubt):
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b

   Second make the file for swap. If you want a 32MB swapfile named
   /newswap do:
   # dd if=/dev/zero of=/newswap bs=1k count=32768

   Add a line to your /etc/fstab file to indicate where the new swap will
   be.
   /dev/vnd0c none swap sw 0 0

   Now boot with the new kernel. Then create the vnd0 device to use that
   file as a device:
   # vnconfig -c -v vnd0 /newswap

   And add it now to swap:
   # swapon /dev/vnd0c

   You can now see if it is working with:
   # pstat -s

4.9 - Softupdates

   Softupdates are experimental and are NOT recomended for regular users.

   Over the last few years Krik McKusick has been working on something
   called "soft updates". This is based on an idea proposed by Greg
   Ganger and Yale Patt that imposing a partial ordering on the buffer
   cache opertions would permit the requirement for synchronous writing
   of directory entries to be removed from the FFS code. Thus, a large
   performance increase of disk writing performance.

   To enable Softupdates your kernel must have option

   option FFS_SOFTUPDATES

   then you need to boot into single-user mode:
        boot>boot -s
        [snip]
        bsd# tunefs -s enable <raw device>
        bsd# reboot -n

   GOOD LUCK. Please direct all problem reports with as MUCH information
   as possible (kernel coredumps, tracebacks, etc) to [16]Costa. Do not
   waste his time with any other questions or incomplete problem reports.

4.10 - How much space do I need for an OpenBSD installation?

   The following are suggested sub-tree sizes for a full system install.
   The numbers include enough extra space to permit you to run a typical
   home system that is connected to the internet:
SYSTEM          /       /usr    /var    /usr/X11R6
alpha           56M     540M    27M     161M
amiga           45M     399M    24M      36M
arc             47M     268M    20M      60M
hp300           31M     234M    24M      47M
i386            35M     229M    24M      72M
mac68k          29M     232M    24M      36M
mvme68k         48M     448M    24M       -  (no Xserver)
pmax            50M     355M    24M      60M
sparc           40M     259M    24M      49M
powerpc         39M     423M    26M     124M

   When you are in the disklabel editor, you may choose to make your
   entire system have just an 'a' and 'b' partition. The 'a' partition
   you set up in disklabel will become your root partition, which should
   be the sum of all the 3 main values above (/, /usr, and /var) plus
   some space for /tmp. The 'b' partition you set up automatically
   becomes your system swap partition -- we recommend a minimum of 32MB
   but if you have disk to spare make it at least 64MB.

   However, we recommend you use many separate partitions so that users
   cannot fill up your important partitions as easily, thus causing nasty
   denial of service problems. If you want to be extra cautious, you
   should make the following separate partitions: / swap /usr /var /tmp
   /var/tmp /home.

4.11 - How do I get rid of in "partition 3 id 0" error on boot? (i386)

   This means that your MBR (Master Boot Record) was not installed
   properly or that your BIOS is not compatible with your current MBR. To
   solve this first try to reinstall the OpenBSD boot blocks. To do so
   use [17]installboot(8). For example, the most common usage is:

     * Boot from the OpenBSD bootdisk

     * # fsck /dev/rwd0a && mount /dev/wd0a /mnt
     * # cp /usr/mdec/boot /mnt/boot
     * # /usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot wd0

     Here substitute your disk devices for rwd0a & wd0a. This will
   install the boot blocks again.

     Then Reboot.

   If this doesn't work you still have a few more options. So, luck
   hasn't run out yet. The first is to use a bootloader such as OS-BS.
   The OpenBSD cd has the os-bs bootloader included in the tools
   directory. If you didn't purchase a CD-ROM, you can download os-bs
   from any of the OpenBSD ftp sites.

   pub/OpenBSD/2.5/tools/osbs135.exe

   and take some time to look through the web pages at
   [18]http://www.prz.tu-berlin.de/~wolf/os-bs.html

   There are also other commercial bootloaders or lilo that you can use
   for multi-booting.

   Here is a simple outline of how to get lilo onto your system.

     * Boot a DOS floppy and do a fdisk /MBR. Make sure you do that on
       the drive you'll be booting from.
     * Boot from a linux disk and install LILO & chain it to your OpenBSD
       boot block.

   For further instructions read [19]INSTALL.linux

4.12 - How do I get a dmesg from a boot floppy?

   RAMDISK images (boot floppies) do not ship with the dmesg utility.
   They do, however, have the /kern filesystem mounted. To copy the dmesg
   information to a file, do a:
   # cat /kern/msgbuf >mydmesg

   Boot disks also have 'more' to page through the output:
   # more /kern/msgbuf

4.13 - Reinstalling bootblocks (i386 specific)

   Older versions of MS-DOS can only deal with disk geometries of 1024
   cylinders or less. Since virtually all modern disks have more than
   1024 cylinders, most SCSI BIOS chips (which come on the SCSI
   controller card) and IDE BIOS (which is part of the rest of the PC
   BIOS) have an option (sometimes the default) to "translate" the real
   disk geometry into something that fits within MS-DOS' ability.
   However, not all BIOS chips "translate" the geometry in the same way.
   If you change your BIOS (either with a new motherboard or a new SCSI
   controller), and the new one uses a different "translated" geometry,
   you will be unable to load the second stage boot loader (and thus
   unable to load the kernel). (This is because the first stage boot
   loader contains a list of the blocks that comprise /boot in terms of
   the original "translated" geometry.) If you are using IDE disks, and
   you make changes to your BIOS settings, you can (unknowingly) change
   its translation also (most IDE BIOS offer 3 different translations.)
   To fix your boot block so that you can boot normally, just put a boot
   floppy in your hard drive, and at the boot prompt, type "b hd0a:/bsd"
   to force it to boot from the first hard disk (and not the floppy).
   Your machine should come up normally. You now need to update the first
   stage boot loader to see the new geometry (and re-write the boot block
   accordingly).
   Our example will assume your boot disk is sd0 (but for IDE it would be
   wd0, etc..):
# cd /usr/mdec; ./installboot /boot biosboot sd0

4.14 - Multibooting OpenBSD

   OpenBSD & NT

   To multiboot OpenBSD and NT, you can use NTloader, the bootloader the
   NT uses. To multi-boot with NT, you need a copy of your OpenBSD pbr.
   After running installboot, you can copy it something like this:
        # dd if=/dev/rsd0a of=openbsd.pbr bs=512 count=1

   Now boot NT and put openbsd.pbr in c:. Add a line like this to the end
   of c:\boot.ini:
        c:\openbsd.pbr="OpenBSD"

   When you reboot, you should be able to select OpenBSD from the NT
   loader menu. There is much more information available about NTloader
   at the [20]NTLDR Hacking Guide.

   OpenBSD & Windows or DOS

   To boot OpenBSD along with Windows 3.1, Windows95, or DOS you must use
   a boot loader on the system that can handle OpenBSD, Windows, and DOS!
   Some bootloaders of choice are [21]osbs20b8.zip or [22]The Ranish
   Partition Manager. Both of these are able to boot OpenBSD partitions.

   OpenBSD & Linux

   Please refer to [23]INSTALL.linux, which gives indepth instructions on
   getting OpenBSD working with Linux.

   [24][Back to Main Index] [25][To Section 3.0 - Obtaining OpenBSD]
   [26][To Section 5.0 - Kernel configuration and Disk Setup]
     _________________________________________________________________

   [27][back] [28]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq3.html
   3. http://openbsd.org/faq/faq5.html
   4. http://openbsd.org/orders.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html
   6. http://openbsd.org/faq/log25.txt
   7. http://openbsd.org/faq/log25.txt
   8. http://openbsd.org/faq/log25.txt
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html
  10. http://openbsd.org/faq/log25.txt
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html
  16. mailto:csapuntz@openbsd.org
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&format=html
  18. http://www.prz.tu-berlin.de/~wolf/os-bs.html
  19. http://openbsd.org/faq/INSTALL.linux
  20. http://www.dorsai.org/~dcl/publications/NTLDR_Hacking/
  21. http://www.freebird.org/sw-map/bootmanager.html
  22. http://www.users.intercom.com/~ranish/part/
  23. http://openbsd.org/faq/INSTALL.linux
  24. http://openbsd.org/faq/index.html
  25. http://openbsd.org/faq/faq3.html
  26. http://openbsd.org/faq/faq5.html
  27. http://openbsd.org/faq/index.html
  28. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 4.0 - Installation and Disk
   Setup] [3][To Section 6.0 - Networking]

                   5.0 - Kernel Configuration and Disk Setup

5.1 - Why would I want to create my own custom kernel?

   It is a joyous occasion when you as a user get to configure and build
   your own custom kernel. Why would you want to do this though?

     * You can define which drivers your computer has support for.
     * You can get rid of unneeded drivers in the GENERIC kernel
     * Speed up boot times
     * Remove default options or add options which may not have been
       enabled by default

5.2 - Kernel Configuration Options

   Kernel Configuration Options are options that you add to your kernel
   configuration that place certain features into your kernel. This
   allows you to have exactly the support you want, without having
   support for unneeded devices. There are multitudes of options that
   allow you to customize you kernel. Here we will go over only some of
   them, those that are most commonly used. Check the [4]options(4) man
   page for a more complete list of options. You can also check the
   example configuration files that are availible for your architecture.

   Not all kernel options have been tested for compatibility with all
   other options. Don't put an option in your kernel unless you actually
   have a reason to do so! The one kernel configuration which gets the
   most testing is the GENERIC kernel. This is usually a combination of
   the options in /usr/src/sys/arch/<your arch>/conf/GENERIC and
   /usr/src/sys/conf/GENERIC.

     * [5]Alpha Kernel Conf Files
     * [6]i386 Kernel Configuration files
     * [7]mac68k Kernel Configuration files
     * [8]pmax Kernel Configuration Files
     * [9]sparc Kernel Configuration Files
     * [10]Other Arch's

   Look closely at these files and you will notice a line like:
   include "../../../conf/GENERIC"
   This means that it *IS* referencing yet another configuration file.
   This file stores non arch-dependent options. So when creating your
   Kernel Config be sure to look through [11]/sys/conf/GENERIC and see
   what you want. There ARE options in there that are NEEDED.

   All of the options listed below should be placed in your kernel
   configuration file in the format of:
   option OPTION
   for example. To place option debug in the kernel, add a line like
   this:
   option DEBUG
   Options in the OpenBSD kernel are translated into compiler
   preprocessor options, therefore an option like DEBUG would have the
   source compiled with option -DDEBUG. Which is equivalent to doing a
   #define DEBUG throughout the kernel.

   OpenBSD has a great many compatibility options which allow you to use
   binaries from other OS's. Not all are availibly on every
   architechture, so be sure to read the man pages for each option to see
   if your arch is supported.

     * [12]COMPAT_SVR4(8) - Compatibility with SVR4 binaries.
     * [13]COMPAT_BSDOS(8) - Compatibility with BSD/OS binaries.
     * [14]COMPAT_LINUX(8) - Compatibility with Linux binaries.
     * [15]COMPAT_SUNOS(8) - Compatibility with SunOS binaries.
     * [16]COMPAT_ULTRIX(8) - Compatibility with Ultrix binaries.
     * [17]COMPAT_FREEBSD(8) - Compatibility with FreeBSD binaries.
     * COMPAT_HPUX - Compatibility with HP-UX binaries. Only availible on
       some m68k arch's.
     * [18]COMPAT_IBCS2(8) - Compatibility to run ibcs2 binaries.
     * COMPAT_OSF1 - Run Digital Unix binaries. Availible only on Alpha
       platform.
     * COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly
       discouraged, But it is needed for our Navigator port
     * COMPAT_11 - Compatibility with NetBSD 1.1
     * COMPAT_NOMID - Compatibility with a.out executables that lack a
       machine id.

   It is always helpful to be able to debug problems with the kernel. But
   many choose not to put these options in their kernel because these
   options add considerable size to the kernel. There are however
   extremely helpful in a case where a bug might be present. This well
   help your or developers discover the source of your problems much
   quicker. Here is a list of popular debugging options that can be added
   to your kernel.

     * [19]DDB - This compiles in the in-kernel debugger. This isn't
       availible on all platforms. So be sure to read before adding it.
     * [20]KGDB - Compiles a remote kernel debugger using gdb's `remote
       target` feature.
     * makeoptions DEBUG="-g" - Makes bsd.gdb along with bsd. This is
       useful for debugging crash dumps with gdb. NOTE: This option also
       turns on option DEBUG
     * DEBUG - Used to put various debugging options in the kernel, where
       the source has defined them.
     * KTRACE - Adds hooks for the system call tracing facility. Which
       allows users to use [21]ktrace(1).
     * DIAGNOSTIC - Adds code to the kernel that does internal
       consistency checks.
     * GPROF - adds code to the kernel for kernel profiling with
       [22]kgmon(8).
     * makeoptions PROF="-pg" - The -pg flag causes the kernel to be
       compiled with support for profiling. Option GPROF is required to
       use this option.

   Filesystem Options.
     * FFS - Berkeley Fast Filesystem NOTE: This option is required
     * EXT2FS - Second Extended File System, This is needed for those of
       you who want to read Linux partitions.
     * MFS - Memory File System that stores files in swapable memory.
       This is not quite stable as of now.
     * NFS - Network File System, This is needed if you will be using
       NFS.
     * CD9660 - This is iso9660 + rockridge filesystem. This is required
       to read from cd's
     * MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support
       for Windows 95 long name + mixed case extensions.
     * FDESC - Includes code for a file system which can be mounted on
       /dev/fd
     * KERNFS - Includes code which permits the mounting of a special
       file system (normally mounted on /kern) in which files
       representing various kernel variables and parameters may be found.
     * NULLFS - Code to have a loopback filesystem. [23]mount_null(8) has
       more information
     * PROCFS - Includes code for a special file system (conventionally
       mounted on /proc)
     * PORTAL - Includes the (experimental) portal filesystem. This
       permits interesting tricks like opening TCP sockets by opening
       files in the file system.
     * UMAPFS - Includes a loopback file system in which user and group
       ids may be remapped -- this can be useful when mounting alien file
       systems with different uids and gids than the local system (eg,
       remote NFS).
     * UNION - Includes code for the union file system, which permits
       directories to be mounted on top of each other in such a way that
       both file systems remain visible. This code isn't quite stable
       yet.
     * XFS - Add hooks for using a filesystem that is compatible with the
       AFS filesystem. Currently used by the Arla/AFS code.
     * LFS - Log Structured Filesystem.
     * FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on
       softupdates more read the [24]Softupdates FAQ section.
     * NFSSERVER - Allow for the server-side NFS code to be included in
       the kernel.
     * NFSCLIENT - Allow for the client-side NFS code to be included in
       the kernel.
     * FIFO - Support for FIFO's.. RECOMMENDED.
     * NVNODE=integer - Where integer is the size of the cache used by
       the name-to-inode translation routines, (a.k.a. the namei() cache,
       though called by many other names in the kernel source).
     * EXT2FS_SYSTEM_FLAG - This option changes the behavior of the
       APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem.
       Read [25]options(4) for more details.
     * QUOTA - Support for Filesystem Quota's. To read up on using quotas
       read [26]FAQ 10

   Misc. Options
     * PCIVERBOSE - Make the boot process more verbose for PCI
       peripherals.
     * EISAVERBOSE - Make the boot process more verbose for EISA
       peripherals.
     * PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA
       peripherals.
     * APERTURE - Provide in-kernel support for VGA framebuffer mapping
       by user processes. Needed to run X.
     * XSERVER - Support for the X server console driver. Needed for X.
     * LKM - Support for Loadable Kernel Modules. Not availible on all
       arch's. Read [27]lkm(4) for more information.
     * INSECURE - Hardwires the kernel security level to -1. Read
       [28]init(8) for more information on kernel security levels.
     * MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to
       allow for non-contiguous memory.
     * RAM_DISK_HOOKS - Allows for machine dependent functions to be
       called when the ramdisk driver is configured.
     * RAM_DISK_IS_ROOT - Forces the ramdisk to be root.
     * CCDNBUF=integer - Set number of component buffers used by CCD(4).
       Default is 8. For more on CCD read the [29]CCD(4) man page, or the
       [30]Performance Tuning FAQ section.
     * KMEMSTATS - This makes malloc(9), the kernel memory allocator keep
       statistics on its use. If option DEBUG is used, this option is
       automatically turned off by config.
     * BOOT_CONFIG - Adds support of the -c boot option.

   Networking Options
   Also check the [31]Networking FAQ or the [32]Networking Performance
   Tuning FAQ.
     * GATEWAY - Enables IPFORWARDING and (on most ports) increases the
       size of NMBCLUSTERS.
     * NMBCLUSTERS=integer - Controls the size mbuf cluster map.
     * IPFORWARDING - Enables IP routing behavior. With this option
       enabled, the machine will forward IP datagrams between its
       interfaces that are destined for other machines.
     * MROUTING - Includes support for IP multicast routers.
     * INET - Includes support for the TCP/IP protocol stack. This option
       is REQUIRED
     * MCLSHIFT=value - This option is the base-2 logarithm of the size
       of mbuf clusters. Read [33]options(4) for more information on this
       option.
     * NS - Include support for the Xerox XNS protocol stack. See
       [34]ns(4)
     * ISO,TPIP - Include support for the ubiquitous OSI protocol stack.
       See [35]iso(4) for more information.
     * EON - Include support for OSI tunneling over IP.
     * CCITT,LLC,HDLC - Include support for the X.25 protocol stack.
     * IPX, IPXIP - Include support for Internetwork Packet Exchange
       protocol commonly in use by Novell NetWare.
     * NETATALK - Include kernel support for the AppleTalk family of
       protocols.
     * TCP_COMPAT_42 - Use of this option is extremely discouraged, so it
       should not be enabled. TCP bug compatibility with 4.2BSD. In
       4.2BSD, TCP sequence numbers were 32-bit signed values. Modern
       implementations of TCP use unsigned values.
     * TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows
       one lost segment to be recovered per round trip time.
     * TCP_SACK - Turns on selective acknowledgements.
     * TCP_FACK - Turns on forward acknowledgements allowing a more
       precise estimate of outstanding data during the fast recovery
       phase by using SACK information. This option can be used together
       with TCP_SACK.
     * IPFILTER - This option enables the IP filtering on the packet
       level using the ipfilter package.
     * IPFILTER_LOG - This option, in conjunction with IPFILTER, enables
       logging of IP packets using ip-filter.
     * IPFILTER_DEFAULT_BLOCK - This option sets the default policy of
       ip-filter. If it is set, ip-filter will block packets by default.
     * PPP_FILTER - This option turns on [36]pcap(3) based filtering for
       ppp connections.
     * PPP_BSDCOMP - PPP BSD compression.
     * PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
     * IPSEC - This option enables IP security protocol support. See
       [37]ipsec(4) for more details. This now implies option KEY, which
       gives support for PFKEYv2.
     * ENCDEBUG - This option enables debugging information to be
       conditionally logged incase IPSEC encounters errors.
     * TCP_SIGNATURE - TCP MD5 Signatures, for BGP routing sessions

   PCVT Options (only valid on i386 architecture)
     * PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.
     * PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC
       VT200 (TM) is generated.
     * PCVT_SCREENSAVER - Enables the builtin screensaver feature.
       Defaults to on.
     * PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is
       used. Default is off.
     * PCVT_CTRL_ALT_DEL - If enabled, the key combination <Ctrl> <Alt>
       <Del> invokes a CPU reset. Default is off.
     * PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard.
       Default is on.
     * PCVT_24LINESDEF - If enabled, the 25-line modi (VT emulation with
       25 lines, and HP emulation with 28 lines) default to 24 lines only
       to provide a better compatibility to the original DEV VT220 (TM).
     * PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad.
       Useful for notebooks when running XFree86. Defaults to off
     * PCVT_META_ESC - If enabled, a sequence composed of <esc>, followed
       by the normalkey code is emitted if a key is pressed with the
       <Alt> key modifier. If disabled, then normal key code with the
       value 0x80 added is sent. Defaults to off.

   SCSI Subsystem Options
     * SCSITERSE - Terser SCSI error messages. This omits the table for
       decoding ASC/ASCQ info, saving about 8 bytes or so.
     * SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to
       the console.

5.3 - Building your own kernel

   Full instructions for creating your own custom kernel are in the
   [38]afterboot(8) man page.

   To compile your kernel from the cdrom do the following:
#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make

   To compile a kernel inside a writeable source tree do the following:
#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : [39]config(8))
#cd ../compile/SOMEFILE
#make

   Where $ARCH is the architecture you are using (e.g. i386). You can
   also do a make depend to make the dependencies for the next time you
   compile your kernel.

   To move your kernel into place.
#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd

   To revert to your old kernel at boot you need to just
boot>bsd.old

   and your old kernel will be loaded instead of /bsd.

5.4 - Boot Time Configuration

   Sometimes when booting your system you might notice that the kernel
   finds your device but maybe at the wrong IRQ. And maybe you need to
   use this device right away. Well, without rebuilding the kernel you
   can use OpenBSD's boot time kernel configuration. This will only
   correct your problem for one time. If you reboot, you will have to
   repeat this procedure. So, this is only meant as a temporary fix, and
   you should correct the problem by fixing and recompiling your kernel.
   Your kernel does however need option BOOT_CONFIG in the kernel, which
   GENERIC does have.

   Most of this document can be found in the man page [40]boot_config(8)
   To boot into the User Kernel Config, or UKC, at boot time us the -c
   option.
Boot> boot wd0a:/bsd -c

   Or whichever kernel it is you want to boot. Doing this will bring up a
   UKC prompt. From here you can issue commands directly to the kernel
   specifying devices you want to change or disable or even enable.

   Here is a list of common commands in the UKC.

   add device - Add a device through copying another

   change devno | device - Modify one or more devices

   disable devno | device - Disable one or more devices

   enable devno | device - Enable one or more devices

   find devno | device - Find one or more devices

   help - Short summary of these commands

   list - List ALL known devices

   exit/quit - Continue Booting

   show [attr [val]] - Show devices with an attribute and optional with a
   specified value

   Once you get your device configured, use quit or exit and continue
   booting. After so you should correct your Kernel configuration and
   Compile a new kernel. Refer to [41]Building your own kernel for help.

   [42][Back to Main Index] [43][To Section 4.0 - Installation and Disk
   Setup] [44][To Section 6.0 - Networking]
     _________________________________________________________________

   [45][back] [46]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq4.html
   3. http://openbsd.org/faq/faq6.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/
   6. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/
   7. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/
   8. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/
   9. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/
  11. http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html
  24. http://openbsd.org/faq/faq4.html#4.9
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  26. http://openbsd.org/faq/faq10.html#10.10
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html
  28. http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html
  30. http://openbsd.org/faq/faq12.html#12.2
  31. http://openbsd.org/faq/faq6.html
  32. http://openbsd.org/faq/faq12.html#12.1
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html
  37. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html
  38. http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html
  39. http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html
  40. http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html
  41. http://openbsd.org/faq/faq5.html#5.3
  42. http://openbsd.org/faq/index.html
  43. http://openbsd.org/faq/faq4.html
  44. http://openbsd.org/faq/faq6.html
  45. http://openbsd.org/faq/index.html
  46. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 5.0 - Kernel configuration and
   Disk Setup] [3][To Section 7.0 - Keyboard controls]

                               6.0 - Networking
     _________________________________________________________________

6.1 - Initial Network Setup

  Interfaces

   Here we assume you have all your network interfaces working, and a
   basic TCP/IP knowledge. If not, go to the [4]Kernel Configuration and
   Setup section, and/or read a nice intro to TCP/IP. Other recommended
   reading are the [5]ifconfig(8) and [6]netstat(1) man pages.

   All your interfaces should be listed with:
# ifconfig -a

lo0: flags=8009<UP,LOOPBACK,MULTICAST>
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008<LOOPBACK,MULTICAST>
xl0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST>
        media: Ethernet 100baseTX half-duplex
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
        inet 10.1.1.1 netmask 0xffffff00 broadcast 10.1.1.255
sl0: flags=c010<POINTOPOINT,LINK2,MULTICAST>
sl1: flags=c010<POINTOPOINT,LINK2,MULTICAST>
ppp0: flags=8010<POINTOPOINT,MULTICAST>
ppp1: flags=8010<POINTOPOINT,MULTICAST>
tun0: flags=10<POINTOPOINT>
tun1: flags=10<POINTOPOINT>
enc0: flags=8<LOOPBACK>

   First there is lo0 the loopback interface. It MUST have the assigned
   address of 127.0.0.1 no matter what network setup you use. The next
   important one is xl0 in this example (could be neX or epX depending on
   the brand), which is a board itself. Look it has UP and RUNNING flags
   on, as lo0 but no other interface have them. That means oviously they
   are working. Your interface could be down if you never configured it,
   and look like the other interfaces. The others are not part of this
   section, as sl and ppp are for serial line comunication, tun is a
   pseudo-device for tunneling and enc a pseudo-device for encryption.

   If xl0 was uninitialized, you can assign it an address creating a
   ascii file /etc/hostname.xl0 having a string like this:
inet 10.1.1.1 255.255.255.0 NONE

   In the above example we show inet 10.1.1.1, where the second argument
   is our IP address. 255.255.255.0 is our netmask and NONE shows no
   media tags. (full-duplex, etc). This hostname 'mona' needs to have
   record in /etc/hosts:
10.1.1.1        mona    mona.openbsd.org.ar

   What actually happens when you boot is that it looks up 'mona' in
   /etc/hosts, and then configures the interface to 10.1.1.1. If you have
   multiple ethernet interfaces, this is probably a painful way to do
   things, and so you can also put the number right in /etc/hostname.xl0:
inet 10.1.1.1 255.255.255.0 NONE

   Now check that you have a file /etc/myname and a file /etc/mygate. If
   you don't have them, you need to create them. If your gateway is a
   machine named "wintermute" wich is also in the /etc/hosts, use this
   commands:
# echo "mona" > /etc/myname
# echo "wintermute" > /etc/mygate

   Ok, you are done for a standalone system, but to activate your
   configuration now (without rebooting) do:
# sh /etc/netstart

   This will give you a few errors, but don't worry as all them are
   concerning 127.0.0.x (loopback)

   Note: if you want to use the system as a gateway, later there's a
   "Firewall Setup" section, but you need to read all this first.

   Now check your routes are ok (here we use -n to make it simpler to
   look at):
# netstat -rn
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu
Interface
default            10.1.1.254         UGS         0        0      -  xl0
10.1.1/24          link#1             UC          0        0      -  xl0
10.1.1.1           127.0.0.1          UGHS        0        0      -  lo0
10.1.1.254         link#1             UHL         1        0      -  xl0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          3       24      -  lo0
224/8              link#1             UCS         0        0      -  xl0

Encap:
Source address/netmask          Port  Destination address/netmask     Port Prot
o SA(Address/SPI/Proto)

   (The default gateway here is 10.1.1.254)

  IP Aliasing

   If you want to map more than one IP address on a single network
   interface, you need to assign an "alias" to it. The way to do it on
   OpenBSD is simply assigning the interface another IP with the "alias"
   option like this:

# ifconfig xl0 alias 10.1.1.2 netmask 255.255.255.255

   Here ne2 is assigned another IP number (remember it already has
   10.1.1.1). Note the netmask used! Don't use 255.255.255.0 in this kind
   of cases (both numbers are on the same subnet), only ONE address
   should handle the subnet. If you do such kind of misconfiguration, the
   following error appears:

ifconfig:SIOCAIFADDR: File exists

   Now let's change the configuration file for this, /etc/ifaliases. Add
   to it this line:

xl0   10.1.1.2 255.255.255.255

   This means, simply, interface xl0 should have an alias 10.1.1.2 with
   the netmask 255.255.255.255.

  DNS Client Setup

   Let's assume your DNS servers are 125.2.3.4 and 125.2.3.5, and your
   machine name belongs to the domain yourdomain.com. You should have the
   following lines to your /etc/resolv.conf file:
domain yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind

  Gateway Setup

   This is the basic information you need to set up your OpenBSD box as a
   gateway (also called a router.) If you are using OpenBSD as a router
   on the Internet, we suggest that you also read the IP Filter setup
   instructions below to block potentially malicious traffic. Also, due
   to the low availability of IPv4 addresses from network service
   providers and regional registries, you may want to look at Network
   Address Translation (next section of this document) for information on
   conserving your IP address space.

   If you want your OpenBSD machine to act as a dedicated router, and you
   are building a custom kernel configuration for it, you can either
   compile your kernel with options IPFORWARDING or GATEWAY. (See
   [7]section 12 for further information on tuning NMBCLUSTERS if you are
   doing this.) For the rest of us, OpenBSD now has a sysctl mechanism to
   turn on and off IP Forwarding at boot. If you want it to "forward" any
   packets between your interfaces, modify the /etc/sysctl.conf line that
   toggles the forwarding variable on bootup:
net.inet.ip.forwarding=1

   To make the changes without booting:
# sysctl -w net.inet.ip.forwarding=1
net.inet.ip.forwarding: 0 -> 1

   Now modify the routes on the other hosts on both sides. There are many
   possible uses of OpenBSD as a router, using software such as
   [8]routed(8), [9]gated, [10]mrtd, and [11]zebra. OpenBSD has support
   in the ports collection for both gated and mrtd. OpenBSD supports
   several T1, HSSI, ATM, FDDI, Ethernet, and serial (PPP/SLIP)
   interfaces.

6.2 - IP Filter - ipf and ipnat setup

   The IP Filter package was created to handle with two tasks, dealing
   with packet level forwarding permissions [12]ipf(8) and mapping
   hosts/subnets to a range of external addresses [13]ipnat(8). The
   configuration files for these two services are /etc/ipf.rules and
   /etc/ipnat.rules.

   You need to edit /etc/rc.conf to activate them at boot time. You also
   need to have net.inet.ip.forwarding=1 in your /etc/sysctl.conf (or
   your kernel needs to have IPFORWARDING or GATEWAY options turned on.)
   You also need a kernel compiled with option IPFILTER and IPFILTER_LOG
   (the GENERIC kernels do have these options).

   If you have IP Filter compiled in to your kernel, but you don't have
   it turned on in your /etc/rc.conf file, you can still activate it
   easily.
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules

   The -E flag on ipf 'enables' IP Filter. -Fa clears out any rules that
   you may have in there. -f /etc/ipf.rules loads the rules from
   /etc/ipf.rules.

   If you make changes to /etc/ipf.rules after ipf is loaded, you can
   reload your rules pretty easily!
# ipf -Fa -f /etc/ipf.rules

   Same for ipnat...
# ipnat -CF -f /etc/ipnat.rules

   This document will cover some basic ipf and ipnat configurations
   below. There are a lot of nice examples in /usr/share/ipf/ for ipnat
   and ipf. We recommend you to choose the one closer to what you want,
   and modify it to fit your needs. You can find other IP Filter
   information at the IP Filter [14]mailing list archive, the [15]IP
   Filter web site, and finally the [16]the IP Filter HOWTO.

  IPF

   Modify rc.conf so it has IPFILTER=YES. The file /etc/ipf.rules has a
   simple yet powerful syntax. Here we deal with the most common ways of
   usage, for a more strict definition see [17]ipf(5). Here is assumed
   xl0 as the external interface to internet, on this one uses to have
   more rules than internal interfaces.

   Configurations usually start letting everything come and go, and then
   apply the necesary rules to block offending packets. So this is first:

pass out from any to any
pass in from any to any

   Now lets block any incoming connection to port 82 tcp (eg. there's an
   internal network report agent using http running on several hosts):

block in on xl0 proto tcp from any to any port = 82

   This rule means:

   "Block all incoming packets on xl0 interface whose protocol is TCP no
   matter destination/origin using port 82"

   If you want to log all rejected packets add "log" after "block in", or
   "log quick" if you don't want it to send a message to every console
   root is logged in.

   Also, a typical rule is to block rpc portmap:

block in log on xl0 proto udp from any to any port = sunrpc

  IPNAT

   Based on [18]RFC 1631, ipnat provides an easy way to map internal
   networks to a single routeable ("real") internet address. This is very
   useful if you don't have officially asigned addresses for every host
   on your internal network. When you set up private/internal networks,
   you can take advantage of reserved address blocks (assigned in [19]RFC
   1918), such as:

   10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
   172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
   192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

   To use ipnat, ipf must be activated. As outlined above, for changes to
   stay effective through reboots, you should make changes to
   /etc/rc.conf (where it has IPNAT and IPFILTER.) You can manually
   activate ipf with the command below.
# ipf -E

   Example: You have an internal network using 192.168.5.0, with a
   netmask of 255.255.255 0, and you want to give it access to internet
   using OpenBSD (of course!), and a ppp connection using address
   200.1.2.3, use this rule:

map tun0 192.168.5.0/24 -> 200.1.2.3/32

   This rule means:

   "Any IP connections going out tun0 from an address matching the first
   24 bits of 192.168.5.0 should be mapped to the address 200.1.2.3 (only
   one address since /32 means every bit)"

   If you don't like using CIDR notation, IP Filter also allows you to
   use netmasks. A functional equivalent to the example above, using
   netmasks looks like this:

map tun0 192.168.5.0/255.255.255.0 -> 200.1.2.3/255.255.255.255

   But here arises a problem. You are assigning a lot of addresses to
   only one address. But the port numbers aren't changing, and it is very
   likely that your workstations on 192.168.5.0/24 will use the same port
   numbers to initiate connections from. (If this doesn't make sense,
   don't worry, but keep reading.) The way to go arount it is to map TCP
   and UDP ports to a certain range with the option "portmap". Since ICMP
   doesn't even use ports, it is not covered by the "portmap" rule. (ICMP
   uses an ID field usually based on a process number) In our example,
   there are now two map rules to cover all of these protocols. The end
   result looks like this:

map tun0 192.168.5.0/24 -> 200.1.2.3/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> 200.1.2.3/32

   If you have a dynamic address assignment (as in, you do not know what
   address they will give you when you connect), you can put the
   interface name in place of the IP address. Note that if you do this,
   you will have to run ipnat -CF -f /etc/ipnat.rules every time your IP
   address changes (or, every time you dial up.)

map tun0 192.168.5.0/24 -> tun0/32 portmap tcp/udp 10000:65000
map tun0 192.168.5.0/24 -> tun0/32

   NAT is also able to help you in renumbering. Say you were assigned a
   net block 35.8.9.0/22, and your internet provider can no longer route
   these addresses to you, or say you are switching providers. Your new
   address block is 192.9.4.0/22, but to switch all 500 devices you have
   on this block would be very time consuming! ipnat provides a feature
   called bimap:

bimap xl0 35.8.9.0/22 -> 192.9.4.0/22

   This will literally map every computer in 35.8.9.0 to a new address in
   192.9.4.0. The drawback of this feature is that the translation is not
   consistent. A computer that initiates a connection from 35.8.9.0 will
   get a random IP address from 192.9.4.0. A future version of IP Filter
   will allow for one-to-one translation (where 35.8.9.99 will always get
   mapped to 192.9.4.99).

   And of course, there are other potential uses of NAT that are probably
   beyond the scope of this document.

  Redirecting ports

   This is another very handy feature of IPNAT. If you have a host on the
   internal network (using private addresses), and you want to let
   incoming connections to it, you just need a simple redirect rule. For
   example, if you have a web server on internal network at 10.2.2.7
   listening on port 80, and want it to be accesible from the outside
   simply redirecting external IP 120.2.3.4 on xl0, just add this rule to
   /etc/ipnat.rules:

rdr xl0 120.2.3.4 port 80 -> 10.2.2.7 port 80

   When you write rules, it may help to visualize the packet flow.

Internet <--> (xl0 120.2.3.4) OpenBSD (xl1 10.2.2.1) <--> LAN <--> (10.2.2.7 XY
Z Web server)

   One last reminder that you must have net.inet.ip.forwarding=1 or
   option IPFORWARDING to use IP Filter (ipf, ipnat). Also, redirect only
   works for packets that are being routed through the OpenBSD box. If a
   web browser from inside the NAT (say, from 10.2.2.5 from the example
   above) tries to connect to port 80 on 120.2.3.4, nothing will happen.

6.3 - IPSec

   IPSec is partially documented in the [20]vpn(8) man page. There are
   various files in [21]/usr/share/ipsec/ directory which can also assist
   you. The manual pages for [22]ipsec(4), [23]ipsecadm(8),
   [24]photurisd(8), [25]startkey(1), [26]isakmpd(8) and
   [27]isakmpd.conf(5) are also available!

   You should also check [28]Codetalker which has an FAQ for setting up
   an IPSec VPN with OpenBSD. It explains some basic IPSec concepts and
   how to apply them to a VPN setup.

6.4 - DHCP

   To use the DHCP client [29]dhclient(8) included with OpenBSD, edit
   /etc/hostname.xl0 (this is assuming your main ethernet interface is
   xl0. Yours might be ep0 or fxp0 or something else!) All you need to
   put in this hostname file is 'dhcp'
# echo dhcp >/etc/hostname.xl0

   This will cause OpenBSD to automatically start the DHCP client on
   boot. OpenBSD will gather its' IP address, default gateway, and DNS
   servers from the DHCP server.

   If you want to use OpenBSD as a DHCP server [30]dhcpd(8), edit
   /etc/rc.conf. Set it up so that dhcpd_flags="-q" instead of
   dhcpd_flags=NO. Put the interfaces that you want dhcpd to *listen* on
   in /etc/dhcpd.interfaces.
# echo xl1 xl2 xl3 >/etc/dhcpd.interfaces

   Then, edit /etc/dhcpd.conf. The options are pretty self explanatory.
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }

   This will tell your dhcp clients that the domain to append to DNS
   requests is xyz.mil (so, if the user types in 'telnet joe' then it
   will send them to joe.xyz.mil). It will point them to DNS servers
   192.168.1.3 and 192.168.1.5. For hosts that are on the same network as
   an ethernet interface on the OpenBSD machine, which is in the
   192.168.1.0/24 range, it will assign them an IP address between
   192.168.1.32 and 192.168.1.127. It will set their default gateway as
   192.168.1.1.

6.5 - PPP

   PPP is generally an easy thing to set up. What follows is a basic
   intro based on the information provided in /etc/ppp and the [31]ppp(8)
   manual pages. These are highly suggested reading before attempting to
   setup PPP or even reading this FAQ entry. If you have read these the
   following should look familiar because it is that info with a little
   bit of elaboration.

   First you will need to find out a little bit about how your ISP sets
   up its PPP connections. Does it use scripted login, PAP, CHAP, do you
   have a dynamic or static IP etc. This along with some basic info about
   your modem will allow us to easily create a PPP dial in script for
   your ISP.

   First we will create a PPP conf using what is already in
   /etc/ppp/ppp.conf.sample as a guide. The first section we come to is
   the section labeled default. This is the best place to specify logging
   options, your modem device and dial options. It will always be
   executed when ppp is run. The following is the default section that
   comes standard with /etc/ppp/ppp.conf.sample and an explanation of
   what each parameter does:

   <Default Section>
   default:

   This parameter tells PPP to log output which pertains to the arguments
   you give the parameter.
set log Phase Chat LCP IPCP CCP tun command

   This will set the default modem device on the system which here is com
   2
set device /dev/cua01

   This parameter sets the speed of the serial device.
set speed 115200

   This will set the commands to follow when certain actions take place
   while dialing. Abort the call if the number is busy, abort the call if
   there is no carrier. Wait 5 seconds for carrier. Issue AT and wait for
   response. If AT is ok then dial the number and timeout if not
   connected in 40 seconds. Once dialed in wait for the CONNECT message
   to tell us we are connected.
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\d
ATDT\\T TIMEOUT 40 CONNECT"

   Now that the default modem options are set we will need to create a
   section in the ppp.conf for our ISP. Below are a few examples of what
   could be in there and what type of isp they are tailored for.

   <MyISP Section>
   myisp:
   This of course sets the number to dial for your isp.
set phone 1234567

   This sets the login options. It will abort login if there is no
   carrier with a timeout of 5 seconds. It will then wait for the login:
   prompt and send your login name, and then it will wait for the
   password prompt and send your password.
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"

   This sets the timeout for the entire login process.
set timeout 120

   This will set the ip address you expect your your side and for the
   remote side of the connection. The /0 bit tells the connection that no
   bits of this ip address need to match and the whole thing can be
   replaced. This also sets your default netmask and gateway.
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0

   This will make the default gateway the remote end of the ppp
   connection.
add default HISADDR

   This tells ppp to ask the peer for the nameserver addresses that
   should be used. This isn't always supported, but if it is
   /etc/resolv.conf will automatically be updated.
enable dns

   <Pap/Chap Section>
   What if your ISP uses PAP or CHAP? Here is a configuration that will
   work with both PAP or CHAP, PPP will decide which it needs to use.
   myispPAPCHAP:
   This line sets the phone number.
set PHONE 1234567

   PPP will be waiting for the peer to suggest the use of either PAP or
   CHAP.
set LOGIN

   This is where you specify your username.
set authname MyName

   This is where you specify your password.
set authkey MyKey

   This sets the login timeout to 120 seconds.
set timeout 120

   And then procede with the standard commands from above.
   <Sta

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq5.html
   3. http://openbsd.org/faq/faq7.html
   4. http://openbsd.org/faq/faq5.html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html
   7. http://openbsd.org/faq/faq12.html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html
   9. http://www.gated.org/
  10. http://www.mrtd.net/
  11. http://www.zebra.org/
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html
  14. http://false.net/ipfilter/
  15. http://cheops.anu.edu.au/~avalon/ip-filter.html
  16. http://www.swcp.com/~synk/ipf-howto.txt
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html
  18. http://www.geektools.com/rfc/rfc1631.txt
  19. http://www.geektools.com/rfc/rfc1918.txt
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=vpn&apropos=0&sektion=0&format=html
  21. http://www.openbsd.org/cgi-bin/cvsweb/src/share/ipsec/
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&apropos=0&sektion=4&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&apropos=0&sektion=8&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=photurisd&apropos=0&sektion=8&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=startkey&apropos=0&sektion=1&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&apropos=0&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd.conf&apropos=0&sektion=5&format=html
  28. http://www.codetalker.com/greenbox/docs/vpn-24-minifaq.html
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=8&format=html


   [1][Back to Main Index] [2][To Section 6.0 - Networking] [3][To
   Section 8.0 - General Questions]

                            7.0 - Keyboard controls

7.1 - How do I remap the keyboard?

   By using kcon(1), "kcon - keyboard control and remapping for the pcvt
   driver"

   Example:
bsd# kcon -m gb

   This will load the keycap file for Great Britain.

7.2 - Is there gpm or the like in OpenBSD?

   No. But if you are willing to make a port. Please share. :)

   [4][Back to Main Index] [5][To Section 6.0 - Networking] [6][To
   Section 8.0 - General Questions]
     _________________________________________________________________

   [7][back] [8]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq6.html
   3. http://openbsd.org/faq/faq8.html
   4. http://openbsd.org/faq/index.html
   5. http://openbsd.org/faq/faq6.html
   6. http://openbsd.org/faq/faq8.html
   7. http://openbsd.org/faq/index.html
   8. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 7.0 - Keyboard controls] [3][To
   Section 9.0 - Tips for linux users]

                            8.0 - General Questions

8.1 - What are these Kerberos warning when I first login?

   When you first install your system you will most likely notice a
   warning message that is something like this:
   Warning: no Kerberos tickets issued.

   THIS WARNING IS COMPLETELY IRRELEVANT AND SHOULD ONLY BE REMOVED IF
   COMPLETELY NECESSARY

   Well since you probably haven't set up Kerberos on your system, you
   wouldn't be getting a ticket. If you do have Kerberos running, you
   need to check into that. If you can't STAND that warning and never
   plan on using Kerberos here is how to get rid of it for good.

     * Make sure you have the source code.
     * Edit /usr/share/mk/bsd.own.mk and set KERBEROS to 'no', or create
       an /etc/mk.conf file that does this.
     * cd /usr/src/usr.bin/login ; make clean ; make ; make install

8.2 - How do I change virtual terminals?

   Simply type [ctrl] - [alt] - [One of the function keys] or just hit
   [f9]-[f12] which are just mapped to [ctrl] - [alt]
   functions. (i386)

   Only the i386 arch has virtual terminal capabilities. You can also use
   virtual terminals when using X. For example, If you start X on term 1,
   and switch with [ctrl]-[alt]-[F2] to term 2, X will seem to disapear
   and will not come back by simply switching back to term 1. You must
   [ctrl]-[alt]-[F5] to get your X display back.

8.3 - I forgot my root password, what do I do now?

   A few steps to recovery
    1. Boot into single user mode. For i386 arch type boot -s at the boot
       prompt.
    2. mount the drives.
        bsd# fsck -p / && mount -u /
    3. If /usr is not the same partition that / is (and it shouldn't be)
       then you will need to mount it, also
        bsd# fsck -p /usr && mount /usr
    4. run passwd
    5. boot into mulituser mode.. and remember your password!

8.4 - X wont start, I get tons of error messages

   If you have X completely set up and you are using an XF86Config that
   you know works then the problem most likely lies in the
   machdep.allowapature. You also need to make sure that both:

option XSERVER
option APERTURE

   are in your kernel configuration. [BOTH these are in the GENERIC
   kernel]

   Then you need to edit /etc/sysctl.conf
   and set machdep.allowaperture=1. This will allow X to access the
   aperture driver. This would be set up if the question during install
   about whether or not you would be running X was answered correctly.
   OpenBSD requires for all X servers that the aperture driver be set,
   because it controls access to the I/O ports on video boards.

   For other X problems on the i386, consult the XFree86 FAQ at
   [4]http://www.xfree86.org/FAQ/.

8.5 - What is CVS? and How do I use it?

   CVS is what the OpenBSD project uses to control changes to the source
   code. CVS stands for Concurrent Versions System. You can read more
   about CVS at [5]http://www.cyclic.com/. CVS can be used by the end
   user to keep up to date with source changes, and changes in the ports
   tree. CVS makes it extremely simple to download the source via one of
   the many CVS mirrors for the project.

  How to initially setup your CVS environment

   There are a few ways to initially set up your CVS environment. To
   start off, you will need an initial CVS checkout of the sources. If
   you bought the CD, you're in luck, because it holds the CVS checkout
   for that release. You can extract it from your CD by doing the
   following:

   If you don't have an OpenBSD CD, you will have to retrieve the sources
   from on of the OpenBSD AnonCVS servers. These servers are listed on
   [6]http://www.openbsd.org/anoncvs.html Once you have chosen a server
   you need to choose which module you are going to retrieve. There are
   three main modules availible for checkout from the CVS tree. These
   are:
     * src - The src module has the complete source code for OpenBSD.
       This includes userland and kernel sources.
     * ports - The ports module holds all you need to have the complete
       OpenBSD ports tree. To read more on the OpenBSD ports tree, read
       [7]Section 8.6 of the OpenBSD FAQ.
     * www - The www module contains all OpenBSD web pages, including
       this FAQ.

   Now that you have decided which module that you wish to retrieve,
   there is one more step left before you can retrive it. You must decide
   in which method you will retrive it. CVS by default retrieves files
   using rsh(1), but some AnonCVS servers don't allow for this so in most
   cases it's best to use ssh. For those of you behind a firewall there
   are also the options of pserver and some AnonCVS servers run ssh on
   port 2022. Be sure to check [8]http://www.openbsd.org/anoncvs.html for
   which servers support what protocols. Next I will show how to do a
   simple source checkout. Here I will be using an AnonCVS server located
   in the U.S., but remember that if you are outside of the U.S you need
   to use a server that is also located there. There are many AnonCVS
   servers located throughout the world, so choose one nearest you. I
   will also be using ssh to retrieve the files.
ericj@oshibana:~> export CVS_RSH=/usr/local/bin/ssh
ericj@oshibana:~> echo $CVS_RSH
/usr/local/bin/ssh
ericj@oshibana:~> export CVSROOT=anoncvs@anoncvs.usa.openbsd.org:/cvs
ericj@oshibana:~> cvs get src
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
cvs checkout: in directory src:
cvs checkout: cannot open CVS/Entries for reading: No such file or directory
cvs server: Updating src
U src/Makefile
[snip]

   Notice here also that I set the CVSROOT environmental variable. This
   is the variable that tells cvs(1) which AnonCVS server to use. This
   can also be specified using the -d option. For example:
ericj@oshibana:~>cvs -d anoncvs@anoncvs.usa.openbsd.org:/cvs get src

   These commands should be run in /usr, which will then create the
   directories of /usr/src, /usr/ports, and /usr/www. Depending, of
   course, on which module you checkout. You can download these modules
   to anywhere, but if you wanted to do work with them (ie make build ),
   it is expected that they be at the place above.

  Keeping your CVS tree up-to-date

   Once you have your initial tree setup, keeping it up-to-date is the
   easy part. You can update your tree at any time you choose, some
   AnonCVS servers update more often then others, so again check
   [9]http://www.openbsd.org/anoncvs.html. In this example I will be
   updating my www module from anoncvs.usa.openbsd.org. Notice the -q
   option that I use, this makes the output not so verbose coming from
   the server.
ericj@oshibana:~> echo $CVSROOT
anoncvs@anoncvs.usa.openbsd.org:/cvs
ericj@oshibana:~> cvs -q up -PAd www
Warning: Remote host denied X11 forwarding, perhaps xauth program could not be
run on the server side.
? www/faq/Makefile
? www/faq/txtdump.sh
U www/want.html
M www/faq/faq8.html
ericj@oshibana:~>

  Other cvs options

   For some, bandwidth and time are serious problems when updating
   repositories such as these. So CVS has a -z[1-9] option which uses
   gzip to compress the data. To use it, do -z[compression-level], for
   instance, -z3 for a compression level of 3.

8.6 - What is the ports tree?

   The ports tree is a set of Makefiles that download, patch, configure
   and install userland programs so you can run them an OpenBSD
   environment without having to do all that by hand. You can get the
   ports tree from any of the OpenBSD ftp servers in
   /pub/OpenBSD/2.5/ports.tar.gz or try the latest updates in
   /pub/OpenBSD/snapshots/ports.tar.gz.

   If you want to run one of the latest ports collections, you'll need to
   update your /usr/share/mk/ directory. CVS up your /usr/src/ directory
   and do a:
# cd /usr/src/share/mk/
# make install

   first.

   A snapshot of the ports tree is also created daily and can be
   downloaded from any of the [10]OpenBSD ftp servers as
   /pub/OpenBSD/snapshots/ports.tar.gz.

   In 2.5-current this information is now stored in the ports tree. In
   ports/infrastructure/. So, once you are running the latest snapshot,
   with the infrastructure dir, you no longer need to update bsd.port.mk
   per instructions above.

   Ports are set up to be EXTREMELY easy to make and install. Here is an
   example install for someone wanting to install the X11 program xfig.
   You'll notice the dependencies are automatically detected and
   completed:

   First you need to cd to the dir of the program you want. If you are
   searching for a program, you can either update your locate database,
   or use the search function talked about below. Once you are in the dir
   of the program you want, you can just type make install. For example.
fenetyllin:/usr/ports/graphics/xfig# make install
===>  Extracting for xfig-3.2.2
===>  xfig-3.2.2 depends on shared library: jpeg.62. - /usr/local/lib/libjpeg.s
o.62.0 found
===>  xfig-3.2.2 depends on shared library: Xaw3d.6. - not found
===>  Verifying install for Xaw3d.6. in /usr/ports/x11/Xaw3d
>> Xaw3d-1.3.tar.gz doesn't seem to exist on this system.
>> Attempting to fetch from ftp://crl.dec.com/pub/X11/contrib/widgets/Xaw3d/R6.
1/.
Connected to crl.dec.com.
220 crl.dec.com FTP server (Digital UNIX Version 5.60) ready.
331 Guest login ok, send ident as password.
230 Guest login ok, access restrictions apply.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type set to I.
250 CWD command successful.
250 CWD command successful.
Retrieving pub/X11/contrib/widgets/Xaw3d/R6.1/Xaw3d-1.3.tar.gz
local: Xaw3d-1.3.tar.gz remote: Xaw3d-1.3.tar.gz
227 Entering Passive Mode (192,58,206,2,5,14)
150 Opening BINARY mode data connection for Xaw3d-1.3.tar.gz (0.0.0.0,0) (29027
7 bytes).
100% |**************************************************|   283 KB    00:00 ETA
226 Transfer complete.
290277 bytes received in 101.09 seconds (2.80 KB/s)
221 Goodbye.
===>  Extracting for Xaw3d-1.3
/bin/mkdir -p /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d
cd /usr/ports/x11/Xaw3d/work/xc/lib/Xaw3d/X11/Xaw3d; ln -sf ../../*.h .
===>  Patching for Xaw3d-1.3
===>  Configuring for Xaw3d-1.3
mv -f Makefile Makefile.bak
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
make Makefiles
[snip]

   You can see a list of both ports and packages by using the pkg_info
   command.
bsd# /usr/sbin/pkg_info
zsh-3.0.5           The Z shell.
screen-3.7.4        A multi-screen window manager.
ssh-1.2.21          Secure shell client and server (remote login program).
emacs-20.2          GNU editing macros.
lynx-2.7.1ac-0.107  An alphanumeric display oriented World-Wide Web Client.
tcsh-6.07.02        An extended C-shell with many useful features.
bash-2.01           The GNU Borne Again Shell.
zip-2.2             Create/update ZIP files compatabile with pkzip.
mm-2.7              Implementation of MIME, the Multipurpose Internet Mail Exte
n
ircii-2.8.2-epic3.004 An enhanced version of ircII, the Internet Relay Chat cli
ent
ispell-3.1.20       An interactive spelling checker.
tin-1.3.970930      TIN newsreader (termcap based)
procmail-3.11p7     A local mail delivery agent.
strobe-1.03         Fast scatter/gather TCP port scanner
lsof-4.15           Lists information about open files.
xntp3-5.92          Network Time Protocol Implementation.
ncftp-2.4.3
 nmh-0.27            The New MH mail handling program
bzip2-0.1p12        A block-sorting file compressor

   If you are looking for a specific program in the ports tree, you can
   try
fenetyllin:/usr/ports/# make search key="xfig"
Port:   xfig-3.2.2
Path:   /home/ports/graphics/xfig
Info:   A drawing program for X11
Maint:  angelos@openbsd.org
Index:  graphics x11
B-deps: Xaw3d-1.3 jpeg-6b
R-deps: Xaw3d-1.3 ghostscript-5.10 gv-3.5.8 jpeg-6b png-1.0.2 transfig-3.2.1
Archs:  any

Port:   transfig-3.2.1
Path:   /home/ports/print/transfig
Info:   Tools to convert Xfigs .fig files.
Maint:  angelos@openbsd.org
Index:  print
B-deps: jpeg-6b
R-deps: ghostscript-5.10 jpeg-6b png-1.0.2
Archs:  any
[snip]

   More information about the ports can be found in the ports man page

   Our ports tree is constantly being expanded, and if you would like to
   help please see: [11]http://www.openbsd.org/ports.html

8.7 - What are packages?

   Packages are the precompiled binaries of some of the most used
   programs. They are ready for use on an OpenBSD system. Again, like the
   ports, packages are very easy to maintain and update. Packages are
   constantly being added so be sure to check each release for additional
   packages.

   Here is a list of tools used in managing packages.
     * pkg_add (1) - a utility for installing software package
       distributions
     * pkg_create (1) - a utility for creating software package
       distributions
     * pkg_delete (1) - a utility for deleting previously installed
       software package distributions
     * pkg_info (1) - a utility for displaying information on software
       packages

   Here is a sample user installing ispell via a package:
   bsd# pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/2.5/packages/${arch}/ispell-3.1.
       20.tgz

   where ${arch} is your architecture

   Again, like with ports you can use the [12]pkg_info(1) program to view
   what is already installed on your system.

   To delete packages you will want to use the [13]pkg_delete(1) command.
   It is used the same way as [14]pkg_add(1).
   bsd# /usr/sbin/pkg_delete ispell-3.1.20

   and it is gone.

   Packages can be found on any of the [15]OpenBSD ftp mirror sites, or
   they can be found on your OpenBSD CDs.

8.8 - Is there any way to use my floppy drive if it's not attached during boot?

   Sure. You need to add "flags 0x20" at the end of the fd* entry and
   recompile your kernel. The line should be read:
  fd*     at fdc? drive ? flags 0x20

   After that you would be able to use the floppy drive all the time. It
   doesn't matter if you plugged it later after boot.

8.9 - Boot time Options - Using the OpenBSD bootloader

   When booting your OpenBSD system, you have probably noticed the boot
   prompt.

   boot>

   For most people, you won't have to do anything here. It will
   automatically boot if no commands are given. But sometimes problems
   arise, or special functions are needed. That's where these options
   will come in handy. To start of, you should read through the
   [16]boot(8) man page. Here we will go over the most common used
   commands for the bootloader.

   To start off, if no commands are issued, the bootloader will
   automatially try to boot /bsd. If that fails it will try /obsd, and so
   on till it finds a bootable kernel. You can specify this by hand by
   typing:
   boot> boot wd0a:/bsd

   or
   boot> b /bsd

   This will work if device wd0a is configured as your root device.

   Here is a brief list of options you can use with the OpenBSD kernel.
   -a : This will allow you to specify an alternate root device after
       booting the kernel.
       -c : This allows you to enter the boot time configuration. Check
       the [17]Boot Time Config section of the faq.
       -s : This is the option to boot into single user mode.
       -d : This option is used to dump the kernel into ddb. Keep in mind
       that you must have DDB built into the kernel.
       -b : Shortcut for RB_HALT.

   These are entered in the format of: boot [ image [-abcds]]

   For further reading you can read [18]boot_i386(8) man page

8.10 - S/Key

   S/Key is a ``one-time password'' scheme. This allows for one-time
   passwords for use on un-secured channels. This can come very handy for
   those who don't have the ability to use ssh or any other encrypted
   channels. OpenBSD's S/Key implimentation can use a variety of
   algorithms as the one-way hash. Here is the list of algorithms
   availible:
     * [19]md4
     * [20]md5
     * [21]sha1
     * [22]rmd160.

  Setting up S/Key - The first steps

   To start of the file /etc/skeykeys must exist. If this file is not in
   existance, have the super-user create it. This can be done simply by
   doing:
# touch /etc/skeykeys

   Once that file is in existance, you can initalize your S/Key. To do
   this you will have to use [23]skeyinit(1). With skeyinit(1), you will
   first be prompted for your password to the system. This is the same
   password that you used to log into the system. Running skeyinit(1)
   over an insecure channel is completely not recommended, so this should
   be done over a secure channel (such as ssh) or the console. Once you
   have authorized yourself with your system password you will be asked
   for yet another password. This password is the secret password, and is
   NOT your system password. The secret password is not limited to 8
   characters like system passwords, actually it must be at least 10
   characters. A few word phrases are suggested. Here is an example user
   being added.
oshibana:ericj> skeyinit ericj
[Adding ericj]
Reminder - Only use this method if you are directly connected
           or have an encrypted channel.  If you are using telnet
           or rlogin, exit with no password and use skeyinit -s.
Enter secret password:
Again secret password:

ID ericj skey is otp-md5 99 oshi45820
Next login password: HAUL BUS JAKE DING HOT HOG

   One line of particular importance in here is ID ericj skey is otp-md5
   99 oshi45820. This gives alot of information to the user. Here is a
   breakdown of the sections and their importance.
     * otp-md5 - This shows which one-way has was used to create your
       One-Time Password (otp).
     * 99 - This is your sequence number. This is a number from 100 down
       to 1. Once it reaches one, another secret password must be
       created.
     * oshi45820 - This is your key.

   But of more immediate importance is your password. Your password
   consists of 6 small words, combined together this is your password,
   spaces and all.

  Actually using S/Key to login.

   By now your skey has been initialized, and you have your password.
   You're ready to login. Here is an example session using s/key to
   login.
oshibana:ericj> ftp localhost
Connected to localhost.
220 oshibana.shin.ms FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): ericj
331 Password [ otp-md5 96 oshi45820 ] for ericj required.
Password:
230- OpenBSD 2.5-current (OSHIBANA) #8: Tue Jun 22 19:20:16 EDT 1999
230-
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230-
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230-
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> quit
221 Goodbye.

   Some of you might have noticed that my sequence number has changed.
   otp-md5 96 oshi45820. This is because by now i have used s/key to
   login several times. But how do you get your password after you've
   logged in once? Well to do this, you'll need to know what sequence
   number your using and your key. As you're probobly thinking, how can
   you remember which sequence number your on? Well this is simple, use
   [24]skeyinfo(1), and it will tell you what to use. For example here, I
   need to generate another password for a login that I might have to
   make in the future. (remember I'm doing this from a secure channel).
oshibana:ericj> skeyinfo
95 oshi45820

   From this I can create the password for my next login. To do so, I'll
   use [25]skey(1). I can use exactly that output from above to create my
   password.
oshibana:ericj> skey 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
NOOK CHUB HOYT SAC DOLE FUME

   I'm sure many of you won't always have a secure connect to create
   these passwords, and creating them over an insecure connection isn't
   feasible, so how can you create multiple passwords at one time? Well
   you can supply skey(1) with a number of how many passwords you want
   created. This can then be printed out and taken with you wherever you
   go.
oshibana:ericj> skey -n 5 95 oshi45820
Reminder - Do not use this program while logged in via telnet or rlogin.
Enter secret password:
91: SHIM SET LEST HANS SMUG BOOT
92: SUE ARTY YAW SEED KURD BAND
93: JOEY SOOT PHI KYLE CURT REEK
94: WIRE BOGY MESS JUDE RUNT ADD
95: NOOK CHUB HOYT SAC DOLE FUME

   Notice here though, that the bottom password should be the first used,
   because we are counting down from 100.

  Controlling S/Key

   For more control over S/Key there is the /etc/skey.access file. (This
   does not exist by default, so it must be created.) This file can
   restrict S/Key in three primary ways.
     * permit internet - Which will allow certain IPs to connect and use
       s/key.
     * permit user - Which will allow users by login name access to s/key
       use.
     * permit port - Which is really only useful for assigned ports, (ie
       dial-up)

   If I wanted to allow one single user ( ericj ), from a certain IP (
   10.1.1.5 ), I would create a file like so.
# cat /etc/skey.access
permit internet 10.1.1.5
permit user ericj

   [26][Back to Main Index] [27][To Section 7.0 - Keyboard controls]
   [28][To Section 9.0 - Tips for linux users]
     _________________________________________________________________

   [29][back] [30]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq7.html
   3. http://openbsd.org/faq/faq9.html
   4. http://www.xfree86.org/FAQ/
   5. http://www.cyclic.com/
   6. http://openbsd.org/anoncvs.html
   7. http://openbsd.org/faq/faq8.html#8.6
   8. http://openbsd.org/anoncvs.html
   9. http://openbsd.org/anoncvs.html
  10. http://openbsd.org/ftp.html
  11. http://openbsd.org/ports.html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&sektion=1&format=html
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_delete&sektion=1&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&sektion=1&format=html
  15. http://openbsd.org/ftp.html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=boot&sektion=8&format=html
  17. http://openbsd.org/faq/faq5.html#5.4
  18. http://www.OpenBSD.org/cgi-bin/man.cgi?query=boot_i386&sektion=8&format=html
  19. http://www.openbsd.org/cgi-bin/man.cgi?query=md4&sektion=3&format=html
  20. http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=3&format=html
  21. http://www.openbsd.org/cgi-bin/man.cgi?query=sha1&sektion=3&format=html
  22. http://www.openbsd.org/cgi-bin/man.cgi?query=rmd160&sektion=3&format=html
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinit&sektion=1&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=skeyinfo&sektion=1&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=skey&sektion=1&format=html
  26. http://openbsd.org/faq/index.html
  27. http://openbsd.org/faq/faq7.html
  28. http://openbsd.org/faq/faq9.html
  29. http://openbsd.org/faq/index.html
  30. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 8.0 - General Questions] [3][To
   Section 10.0 - System Administration]

                          9.0 - Migrating from Linux

   If you are migrating from Linux to OpenBSD, note that OpenBSD has
   COMPAT_LINUX enabled by default in the GENERIC kernel. To run any
   Linux binaries that are not statically linked (most of them), you need
   to follow the instructions on the [4]compat_linux(8) manual page. A
   simple way to get most of the useful Linux libraries is to install
   linux_lib from your ports collection.
# cd /usr/ports/emulators/linux_lib
# make install

   OpenBSD supports the EXT2FS file system. You must recompile your
   kernel with option EXT2FS in order to get this support. Once you have
   it, you can mount your Linux partitions. Use disklabel disk to see
   what OpenBSD thinks your Linux partition is (but don't use disklabel
   or fdisk to make any changes to it).

9.1 - Simple tips for Linux (and other free Unix-like OS) users

   There are several differences between OpenBSD and Linux. These
   differences include but are not limited to, bootup procedure, network
   interface usage and disk management. Most differences are well
   documented, but involve searching manpages. This document tries to be
   an index of those differences.

     * OpenBSD has a ports tree. This is to accomodate the fact that at
       this point not many applications are native to the OpenBSD
       environment. This is both an attempt to get applications to work
       on OpenBSD for end-users and to get more applications made with
       OpenBSD in mind. Eventually this ports tree will be used to make a
       nice set of binary packages.
     * OpenBSD uses CVS for source changes. With Linux, source code is
       disseminated through separate distributions. OpenBSD has pioneered
       anonymous CVS, which allows anyone to extract the full source tree
       for any version of OpenBSD (from 2.0 to current, and all revisions
       of all files in between) at any time! There is also a very
       convenient and easy to use [5]web interface to CVS.
     * OpenBSD periodically releases snapshots for various architectures
       and makes a stable, official CD release every 6 months.
     * OpenBSD contains STRONG CRYPTO, which USA based OS's can't
       contain. (See [6]http://www.openbsd.org/crypto.html) OpenBSD has
       also gone through heavy security auditing and many security
       features have already been implemented into the source tree.
       (IPSEC, KERBEROS).
     * OpenBSD's kernel is /bsd.
     * The names of hard disks are usually /dev/wd and /dev/sd (ATA/SCSI)
     * /sbin/ifconfig with no arguments in Linux gives the state of all
       the interfaces. Under OpenBSD you need the -a flag.
     * /sbin/route with no arguments in Linux gives the state of all the
       active routes. Under OpenBSD you need the "show" parameter, or do
       a netstat -r (nice).
     * OpenBSD comes with Darren Reed's IP Filter package, not ipfw. This
       means that:
          + IP-Masquerading is done through ipnat. ([7]ipnat(1))
          + ipfwadm is done through ipf ([8]ipf(1), [9]ipf(5))
          + You should look at [10]section 6 for detailed configuration
            assistance and information.
     * Interface address is stored in /etc/hostname.<interfacename>. It
       can be a name instead of an IP address.
     * The machine name is in /etc/myname
     * The default gateway is in /etc/mygate
     * The network interface aliases are in /etc/ifaliases
     * OpenBSD's default shell is /bin/sh, which is the Korn shell.
       Shells such as bash and tcsh can be added as packages or installed
       from the ports tree.
     * Password management changes a lot. The main files are different.
       ([11]passwd(1), [12]passwd(5))

9.2 - Dual booting Linux and OpenBSD

   Yes! it is possible!

   Read [13]INSTALL.linux

   [14][Back to Main Index] [15][To Section 8.0 - General Questions]
   [16][To Section 10.0 - System Administration]
     _________________________________________________________________

   [17][back] [18]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq8.html
   3. http://openbsd.org/faq/faq10.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&format=html
   5. http://www.openbsd.org/cgi-bin/cvsweb/
   6. http://openbsd.org/crypto.html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=1&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=1&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=5&format=html
  10. http://openbsd.org/faq/faq6.html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=1&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&apropos=0&sektion=5&format=html
  13. http://openbsd.org/faq/INSTALL.linux
  14. http://openbsd.org/faq/index.html
  15. http://openbsd.org/faq/faq8.html
  16. http://openbsd.org/faq/faq10.html
  17. http://openbsd.org/faq/index.html
  18. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 9.0 - Migrating from Linux]
   [3][To Section 11.0 - OpenBSD 2.4 Specific Information]

                         10.0 - System Administration
     _________________________________________________________________

10.1 - Why does it say that I'm in the wrong group when I try to su root?

   Existing users must be added to the "wheel" group by hand. This is
   done for security reasons, and you should be cautious with whom you
   give access to. On OpenBSD, users who are in the wheel group are
   allowed to use the [4]su(1) userland program to become root. Users who
   are not in "wheel" cannot use su(1). Here is an example of a
   /etc/group entry to place the user ericj into the "wheel" group.

   If you are adding a new user with [5]adduser(8), you can put them in
   the wheel group by answering wheel at Invite user into other groups:
   This will add them to /etc/group, which will look something like this:
wheel:*:0:root,ericj

   If you are looking for a way to allow users limited access to
   superuser privileges, without putting them in the "wheel" group, use
   [6]sudo(8).

10.2 - How do I duplicate a filesystem?

   To duplicate your filesystem use [7]dump(8) and [8]restore(8). For
   example. To duplicate everything under directory SRC to directory DST,
   do a:
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )

   dump is designed to give you plenty of backup capabilities, and it may
   be an overkill if you just want to duplicate a part of a (or an
   entire) filesystem. The command [9]tar(1) may be faster for this
   operation. The format looks very similar:
# cd /SRC; tar cf -  . | (cd /DST; tar xpf - )

10.3 - How do I get httpd, sendmail, etc to startup with the system?

   OpenBSD uses rc-style startup to control starting applications with
   the system. For common daemons you can simply edit [10]/etc/rc.conf.
   For example: To have ftpd started on boot change the ftpd entry from:
   ftpd_flags=NO

   to:
   ftpd_flags="-D"

   You can add any flags that you wish ftpd to start with.

   If you have your own daemons that you want to be started, here is a
   simple entry that you can put into /etc/rc.local.
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi

   Once in there, it will come up with the system each time.

10.4 - Why do users get relaying access denied when they are remotely sending
mail through my OpenBSD system?

   Try this:
# cat /etc/sendmail.cf | grep relay-domains

   The output may look something like this:
FR-o /etc/mail/relay-domains

   If this file doesn't exist, create it. You will need to enter the
   users who are sending mail remotely with the following syntax:
.domain.com    #Allow any .domain.com user to send mail through us
sub.domain.com #Allow sub.domain.com to send mail through us

   Don't forget send a 'HangUP' signal to sendmail, (a signal which
   causes most daemons to re-read their configration file):
# kill -HUP `cat /var/run/sendmail.pid`

10.5 - I've set up POP, but users have trouble accessing mail thru POP. What
can I do?

   Most issues dealing with POP are problems with temporary files and
   lock files. If your pop server sends an error message such as:
-ERR Couldn't open temporary file, do you own it?

   Try setting up your permissions as such:
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username

   Another thing to check is that the user actually owns their own
   /var/mail file. Of course this should be the case (as in,
   /var/mail/joe should be owned by joe) but if it isn't set correctly it
   could be the problem!

   Of course, making /var/mail writeable by group mail opens up some
   vague and obscure security problems. It is likely that you will never
   have problems with it. But it could (especially if you are a high
   profile site, ISP,...)! Try running cucipop or another POP daemon from
   the OpenBSD ports collection. Or, you could just have the wrong
   options selected for your pop daemon (like dot locking). Or, you may
   just need to change the directory that it locks in (although then the
   locking would only be valueable for the POP daemon.)

10.6 - Setting up a Secure HTTP server with SSL(8)

   This will take you through all the steps it takes to set up your own
   Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
   with SSLeay. Because of patented RSA algorigthms, these cannot be
   shipped with OpenBSD. libssl includes support for SSL version 2, SSL
   version 3, and TLS version 1. So for now, because of patent
   restictions, OpenBSD must ship without a fully-functional libssl. But
   it is still completely useable. If you are able to use the RSA
   patented libraries, you can easily upgrade your libssl with a command
   like this.
   # pkg_add
       ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1
       .1.tgz

   Where ${ver} is the OpenBSD version number, and ${arch} is your
   architecture.

   The steps shown here are taken in part from the [11]ssl(8) man page.
   Refer to it for further information. This FAQ entry only outlines how
   to creating an RSA certificate for web servers, not a DSA server
   certificate. To find out how to do so, please refer to the ssl(8) man
   page.

   Here is how you create your server key and certificate. These will go
   to /etc/ssl/private/. To use the RSA features, you must have upgraded
   your libssl. Now you can create your key. Using ssleay,
# ssleay genrsa -out /etc/ssl/private/server.key 1024

   This will create a key of 1024 bits. Next you need to create a
   Certificate Signing Request which is used to get a CA or Certificate
   Authority to sign your key. Here is the command to do so.
   # ssleay req -new -key /etc/ssl/private/server.key -out
       /etc/ssl/private/server.csr

   You would now give /etc/ssl/private/server.csr to the CA to get it
   signed. Or you could also sign the certificate for yourself. Here is
   how you would do this.
   # ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey
       /etc/ssl/private/server.key -out /etc/ssl/server.crt

   This will sign your key, and it will be valid for up to 365 days. With
   this done you can now start the httpd server. To start httpd(8) with
   ssl you must start the daemon with the -DSSL flag. You can start this
   on boot in /etc/rc.conf by changing the httpd line to look like so:
httpd_flags="-DSSL"

   This server will run on port 443.

10.7 - I edited /etc/passwd, but the changes didn't seem to take place. Why?

   If you edit /etc/passwd, your changes will be lost. OpenBSD generates
   /etc/passwd dynamically with [12]pwd_mkdb(8). The main password file
   in OpenBSD is /etc/master.passwd. According to pwd_mkdb(8),
FILES
     /etc/master.passwd  current password file
     /etc/passwd         a Version 7 format password file
     /etc/pwd.db         insecure password database file
     /etc/pwd.db.tmp     temporary file
     /etc/spwd.db        secure password database file
     /etc/spwd.db.tmp    temporary file

   In a traditional Unix password file, such as /etc/passwd, everything
   including the user's encrypted password is available to anyone on the
   system (and is a prime target for programs such as Crack.) 4.4BSD
   introduces the master.passwd file, which has an extended format (with
   additional options beyond what was provided by /etc/passwd) and is
   only readable by root. For faster access to data, the library calls
   which access this data normally read /etc/pwd.db and /etc/spwd.db.

   OpenBSD does come with a tool with which you should edit your password
   file. It is called vipw(8). Vipw will use vi (or your favourite editor
   defined per $EDITOR) to edit /etc/master.passwd. After you are done
   editing, it will re-create /etc/passwd, /etc/pwd.db, and /etc/spwd.db
   as per your changes. Vipw also takes care of locking these files, so
   that if anyone else attempts to change them at the same time, they
   will be denied access.

10.8 - What is the best way to add and delete users?

   The best way to add a user in OpenBSD is to use the [13]adduser(8)
   script. You can configure this to work however you like by editing
   /etc/adduser.conf. You can add users by hand, but this is the
   recommended way to addusers. adduser(8) allows for consistancy checks
   on /etc/passwd, /etc/group, and shell databases. It will create then
   entries for you, and HOME directory, and even send a message to the
   user welcoming them. This can be changed to meet your needs. For
   further instructions on adding users read the [14]adduser_proc(8) man
   page.

   To delete users you should use the [15]rmuser(8) utility. This will
   remove all existence of a user. It will remove any crontab(1) entries,
   their HOME dir (if it is owned by the user), and their mail. Of course
   it will also remove their /etc/passwd and /etc/group entries.

10.9 - How do I create an ftp-only account?

   There are a few ways to do this, but a very common way to do such is
   to add /bin/false into /etc/shells. Then when you create the user set
   his shell to /bin/false, they will not be able log in interactively,
   but will be able to use ftp capabilities. adduser(8) will give them a
   home dir by default of /home/. If this is what you desire it doesn't
   need to be changed, however you can set this to whatever directory you
   wish.

10.10 - Setting up Quotas

   Quotas are used to limit users space that they have available to them
   on your drives. It can be very helpful in situations where you have
   limited resources. Quotas can be set in two different ways.

     * User Quotas
     * Group Quotas

   The first step to setting up quotas is to make sure that option QUOTA
   is in your Kernel Configuration. This option is in the GENERIC kernel.
   After this you need to mark in /etc/fstab the filesystems which will
   have quotas enabled. The keywords userquota and groupquota should be
   used to mark each fs that you will be using quotas on. By default the
   files quota.user and quota.group will be created at the root of that
   filesystem to hold the quota information. This default can be
   overwritten by doing, userquota=/var/quotas/quota.user. Or whatever
   file you want to use for holding quota information. Here is an example
   /etc/fstab that has one filesystem with userquotas enabled.
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1

   Now it's time to set the user's quotas. To do so you use the utility
   [16]edquota(8). A simple use is just edquota <user>. edquota(8) will
   use vi(1) to edit the quotas unless the environmental variable EDITOR
   is set to a different editor. For example:
   # edquota ericj

   This will give you output similar to this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
        inodes in use: 25, limits (soft = 0, hard = 0)

   To add limits, edit it to give results like this:
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
        inodes in use: 25, limits (soft = 0, hard = 0)

   In this the softlimit is set to 1000 blocks and the hardlimit is set
   to 1050 blocks. A softlimit is a limit where the user is just warned
   when they cross it and have until their grace period is up to get
   their disk usage below their limit. Grace periods can be set by using
   the -t option on edquota(8). After the grace period is over the
   softlimit is handled as a hardlimit. This usually results in an
   allocation failure.

   Now that the quotas are set, you need to turn the quotas on. To do
   this use [17]quotaon(8). For example:
# quotaon -a

   This will go thru /etc/fstab to turn on the filesystems with quota
   options. Now that quotas are up and running, you can view them by the
   [18]quota(1). Using a command of quota <user> will give that users
   infoformation. When called with no arguments will give your quota
   statistics. For example:
# quota ericj

   Will result in output similar to this:
Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0

   By default quotas set in /etc/fstab will be started on boot. To turn
   them off use
# quotaoff -a

10.11 - How to Setup Kerberos Clients and Servers under OpenBSD

   As a user/administrator of OpenBSD systems, you are fortunate that
   KerberosIV is an pre-installed component of the default system. Here
   is a guide to setting up both the Kerberos realm server, as well as a
   client.

   An *EXTREMELY* important point to remember is that Kerberos clients
   and servers much have their system clocks synchronized. If there is
   more than a 5 minute time skew, you will receive wierd errors that do
   not immediately reveal themselves to be caused by time skew, such as:
kinit: Can't send request (send_to_kdc)

   Another more accurate error is:
kauth: Time is out of bounds (krb_rd_req)

   An easy way to synchronize system clocks is with xntpd, available in
   the ports tree at /usr/ports/sysutils/xntpd/.
   This FAQ entry assumes you have prior knowledge of the Kerberos
   concepts. For a great, easy to understand, reference, see:
     * [19]The FreeBSD handbook
     * Use the command info kth-krb
     * [20]Designing an Authentication System: a Dialogue in Four Scenes
     * [21]Papers and Documentation Describing KerberosIV

   Or the book
     * [22]Network Security Private Communication in a Public World
       [Kaufman, Perlman, Speciner, 1995]

  How to setup the Kerberos IV REALM and SERVER

   We will be setting up the CIARASYSTEMS.COM realm, with
   avalanche.ciarasystems.com as the main server.

   To start off, we will need to edit our configuration files. These
   files are located at /etc/kerberosIV/. The two files we are concerned
   about are krb.realms and krb.conf. Lets start off with krb.conf.
[root@avalanche kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

   As you can see, this tells kerberos that the domain is
   CIARASYSTEMS.COM (or logical realm) and that within that domain,
   avalanche is the administration server. Next we will look at
   krb.realms. For more information on this refer to [23]krb.conf.
[root@avalanche kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM

   krb.realms provides a translation from a hostname to the Kerberos
   realm name for the services provided by that host. Each line of the
   translation file is in one of the following forms (domain_name should
   be of the form .XXX.YYY). So in this example, avalanche is the
   hostname of a computer on the CIARASYSTEMS.COM realm. And
   .ciarasystems.com is the domain name on the realm CIARASYSTEMS.COM.
   Again, for further information read the [24]krb.realms. man page.

   Next we will run [25]kdb_init(8) to create the initial Kerberos
   database.
[root@avalanche kerberosIV] kdb_init
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: not shown
Verifying password -
Enter Kerberos master password:

   Next we need to use [26]kstash(8) which is used to save the Kerberos
   key distribution center (KDC) database master key in the master key
   cache file.
[root@avalanche kerberosIV] kstash
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: passwd
Instance: avalanche

<Not found>, Create [y] ? y

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <----- Use 'RANDOM' as password
Verifying password -
New Password:

Random password [y] ? y

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: rcmd
Instance: avalanche

, Create [y] ? y
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <----- Use 'RANDOM' as password
Verifying password -
New Password:

Random password [y] ? y

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? 2001-12-31
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <----- Hit <ENTER> to end

   A srvtab file is the service key file. These must be extracted from
   the Kerberos key distribution center database in order for services to
   authenticate using Kerberos. For each hostname specified on the
   command line, [27]ext_srvtab(8) creates the service key file
   hostname-new-srvtab, containing all the entries in the database with
   an instance field of hostname.
[root@avalanche kerberosIV] ext_srvtab avalanche

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

[root@avalanche kerberosIV] mv avalanche-new-srvtab srvtab
[root@avalanche kerberosIV] chmod 600 srvtab

   Now we can add users to our database.
[root@avalanche kerberosIV] kdb_edit
Opening database...

Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: jeremie
Instance:

, Create [y] ? y

Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                <---- enter a secure password here
Verifying password

New Password:                <---- re-enter the password here
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          <---- null entry here will cause an exit
                               or you can add more entries.

   So now all the Kerberos particulars are setup. All that is left is to
   enable boot-time loading of the Kerberos server and to enable
   Kerberized-daemons.

   In /etc/rc.conf, set:
   kerberos_server=YES

   In /etc/inetd.conf, uncomment:
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd

   Then, either reboot, or:
[root@avalanche /] kill -HUP `cat /var/run/inetd.pid`
[root@avalanche /] /usr/libexec/kerberos >> /var/log/kerberos.log &
[root@avalanche /] /usr/libexec/kadmind -n >> /var/log/kadmind.log &

   Note: this is a rather simple server setup. Usually, redundant servers
   are setup (as slave servers) so that if one server goes down, all the
   services that depend on Kerberos don't go down. We can also add 'su'
   privileges to a specific principal, see [28]the FreeBSD Handbook.

  How to kerberize your client workstation

   We will be setting the workstation named gatekeeper to be in the
   CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main
   server.

   To start off, we need to setup our krb.conf and krb.realms like the
   above machine. This is so gatekeeper will know what server is the KDC
   and what domain it is on. Again here are the file contents.
[root@gatekeeper kerberosIV] cat krb.conf
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

[root@gatekeeper kerberosIV] cat krb.realms
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM

   Now that is set up, we need to initialize kerberos. To obtain a ticket
   you use [29]kinit(1).
xyz:jeremie% kinit
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: jeremie
Password:

   Now we have identified we can list our tickets with [30]klist(1).
xyz:jeremie$ klist
Ticket file:    /tmp/tkt1000
Principal:      jeremie@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@CIARASYSTEMS.COM

   Looks like we are set now. All that's left to do is test it. Here we
   will test it with rlogin(1) and telnet(1).
xyz:jeremie% telnet avalanche
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999

   and
xyz:jeremie% rlogin avalanche
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999

   We can tell that it is indeed using Kerberos to authenticate the
   rlogin session. To get rid of any tickets issued, you would use
   [31]kdestroy(1). For example:
xyz:jeremie% kdestroy
Tickets destroyed.
xyz:jeremie% rlogin avalanche
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused

   Do not worry about 'Warning: no Kerberos tickets issued.' This is
   because we're only doing kerberos authentication, not ticket passing.
   If you want ticket passing, use Dug Song's [32]krb4 SSH patches. Stock
   KerberosIV doesn't have support for tgt passing, either - only the AFS
   kaserver's implementation of krb4, since the regular KerberosIV kdc
   checks client IP address listed in the ticket.

10.12 - Setting up Anonymous FTP Services.

   Anonymous FTP allows users without accounts to access files on your
   computer via the File Transfer Protocol. This will give an overview of
   setting up the anonymous FTP server, and it's logging, etc.

  Adding the FTP account

   To start off, you need to have an account on your system of ''ftp''.
   This account shouldn't have a useable password, and here we will set
   the login directory to /home/ftp. When using anonymous ftp, the ftp
   daemon will chroot itself to /home/ftp. To read up more on that, read
   the [33]ftp(8) and [34]chroot(2) man pages. Here is an example of
   adding the ftp user. I will do this using [35]adduser(8). We also need
   to add /bin/false to our /etc/shells, this is the "shell" that we will
   be giving to the ftp user. This will allow them not to login, even
   though we will give them an empty password. To do this you can simply
   echo /bin/false >> /etc/shells. Also if you wish for that shell to
   show up during the adduser questions, you need to modify
   /etc/adduser.conf.
oshibana# adduser
Use option ``-silent'' if you don't want see all warnings & questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any inp
ut.
Enter username [a-z0-9_]: ftp
Enter full name []: anonymous ftp
Enter shell csh false ksh nologin sh tcsh zsh [sh]: false
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: no
Enter password []:
Use an empty password? (y/n) [y]: y

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: y
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: n
Goodbye!

  Directory Setup

   Along with the user, this created the directory /home/ftp. This is
   what we want, but there are some changes that we will have to make to
   get it ready for anonymous ftp. Again these changes are explained in
   the [36]ftp(8) man page.
     * /home/ftp - This is the main directory. It should be owned by root
       and have permissions of 555.
     * /home/ftp/bin - This directory will hold binaries that can be
       executed from within the chrooted ftpd environment. This directory
       should be mode 511. Anonymous FTP only needs ls(1) to operate
       correctly. So you need to copy /bin/ls to /home/ftp/bin.
       ~ftp/bin/ls needs to be mode 111, which is executable only.
     * /home/ftp/etc - Directory to hold user information. You should
       copy /etc/pwd.db and /etc/group to this directory. This directory
       should be mode 511, and the two files should be mode 444. These
       are used to give owner names as opposed to numbers. The password
       fields in pwd.db will not be used.
     * /home/ftp/pub - This is the directory to place files in which you
       wish to share. This directory should also be mode 555.

   Note that all these directories should be owned by ''root''. Here is a
   listing of what the directories should look like after their creation.
oshibana# pwd
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:33 bin
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/bin:
total 178
dr-x--x--x  2 root  ftp     512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp     512 Jul  6 11:33 ..
---x--x--x  1 root  ftp  167936 Jul  6 11:33 ls

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..

  Starting up the server and logging

   With ftpd you can choose to either run it from inetd or the rc scripts
   can kick it off. These examples will show our daemon being started
   from [37]inetd.conf. First we must become familiar with some of the
   options to ftpd. The default line from /etc/inetd.conf is:
ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -U
S

   Here ftpd is invoked with -US. This will log anonymous connections to
   /var/log/ftpd and concurrent sessions to /var/run/utmp. That will
   allow for these sessions to be seen via who(1). For some, you might
   want to run only an anonymous server, and disallow ftp for users. To
   do so you should invoke ftpd with the -A option. Here is a line that
   starts ftpd up for anonymous connections only. It also uses -ll which
   logs each connection to syslog, along with the get, retrieve, etc, ftp
   commands.
ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -l
lUSA

   Note - For people using HIGH traffic ftp servers, you might want to
   not invoke ftpd from inetd.conf. The best option is to comment the
   ftpd line from inetd.conf and start ftpd from rc.conf along with the
   -D option. This will start ftpd as a daemon, and has much less
   overhead as starting it from inetd. Here is an example line to start
   it from rc.conf.
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"

   This of course only works if you have ftpd taken out of
   /etc/inetd.conf.

  Other relevant files

     * /etc/ftpwelcome - This holds the Welcome message for people once
       they have connected to your ftp server.
     * /etc/motd - This holds the message for people once they have
       successfully logged into your ftp server.
     * .message - This file can be placed in any directory. It will be
       shown once a user enters that directory.

   [38][Back to Main Index] [39][To Section 9.0 - Migrating from Linux]
   [40][To Section 11.0 - OpenBSD 2.4 Specific Information]
     _________________________________________________________________

   [41][back] [42]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq9.html
   3. http://openbsd.org/faq/faq24.html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html
   8. http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html
   9. http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html
  10. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html
  12. http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0
  13. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  14. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html
  15. http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html
  16. http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html
  17. http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html
  18. http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html
  19. http://www.freebsd.org/handbook/kerberos.html
  20. http://web.mit.edu/kerberos/www/dialogue.html
  21. http://web.mit.edu/kerberos/www/papers.html#krb4
  22. http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/
  23. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html
  24. http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html
  25. http://www.openbsd.org/cgi-bin/man.cgi?query=kbd_init&sektion=8&format=html
  26. http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html
  27. http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html
  28. http://www.freebsd.org/handbook/kerberos.html#AEN4957
  29. http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html
  30. http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html
  31. http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html
  32. http://www.monkey.org/~dugsong/ssh-afs-kerberos.html
  33. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  34. http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html
  35. http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html
  36. http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html
  37. http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf
  38. http://openbsd.org/faq/index.html
  39. http://openbsd.org/faq/faq9.html
  40. http://openbsd.org/faq/faq24.html
  41. http://openbsd.org/faq/index.html
  42. mailto:www@openbsd.org


   [1][Back to Main Index] [2][To Section 10.0 - System Administration]
   [3][To Section 12.0 - Performance Tuning]

                    11.0 - OpenBSD 2.4 Specific Information
     _________________________________________________________________

11.1 - In 2.4 why do I get UserDir error when running httpd?

   It seems as though userdir support was left out of 2.4. Make sure to
   pick up the patch at:

   [4]http://www.openbsd.org/errata.html

11.2 - Installing at a partition 4GB or higher

   The 2.4 cd's shipped with a problem in installboot. A patch can be
   obtained here [5]http://www.openbsd.org/errata.html. This is fixed in
   -current.

   To place the partition boot record, installboot used a 32 bit
   multiplication for the sectors times the sectorsize which is larger
   than 2^32 -1 (i.e. multiplication overflow) when the partition starts
   at 4 GB or higher. This means the pbr is installed in the real
   partition address modulo 4GB. It's still possible to install at >= 4GB
   with some effort:

   You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or
   any other unix like OS, you should back up the sectors first before
   trying anything.

     * Suppose the partition starts at cylinder 611, and the drive has
       255 heads, 63 sectors: offset for the obsd partition is
       611*255*63= 9815715 sectors. multiply this by 512 and you get:
       5025646080. 5025646080 mod 2^32 = 730678784
       (You can just subtract 2^32 on a hand calculator...) dividing by
       512 gives sector 1427107.
       Ok, suppose were now in linux (where cylinder numbers are 1 higher
       btw..) and that the obsd partition is DOS partition 4:
       dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
       will backup the data that installboot will nuke ..
       Now install OpenBSD. Return to Linux.
       Now we're going to copy the partition boot record to the right
       place.
       dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
       dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
       (adding obsd to lilo should now work)
       Now write back the nuked sector:
       dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
       Caveat: make sure that whatever gets nuked by installboot isn't
       essential to running dd (and starting the other OS). Backing up
       the affected partition is recommended.
     * Use a correct version of installboot (compiled for you by another
       OBSD'er ..):
       put it on another partition, e.g. a DOS partition. Suppose wd0j is
       the DOS partition (see disklabel wd0, this is in case of IDE
       disks), and installboot is named installb there.
       After booting from floppy/CD, press ^C to get into the shell:
          + mkdir dos
          + mount /dev/wd0j dos
          + cp dos/tmp/installb /usr/mdec/installboot

   Now enter 'install' and the installation procedure should use the new
   installboot.

   [6][Back to Main Index] [7][To Section 10.0 - System Administration]
   [8][To Section 12.0 - Performance Tuning]
     _________________________________________________________________

   [9][back] [10]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq10.html
   3. http://openbsd.org/faq/faq12.html
   4. http://openbsd.org/errata.html#userdir
   5. http://openbsd.org/errata.html#installboot
   6. http://openbsd.org/faq/index.html
   7. http://openbsd.org/faq/faq24.html
   8. http://openbsd.org/faq/faq12.html
   9. http://openbsd.org/faq/index.html
  10. mailto:www@openbsd.org

$OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

Warning: this document is currently being reviewed. It's not yet complete,
and probably contains loads of errors. As an example, I can't figure out
why Linux doesn't need mkswap as it shares the exact same blocks with
OpenBSD.


   Linux + OpenBSD: it's possible

   by Marc Espie --  Marc.Espie@OpenBSD.org

It is perfectly possible to have Linux and OpenBSD on the same disk.
As of this writing, OpenBSD can read and write Linux' partitions, whereas
Linux cannot access OpenBSD partitions (they differ from NetBSD partitions).

You can even install OpenBSD from an ext2fs partition (choose install from
disk... ext2fs does not appear in the choices, but `default' it is).

First, make a bootable floppy of Linux.  Then, you  have to find some room
for OpenBSD.  Don't worry about swap space: you can share Linux' swap
partition.

If you want to grab space from a Windows/DOS partition, use fips.
Fips20 knows all about FAT32, so windows 95 is no longer a problem.

Other sources of information, especially concerning other BSD systems,
must be taken with a healthy does of scepticism.

First principles
----------------
OpenBSD does not use the DOS partitions for more than booting.  You just
need a small DOS partition to put your OpenBSD root.  Afterwards, OpenBSD
heeds some other information entirely, called the BSD disklabel.  This
disklabel is another completely distinct description of your hard disk.
It does not even have to be consistent with the usual DOS partitions
information.

Throughout this document, we will distinguish between DOS partitions and
BSD partitions whenever this is necessary.

For consistency, it's better if all parts of the disks that
are actually used by OpenBSD are flagged as occupied, type A6, though it
is not necessary.  The only part of the disk that should appear both as a BSD
partition and as a DOS partition is the root partition: it MUST begin on
the same sector for the boot process to work.

One way to visualize things is to picture OpenBSD embedded inside DOS
partitions: the DOS partitions used by OpenBSD may each contain several
OpenBSD partitions. As long as the DOS partition table has the right
start and length for each partition it will be kept happy.

The OpenBSD disklabel is just another mechanism that yield another
description of the disk. It is vitally important that the BSD root
partition start precisely where the corresponding DOS partition is supposed
to start, and it is better when all BSD partitions stay inside their
DOS partitions boundaries.  Apart from OpenBSD partitions proper, the
BSD disklabel can contain a BSD description of other DOS partitions, but
this is not mandatory. If you don't have any constraints, having a correct
description of all partitions is better, but with bigger disks, keep in mind
that OpenBSD disklabels can't hold more than 16 partitions.

Contrarily to popular belief, OpenBSD does *NOT* need one contiguous chunk
of the disk (a `slice' in FreeBSD lingo).  It is probably the simplest setup,
but other considerations (such as the need to boot several OS, and to have
several small primary partitions that all within the first  1024 BIOS
cylinders) may lead you to use two chunks for OpenBSD.

If you can, it is MUCH better to devote a full disk to OpenBSD: this limits
the number of mistakes you can do. Admittedly there are some cases where
this isn't a option (my machine is a laptop... I have to cope with the
hard disk I have).

Mapping your disk
-----------------
Starting from Linux, get a grasp of your partitions. Use df to check which
is what, then fdisk to get the actual setup of the disk.
Here is my disk:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = cylinders of 8064 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1            1        1      260  1048288+   6  DOS 16-bit >=32M
/dev/hda2          261      261      273    52416   83  Linux native
/dev/hda4          287      287      601  1270080    5  Extended
/dev/hda5          287      287      303    68512   82  Linux swap
/dev/hda6          304      304      456   616864+  83  Linux native
/dev/hda7          457      457      520   258016+  83  Linux native
/dev/hda8          521      521      537    68512+  83  Linux native
/dev/hda9          538      538      601   258016+  83  Linux native

(In case you're wondering, yes this is a big disk. The Linux playground is
large, the OpenBSD area will be huge. As a developer, I usually have loads
of source & binaries lying around... a simple OpenBSD installation can fit
within 300 Mb with room to spare.)
In my setup hda2 is /, hda6 is /usr, hda7 is /usr/local, hda8 is /var, and
hda9 is /home.

Get the display to sectors with u, and jot down the corresponding
information as well:
--
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders
Units = sectors of 1 * 512 bytes

   Device Boot   Begin    Start      End   Blocks   Id  System
/dev/hda1           63       63  2096639  1048288+   6  DOS 16-bit >=32M
/dev/hda2      2096640  2096640  2201471    52416   83  Linux native
/dev/hda4      2306304  2306304  4846463  1270080    5  Extended
/dev/hda5      2306368  2306368  2443391    68512   82  Linux swap
/dev/hda6      2443455  2443455  3677183   616864+  83  Linux native
/dev/hda7      3677247  3677247  4193279   258016+  83  Linux native
/dev/hda8      4193343  4193343  4330367    68512+  83  Linux native
/dev/hda9      4330431  4330431  4846463   258016+  83  Linux native

Okay, finally switch to expert mode, and note the corresponding data.
Disk /dev/hda: 128 heads, 63 sectors, 993 cylinders

Nr AF  Hd Sec  Cyl  Hd Sec  Cyl   Start    Size ID
 1 00   1   1    0 127  63  259      63 2096577 06
 2 00   0   1  260 127  63  272 2096640  104832 83
 3 00   0   0    0   0   0    0       0       0 00
 4 00   0   1  286 127  63  600 2306304 2540160 05
 5 00   1   2  286 127  63  302      64  137024 82
 6 00   1   1  303 127  63  455      63 1233729 83
 7 00   1   1  456 127  63  519      63  516033 83
 8 00   1   1  520 127  63  536      63  137025 83
 9 00   1   1  537 127  63  600      63  516033 83

Note that this is STILL the same data. The good point about this last
display is that it is almost what you're going to see in OpenBSD fdisk !

There are some differences though, mostly because Linux fdisk has made
some rather confusing choices:
- in simple mode it starts numbering cylinders at 1... whereas
everything else starts from 0.
- in simple mode it shows blocks of 1024 bytes, which makes for half-blocks
(marked with a +) and sizes halved from the real block size.
- in expert mode it shows extended partitions offset from the start
of the extended partition.
- the hd/sec/cyl is a confusing order, as the sector number is computed
from cyl/hd/sec, in that order.
- it never shows and doesn't care about the real disk geometry.

You will notice that the 3rd primary partition is empty... this is where
I intend to stick my OpenBSD root partition (both DOS and BSD partitions),
and that I have left cylinders 601--992 empty... this is where I intend to
stick the rest of OpenBSD.
After OpenBSD is installed, partition 3 will show up as:
/dev/hda3          274      274      286    52416   a6  Unknown
/dev/hda3      2201472  2201472  2306303    52416   a6  Unknown

(recent Linux fdisk will display a6 as OpenBSD, but they still don't know
how to deal with the disklabel. Important: NEVER use Linux fdisk to fiddle
with OpenBSD disklabels.)


Before starting to install OpenBSD, now would be a good time to check the
INSTALL.pt document...  Especially note the alignment restriction of
partitions (first sector of a partition must be at head 0, sector 1 of a
cylinder). This is enforced by Linux' fdisk.

The other point to note is that extended partitions are actually linked
lists. This will show up in OpenBSD' fdisk.

Your clock and OpenBSD
----------------------
OpenBSD expects your hardware clock to be in universal time, and uses
time zones to give you local time. With Linux, this depends...
most distributions use a small program called hwclock to set up the
system time from the hardware clock when booting... there is a --utc
option if your hardware clock is in universal time, but this is not
always what happens by default.

For instance, on a redhat 5.1 system, this happens in /etc/rc.d/rc.sysinit
which loads an /etc/sysconfig/clock that defines a variable called UTC, and
then proceeds calling hwclock.
- ensure UTC is set to true,
- adjust your hardware clock from the system time if necessary, e.g.,
hwclock --systohc --utc.

The Linux partition table and OpenBSD
-------------------------------------
There is a problem with many Linux rc that do mount all file systems even
in single-user mode.  After you've installed OpenBSD, if your Linux kernel
knows about BSD disklabels, it may insert lots of BSD partitions in its
list. Then, at the next reboot, you're in trouble. The simplest way around
this problem is probably to make sure you can boot from a Linux kernel
that doesn't know about disklabels.   Otherwise, you may wish to check
your inittab and your rc to make deadly sure that single-user boot
will work.

The OpenBSD installation
------------------------
If you've got the space, you can install from your ext2fs partitions. This
is what I did, as I have a slip connection to the rest of the world, and
the OpenBSD install floppy does not include slip.

REMEMBER TO BACKUP ALL IMPORTANT DATA ON YOUR DISK BEFORE DOING THE
INSTALLATION !!!

So you cp floppy*.fs /dev/fd0, then reboot...

First, the BSD kernel + ram disk loads, then there is a boot prompt, and
five seconds later, the boot proper starts.

After a while, you will see your disk configuration scroll by.  I got:
  wd0 at wdc0 drive 0: <TOSHIBA MK4006MAV>
  wd0: 3909MB, 7944 cyl, 16 head, 63 sec, 512 bytes/sec, 8007552 sec total
  wd0: using 16-sector 16-bit pio transfers, lba addressing

at which point I got somewhat confused, especially as this is a configuration w
ith
more than 1024 cylinders.  In fact, this is the actual disk geometry, when
you inquire about it, but the geometry that the BIOS does see IS the fdisk
geometry, with 993 cylinders.  As the 1024 cylinders is purely a BIOS
limitation, there is no actual trouble.

If you want to be sure, enquire at the boot prompt:
boot>machine diskconfig
before the automatic boot sequence continues.


Then I got into fdisk, and I proceeded to enter my new OpenBSD partition.
This is what the fdisk dump looked after my changes:

Disk: wd0       geometry: 992/128/63 [7999488 sectors]
Offset: 0       Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 06    0   1   1 -  259 127  63 [        63 -    2096577] DOS > 32MB
 1: 83  260   0   1 -  272 127  63 [   2096640 -     104832] Linux files*
 2: A6  273   0   1 -  285 127  63 [   2201472 -     104832] OpenBSD
 3: 05  286   0   1 -  600 127  63 [   2306304 -    2540160] Extended DOS

Selected extended partition 3
New MBR at offset 2306304.
Offset: 2306304 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 82  286   1   2 -  302 127  63 [   2306368 -     137024] Linux swap
 1: 05  303   0   1 -  455 127  63 [   2443392 -    1233792] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2306304 -          0] unused

Selected extended partition 1
New MBR at offset 2443392.
Offset: 2443392 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  303   1   1 -  455 127  63 [   2443455 -    1233729] Linux files*
 1: 05  456   0   1 -  519 127  63 [   3677184 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   2443392 -          0] unused

Selected extended partition 1
New MBR at offset 3677184.
Offset: 3677184 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  456   1   1 -  519 127  63 [   3677247 -     516033] Linux files*
 1: 05  520   0   1 -  536 127  63 [   4193280 -     137088] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   3677184 -          0] unused

Selected extended partition 1
New MBR at offset 4193280.
Offset: 4193280 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  520   1   1 -  536 127  63 [   4193343 -     137025] Linux files*
 1: 05  537   0   1 -  600 127  63 [   4330368 -     516096] Extended DOS
 2: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4193280 -          0] unused

Selected extended partition 1
New MBR at offset 4330368.
Offset: 4330368 Signatures: 0xAA55,0x0
         Starting        Ending
 #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
-------------------------------------------------------------------------
 0: 83  537   1   1 -  600 127  63 [   4330431 -     516033] Linux files*
 1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
 2: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused
 3: 00    0   0   0 -    0   0   0 [   4330368 -          0] unused

Nothing to it... you just follow the extended partition links using select,
jot down whatever you need, add the OpenBSD partition to look like you want
it to, and save everything.

After you leave fdisk, you get to the interesting part: the disklabel
itself. If all goes well, OpenBSD synthesizes a nice disklabel out of what
it can deduce from the disk, including the ext2fs partitions.

There are only a few subtleties to take care of:
- initially, you can ONLY edit the disklabel part that matches the OpenBSD
DOS partition (a `slice' in FreeBSD lingo). You have to use b 0 *  before
you can edit the whole disk.
- the real disk geometry becomes relevant. The Berkeley fast file system
can't use partial cylinder groups, hence BSD partitions should start
on cylinder boundaries, as any remaining sectors  will be lost anyway.
- units for size and offset can be given as sectors (default) or cylinders.

After edition, this is what my disklabel looks like:

# using MBR partition 2: type A6 off 2201472 (0x219780) size 104832 (0x19980)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK4006M
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 7944
total sectors: 8007552
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # milliseconds
track-to-track seek: 0  # milliseconds
drivedata: 0

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   104832  2201472    4.2BSD     1024  8192    16   # (Cyl. 2184 - 2287)
  b:   137024  2306368      swap                        # (Cyl. 2288 - 2423*)
  c:  8007552        0    unused        0     0         # (Cyl.    0 - 7943)
  d:   409248  4846464    4.2BSD     1024  8192    16   # (Cyl. 4808 - 5213)
  e:   511056  5255712    4.2BSD     1024  8192    16   # (Cyl. 5214 - 5720)
  f:   204624  5766768    4.2BSD     1024  8192    16   # (Cyl. 5721 - 5923)
  g:  1073520  5971392    4.2BSD     1024  8192    16   # (Cyl. 5924 - 6988)
  h:   962640  7044912    4.2BSD     1024  8192    16   # (Cyl. 6989 - 7943)
  i:  2096577       63     MSDOS                        # (Cyl.    0*- 2079*)
  j:   104832  2096640    ext2fs                        # (Cyl. 2080 - 2183)
  l:  1233729  2443455    ext2fs                        # (Cyl. 2424*- 3647*)
  m:   516033  3677247    ext2fs                        # (Cyl. 3648*- 4159*)
  n:   137025  4193343    ext2fs                        # (Cyl. 4160*- 4295*)
  o:   516033  4330431    ext2fs                        # (Cyl. 4296*- 4807*)

Things to check:
- this disklabel is saved in MBR2 (basic DOS partition 2), as expected.
- all the BSD partitions proper are aligned on a cylinder boundary.
the root partition begins at the precise same offset the corresponding DOS
partition begins, and it extends for the same length.
Other BSD partitions don't show up in the DOS partition setup, hence they
begin precisely on cylinder 601/4808.
- the ext2fs partitions have the exact same layout under the OpenBSD
disklabel.

One point that is somewhat laborious is that the disklabel -E mode
(which you are currently using) tends to move partitions around to ensure
that ALL defined partitions are contiguous. Hence, you may need some fiddling
around and printing to ensure that Linux partitions do show up where they
should.  In my case, disklabel moved the swap and all the ext2fs partitions
slightly, and I add to adjust them manually...

Once the disklabel is written to disk, the installation proceeds as usual.

ext2fs partitions are perfectly usable from OpenBSD. My /home partition
is ext2fs, I have been using it for a week now without any trouble.

Booting
-------
First time I booted my system back, I did not get into OpenBSD as expected...
I plain forgot I had installed lilo in the master boot block, and lilo
does not heed the active partition flag. The fix was rather simple: from
the Linux system, I just had to edit lilo.conf to add the obsd entry:

boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
timeout=50
image=/boot/myvmlinuz
   label=linux
   root=/dev/hda2
   vga=4
   read-only
image=/boot/vmlinuz-2.0.34-1
   label=redhat
   root=/dev/hda2
   read-only
other=/dev/hda1
   label=dos
   table=/dev/hda
other=/dev/hda3
   label=obsd
   table=/dev/hda

rerun lilo, and voila, OpenBSD was able to boot !

Linux and OpenBSD partitions
----------------------------
As of 2.0.35/2.1.122, Linux does not support OpenBSD partitions. The way
the Linux kernel works is reasonably straightforward (code in
drivers/block/genhd.c): when detecting a BSD partition (type A5),
it checks and parses the first block for a disklabel, and use that
information to instantiate some new partitions,
that will show up in that drive's partition list, exactly like extended
partitions do show up. Unfortunately, that check is hard coded for a type A5
(NetBSD/FreeBSD) partition, and it recognizes 8 partitions disklabels only
anyway.

Just hacking the Linux code to recognize A6 is not quite enough.  You also
need to trim down the resulting list of partitions, as your ext2fs
partitions will now show up twice !
I'm experimenting with the following patch, which should make it to linux-kerne
l
soon:
--------------------------------------------------------------
diff -ur linux.orig/drivers/block/genhd.c linux/drivers/block/genhd.c
--- linux.orig/drivers/block/genhd.c
Mon Aug  4 20:45:35 1997
+++ linux/drivers/block/genhd.c
Thu Sep 24 18:55:31 1998
@@ -205,11 +206,46 @@
 }

 #ifdef CONFIG_BSD_DISKLABEL
+static void check_and_add_bsd_partition(struct gendisk *hd, struct bsd_partiti
on *bsd_p)
+{
+
struct hd_struct *lin_p;
+

/* check relative position of partitions.  */
+
for (lin_p = hd->part + 1; lin_p - hd->part < current_minor; lin_p++) {
+


/* no relationship -> try again */
+

if (lin_p->start_sect + lin_p->nr_sects <= bsd_p->p_offset
+


|| lin_p->start_sect >= bsd_p->p_offset + bsd_p->p_size)
+


continue;

+


/* equal -> no need to add */
+

if (lin_p->start_sect == bsd_p->p_offset &&
+


lin_p->nr_sects == bsd_p->p_size)
+


return;
+


/* bsd living within dos partition */
+

if (lin_p->start_sect <= bsd_p->p_offset && lin_p->start_sect
+


+ lin_p->nr_sects >= bsd_p->p_offset + bsd_p->p_size) {
+#ifdef DEBUG_BSD_DISKLABEL
+


printk("w: %d %ld+%ld,%d+%d",
+



lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+



bsd_p->p_offset, bsd_p->p_size);
+#endif
+


break;
+

}
+


/* ouch: bsd and linux overlap. Don't even try for that partition */
+#ifdef DEBUG_BSD_DISKLABEL
+

printk("???: %d %ld+%ld,%d+%d",
+


lin_p - hd->part, lin_p->start_sect, lin_p->nr_sects,
+


bsd_p->p_offset, bsd_p->p_size);
+#endif
+

printk("???");
+

return;
+
} /* if the bsd partition is not described by DOS, we end up there */
+
add_partition(hd, current_minor, bsd_p->p_offset, bsd_p->p_size);
+
current_minor++;
+}
 /*
  * Create devices for BSD partitions listed in a disklabel, under a
  * dos-like partition. See extended_partition() for more information.
  */
-static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev)
+static void bsd_disklabel_partition(struct gendisk *hd, kdev_t dev, int max_pa
rtitions)
 {

struct buffer_head *bh;

struct bsd_disklabel *l;
@@ -225,19 +261,15 @@


return;

}

-
p = &l->d_partitions[0];
-
while (p - &l->d_partitions[0] <= BSD_MAXPARTITIONS) {
+
if (l->d_npartitions < max_partitions)
+

max_partitions = l->d_npartitions;
+
for (p = l->d_partitions; p - l->d_partitions <  max_partitions; p++) {


if ((current_minor & mask) >= (4 + hd->max_p))



break;
-
-

if (p->p_fstype != BSD_FS_UNUSED) {
-


add_partition(hd, current_minor, p->p_offset, p->p_size);
-


current_minor++;
-

}
-

p++;
+

if (p->p_fstype != BSD_FS_UNUSED)
+


check_and_add_bsd_partition(hd, p);

}

brelse(bh);
-
 }
 #endif

@@ -248,6 +280,11 @@

struct partition *p;

unsigned char *data;

int mask = (1 << hd->minor_shift) - 1;
+#ifdef CONFIG_BSD_DISKLABEL
+
/* no bsd disklabel as a default */
+
kdev_t bsd_kdev = 0;
+
int bsd_maxpart;
+#endif
 #ifdef CONFIG_BLK_DEV_IDE

int tested_for_xlate = 0;

@@ -365,13 +402,29 @@




hd->part[minor].nr_sects = 2;


}
 #ifdef CONFIG_BSD_DISKLABEL
+


/* tag first disklabel for late recognition */


if (SYS_IND(p) == BSD_PARTITION) {
-


printk(" <");
-


bsd_disklabel_partition(hd, MKDEV(hd->major, minor));
-


printk(" >");
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = BSD_MAXPARTITIONS;
+


}
+

} else if (SYS_IND(p) == OPENBSD_PARTITION) {
+


printk("!");
+


if (!bsd_kdev) {
+



bsd_kdev = MKDEV(hd->major, minor);
+



bsd_maxpart = OPENBSD_MAXPARTITIONS;
+


}


}
 #endif

}
+#ifdef CONFIG_BSD_DISKLABEL
+
if (bsd_kdev) {
+

printk(" <");
+

bsd_disklabel_partition(hd, bsd_kdev, bsd_maxpart);
+

printk(" >");
+
}
+#endif

/*

 *  Check for old-style Disk Manager partition table

 */
diff -ur linux.orig/include/linux/genhd.h linux/include/linux/genhd.h
--- linux.orig/include/linux/genhd.h
Wed Mar 18 20:25:30 1998
+++ linux/include/linux/genhd.h
Thu Sep 24 18:55:43 1998
@@ -69,12 +70,19 @@
 #ifdef CONFIG_BSD_DISKLABEL
 /*
  * BSD disklabel support by Yossi Gottlieb <yogo@math.tau.ac.il>
+ *
+ * updated by Marc Espie <Marc.Espie@openbsd.org>
  */

+/* check against BSD src/sys/sys/disklabel.h for consistency */
+
 #define BSD_PARTITION

0xa5
/* Partition ID */
+#define OPENBSD_PARTITION
0xa6

 #define BSD_DISKMAGIC
(0x82564557UL)
/* The disk magic number */
 #define BSD_MAXPARTITIONS
8
+#define OPENBSD_MAXPARTITIONS 16
+
 #define BSD_FS_UNUSED

0
/* disklabel unused partition entry ID */
 struct bsd_disklabel {

__u32
d_magic;

/* the magic number */
----------------------------------------------------------------------
It does:
- trigger the recognition of OpenBSD disklabels,
- force bsd partitions to appear at the end of the partition list,
- check the bsd disklabel for redundancy and consistency with the dos
partition table, so that the same partition does not show up twice.

You also need a working ufs, such as
<ftp://sunsite.unc.edu/pub/Linux/ALPHA/ufs/u2fs-0.4.3.tar.gz>
This package yields a new module, plus a small patch to tie the module
with the rest of the Linux kernel. I would recommend checking that patch
manually, as Linux module information tends to vary widely, and it is
pretty trivial to add by hand anyway.

Running Linux binaries under OpenBSD
------------------------------------
You just have to recompile your BSD kernel with COMPAT_LINUX, and set up
/emul/linux as explained in compat_linux(1).

It's a good idea to mount your Linux file system under another point, then
make symbolic links so that you can control what gets used precisely.
Don't bother with the ports emul/linux_lib entry: it's only a set of Linux
libraries for people who don't have a Linux system running.

As of this writing, most applications work, apart from sound.

The Linux sound devices use differing ioctl from OpenBSD, hence anything that
needs to change the audio mode won't work, and produce audio garbage at best.

A small detail that may cause problems: uname still says `OpenBSD', even
under Linux compatibility.  The reason behind that is that we don't want
netscape to tell it was run from a Linux box, when it is used under
OpenBSD.

Some programs, for instance maple, do depend on uname answering `Linux'.
For maple, this is straigthforward: you just have to fudge
/usr/local/maple/bin/maple.system.type to check OpenBSD in the same
class with Linux.

Similar shell scripts are easy to fix.  Binary programs that don't run
suid can be coerced by using LD_PRELOAD.

As a rule, this should be achieved on a program-by-program basis.
The more networking programs that do tell they're running under OpenBSD,
the merrier !



   [1][Back to Main Index] [2][To Section 11.0 - OpenBSD 2.4 Specific
   Information]

                           12.0 - Performance Tuning
     _________________________________________________________________

12.1 - Networking

   If you run a busy server, gateway or firewall, you should make sure to
   prevent memory starvation to various parts of the kernel described
   below.

   The [3]options(4) man page talks about the options presented.

   An option you may need to change for a busy server, gateway or
   firewall is NMBCLUSTERS. This controls the size of the kernel mbuf
   cluster map. On your computer, if you get messages like "mb_map full",
   you need to increase this value. If traffic on a networking interface
   stops for no apparent reason, this may also be a sign that you need to
   increase this value. A reasonable value on the i386 port with most
   100Mbps ethernet interfaces (no matter how many the machine has) is
   8192.
   option NMBCLUSTERS=8192

12.2 - Disk I/O

   Disk I/O speed is a significant factor in the overall speed of your
   computer. It becomes increasingly important when your computer is
   hosting a multi-user environment (users of all kinds, from those who
   log-in interactively to those who see you as a file-server or a
   web-server.) Data storage constantly needs attention, especially when
   your partitions run out of space and when your disks fail. OpenBSD has
   several options to increase the speed of your disk operations and
   provide fault tolerance.

  CCD

       The first option is the use of [4]ccd(4), the Concatenated Disk
       Driver. This allows you to join several partitions into one
       virtual disk (and thus, you can make several disks look like one
       disk). This concept is similar to that of LVM (logical volume
       management), which is found in many commercial Unix flavors.
       If you are running GENERIC, ccd is already enabled. If not, you
       may need to add it to your kernel configuration. To start setup of
       ccd, you need to add support for it in your kernel. A line such
       as:

pseudo-device   ccd     4       # concatenated disk devices

   The above example gives you up to 4 ccd devices (virual disks). Now
   you need to figure out what partitions on your real disks that you
   want to dedicate to ccd. Use disklabel to mark these partitions as
   type 'ccd'. On some architectures, disklabel may not allow you to do
   this. In this case, mark them as 'ffs'.

   If you are using ccd to gain performance by striping, note that you
   will not get optimum performance unless you use the same model of
   disks with the same disklabel settings.

   Edit /etc/ccd.conf to look something like this: (for more information
   on configuring ccd, look at [5]ccdconfig(8))
# Configuration file for concatenated disk devices
#
# ccd   ileave  flags   component devices
ccd0   16      none    /dev/sd2e /dev/sd3e

   To make your changes take effect, run
# ccdconfig -C

   As long as /etc/ccd.conf exists, ccd will automatically configure
   itself upon boot. Now, you have a new disk, ccd0, a combination of
   /dev/sd2e and /dev/sd3e. Just use disklabel on it like you normally
   would to make the partition or partitions you want to use. Again,
   don't use the 'c' partition as an actual partition that you put stuff
   on. Make sure your useable partitions are at least one cylinder off
   from the beginning of the disk.

  RAID

       Another solution is [6]raid(4) which will have you use
       [7]raidctl(8) to control your raid devices. OpenBSD's RAID is
       based off of Greg Oster's [8]NetBSD port of the CMU [9]RAIDframe
       software. OpenBSD has support for RAID levels of 0, 1, 4, and 5.
       With raid, as with ccd, support must be in the KERNEL. Unlike ccd,
       support for RAID is not found in GENERIC, it must be compiled into
       your kernel (RAID support adds some 500K to the size of an i386
       kernel!)

pseudo-device   raid   4       # RAIDframe disk device

   Setting up RAID on some operating systems is confusing and painful to
   say the least. Not so with RAIDframe. Read the [10]raid(4) and
   [11]raidctl(8) man pages to get the whole scoop, there are too many
   options and possible configurations which are beyond the scope of this
   document.

  Filesystem Buffer

   For fileservers with memory to spare, you can increase
       BUFCACHEPERCENT. That is, what percentage of your RAM should you
       use as a file system buffer. This option may change when the
       Unified Buffer Cache is completed and is part of OpenBSD. In the
       mean time, to increase BUFCACHEPERCENT, you should add a line to
       your kernel configuration like this:

   option BUFCACHEPERCENT=30

   Of course you can make it as low as 5 percent (the default) or as high
   as 50 percent (or more.)

  Soft updates

   Another tool that can be used to speed up your system is softupdates.
       One of the slowest operations in the traditional BSD file system
       is updating metainfo (which happens, among other times, when you
       create or delete files and directories.) Softupdates attempts to
       update metainfo in RAM instead of writing to the hard disk each
       and every single metainfo update. Another effect of this is that
       the metainfo on disk should always be complete, although not
       always up to date. So, a system crash should not require fsck upon
       boot up, but simply a background version of fsck that makes
       changes to the metainfo in RAM (a la softupdates). This means
       rebooting a server is much faster, because you don't have to wait
       for fsck! (OpenBSD does not have this feature yet.) You can read
       more about softupdates in the [12]softupdates FAQ entry. If you
       use softupdates, you will most certainly want to take advantage of
       the Tuning kmem section below.

12.3 - Tuning kmem

   If you start using the performance tuning measures above, you may
   start running out of kernel memory. If you start getting panics like
   "out of space in kmem_map" then you need to try
   option NKMEMCLUSTERS=8192

   Note that 8192 is valid for the i386 architecture, but may be too
   little or too much for others. Look at /usr/include/machine/param.h to
   see more information.

   You may also want to increase the number of static kernel maps and
   entries. The default value for these options is architecture dependant
   and is specified in /sys/vm/vm_map.h. If you are using soft updates,
   the following values should keep you going!
   option MAX_KMAP=120
       option MAX_KMAPENT=6000

12.4 - Hardware choices

   (Note- this section is heavily centered around the i386, or PC,
   architecture. That is to say... other architectures don't give you
   quite as many choices!)

   The performance of your applications depends heavily on your OS and
   the facilities it provides. This may be part of the reason that you
   are using OpenBSD. The performance of your applications also depends
   heavily on your hardware. For many folks, the Price/Performance ratio
   of a brand new PC with a Intel Pentium III or AMD Athlon processor is
   much better then the Price/Performance ratio of a Sun UltraSparc 60!
   And, the price of OpenBSD can't be beat.

   If you are shopping for a new PC, whether you are buying it piece by
   piece or completely pre-built, you want to make sure first that you
   are buying reliable parts. In the PC world, this is not easy. Bad or
   otherwise unreliable or mismatched parts can make OpenBSD run poorly
   and crash often. The best advice we can give is to be careful, buy
   brands and parts that have been reviewed by an authority you trust.
   Sometimes, when you skimp on the price of a PC, you lose in quality!

   There are certain things that will help bring out the maximum
   performance of your hardware:
     * Use multiple disks.
       Instead of buying one 20GB disk, buy multiple 4GB or 9GB disks.
       While this may cost more, distributing the load over multiple
       spindles will decrease the amount of time necessary to access data
       on the disks. And, with more spindles, you will get more
       reliability and faster data access with RAID.
     * Use SCSI where you can.
       If you are building a server, and you need more then 10GB of disk
       space, the SCSI architecture is the best choice. IDE limits you to
       two disks per controller. Wide SCSI limits you to 15 per
       controller! While SCSI costs more, the flexibility and performance
       can justify these costs. IDE was not designed for use in a
       multi-user, multi-tasking environment.
     * Use SDRAM.
       This option applies mainly to PCs. Most other architectures don't
       give you a choice of what kind of RAM you can use. Several PCs
       still do. Avoid SIMMs, as there are not many companies
       manufacturing them anymore, and in some cases they cost more then
       equivalent SDRAM!
     * Use ECC or parity RAM.
       Parity adds some functionality to see if the data in RAM has been
       corrupted. ECC extends this functionality and attempts to correct
       some bit corruption errors on the fly. This option applies mainly
       to PCs. Most other architectures simply require parity or ECC
       capable RAM. Several non-PC computers won't even boot with
       non-parity RAM. If you aren't using ECC/parity RAM, you may get
       data corruption and other abnormalities. Several manufacturers of
       "cheap PC RAM" don't even make an ECC variety! This will help you
       avoid them! PC manufacturers often sell several product lines,
       divided around "servers" and "workstations." The servers will
       incorporate ECC RAM into their architecture. Unix workstation
       manufacturers have been using parity (and now ECC) for several
       years in all of their product lines.
     * Avoid ISA devices.
       While most folks avoid ISA devices, because they are generally
       hard to configure and out of date, there are still plenty in
       existence. If you are using the ISA bus for your disk or network
       controllers, (or even worse, for both) remember that the ISA bus
       itself can be a performance bottleneck. If you need speed, look to
       PCI. Of course, there are still several ISA bus cards that work
       just fine. Unfortunately, most of these are sound cards and serial
       port cards.

   [13][Back to Main Index] [14][To Section 11.0 - OpenBSD 2.4 Specific
   Information]
     _________________________________________________________________

   [15][back] [16]www@openbsd.org
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $

References

   1. http://openbsd.org/faq/index.html
   2. http://openbsd.org/faq/faq24.html
   3. http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html
   4. http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html
   5. http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html
   6. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
   7. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
   8. http://www.cs.usask.ca/staff/oster/raid.html
   9. http://www.pdl.cs.cmu.edu/RAIDframe/
  10. http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html
  11. http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html
  12. http://openbsd.org/faq/faq4.html#4.9
  13. http://openbsd.org/faq/index.html
  14. http://openbsd.org/faq/faq24.html
  15. http://openbsd.org/faq/index.html
  16. mailto:www@openbsd.org


MINI-FAQ: Upgrading OpenBSD

  Latest OpenBSD Version - 2.5

    Kjell Wooding <[1]kwooding@codetalker.com>

   Last Update - 03 Jun 1999

     If you've ever tried compiling the -current sources from an older
     OpenBSD release, you're aware that the process isn't always
     straightforward. This Mini-FAQ is an attempt to address the most
     common issues encountered when upgrading between OpenBSD releases,
     or from the releases to -current

  1.0: General Upgrade Questions

   [2]1.1: Terminology. What is -current? What are Snapshots?
   [3]1.2: What is the easiest way to upgrade to -current?
   [4]1.3: I looked, but didn't see any snapshots on the FTP site. Where
   did they go?
   [5]1.4: How do I get the latest source?
   [6]1.5: Okay, I have the tree. How do I build it.
   [7]1.6: My make build stopped halfway. Do I have to redo the whole
   thing?

  2.0: Upgrading from 2.3

   [8]2.1: What are the major problems upgrading from 2.3 to 2.4?
   [9]2.2: I tried the build, but it failed when trying to compile
   ssleay.
   [10]2.3: I tried the build, but it failed when trying to make
   something for the PowerPC.

  3.0: Upgrading from 2.4

   [11]3.1: What are the major problems upgrading from 2.4 to 2.5?
   [12]3.2: I tried the build, but it failed on cap_mkdb.

  4.0: Upgrading from 2.5

   [13]4.1: What are the major problems upgrading from 2.5 to -current?
   [14]4.2: How do I upgrade gcc to egcs

     [15]4.2.1 - i386 and sparc are no longer #define'ed
     [16]4.2.2 - Build fails in xlint
     [17]4.2.3 - Core Dump on uthread_autoinit.c
     [18]4.2.4 - egcs seems much slower than gcc
     [19]4.2.5 - egcs generates larger code than gcc
     [20]4.2.6 - After installing egcs I have very little disk space
     left
     [21]4.2.7 - My build fails to build libcurses

   [22]4.3: My make build dies with unimplemented syscall errors.

                           _____________________

  1.0: General Upgrade Questions

    1.1: Terminology. What is -current? What are Snapshots?

   Unlike Operating System projects like Linux and FreeBSD, OpenBSD
   development happens from a single source tree. On approximately
   six-month intervals, OpenBSD releases are produced. These are numbered
   in the conventional (2.x) manner. The current OpenBSD release is 2.5.

   -current, short for openbsd-current, refers to the up-to-the-minute
   version of the source tree contained in the CVS repository. This is
   the tree most commonly used by OpenBSD developers. The -current tree
   contains all the code that is planned for the next release. From time
   to time, brave souls will abandon the formal releases and run
   openbsd-current, usually to take advantage of features that have not
   yet made it into the formal releases. Because of its uncertain nature,
   however, upgrading to -current is not recommended for non-technical
   users.

   Between formal releases, a series of snapshot releases are [23]made
   available. Snapshots are test releases of the -current source tree.
   Because they reflect the current state of development, there is no
   guarantee that snapshot releases will work correctly (or even at all).
   Snapshots are quite useful when moving from a formal release (or older
   version of -current) to the current tree.

    1.2: What is the best way to upgrade to -current?

   Due to changes in the underlying libraries, moving directly from a
   release to -current is not always easy. The most painless way to move
   up to -current is to first upgrade to the latest snapshot (usually,
   via an FTP install). Once the snapshot is installed, the latest source
   can be [24]fetched and [25]built. This procedure should eliminate most
   toolchain and library problems.

    1.3: I looked, but didn't see any snapshots on the FTP site. Where did they
    go?

   The snapshots used to be taken temporarily offline right around the
   release time of a new version. This is no longer the OpenBSD policy.

   Snapshots may be removed as they become old (or no longer relevant).
   If no snapshot is available, you should upgrade to the most recent
   release and build the remainder of the way from source.

    1.4: How do I get the latest source?

   Short answer: [26]http://www.openbsd.org/anoncvs.html

   For example. To retrieve the entire tree via CVS: (using the bash
   shell. Others substitute setenv for export)
 # export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
 # export CVS_RSH=/usr/local/bin/ssh
 # cd /usr
 # cvs -q get -PA src

    1.5: Okay, I have the tree. How do I build it.

   Basic instructions are in /usr/src/Makefile. This is a slightly
   expanded version.

1. Clean out the old object files.

   If you created a separate /usr/obj directory, clean that, and
   rebuild the symbolic links:

   # rm -rf /usr/obj
   # mkdir /usr/obj
   # cd /usr/src
   # make obj

   If you're worried there are object files in your source tree,
   do this:

   # cd /usr/src
   # find . -type l -name obj | xargs rm
   # make cleandir
   # rm -rf /usr/obj
   # mkdir /usr/obj
   # make obj

2. Perform any verion-specific configuration changes. For example,
   2.3 users must add the named user and group before
   moving to 2.4 or later. See the specific Mini-FAQ section for
   your version.

3. Make sure all the appropriate directories are created. This
   is especially important when upgrading from older versions, but is
   sometimes necessary in other cases. The easiest way to do this is:

   # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

4. Compile a new kernel.

   # cd /usr/src/sys/arch/`machine`/conf
   # cp GENERIC MYKERNEL
   # vi MYKERNEL
   (edit MYKERNEL to your liking)
   # config MYKERNEL
   # cd ../compile/MYKERNEL
   # make clean && make depend && make
   (arc architecture only) copy bsd.ecoff to your FAT partition
   # cp /bsd /bsd.old && cp bsd /bsd
   # chown root.wheel /bsd (if you compiled as someone else)
   (reboot)

5. Compile the system.

   # cd /usr/src
   # make build

6. Update /etc and /dev by hand. These are not updated
   automatically. Choose a directory with enough space to
   hold /, /dev, /var, and /etc. Here I'll use /home/newroot
   (Note: make sure the directory hierarchy you choose
   does not have group write (g+w) or other write (o+w)
   permissions or sendmail will complain during this step.
   This makes /tmp a bad choice):

   # mkdir /home/newroot
   # export DESTDIR=/home/newroot
   # cd /usr/src/etc && make distribution-etc-root-var

   Now compare the files in /home/newroot with their
   installed counterparts. Replace or update the files as
   necessary.

   # rm -rf /home/newroot   (when done)

7. Reboot to make sure the new /etc files are correct

    1.6: My make build stopped halfway. Do I have to redo the whole thing?

   I would, but if you really want to pick up where you left off, do a:
 # cd /usr/src
 # make -n build

   This will show you what make build is doing. For example, mine tells
   me:
 (cd /usr/src/share/mk &&  make install)
 (cd /usr/src/include;  make includes)
 make cleandir
 (cd /usr/src/lib && make depend && make &&   make install)
 (cd /usr/src/gnu/lib && make depend && make &&   make install)
 (cd /usr/src/kerberosIV && make build)
 make depend && make &&  make install

   To pick up where you left off, just reissue the commands from the
   point where the compile died.

   If you do this procedure a lot, you may want to create a new target in
   your makefile. Simply copy the entry for build (to build-noclean, for
   example), and remove the make cleandir reference.

  2.0: Upgrading from 2.3

    2.1: What are the major problems upgrading from 2.3 to 2.4?

    New User: named

   After 2.3, the named DNS daemon was moved to a chroot jail. To make
   this change possible, the named user was created. If you do not have
   it already, you will need to create this user to ensure that all
   directories get created properly during the build process.

   Add the following entry to /etc/passwd using vipw
   named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin

   Add the following to /etc/group:
   named:*:70:

    2.2: I tried the build, but it failed when trying to compile ssleay.

   You are likely missing an entry for the named user in your password
   file.

   Short Answer:

   Create this user prior to the build.

   Long Answer:

   The named user is required in order to set permissions correctly. If
   this user is missing, part of the build process fails. If you capture
   your build to a file (say, with a make build &>/tmp/build.log) you
   will notice the following message:
  (cd /usr/src/etc && make DESTDIR=/ distrib-dirs)
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  mtree: unknown user named
  mtree: failed at line 1632 of the specification
  *** Error code 1 (ignored)

   Unfortunately for us, the build continued happily on its way, totally
   ignoring the fact that an error occurred.

   If the named user exists, mtree works properly:
  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   The reason for the fail, then, is that the /usr/include/ssl directory
   was never created. Without the header files, the ssleay build fails.

   Fix:

   Create the named user and group. Remove /usr/include/ssl, /var/named,
   and any other directory from the list above that was mistakenly
   created as a normal file by the make build.

    2.3: I tried the build, but it failed when trying to make something for the
    PowerPC.

   Your directory tree is incomplete. Specifically, the
   /usr/share/man/cat4/powerpc directory is missing.

   Quick Fix:

   Create this directory and proceed with the compilation

   Complete Fix:

   Create the entire directory tree. Do a:
  # cd /usr/src/etc && make DESTDIR=/ distrib-dirs

   You will likely see an output like the following:
  install -d -o root -g wheel -m 755 /
  mtree -def mtree/4.4BSD.dist -p // -u

  missing: ./var/named (created)
  missing: ./var/named/dev (created)
  missing: ./var/named/etc (created)
  missing: ./etc/afs (created)
  missing: ./etc/ssl (created)
  missing: ./etc/ssl/private (created)
  missing: ./usr/obj (not created: File exists)
  missing: ./usr/share/doc/html (created)
  missing: ./usr/share/doc/html/lynx_help (created)
  missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
  missing: ./usr/share/doc/usd/13.viref (created)
  missing: ./usr/share/man/cat4/powerpc (created)
  missing: ./usr/share/man/man4/alpha (created)
  missing: ./usr/share/man/man4/pmax (created)
  missing: ./usr/share/man/man4/powerpc (created)
  missing: ./usr/share/tmac/mdoc (created)
  missing: ./var/www/htdocs/manual/vhosts (created)
  missing: ./usr/include/ssl (created)

   Note that /usr/share/man/cat4/powerpc was one of the directories
   created by this process.

  3.0: Upgrading from 2.4

    3.1: What are the major problems upgrading from 2.4 to 2.5?

    cap_mkdb

   The syntax for invoking cap_mkdb has changed slightly. Before doing a
   make build, rebuild cap_mkdb from the latest source:
# cd /usr/src/usr.bin/cap_mkdb
# make clean && make && make install

   The make build should then run to completion

    Man Page Changes

   Several man pages were moved from section 1 to later sections
   Unfortunately, if the old man pages are left in section 1, unwary
   users will not see the latest version of the page.

   The following pages should be removed:
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0

    Snake

   You will need to remove the contents of the obj directory before
   upgrading /usr/src/games/snake.

    3.2: I tried the build, but it failed on cap_mkdb.

   Symptom:

   A make build resulted in an error like this:
  cap_mkdb -i -f terminfo terminfo.src
  cap_mkdb: illegal option -- i
  usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
  *** Error code 1

   Quick Fix:

   You need to build a new cap_mkdb. See [27]3.1.

  4.0: Upgrading from 2.5

    4.1: What are the major problems upgrading from 2.5 to -current?

      perl and make

   The latest version of Perl (5.005_03) requires a new version of make
   to compile properly. You must rebuild make before building the new
   Perl. Do a:
# cd /usr/src/usr.bin/make
# make clean && make && make install

   Then go ahead and rebuild the new Perl. You will need to clean out the
   Perl obj directory by hand before building.

   Perl developers should take note of the latest changes. From
   millert@openbsd.org:
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

    1) Perl lib files have moved from /usr/lib/perl5 to the more correct
       /usr/libdata/perl5
    2) The default site_perl directories now live in /usr/local.  Ie:
       if you install a perl module, it will place itself in
       /usr/local/libdata/perl5/site_lib.  This makes it easy to
       see what non-stock modules you have.  It also means that we
       can have perl modules in the ports system easily.
    3) The perl library man pages are now install in /usr/share/man/cat3p
       You'll need to update your man.conf based on the src/etc/man.conf
       to take advantage of them.  This means you can now do
       "man 3p less" and get info on the less pragma but "man less"
       will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

      Compiler Change: egcs replaces gcc

   This change is likely the most significant change you will encounter.
   For detailed instructions, see section [28]4.2.

      Kernel Structure - statfs - changed

   The statfs structure has changed as of May 31. You must rebuild your
   kernel before attempting a make build. See [29]4.3 for details.

    4.2: How do I upgrade gcc to egcs

   The safest way will be to upgrade to a recent snapshot, once one is
   available. Look for a snapshot first!. Bootstrapping the new compiler
   from the old should be a last resort.

   First, note that some platforms have not been bootstrapped
   successfully yet. To date, the following should work, if you are
   careful:
     * i386
     * sparc
     * m68k
     * alpha

   mips and rs6000 have problems.

   To test whether your platform can be bootstrapped, grab and install
   the egcs-snapshot, available from the [30]ports collection. If this
   works, the in-tree version likely will, too. This is the safest method
   of proceeding.

   Now, before going any further, ensure that your copies of binutils,
   gas, and ld are up to date. Note that there are two copies of gas and
   ld in the tree. On i386 and sparc, the binutils versions are not used.
   Check /usr/src/gnu/usr.bin/gas and /usr/src/gnu/usr.bin/ld instead.

   The following instructions referred to the original egcs snapshot
   (egcs-990517). Since that time, a second snapshot (egcs-990608) has
   gone into the tree. If you are coming from vanilla 2.5, it is unlikely
   that you will be able to build the latest version directly. In this
   event, you will have to bootstrap an intermediate version using these
   instructions.

   From espie@openbsd.org:

Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems.
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...

     [author note: Actually, it doesn't quite work. xlint will fail to
     build. The fix is simple though. Simply do a make && make install
     in the /usr/src/usr.bin/xlint/xlint directory before you attempt a
     make build and proceed. See [31]4.2.2.]
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.

   If you made it through this procedure, and everything is still
   working, congratulations. If not, check the following sections for
   advice. Problems not listed here should be posted to tech@openbsd.org.

      4.2.1 - i386 and sparc are no longer #define'ed

   This is true. egcs uses the cleaner __i386__ and __sparc__. If you
   need to compile code that relies on the old defines, add a -Dsparc or
   -Di386 to the appropriate location of your Makefile.

      4.2.2 - Build fails in xlint

   This is due to semantic differences in cpp. The workaround is simple,
   and similar to the cap_mkdb issue described in [32]3.1.

   Do a:
# cd /usr/src/usr.bin/xlint/xlint
# make && make install

   now re-run make, and the build should continue.

      4.2.3 - Core Dump on uthread_autoinit.c

   You have fallen victim to a linker bug. Here's a relevant message:
   From: Marc Espie
   Subject: egcs core-dumping on uthread_autoinit.c

   If this happens to you, this is a known linker problem... the cc1 you have
   was linked in a weird way.

   Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
   problem, but this was cutting things too close, and the bug reappeared,
   probably thanks to unrelated changes in libc or elsewhere...

   The tree has been patched with a work-around in

   src/gnu/egcs/f/lang-options.h

   make sure you have the kludged version of that file (at least rev 1.2),
   recompile and reinstall cc1, the problem should go away.

   What's going on is that the 386 linker gets something wrong because of
   the huge strings array in toplev.c, and something gets mislinked, so
   that
   void f(void) __attribute((constructor)) {}
   kills cc1.

   As a work-around, I've killed Fortran options help texts, until someone find
s
   where the linker errs.

      4.2.4 - egcs seems much slower than gcc

   It is, but there is a reason. egcs performs more optimizing passes.
   Data alignment and other such functionality will be better with
   egcs-generated code.

      4.2.5 - egcs generates larger code than gcc

   Yes it does. This is especially noticable with the old -O2 gcc switch.
   egcs introduces a new option, -Os which optimizes for space. This is
   roughly comparable to the old -O2 behavior.

      4.2.6 - After installing egcs I have very little disk space left

   egcs installs into a different subdirectory than gcc 2.8.1. You may
   remove gcc once egcs is bootstrapped and working. (on a related note,
   the perl changes mentioned in [33]4.1 mean that you can remove the
   /usr/lib/perl5 directory. The new location for this data is
   /usr/libdata/perl5.)

      4.2.7 - My build dies while making libcurses

   libcurses now relies on the latest version of cpp. Fetch the latest
   version, rebuild cpp, and continue. Eg:
# cd /usr/src/usr.bin/cpp && make install

   And try the make build again.

    4.3: My make build dies with unimplemented syscall errors.

   Short Answer:

   The kernel structure statfs has changed. You will need to recompile
   the kernel before attempting a make build.

   Long Answer:

   The kernel structure statfs has changed. The new struct statfs has the
   following features:
     * Has a u_int32_t flags field--now softdep can have a real flag.
     * Uses u_int32_t instead of longs (nicer on the alpha). Note: the
       man page used to lie about setting invalid/unused fields to -1.
       SunOS does that but our code never has.
     * Gets rid of f_type completely. It hasn't been used since NetBSD
       0.9 and having it there but always 0 is confusing. It is
       conceivable that this may cause some old code to not compile but
       that is better than silently breaking.
     * Adds a mount_info union that contains the FSTYPE_args struct. This
       means that mount can now tell you all the options a filesystem was
       mounted with. This is especially nice for NFS.

   Other changes:
     * The linux statfs emulation didn't convert between BSD fs names and
       linux f_type numbers. Now it does, since the BSD f_type number is
       useless to linux apps (and has been removed anyway)
     * FreeBSD's struct statfs is different from our (both old and new)
       and thus needs conversion. Previously, the OpenBSD syscalls were
       used without any real translation.
     * mount(8) will now show extra info when invoked with no arguments.
       However, to see everything you need to use the -v (verbose) flag.

   --
   $OpenBSD: obsd-faq.txt,v 1.9 1999/07/21 05:47:59 ericj Exp $
   Copyright  1998-1999, Kjell Wooding.
   Please send any comments, questions, or suggestions to
   [34]kwooding@codetalker.com

References

   1. mailto:kwooding@codetalker.com
   2. http://openbsd.org/faq/upgrade-minifaq.html#1.1
   3. http://openbsd.org/faq/upgrade-minifaq.html#1.2
   4. http://openbsd.org/faq/upgrade-minifaq.html#1.3
   5. http://openbsd.org/faq/upgrade-minifaq.html#1.4
   6. http://openbsd.org/faq/upgrade-minifaq.html#1.5
   7. http://openbsd.org/faq/upgrade-minifaq.html#1.6
   8. http://openbsd.org/faq/upgrade-minifaq.html#2.1
   9. http://openbsd.org/faq/upgrade-minifaq.html#2.2
  10. http://openbsd.org/faq/upgrade-minifaq.html#2.3
  11. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  12. http://openbsd.org/faq/upgrade-minifaq.html#3.2
  13. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  14. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  15. http://openbsd.org/faq/upgrade-minifaq.html#4.2.1
  16. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  17. http://openbsd.org/faq/upgrade-minifaq.html#4.2.3
  18. http://openbsd.org/faq/upgrade-minifaq.html#4.2.4
  19. http://openbsd.org/faq/upgrade-minifaq.html#4.2.5
  20. http://openbsd.org/faq/upgrade-minifaq.html#4.2.6
  21. http://openbsd.org/faq/upgrade-minifaq.html#4.2.7
  22. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  23. ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/
  24. http://openbsd.org/faq/upgrade-minifaq.html#1.4
  25. http://openbsd.org/faq/upgrade-minifaq.html#1.5
  26. http://openbsd.org/anoncvs.html
  27. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  28. http://openbsd.org/faq/upgrade-minifaq.html#4.2
  29. http://openbsd.org/faq/upgrade-minifaq.html#4.3
  30. http://openbsd.org/ports.html
  31. http://openbsd.org/faq/upgrade-minifaq.html#4.2.2
  32. http://openbsd.org/faq/upgrade-minifaq.html#3.1
  33. http://openbsd.org/faq/upgrade-minifaq.html#4.1
  34. mailto:kwooding@codetalker.com

Enter pathname of shell or RETURN for sh: _
erase ^?, werase ^W, kill ^U, intr ^C
(I)nstall, (U)pgrade or (S)hell? _i
=================================================
Welcome to the OpenBSD/i386 2.5 installation program.

This program is designed to help you put OpenBSD on your disk in a simple and
rational way.

As with anything which modifies your disk's contents, this program can cause
SIGNIFICANT data loss, and you are advised to make sure your data is backed
up before beginning the installation process.

Default answers are displayed in brackets after the questions.  You can hit
Control-C at any time to quit, but if you do so at a prompt, you may have
to hit return.  Also, quitting in the middle of installation may leave your
system in an inconsistent state.  If you hit Control-C and restart the
install, the install program will remember many of your old answers.

Proceed with installation? [n] _y

Cool! Let's get to it...
Specify terminal type [pcvt25]: _

The installation program needs to know which disk to consider the root disk.
Note the unit number may be different than the unit number you used in the
boot program (especially on a PC with multiple disk controllers).
Available disks are:

wd0
wd1
sd0

Which disk is the root disk [wd0]? _
Do you want to use the *entire* disk for OpenBSD? [no] _yes

[...]

Inside the BIOS 'A6' ('OpenBSD') partition you just created, there resides an
OpenBSD partition table which defines how this BIOS partition is to be split
up. This table declares the offsets and sizes of your / partition, your swap
space, and any other partitions you might create.  (NOTE: The OpenBSD disk
label offsets are absolute, ie. relative to the start of the disk... NOT
relative to the start of the BIOS 'A6' partition).

If this disk is shared with other operating systems, those operating systems
should have a BIOS partition entry that spans the space they occupy completely.
For safety, also make sure all OpenBSD file systems are within the offset and
size specified in the 'A6' BIOS partition table.  (By default, the disklabel
editor will try to enforce this).  If you are unsure of how to use multiple
partitions properly (ie. seperating /,  /usr, /tmp, /var, /usr/local, and other
things) just split the space into a root and swap partition for now.

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41)

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
> _d a
> _a a
offset: [63] _
size: [16386237] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a b
offset: [131103] _
size: [16255197] _64M
Rounding to nearest cylinder: 131040
FS type: [swap] _
> _a d
offset: [262143] _
size: [16124157] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/tmp
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a e
offset: [393183] _
size: [15993117] _64M
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] _
mount point: [none] _/var
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a g
offset: [524223] _
size: [15862077] _300M
Rounding to nearest cylinder: 614880
FS type: [4.2BSD] _
mount point: [none] _/usr
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _a h
offset: [1139103] _
size: [15247197] _*
FS type: [4.2BSD] _
mount point: [none] _/home
fragment size: [1024] _
block size: [8192] _
cpg: [16] _
> _w
> _q

You will now have the opportunity to enter filesystem information for wd0.
You will be prompted for the mount point (full path, including the prepending
'/' character) for each BSD partition on wd0.  Enter "none" to skip a
partition or "done" when you are finished.

The following partitions will be used for the root filesystem and swap:

wd0a
/

wd0b
swap

Mount point for wd0d (size=65520k) [/tmp, RET, none, or done]? _
Mount point for wd0e (size=65520k) [/var, RET, none, or done]? _
Mount point for wd0g (size=307440k) [/usr, RET, none, or done]? _
Mount point for wd0h (size=1926256k) [/home, RET, none, or done]? _done

Nowq you can select another disk to initialize.  (Do not re-select a
disk you have already entered information for).  Available disks are:

wd0
wd1

Which one? [done] _

You have configured the following devices and mount points:

wd0a /
wd0d /tmp
wd0e /var
wd0g /usr
wd0h /home

Filesystems will now be created on these devices.
If you made any mistakes, you may edit this now.
Edit using ed? [n] _

============================================================
The next step will overwrite any existing data on:

wd0a wd0d wd0e wd0g wd0h

Are you really sure that you're ready to proceed? [n] _y
[...]

You will now be given the opportunity to configure the network.  This will be
useful if you need to transfer the installation sets via FTP, HTTP, or NFS.
Even if you choose not to transfer installation sets that way, this information
will be preserved and copied into the new root filesystem.

Configure the network [y] _
Enter system hostname (short form): [] _mybox
Enter DNS domain name: [] _someisp.com

If you have any devices being configured by a DHCP server
it is recommended that you do not enter a default route or
any name servers.

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[ ] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [xl0] _
IP address (or 'dhcp')? [] _199.185.137.55
Symbolic (host) name? [mybox] _
Netmask ? [255.255.255.0] _
Your network interface might require non-default
media directives.  The default media is:

media: Ethernet 100baseTX half-duplex
This is a list of supported media:
        media autoselect
        media 100baseTX mediaopt full-duplex
        media 100baseTX mediaopt half-duplex
        media 100baseTX
        media 10baseT mediaopt full-duplex
        media 10baseT
        media 10baseT mediaopt half-duplex
If the default is not satisfactory, and you wish to use another
media, copy that line from above (ie. "media 100baseTX")
Media directives? [] _

You may configure the following network interfaces (the interfaces marked
with [X] have been successfully configured):


[X] xl0

[ ] fxp0

Configure which interface? (or, enter 'done') [done] _
Enter IP address of default route: [none] _199.185.137.128
Enter IP address of primary nameserver: [none] _199.185.137.1
Would you like to use the nameserver now? [y] _

You will now be given the opportunity to escape to the command shell to do
any additional network configuration you may need.  This may include adding
additional routes, if needed.  In addition, you might take this opportunity
to redo the default route in the event that it failed above.
Escape to shell? [n] _
/dev/wd0a on /mnt type ffs (local)
/dev/wd0d on /mnt/tmp type ffs (local)
/dev/wd0e on /mnt/var type ffs (local)
/dev/wd0g on /mnt/usr type ffs (local)
/dev/wd0h on /mnt/home type ffs (local)

Please enter the initial password that the root account will have.
Password (will not echo): _
Password (again): _

It is now time to extract the installation sets onto the hard disk.  Make sure
the sets are either on a local device (i.e. tape, CD-ROM) or on a network
server.  You will have the chance to repeat this step or to extract sets from
several places, so you don't have to try to load all the sets in one try and
can recover from some errors.

Install from (f)tp, (h)ttp, (t)ape, (C)D-ROM, (N)FS or local (d)isk? _c

The following CD-ROM devices are installed on your system; please select
the CD-ROM device containing the partition with the installation sets:

acd0
cd0

Which is the CD-ROM with the installation media? [abort] _acd0
Partition? [c] _

There are two CD-ROM filesystem types currently supported by this program:
cd9660

ISO-9660
ffs

Berkeley Fast Filesystem

Which filesystem type? [cd9660] _
Enter the directory relative to the mount point that
contains the file. [/2.5/i386] _

You will now be asked for files to extract.  In addition to the
files listed in the selector you may enter any file located in
/mnt2//2.5/i386.  You can also enter 'all' to install all the standard
sets, or 'list' to list the files avilable in /mnt2//2.5/i386.
When you are done selecting files, enter 'done'.
Some of these sets are required for your install and some are optional --
You will want at least the base and bsd sets.
Consult the intallation notes if you are not sure which sets are required!

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[ ] misc25.tar.gz

[ ] comp25.tar.gz

[ ] man25.tar.gz

[ ] game25.tar.gz

[ ] xbase25.tar.gz

[ ] xshare25.tar.gz

[ ] xfont25.tar.gz

[ ] xserv25.tar.gz

[X] bsd

File name []? _*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[X] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _-game*

The following sets are available for extraction.
Enter filename, `list', `all', or `done'.
You may de-select a set by prepending a '-' to it's name.


[X] base25.tar.gz

[X] etc25.tar.gz

[X] misc25.tar.gz

[X] comp25.tar.gz

[X] text25.tar.gz

[X] man25.tar.gz

[ ] game25.tar.gz

[X] xbase25.tar.gz

[X] xshare25.tar.gz

[X] xfont25.tar.gz

[X] xserv25.tar.gz

[X] bsd
File name []? _done

Ready to extract selected file sets? [y] _

/mnt2//2.5/i386/base25.tar.gz:
100% |***************************************************| 17774 KB   00:00 ETA
/mnt2//2.5/i386/etc25.tar.gz:
100% |***************************************************|   161 KB   00:00 ETA
/mnt2//2.5/i386/bsd:
100% |***************************************************|  2281 KB   00:00 ETA
/mnt2//2.5/i386/misc25.tar.gz:
100% |***************************************************|  1637 KB   00:00 ETA
/mnt2//2.5/i386/comp25.tar.gz:
100% |***************************************************| 11481 KB   00:00 ETA
/mnt2//2.5/i386/man25.tar.gz:
100% |***************************************************|  3543 KB   00:00 ETA
/mnt2//2.5/i386/xbase25.tar.gz:
100% |***************************************************|  5376 KB   00:00 ETA
/mnt2//2.5/i386/xshare25.tar.gz:
100% |***************************************************|  1482 KB   00:00 ETA
/mnt2//2.5/i386/xfont25.tar.gz:
100% |***************************************************|  6017 KB   00:00 ETA
/mnt2//2.5/i386/xserv25.tar.gz:
100% |***************************************************| 15188 KB   00:00 ETA

Extract more sets? [n] _
Copying fstab...done.
Copying hostname.xl0...done.
Copying hosts...done.
Copying myname...done.
Copying mygate...done.
Copying resolv.conf...done.

Select a time zone for your location. Timezones are represented on the
system by a directory structure rooted in "/usr/share/timezone". Most
timezones can be selected by entering a token like "MET" or "GMT-6".
Other zones are grouped by continent, with detailed zone information
separated by a slash ("/"), e.g. "US/Pacific" or "Canada/Mountain".

To get a listing of what's available in /usr/share/zoneinfo, enter "?"
at the prompts below.

What timezone are you in [`?' for list] [GMT]? _?
Africa/      Chile/       GMT          Jamaica      Navajo       UCT
America/     Cuba         GMT+0        Japan        PRC          US/
Antarctica/  EET          GMT-0        Kwajalein    PST8PDT      UTC
Arctic/      EST          GMT0         Libya        Pacific/     Universal
Asia/        EST5EDT      Greenwich    MET          Poland       W-SU
Atlantic/    Egypt        HST          MST          Portugal     WET
Australia/   Eire         Hongkong     MST7MDT      ROC          Zulu
Brazil/      Etc/         Iceland      Mexico/      ROK          posixrules
CET          Europe/      Indian/      Mideast/     Singapore
CST6CDT      Factory      Iran         NZ           SystemV/
Canada/      GB           Israel       NZ-CHAT      Turkey
What timezone are you in [`?' for list] [GMT]? _Canada
There are several timezones available within zone 'Canada'
Select a sub-timezone [`?' for list]: _?
Atlantic            Eastern             Pacific
Central             Mountain            Saskatchewan
East-Saskatchewan   Newfoundland        Yukon
Select a sub-timezone [`?' for list]: _Mountain
You have selected timezone "Canada/Mountain".
Installing timezone link...done.
Installing boot block...
boot: /mnt/boot
proto: /usr/mdec/biosboot
device: /dev/rwd0c
/usr/mdec/biosboot: entry point 0
proto bootblock size 512
room for 12 filesystem blocks at 0x16f
Will load 6 blocks of size 8192 each.
Using disk geometry of 63 sectors and 128 heads.
 0: 19 @(0 93 45) (5903-5921)
 1: 63 @(0 94 1) (5922-5984)
 2: 14 @(0 95 1) (5985-5998)
/mnt/boot: 3 entries total
using MBR partition 3: type 166 (0xa6) offset 63 (0x3f)

Do you expect to run X windows on this machine? [y or n] _y
Enabling machdep.allowaperture. Read xf86(4) for more information.

Making all device nodes (by running /dev/MAKEDEV) ...... done.
Unmounting filesystems... /mnt/usr /mnt/var /mnt/tmp /mnt ... Done.
Done.

CONGRATULATIONS!  You have successfully installed OpenBSD!  To boot the
installed system, enter halt at the command prompt. Once the system has
halted, reset the machine and boot from the disk.

# _reboot


