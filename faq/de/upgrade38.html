<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD-Upgradeanleitung</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2005, 2006 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="index.html">[FAQ-Index]</a>
</font>

<h1><font color="#e00000">Upgradeanleitung: 3.7 auf 3.8</font></h1>
<hr>

<i>Hinweis: Upgrades werden nur von einem Release zum direkt darauf
folgenden Release unterstützt.
Überspringe keine Releases.</i>

<p><i>
Es wird dringend dazu geraten, diesen Prozess zu lesen und voll und
ganz zu verstehen, bevor du ihn durchführst.
Wenn du das hier beschriebene auf einer wichtigen oder physikalisch
entfernten Maschine machst, solltest du diesen Prozess erst auf einer
identischen lokalen Maschinen versuchen, um sicherzustellen, dass alles
funktioniert, bevor du dich an die wichtige oder entfernte Maschine
wagst.
</i>

<p>
Upgrading ist ein bequemer Weg, um dein OpenBSD-System auf die
aktuellste Version zu bringen.
Jedoch sind die Ergebnisse nicht beabsichtigt, genau so zu sein wie
eine Installation, bei der alles gelöscht und wieder aufgespielt wird.
Insbesondere alte Bibliotheksdateien werden beim Upgradeprozess nicht
deinstalliert, da sie von alten Applikationen, die vielleicht später
noch aktualisiert werden, noch benötigt werden könnten. Wenn du WIRKLICH
all diese alten Dateien loswerden möchtest, wärst du mit einer
vollständigen Neuinstallation vermutlich besser dran.

<h2>Vor dem Upgrade ...</h2>
Vor dem Upgrade entscheiden sich einige Benutzer, alle
<a href="faq15.html#PkgMgmt">Packages</a> zu entfernen und anschließend
neue Versionen nach dem Upgrade zu installieren.
<p>
Um schnell alle Packages von deinem System zu deinstallieren:
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Installiere die neuen Versionen dieser Applikationen nach dem Upgrade.

<p>

Bedenke, dass mit OpenBSD 3.8 die pkg-Werkzeuge nun ,in-place'
Aktualisierungen unter Verwendung von <code>pkg_add -r</code>
unterstützen. Dies wurde mit den meisten Packages getestet, insbesondere
mit den CD-Packages, die für 3.6 und 3.7 mitgeliefert wurden.
Einige wichtige Punkte sind:
<ul>
<li><code>pkg_add -r</code> macht keine systemweiten Updates -
stattdessen muss das zu aktualisierende Package angegeben werden.
Eine neue Option namens <code>pkg_add -u</code> kann verwendet werden,
um die genaue Liste der Packages zu ermitteln, die an <code>pkg_add
-r</code> übergeben werden müssen.
<li><code>pkg_add -r  -F update -F updatedepends -q
Liste_der_neuen_Pkgs</code> sollte in den meisten Fällen genügen.
<li>Mozillapackages von 3.7 können nun gefahrlos auf eine 3.8-Version
aktualisiert werden.
</ul>

<p>
<b>Der tx(4)-Treiber ist nun
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=epic&amp;sektion=4">epic(4)</a></b>.
Wenn sich in deinem System eine tx(4)-basierte Karte befindet (zum
Beispiel vom Typ SMC Etherpower II 10/100), wird sie nun unter
OpenBSD 3.8 von einem anderen Treiber als unter 3.7 unterstützt.
VOR dem Upgrade solltest du deine <tt>/etc/hostname.tx*</tt>-Datei(en)
mit dem passenden <tt>/etc/hostname.epic*</tt>-Dateinamen kopieren, da
dein Netzwerk sonst nach dem Upgradeprozess nicht funktionieren wird.

<h2>Mit Installationsmedium upgraden</h2>
Der einfachste und sicherste Weg, um von Binärdateien aus upzugraden,
ist von einem Installationsmedium zu booten und den Upgradeschritten
zu folgen, welche sich dem <a href="faq4.html">Installationprozess</a>
sehr ähneln. Führe die
<a href="#etcUpdates"><tt>/etc</tt>-Aktualisierungen</a>, die weiter
unten angegeben sind, danach aus.

<h2>Ohne Installationsmedium upgraden</h2>
<i>Diese Vorgehensweise wird nicht empfohlen. Verwende die
Installationsmedium-Methode, wenn es irgendwie möglich ist!</i>

<p>
Manchmal muss man ein Upgrade einer Maschine durchführen, wenn man
nicht auf einfache Weise den normalen Upgradeprozess durchführen kann.
Man kann dies normalerweise durchführen, indem man vorsichtig einen
Prozess befolgt, der einem source-basierten Upgrade sehr ähnlich ist:

<ul>
<li><b>Lege die Installationsdateien in einem ,guten' Verzeichnis ab</b>.
Stelle sicher, dass du genügend freien Platz hast!

<li><b>Deaktivere das Starten aller »unsicheren« Applikationen beim
Booten:</b>
Es wird Momente während der Installation geben, in denen zwar PF nicht
geladen werden kann, deine Applikationen aber eventuell normal gestartet
und ausgeführt werden. Jede Applikation, deren Sicherheit von PF
abhängig ist, sollte daher zuvor deaktiviert werden; sie sollte auch
erst erneut aktiviert werden, wenn die Funktionsweise von PF nach dem
Upgrade sichergestellt worden ist.
Es mag weitere Applikationen geben, die du während dem Upgradeprozess
nicht ausführen möchtest - beende und deaktiviere sie ebenfalls.

<li><b>Installiere neue(n) Kernel</b>
<blockquote><pre>
cd /<i>Pfad</i>
rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /
</pre></blockquote>

Achte auf die zusätzlichen Schritte, um den primären Kernel zu
kopieren: diese werden durchgeführt, um zu gewährleisten, dass immer
eine funktionsfähige Kopie des Kernels auf der Platte ist, so dass das
System booten kann, falls ein Stromausfall oder ein Systemabsturz zu
sehr ungüstiger Zeit eintreten.

<li><b>Installiere neue <tt>/etc/firmware</tt>-Dateien:</b>
Aus der Tatsache heraus, dass einige hochgeladene ,firmware'-Teile
vom Kernel in Dateien verschoben wurden, die sich im
<tt>/etc/firmware</tt>-Verzeichnis befinden, könnten einige wenige
Treiber nicht korrekt geladen werden, wenn keine hochgeladene
Firmwaredatei zur Verfügung steht, wenn der neue Kernel bootet.
Dies wird nur Benutzer einiger weniger Geräte betreffen, obwohl alle
Benutzer diesen Schritt ohne weiterer Beeinträchtigung ausführen können.
Um die Firmwaredateien aus <tt>base38.tgz</tt> zu entpacken, verwende
das Folgende als root vor dem nächsten Schritt:

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base38.tgz "*etc/firmware/*"
</pre></blockquote>

<li><b>Starte mit dem neuen Kernel neu:</b>
Es mag verführerisch sein, diesen Schritt zu überspringen, aber er
sollte nun durchgeführt werden, da - wie üblich - der neue Kernel die
alten Userlandapplikationen ausführen wird (wie zum Beispiel den
bald wichtigen <tt>reboot</tt>!), ein neues Userland aber häufig
NICHT mit einem alten Kernel zusammen funktioniert.

<li><b>Installiere neue Userlandapplikationen</b>
<i>Installiere noch NICHT <tt>etc38.tgz</tt> und
<tt>xetc38.tgz</tt>!</i>

<blockquote><pre>
cd /
tar xzpf /<i>Pfad</i>/base38.tgz
tar xzpf /<i>Pfad</i>/comp38.tgz
tar xzpf /<i>Pfad</i>/game38.tgz
tar xzpf /<i>Pfad</i>/man38.tgz
tar xzpf /<i>Pfad</i>/misc38.tgz
tar xzpf /<i>Pfad</i>/xbase38.tgz
tar xzpf /<i>Pfad</i>/xfont38.tgz
tar xzpf /<i>Pfad</i>/xserv38.tgz
tar xzpf /<i>Pfad</i>/xshare38.tgz
</pre></blockquote>
Hinweis: nicht alle Dateisets müssen für alle Einsatzgebiete
installiert werden, wenn du jedoch ein Dateiset ursprünglich installiert
hast, solltest du es jetzt doch mit einem neuen Dateiset upgraden.

<p>
Hinweis: Die Dateien in <tt>/etc</tt> werden weiter unten getrennt
behandelt, so dass <tt>etc38.tgz</tt> und <tt>xetc38.tgz</tt>
an dieser Stelle NICHT entpackt werden.

<li><b><tt>/dev</tt> aktualisieren.</b>
Die neue
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>-Datei
wird durch die Installation von <tt>base38.tgz</tt> nach /dev kopiert,
so dass du einfach nur Folgendes machen musst:
<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>

<li><b>Upgrade <tt>/etc</tt> wie unten beschrieben</b>.

<li><b>Starte neu</b>
</ul>

Während diesem Prozess könnte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
viele Fehlermeldungen wie diese erzeugen:
<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204
</pre>
Diese Nachrichten können unbesorgt ignoriert werden, du könntest aber
auch sendmail(8) während dem Upgradeprozess beenden.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Aktualisierungen in <tt>/etc</tt></h2>

Falls du nun unter Verwendung eines Installationsmediums und dadurch
einen formalen ,Upgrade'-Prozess oder aber ein Binaryupdate vor Ort
durchführst, gibt es einige Schritte, die manuell durchgeführt
werden müssen.

<a name="users"></a>
<h4>Neue Benutzer und Gruppen</h4>
Ein HostAP-Daemon wurde hinzugefügt, so dass neue Benutzer und Gruppen
notwendig sind.

Füge Benutzer und Gruppen als <i>root</i> unter Verwendung von
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
hinzu:

<blockquote><pre>
useradd -u86 -g=uid -c"HostAP Daemon" -d/var/empty -s/sbin/nologin _hostapd
</pre></blockquote>

Dieser Schritt wird sowohl den neuen Benutzer als auch die
zugewiesene Gruppen erstellen. Deine Umgebung erlaubt eventuell
Copy&amp;Paste dieser Kommandos.


<a name="apps"></a>
<h4>Userlandapplikationen</h4>

<a name="etcfiles"></a>
<h4><tt>/etc</tt>-Dateiänderungen</h4>
Du solltest die <tt>etc38.tgz</tt>-Dateien in ein temporäres Verzeichnis
entpacken:
<blockquote><pre>
cd /tmp
tar xzpf /<i>Pfad</i>/etc38.tgz
</pre></blockquote>


Dateien, die ordnungsgemäß von <tt>etc38.tgz</tt> ,so wie sie sind'
kopiert werden können:

<blockquote><pre>
hostapd.conf
netstart
pf.os
rc
services
mtree/*
</pre></blockquote>

Bedenke, dass es möglich IST, all diese Dateien lokal zu modifizieren.
Solltest du sie also modifiziert haben, musst du sie manuell anpassen.
Hier sind Copy&amp;Paste-Zeilen, um diese Dateien zu kopieren,
angenommen, dass du <tt>etc39.tgz</tt> in dem zuvor empfohlenen
Verzeichnis abgelegt hast:

<blockquote><pre>
cd /tmp/etc
cp hostapd.conf netstart pf.os rc services /etc
cp mtree/* /etc/mtree/
</pre></blockquote>

<p>
Dateien, die per Hand angepasst werden müssen, so dass alle lokalen
Änderungen beibehalten werden (falls sie vom Original abweichen) -
ansonsten kannst du sie auch einfach kopieren:

<blockquote><pre>
ftpusers
inetd.conf
login.conf
rc.conf
sysctl.conf
syslog.conf
mail/aliases
</pre></blockquote>

Die Änderungen dieser Dateien befinden sich in
<a href="../upgrade38.patch">dieser Patchdatei</a>. Du kannst
versuchen, sie zu verwenden, indem du das Folgende als root ausführst:
<blockquote><pre>
cd /
patch -C -p0 &lt;upgrade38.patch
</pre></blockquote>

Hiermit wird geprüft, wie gut der Patch sich in DEIN System einbinden
lässt. Um ihn tatsächlich einzubinden, lass die Option <tt>-C</tt> weg.
Beachte, dass es sehr wahrscheinlich ist, dass wenn du diese Dateien
modifiziert, nicht immer auf dem aktuellsten Stand gehalten hast oder
von einem Snapshot von 3.7 aus upgradest, dieser Patch nicht richtig
angewandt werden kann.
In diesen Fällen musst du die Änderungen manuell vornehmen.
Teste diesen Prozess bitte, bevor du dich darauf verlässt, dass alles
funktioniert, wenn du ihn an einem schwer zu erreichenden System
anwendest.

<p>
Beachte, dass die Datei <tt>/etc/mail/aliases</tt> geändert wurde, so
dass du
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
ausführen musst, damit diese Änderungen wirksam werden.

<p>
Die folgenden Dateien haben Änderungen erfahren, die du dir genauer
ansehen solltest, da sie sehr wahrscheinlich nicht direkt kopiert oder
eingepflegt werden können (d.&nbsp;h. wenn du pf.conf verwendest, dann
solltest du dir die empfohlene Änderung der Sicherheitsrichtlinie
angucken und für dich selbst entscheiden, ob sie für deine Anwendungen
eingesetzt werden kann):

<blockquote><pre>
pf.conf
spamd.conf
/root/.profile
</pre></blockquote>


Verwende schlussendlich
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>,
um alle neuen Verzeichnisse zu erstellen:
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="index.html">[FAQ-Index]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade38.html,v 1.17 ]<br>
$Translation: upgrade38.html,v 1.14 2006/04/24 17:44:30 paldium Exp $<br>
-->
$OpenBSD: upgrade38.html,v 1.11 2006/04/25 08:25:49 saad Exp $
</small>

</body>
</html>
