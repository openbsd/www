<html>
<head>
<title>11-2.4.0 - OpenBSD 2.4 Specific Information</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif">
<p>
<h2><font color=#e00000>11-2.4 - OpenBSD 2.4 Specific Information</font><hr></h2>
</p>

<p>
<ul><h3>Table of Contents</h3>
<li><a href="#11.1">11.1 - Why do I get UserDir error when running httpd?</a>
<li><a href="#11.2">11.2 - Installing at a partition 4GB or higher</a>
<li><a href="log24.txt">11.3 - OpenBSD 2.4 installation walkthrough</a>
</ul>
</p> 
<hr>

<br>

<p>
<a name= "11.1">
<h2>11.1 - In 2.4 why do I get UserDir error when running httpd?</h2>
</a>
</p>
   
<p>
It seems as though userdir support was left out of 2.4. Make sure to pick
up
the patch at:
</p>

<p>
<a href= "../errata24.html#userdir">http://www.openbsd.org/errata24.html</a>
</p>

<p> 
<a name= "11.2"></a>
<h2>11.2 - Installing at a partition 4GB or higher</h2>
</p>

<p>
The 2.4 CDs shipped with a problem in installboot. A patch can be
obtained
here <a href= "../errata.html#installboot">
              http://www.openbsd.org/errata.html</a>.
This is fixed in -current.
</p>

<p>
To place the partition boot record, installboot used a 32 bit multiplication
for the sectors times the sectorsize which is larger than 2^32 -1 (i.e.
multiplication overflow) when the partition starts at 4 GB or higher. This
means the pbr is installed in the real partition address modulo 4GB. It's
still possible to install at >= 4GB with some effort:
</p>

<p> 
You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or any
other unix like OS, you should back up the sectors first before trying
anything.
</p>

<p>
<ul>
    <li>Suppose the partition starts at cylinder 611, and the drive has
        255 heads, 63 sectors: offset for the obsd partition is 611*255*63=
        9815715 sectors. multiply this by 512 and you get: 5025646080.
        5025646080 mod 2^32 = 730678784
        <p>
        (You can just subtract 2^32 on a hand calculator...) dividing by 512
        gives sector 1427107.
        </p>

        <p>
        Ok, suppose were now in linux (where cylinder numbers are 1 higher
        btw..) and that the obsd partition is DOS partition 4:
        </p>

        <p>
        <strong>
        dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
        </strong>
        </p>
        
        <p>
        will backup the data that installboot will nuke ..
        </p>
        
        <p> 
        Now install OpenBSD. Return to Linux.
        </p>
        
        <p>
        Now we're going to copy the partition boot record to the right place.
        </p>
           
        <p>
        <strong>
        dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
        <br>
        dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
        </strong>
        </p>
        
        <p>
        (adding obsd to lilo should now work)
        </p>
        
        <p>
        Now write back the nuked sector:
        </p>
        
        <p>
        <strong>
        dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
        </strong>
        </p>        
        <p>
        Caveat: make sure that whatever gets nuked by installboot isn't
        essential to running dd (and starting the other OS). Backing up the
        affected partition is recommended.
        </p>
        
    <li>Use a correct version of installboot (compiled for you by another OBSD'er ..):
        <p> 
        put it on another partition, e.g. a DOS partition. Suppose wd0j is the
        DOS partition (see disklabel wd0, this is in case of IDE disks), and
        installboot is named installb there.
        </p>
        <p> 
        After booting from floppy/CD, press ^C to get into the shell:
        <strong>
        <ul>
            <li> mkdir dos<br>
            <li> mount /dev/wd0j dos<br>  
            <li> cp dos/tmp/installb /usr/mdec/installboot<br>
        </ul>
        </strong>
        </p>
</ul>   
</p>
        
<p>
Now enter 'install' and the installation procedure should use the new
installboot.
</p>    

<p> 
<hr>
<a href= "index.html"><img height= "24" width= "24" src="../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq11-2.4.html,v 1.10 2002/01/21 20:28:25 nick Exp $</small>
</p>
</body>
</html>

