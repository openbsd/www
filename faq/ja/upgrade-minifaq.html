<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
    <title>OpenBSD Upgrading Mini-FAQ</title>
  </head>

  <body bgcolor="#FFFFFF" text="#000000" link="#23238E">

    <h1>ミニ FAQ: OpenBSD のアップグレード</h1>

    <h2>OpenBSD 最新リリース - 3.4</h2>

    <address>
      <p>Kjell Wooding 
	&lt;<a href="mailto:kjell@openbsd.com">kjell@openbsd.org</a>&gt;<br>
	更新: 
	$OpenBSD: upgrade-minifaq.html,v 1.60 2004/04/17 19:33:21 jufi Exp $</p>
    </address>
    <br>

    <blockquote>
      <p>このミニ FAQ は、OpenBSD のリリース間での、あるいはリリースから
      <em>-current</em> へのアップグレードを行おうとする場合に遭遇する、
      最も一般的な問題に対する取り組む試みです。もはや、<em>Mini</em> で
      あることは難しいのですが、このドキュメントは、歴史上の理由から、
      そしてまた、一貫性の理由からミニ FAQ という名前のままとなっています。
      古いバージョンのための情報は、<a href="upgrade-old.html">別のドキュメント</a>
      の中にあります。</p>
    </blockquote>

    <p>
      この Upgrade Mini-FAQ は、<b>上級者</b>を対象としています。
      もし、あなたが初心者なら、あるいはコンパイラやツールチェインに
      <b>完全には確信が持てない</b>のでしたら、ソースからのアップグレードは、
      <b>よしておいた方が良い</b>でしょう。バイナリリリースや snapshot を
      お試しいただいて、以下に述べられている関連の操作を行っていただき、
      <tt>/etc</tt> のアップグレードを実施してください。
    </p>

    <h2>一般的なアップグレードについての質問</h2>

    <p>
      <a href="#1.1">1.1: 用語. <em>-current</em> とは ?
	snapshot とは ?  <em>-stable</em> とは ?</a><br>

      <a href="#1.2">1.2: <em>-current</em> にアップグレードするための
	最も良い方法は ?</a><br>

      <a href="#1.3">1.3: 探してみたのですが、FTP サイトには snapshot は
	見つかりませんした。他の方は、どうされているのでしょう ?</a><br>

      <a href="#1.4">1.4: 最新のソースを取得するには ?</a><br>

      <a href="#1.5">1.5: ソースツリーは取得しました。では、それをどのようにして
	構築するのでしょう ?</a><br>

      <a href="#1.6">1.6: <em>make build</em> が途中で止まってしまったのですが、
	最初からやり直さなければならないのでしょうか ?</a><br>

      <a href="#1.7">1.7: <em>make build</em> の途中でエラーが出ました。
	どうすれば良いのでしょう ?</a><br>

      <a href="#1.8">1.8: <em>gcc</em> コンパイラをアップグレードするための
	標準的な方法はあるのでしょうか ?</a><br>

      <a href="#1.9">1.9: <tt>/etc</tt> や <tt>/var</tt>、<tt>/dev</tt> を
	アップグレードするための最も良い方法とは ?</a><br>

      <a href="#1.10">1.10: 既存のソースツリーから、すべてのゴミをきれいに消去する
	には、どのようにすれば良いのでしょう ?</a><br>

      <a href="#1.11">1.11: <em>make build</em> は root になってから行うべき
	でしょうか ?</a><br>

      <a href="#1.12">1.12: 新しいデバイスが見つからないのですが、どうして
	でしょう ?</a><br>

      <a href="#1.13">1.13: ファイルの階層構造をすべて変更するための簡単な方法は
	あるのでしょうか ?</a><br>

      <a href="#1.14">1.14: アップグレード後、<em>ps</em> コマンドで
       "proc size mismatch." と出てしまうのですが ?</a><br>

      <a href="#1.15">1.15: どのようにして最新の snapshot にアップグレードするのでしょうか ?</a><br>


    </p>

    <h2>3.5 から <i>-current</i> へのアップグレード</h2>
    <p>
      <a href="#3.5.1">3.5.1: pty デバイスのマイナー番号の変更</a><br>
      <a href="#3.5.2">3.5.2: 新しいユーザ/グループ _dhcp</a><br>
      <a href="#3.5.3">3.5.3: 新しいユーザ/グループ _mopd</a><br>
    </p>

    <h2>3.4 から 3.5 へのアップグレード</h2>
    <p>
      <a href="#3.4.1">3.4.1: svnd デバイスのマイナー番号の変更</a><br>
      <a href="#3.4.2">3.4.2: 新しいユーザ/グループ _pflogd</a><br>
      <a href="#3.4.3">3.4.3: インターフェイスの複製</a><br>
      <a href="#3.4.4">3.4.4: 新しいユーザ/グループ _bgpd</a><br>
      <a href="#3.4.4">3.4.5: 新しいバージョンの join(1)</a><br>
      <a href="#3.4.5">3.4.6: sudo の構築の変更</a><br>
      <a href="#3.4.7">3.4.7: 新しいユーザ/グループ _tcpdump</a><br>
      <a href="#3.4.8">3.4.8: machdep.c の変更 (i386)</a><br>
      <a href="#3.4.9">3.4.9: GCC3 への移行 (sparc64)</a><br>
    </p>

    <h2>3.3 から 3.4 へのアップグレード</h2>

    <p>
      <a href="#3.3.1">3.3.1: i386 W^X サポート</a><br>
      <a href="#3.3.2">3.3.2: mquery システムコールの変更</a><br>
      <a href="#3.3.3">3.3.3: i386 の記念日、実行形式のアドレス/MAXDSIZ の変更</a><br>
      <a href="#3.3.4">3.3.4: KerberosIV 認証の削除</a><br>
      <a href="#3.3.4">3.3.5: config の変更</a><br>
      <a href="#3.3.5">3.3.6: ある種の関数への __attribute__((bounded))
                の使用</a><br>
      <a href="#3.3.6">3.3.7: 新しいユーザ/グループ _syslogd</a><br>
      <a href="#3.3.7">3.3.8: カーネル用ヘッダの新しいフォーマット属性
               __kprintf__</a><br>
    </p>

    <h2>3.2 から 3.3 へのアップグレード</h2>

    <p>
      <a href="#3.2.1">3.2.1: 新しい Perl</a><br>
      <a href="#3.2.2">3.2.2: 新しいグループ _radius、_token および _shadow</a><br>
      <a href="#3.2.3">3.2.3: 重要なコンパイラの変更</a><br>
      <a href="#3.2.4">3.2.4: 新しいユーザ/グループ _spamd</a><br>
      <a href="#3.2.5">3.2.5: ipv6-icmp 用のエイリアス</a><br>
      <a href="#3.2.6">3.2.6: 新しいグループ _lkm</a><br>
      <a href="#3.2.7">3.2.7: 新しい libpthread</a><br>
      <a href="#3.2.8">3.2.8: ELF アーキテクチャ用のリンカの変更</a><br>
      <a href="#3.2.9">3.2.9: /var/at の削除と crontab の変更</a><br>
    </p>

    <h2>それ以前のバージョンからのアップグレード</h2>

    <p>OpenBSD 2.3 〜 3.1 からのアップグレードについての情報は、
      <a href="upgrade-old.html">別のドキュメント</a>に移され
      ました。このドキュメントは、少し大きくなり過ぎてしまった
      ようです。</p>


    &nbsp;<hr width="30%">

    <a name="1.0"></a> 
    <h2>一般的なアップグレードについての質問</h2>

    <a name="1.1"></a> 
    <h3>1.1: 用語. <em>-current</em> とは ?
      snapshot とは ?  <em>-stable</em> とは ?</h3>

    <p>OpenBSD 2.7 より前までは、OpenBSD の開発は、単一の、ブランチの
      ないソースツリーで行われていましたが、2.7 から patch ブランチが
      導入されました。</p>

    <p>おおよそ 6 ヶ月間隔で、OpenBSD の <em>release</em> が
      リリースされています。これは、定型的 (2.x, 3.x) なルール
      にて採番されています。現在の OpenBSD の release は、この
      ドキュメントの先頭部分に示されているものです。</p>

    <p><em>-current</em> とは <em>openbsd-current</em> の略であり、
      CVS リポジトリの中のソースツリーの、刻々と更新されている
      バージョンを指す用語です。これは、OpenBSD の開発者たちによって、
      最も共通的に使用されているツリーです。<em>-current</em> ツリー
      は、次の release にしようとしているすべてのコードを含むものです。
      ときどき、勇者たちは、正式な release を捨てて openbsd-current を
      実行しようとし、それは通常、まだ正式な release に含まれていない
      機能の優位性を手にすることができます。しかしながら、その確実では
      ない性質のために、<em>-current</em> へのアップグレードは、技術に
      自信のないユーザには推奨されないものではあります。</p>

    <p>正式の release の間に、<em>snapshot</em> シリーズの
      リリースが、
      <a href="ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/">ここ</a>
      で行われています。snapshot は <em>-current</em> ソースツリーの
      試験的なリリースです。これは、開発の現在の状態を反映したもの
      ですので、snapshot のリリースが、正しく (あるいは、全体として)
      動くだろうことを保証するものではありません。snapshot は、
      正式な release (あるいは、-current の古い目のバージョン) から
      現在のツリーに移行してくる際には、実に役に立つものです。もしも、
      <em>-current</em> を動かす上で問題が出た場合、<em>source-changes</em> 
      <a href="../../ja/mail.html">メーリングリスト</a>の話題の追跡を強く
      推奨します。これは、コミットのメッセージが、最新の偉大な機能の
      追加に関する、価値のある重要な情報をしばしば含んでいるからです。</p>

    <p>OpenBSD 2.7 から、(<em>-stable</em> と呼ばれる)
      <a href="../../ja/stable.html">patch ブランチ</a>が導入されました。
      このブランチは元となる release を含み、これに重要なパッチや修正が
      (errata パッチとなる重要なものに加え、その他の errata エントリに
      相当しないような単純明解なものも含めて) すべて含まれています。</p>

    <p><a href="../../ja/ports.html">ports ツリー</a>は、システムに不可欠な
      ものとなっています。システムをアップグレードするのと同じタイミング
      で、他のすべてのものをアップグレードするのと同じルールで、ports
      ツリーも更新されるべきものです。たとえば、-stable システムの上では、
      -stable の ports を走らせるべきですし、-current の ports は、
      -current システムの上でのみ走らせるべきです。</p>

    <a name="1.2"></a>
    <h3>1.2: <em>-current</em> にアップグレードするための
      最も良い方法は ?</h3>

    <p>ライブラリの変更の問題があるので、release から <em>-current</em>
      への直接の移行は、常に簡単なわけではありません。最も苦痛のない
      <em>-current</em> への移行方法は、まず、
      <a href="#1.15">最新の snapshot にアップグレードすることでしょう</a>。
      いったん、snapshot をインストールすれば、最新のソースを
      <a href="#1.4">取得</a>して、<a href="#1.5">構築</a> することが
      できます。この方法なら、toolchain やライブラリに関するほとんどの
      問題を回避することができるでしょう。</p>

    <a name="1.3"></a> 
    <h3>1.3: 探してみたのですが、FTP サイトには snapshot は
      見つかりませんした。他の方は、どうされているのでしょう ?</h3>
 
    <p>snapshot は、それが古く (あるいは、もはや適切でなく) なれば、
      削除されるかも知れません。もし、有効な snapshot がなくなれば、
      最も最近の release にアップグレードすべきであり、ソースから
      残りを構築すべきでしょう。</p>

    <a name="1.4"></a> 
    <h3>1.4: 最新のソースを取得するには ?</h3>

    <p>短かい回答: 
      <a href="../../ja/anoncvs.html">http://www.openbsd.org/ja/anoncvs.html</a></p>

    <p>たとえば、CVS からツリー全体を取得するには (この例は ksh を
      使う場合で、それ以外の場合は、<em>export</em> の代わりに
      <em>setenv</em> を使用してください)、</p>

<pre>
  # export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
  # export CVS_RSH=/usr/bin/ssh
  # cd /usr
  # cvs -q get -P src
</pre>

    <p>この操作は -current のソースを取得するためのものだということに注意してください。
      ですので、もし、たとえば 3.2-stable を取得したい場合には次のようにしてください。</p>

<pre>
  # cvs -q get -rOPENBSD_3_2 -P src
</pre>

    <a name="1.5"></a> 
    <h3>1.5: ソースツリーは取得しました。では、それをどのようにして構築するのでしょう ?</h3>

    <p>基本的な操作方法は、
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile"
	 ><tt>/usr/src/Makefile</tt></a> の中に記述があります。
      これは、少し拡張されたバージョンです。</p>

    <ol>
      <li>
        <p>古いオブジェクトファイルをきれいに消してしまいましょう。</p>

        <p>もし、個別の /usr/obj ディレクトリを作っているなら、それを消して、
	  シンボリックリンクを再作成します。</p>

<pre>
  # rm -rf /usr/obj/*
  # cd /usr/src
  # make obj
</pre>

        <p>もしも、あなたが何度もこの操作を実行したことがあるのなら、/usr/obj を
	  だけのパーティションとして配置しておいて、<em>newfs</em> を <em>rm</em>
	  の代わりに実行する方が速いということは、もうお気付きかも知れませんね。
	  たとえば、</p>

<pre>
  # umount /usr/obj
  # newfs wd0h
  # mount /usr/obj
  # make obj
</pre>

        <p>もし、ソースツリー中にオブジェクトファイルが作られていないか、
	  ご心配でしたら、次のようにしてみましょう。</p>

<pre>
  # cd /usr/src
  # find . -type l -name obj | xargs rm
  # make cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

      </li>

      <li>
        <p>どのような、バージョン固有の構成変更も実行してください。
	  たとえば、2.3 のユーザは、<em>named</em> ユーザとグループを
	  2.4 かそれ以降に移行する前に追加しておかなければなりません。
	  あなたのバージョンに関係するミニ FAQ のセクションをご参照ください。</p>
      </li>

      <li>
        <p>すべての適切なディレクトリ構造が作られていることを確認します。
	  これは、古い目のバージョンからのアップグレードには特に重要な
	  ことですが、ときどき、他の場合にも必要になることがあります。
	  そのための最も簡単な方法は、次のとおりです。</p>
<pre>
  # cd /usr/src/etc &amp;&amp; env DESTDIR=/ make distrib-dirs
</pre>

      </li>

      <li>
        <p>新しいカーネルをコンパイルします。</p>
<pre>
  # cd /usr/src/sys/arch/`machine`/conf
</pre>

        <p>ほとんどのユーザは GENERIC を使用したいと思うでしょうから、</p>
<pre>
  # config GENERIC
  # cd ../compile/GENERIC
</pre>

        <p><strong>注:</strong> 本当のマゾヒストは、代わりに
	  カスタムカーネルをコンパイルしたいと思うかも知れません。
	  そのようなときは、まず GENERIC から始めて、それに修正を
	  施しましょう。代わりに次のような手順を踏んでください。</p>
<pre>
  # cp GENERIC MYKERNEL
  # vi MYKERNEL
  (お好きなように MYKERNEL を変更してください)
  # config MYKERNEL
  # cd ../compile/MYKERNEL
</pre>

        <p>どちらの場合にも、</p>
<pre>
  # make clean &amp;&amp; make depend &amp;&amp; make
  (arc アーキテクチャの場合のみ) bsd.ecoff を FAT パーティションにコピーします。
  # cp /bsd /bsd.old &amp;&amp; cp bsd /bsd
  # chown root:wheel /bsd (他のユーザ権限でコンパイルしていた場合)
  (reboot)
</pre>
      </li>

      <li>
        <p>システムをコンパイルします。</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
        <p><tt>/etc</tt> と <tt>/dev</tt> とを手動で更新します。
	  これらは自動的には更新されません。/ か /dev、/var、/etc を
	  保持するのに十分なスペースのあるディレクトリを選択してください。
	  この例では、<em>/home/newroot</em> を選択しています。</p>
<pre>
  # mkdir /home/newroot          
  # export DESTDIR=/home/newroot
  # cd /usr/src/etc &amp;&amp; make distribution-etc-root-var
</pre>

        <p>さて、それらのインストールされた相当物と /home/newroot の
	  中のファイルとを比較してください。必要ななら、ファイルを
	  置換するか更新してください。</p>
<pre>
  # rm -rf /home/newroot   (作業終了後)
</pre>
      </li>

      <li>
        <p>/etc のファイルが正しいことを確認するため、リブートします。</p>
      </li>
    </ol>

    <a name="1.6"></a> 
    <h3>1.6: <em>make build</em> が途中で止まってしまったのですが、
      最初からやり直さなければならないのでしょうか ?</h3>

    <p>私ならそうするでしょうが、もし、あなたが本当に途中で終了した
      ところから再開したいのなら、次のようにしましょう。</p>
<pre>
  # cd /usr/src
  # make -n build
</pre>

    <p>これは、make build が何をするのかを見せてくれるでしょう。
      たとえば、私のところでは、次のようになります。</p>
<pre>
  (cd /usr/src/share/mk &amp;&amp;  make install)
  (cd /usr/src/include; make prereq;  make includes)
  make cleandir
  (cd /usr/src/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/kerberosIV/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/usr.bin/perl &amp;&amp;  make -f Makefile.bsd-wrapper config.sh &amp;&amp;  make -f Makefile.bsd-wrapper depend &amp;&amp;  make -f Makefile.bsd-wrapper perl.lib &amp;&amp;
  make -f Makefile.bsd-wrapper install.lib)
  make depend &amp;&amp; make &amp;&amp;  make install
</pre>

    <p>途中で終了したところから再開するために、コンパイルが止ってしまった
      ところからコマンドを発行します。</p>

    <p>もし、この操作を何度も行ったことがあるのでしたら、新しいターゲットを
      Makefile 中に作ろうと思うかも知れませんね。そうするのでしたら、単純に
      <em>build</em> のエントリを (たとえば <em>build-noclean</em> に) 
      コピーして、<em>make cleandir</em> の参照を削除します。</p>

    <a name="1.7"></a> 
    <h3>1.7: <em>make build</em> の途中でエラーが出ました。
      どうすれば良いのでしょう ?</h3>

    <p><em>make build</em> がエラーで終了してしまったら、再構築の前に古い
      オブジェクトの消去を失敗していたということでしょうから、そのチャンス
      だということになります。それらのオブジェクトをきれいに消去するための
      詳細は、<a href="#1.5">1.5</a> を参照してください。</p>

    <p>ツリーの古いオブジェクトのゴミをきれいにしたことを確認したのに、
      それでも build でエラーが出るようなら、次の 3 つのうちのひとつが
      起きている可能性があります。</p>

    <ol>
      <li>既知のアップグレードの問題に遭遇したのでしょう。このドキュメントの
	適切なセクションをちゃんと読んでいるかどうか、そして、そこに書かれて
	いる指示に注意深く従っているかどうか確認してください。</li>

      <li>新たなアップグレードの問題に遭遇したのでしょう。このままでは、
	アップグレードはうまくいかないかも知れません。可能な代替手段を探すため、
	<a href="../../ja/mail.html">misc@ や tech@</a> メーリングリストへの
	最近の投稿を検索しましょう。</li>

      <li>誰かが一時的にソースツリーを壊してしまったのでしょう。この種の
	中断は非常に珍しいことであり、通常は直ちに修復されます。
	少し待ってみて、ソースツリーを取得し直してみてください。
	もし、待てない状況なら、1 日前か 2 日前のツリーの取得を
	試みてください。</li>
    </ol>

    <p>もし、上記の代替手段のすべてを試してみて、それでも数日以上も
      問題が解決しないのでしたら、その問題を misc@openbsd.org に投稿
      してください。関連するエラーメッセージおよびあなたのセットアップの
      どのような特殊性も含まれていることを確認してください。</p>

    <a name="1.8"></a> 
    <h3>1.8: <em>gcc</em> コンパイラを
      アップグレードするための標準的な
      方法はあるのでしょうか ?</h3>

    <p>OpenBSD は、現在、そのツリー中に、ほとんどのプラットフォームで使用されている
      GCC v2.95.3 と、v2.95.3 より良好に動作する一部のプラットフォームで使用されている
      GCC v3.3.2 という、ふたつのコンパイラをサポートしています。

      これらふたつのコンパイラは以下のようにツリーの異なる部分にあります。
       <ul>
       <li>gcc3: <tt>/usr/src/gnu/usr.bin/gcc</tt>
       <li>gcc2: <tt>/usr/src/gnu/egcs/gcc</tt>
       </ul>
      いくつかのプラットフォームでは、将来、GCC3 に移行する予定ですが、
      いくつかのプラットフォームでは、GCC3 がサポートしないため、移行の見込みが立たないものもあります。

    <p>コンパイラのアップグレードは、「鶏と卵」問題の部分がある
      ので、ツリー中のコンパイラの変更は、少々特別な注意を
      要します。一般的には、次のような手順を実行したいと思う
      ことでしょう。</p>

    <p>(そうです。あなたはこれを二度構築することになります。)</p>

<pre>
  <b>GCC 2.95.3 を使用するプラットフォーム:</b>
    # rm -r /usr/obj/gnu/egcs/gcc/*
    # cd /usr/src/gnu/egcs/gcc
        <i>- あるいは -</i>
  <b>GCC 3.3.2 を使用するプラットフォーム:</b>
    # rm -r /usr/obj/gnu/usr.bin/gcc/*
    # cd /usr/src/gnu/usr.bin/gcc

  <b>v3.3.2 と v2.95.3 に共通の構築手順</b>
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
</pre>

    <p>そして、それから通常の <em>make build</em> を実行します。</p>


    <a name="1.9"></a> 
    <h3>1.9: <tt>/etc</tt> や <tt>/var</tt>、<tt>/dev</tt> を
      アップグレードするための最も良い方法とは ?</h3>

    <p><strong>短かい回答</strong>: それは手で行うことです。</p>

    <p><strong>長い回答</strong>:</p>

    <p>ポリシーとして、OpenBSD ツリーのソフトウェアは、<tt>/etc</tt>
      配下のファイルを自動的に変更することはありません。このことは、
      <em>常に</em>システム管理者がそこへの変更を行う必要があるという
      ことを意味しています。アップグレードも例外ではありません。これ
      らのディレクトリ中のファイルの更新は、まず、基本 (配布) ファイル
      にどのような変更がなされたのかを特定し、そして手動で、それらの
      変更点を反映することになります。</p>

    <p>たとえば、ごく最近、変更されたツリーの中のファイルを見るには、
      次のようにします。</p>

<pre>
  # cd /usr/src/etc
  # ls -lt |more
</pre>

    <p>OpenBSD の任意のバージョンの間の <tt>/etc</tt> への変更をすべて
      見るのには、<a href="../../ja/anoncvs.html">CVS</a> が使えます。
      たとえば、3.1 と 3.2 の間の変更点を見るためには、
      次のようにしてください。</p>

<pre>
  # cd /usr/src/etc
  # cvs diff -u -rOPENBSD_3_1 -rOPENBSD_3_2
</pre>

    <p>いったん、変更点を確認したら、それらをローカルのツリーに対して、
      適用してください。どのようなローカルな設定でも、それは保存して
      おきましょう。</p>

    <p>リリース間に見られる典型的な <tt>/etc</tt> の変更点には、次のような
      ものが含まれます。</p>

    <ul>
      <li><tt>/etc/protocols</tt> や <tt>/etc/services</tt> への追加。</li>
      <li>新しい sysctl (<tt>/etc/sysctl.conf</tt> を参照)。</li>
      <li>デフォルトの cron ジョブへの変更。<tt>/etc/daily</tt> や
	<tt>/etc/weekly</tt>、<tt>/etc/monthly</tt>、<tt>/etc/security</tt> を参照。
      </li>
      <li>netstart を含む、すべの rc スクリプト。</li>
      <li>デバイスの変更。
	<a href="#1.12">1.12</a> を参照。
      </li>
      <li><tt>/etc/mtree</tt> のファイル階層構造の変更。
	<a href="#1.13">1.13</a> を参照。
      </li>
      <li>
	新しいユーザ (<tt>/etc/passwd</tt>) とグループ (<tt>/etc/group</tt>)。
      </li>
    </ul>


    <a name="1.10"></a> 
    <h3>1.10: 既存のソースツリーから、すべてのゴミをきれいに消去するには、
      どのようにすれば良いのでしょう ?</h3>

    <p>最も重要なことは、obj ディレクトリの下をきれいに消去してしまうこと
      でしょう。次に、ソースを更新し、残存オブジェクトを消去する手順を
      示します。</p>

<pre>
  # cd /usr/src
  # cvs -q -d anoncvs@some.anon.server:/cvs up -Pd
  # find . -type l -name obj | xargs rm
  # make -k cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

    <p>それでもなお、トラブルに見舞われるようでしたら、CVS でのアップデートの
      際に、<tt>-I ! -I CVS -I obj</tt> を付けて試してみましょう。これにより、
      ソースツリー中のどのようなゴミでも識別されるようになるでしょう。</p>

    <a name="1.11"></a> 
    <h3>1.11: <em>make build</em> は root になってから行うべき
      でしょうか ?</h3>

    <p>make build のプロセスのあるステップでは、root の
      権限が要求されるのですが、build のプロセスには、
      これを比較的容易に行えるようにするため、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
      コマンドへのフックが含まれています。</p>

    <p>もし、<tt>/etc/sudoers</tt> ファイルが正しく設定されているなら、
      次のような方法で、sudo へのフックを使用することができます。</p>

    <ul>
      <li>構築を開始する前に、SUDO=/usr/bin/sudo を環境変数に
	セットするか、</li>

      <li>"SUDO=/usr/bin/sudo" という行を 
	<tt>/etc/mk.conf</tt> ファイルに加えます。</li>
    </ul>

    <a name="1.12"></a> 
    <h3>1.12: 新しいデバイスが見つからないのですが、どうしてでしょう ?</h3>

    <p><tt>/dev/MAKEDEV</tt> スクリプトは、<em>make build</em> の
      プロセスでは自動的に更新されません。一般的なルールとしては、
      更新時にこれをソースツリーからコピーして実行することは良い
      方法なのです。</p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <a name="1.13"></a> 
    <h3>1.13: ファイルの階層構造をすべて変更するための簡単な方法は
      あるのでしょうか ?</h3>

    <p>ときどき、ファイルやディレクトリが、ファイルの階層構造に追加されたり、
      あるいは削除されたりします。同様に、ファイルシステムの一部のオーナーの
      情報が変更されることもあります。ファイルの階層構造を確実に最新に保つ
      ための簡単な方法は、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
      ユーティリティを使用することです。</p>

    <p>まず、最新のソースを取得します。そして、次のようにします。</p>

<pre>
  # cd /usr/src/etc/mtree
  # install -c -o root -g wheel -m 600 special /etc/mtree
  # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

    <p>これで、ファイルシステムの階層構造は最新に保たれるでしょう。</p>

    <a name="1.14"></a> 
    <h3>1.14: アップグレード後、<em>ps</em> コマンドで
      "proc size mismatch." と出てしまうのですが ?</h3>

    <p>
      ユーザランドとカーネルとが同期していません。これらの間には、ある種の
      依存関係がありますから、これらは同じソースからコンパイルされなければ
      なりません。この問題に対処するには、カーネルとユーザランドを同じソース
      から再構築し直さなければなりません。
    </p>

    <p>
      既にひとつは失敗してしまったわけですから、他にも失敗したかも
      しれないものを把握するために、このドキュメントの全体を再読する
      のに理想的な時間でしょう。
    </p>


    <a name="1.15"></a>
    <h3>1.15: どのようにして最新の snapshot にアップグレードするのでしょうか ?</h3>

    <p>
      snapshot のインストールは最新のものに保つための良い方法です。
      私たちは、次期バージョンが確実に最高の品質のものとなるよう、
      特にベータの時点で snapshot をテストして欲しいのです。そして
      それは、全体のツリーから構築するよりはずいぶん簡単なことなのです。
    </p>

    <p>
      <em>-current</em> にするための最も簡単な方法は、ブートイメージを取得して、
      <a href="../faq4.html">FAQ</a> に記述された
      ものを用意することです。単にブートして &quot;(U)pgrade&quot; を選択し、
      その指示に従うだけです。
    </p>

    <p>
      アップグレードプログラムを実行するのには、いくつかの目的があります。
      通常、最も早い方法は、フロッピーや CD-ROM からブートするか、
      -current の <a href="../faq4.html#bsd.rd">bsd.rd</a> を / に置き、
      これを <tt>/bsd</tt> の代わりにブートすることです。
      他のオプションには、ネットワーク経由のブートやテープからのブートが含まれます。
      すべての方法がすべてのアーキテクチャに対して有効になっているわけではありませんので、
      より詳しい情報はインストールの説明を参照してください。
    </p>

    <p>
      その場でのアップグレードでも動作することはありますが、これは推奨できません。
      アップグレードを行う場合に唯一安全な方法は、上記の新しいインストール/アップグレード
      用メディアからブートすることです。
    </p>

    <p>
      どのような場合でも、<a href="#1.9">/etc、/var および /dev</a> については
      手でアップグレードする必要があります。
    </p>

    <a name="3.5"></a>
    <h2>
      3.5 から <i>-current</i> へのアップグレード
    </h2>

    <a name="3.5.1"></a>
    <h3>
      3.5.1: pty デバイスのマイナー番号の変更 (2004/04/11)
    </h3>
    <p>
      仮想ターミナルの最大数を 256 から 992 に増加させるため、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pty&amp;sektion=4">pty</a>
      デバイスのマイナー番号が変更されました。
      ですので、新しいカーネルをブートする前に、更新された
      <tt>/dev/MAKEDEV</tt> を実行する必要があります。
        <ul>
          <li>ソースコードツリーを更新
          <li>新しいカーネルを構築してインストール
          <li>システムの残りの部分を構築 (<em>make build</em>)
          <li>新しい MAKEDEV スクリプトを <tt>/dev</tt> ディレクトリにコピーし、
              新しい pty デバイスを生成
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev && ./MAKEDEV pty0
</pre>
          <li>新しいカーネルでブート
         <li>最早使用されていない古い pty デバイスを除去
<pre>
     # cd /dev && rm -f [pt]ty[rq]*
</pre>
         <li> また、VAX プラットフォームの場合は、以下の実行します。
<pre>
     # cd /dev && rm -f [pt]tyr*
</pre>
        </ul>

    <a name="3.5.2"></a>
    <h3>
      3.5.2: 新しいユーザ/グループ _dhcp (2004/04/12)
    </h3>
    <p>さまざまな dhcp 関連のデーモンが、その特権を落とすために再度作業が行われ、
      あるいは特権分離が行われるようになりました。このため、新しいユーザ/グループ
      _dhcp が必要となりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 77 _dhcp
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _dhcp:*:77:77::0:0:dhcp programs:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.3"></a>
    <h3>
      3.5.3: 新しいユーザ/グループ _mopd (2004/04/14)
    </h3>
    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mopd&amp;sektion=8"
      >mopd(8)</a> デーモンは、初期化後に特権を落とすようになりました。
      このため、新しいユーザ/グループ _mopd が必要となりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 78 _mopd
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _mopd:*:78:78::0:0:MOP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4"></a>
    <h2>
      3.4 から 3.5 へのアップグレード
    </h2>

    <a name="3.4.1"></a>
    <h3>
      3.4.1: svnd デバイスのマイナー番号の変更 (2003/10/10)
    </h3>
    <p>
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svnd&amp;sektion=4">svnd</a>
      デバイスのマイナー番号が変更されましたので、
      新しいカーネルのインストール後に、更新された
      <tt>/dev/MAKEDEV</tt> を実行する必要があります。
        <ul>
          <li>ソースコードツリーを更新
          <li>新しいカーネルを構築
          <li>新しい MAKEDEV スクリプトを dev ディレクトリにコピーし、
              既存の svnd(4) と rsvnd デバイスとを消去し、新しいそれを再生成
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev
     # rm svnd* rsvnd*
     # ./MAKEDEV vnd
</pre>
          <li>構築およびリリースプロセスを継続
        </ul>

      これは、<tt>make release</tt> などを含む、
      svnd デバイスを使用する人に影響します。
    <p>

    <a name="3.4.2"></a>
    <h3>
      3.4.2: 新しいユーザ/グループ _pflogd (2003/10/23)
    </h3>
    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
      >pflogd(8)</a> デーモンは特権分離モードで実行されるようになり、そのため、新しい
      ユーザとグループ _pflogd が必要になりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 74 _pflogd
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _pflogd:*:74:74::0:0:pflogd privsep:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.3"></a>
    <h3>
      3.4.3: インターフェイスの複製 (2003/12/07)
    </h3>
    <p>(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif(4)</a>、
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo(4)</a> や
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun(4)</a>
      などの) いくつかの仮想ネットワークドライバは、
      複製をサポートするようになり、たとえば、デバイスの生成や消去を
      動的に行えるようになりました。もし、あなたが、これらのインターフェイスに
      依存しているのでしたら、新しいカーネルでリブートする前に、更新された
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
      や
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8">netstart(8)</a>
      をインストールしておかなければなりません。

    <p>まず、いつものように新しいカーネルを再構築しインストールします。そして、
      <pre>
  # cd /usr/src && make includes
  # cd sbin/ifconfig
  # make obj depend
  # make
  # make install
  # cp /usr/src/etc/netstart /etc
      </pre>
      を実行してマシンをリブートし、新しいユーザランドを構築してください。
    <p>

    <a name="3.4.4"></a>
    <h3>
       3.4.4: 新しいユーザ/グループ _bgpd (2003/12/17)
    </h3>
    <p>新しい <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8"
      >bgpd(8)</a> デーモンは特権分離モードで実行されるため、新しい
      ユーザとグループ _bgpd が必要になりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 75 _bgpd
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _bgpd:*:75:75::0:0:BGP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.5"></a>
    <h3>
       3.4.5: 新しいバージョンの join(1) (2003/12/28)
    </h3>
    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=join&amp;sektion=1">join(1)</a>
    コマンドは、
    マッチしない行を書く場合に、
    POSIX 標準に従うよう更新されました。
    以下のように
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=security&amp;sektion=8">security(8)</a>
    を更新する必要があります。
     <pre>
  # cp /usr/src/etc/security /etc
     </pre>
    <p>

    <a name="3.4.6"></a>
    <h3>
       3.4.6: sudo の構築の変更 (2004/01/15)
    </h3>
    <p>
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
    コマンドの構築の方法が変更されました。その副作用として、"make build"
    を実行する前に、以下のコマンドを実行しておく必要があります。
     <pre>
  # rm -f /usr/obj/usr.bin/sudo/*
     </pre>
    これを行わなかった場合には、obj ディレクトリを作成しようとするところで
    構築が異常終了してしまいます。
    <p>

    <a name="3.4.7"></a>
    <h3>
      3.4.7: 新しいユーザ/グループ _tcpdump (2004/01/19)
    </h3>
    <p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
      >tcpdump(8)</a> コマンドは特権分離モードで実行されるようになり、そのため、新しい
      ユーザとグループ _tcpdump が必要になりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 76 _tcpdump
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _tcpdump:*:76:76::0:0:tcpdump:/var/empty:/sbin/nologin
</pre>

    <p>
    <a name="3.4.8"></a>
    <h3>
      3.4.8: machdep.c の変更 (i386) (2004/02/01)
    </h3>

    <p>
    <tt>machdep.c</tt> の変更により、カーネルをコンパイルする前に
    binutils を再構築する必要があります。
    これは、i386 にのみ影響します。

<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <p> これでカーネルの再構築が可能になりましたので、残りのシステムを
    <a href="#1.5">1.5</a> 章に従って再構築してください。

    <p>
    <a name="3.4.9"></a>
    <h3>
      3.4.9:  GCC3 への移行 (sparc64) (2004/02/20)
    </h3>

    <p>
    OpenBSD/sparc64 は GCC3 に移行しました。
    アップグレードするため、まず以下を実行してください。

<pre>
    # cd /usr/src/share/mk
    # make install
    # rm -rf /usr/include/g++
</pre>
    これで、(GCC3 ディレクトリを使用して) <a href="#1.8">GCC3 を構築</a>し、
    カーネルとシステムとを <a href="#1.5">1.5</a> 章に従って再構築してください。


    <a name="3.3"></a>
    <h2>
      3.3 から 3.4 へのアップグレード
    </h2>

    <a name="3.3.1"></a>
    <h3>
      3.3.1: i386 W^X サポート (2003/04/16)
    </h3>

    <p>i386 の W^X (Writable xor eXecute) をサポートするために、
      OpenBSD/i386 は a.out の実行形式から ELF に移行しました。ELF は
      W^X のサポートを可能にするなど、ELF は実行形式のレイアウトに対する
      柔軟性を持っています。a.out に対する互換性は、限られた形でしか用意
      されません。スタティックリンクされた a.out バイナリは従来と同様に
      動くでしょうが、ダイナミックリンクの a.out は<b>サポートされません。</b>
    </p>
     <p><b>a.out から ELF へのソースアップグレードはサポートされません。</b>
      <b>スナップショットをインストール</b>すれば、ソースから再構築できます。
      これは i386 だけに関係することで、他のアーキテクチャはこの影響を受けません。
    </p>

    <a name="3.3.2"></a>
    <h3>
      3.3.2: mquery システムコールの変更 (2003/04/28)
    </h3>

    <p>mquery システムコールのパラメータは mmap() にマッチするよう変更されました。
      この変更によって、システムを正しい順序でアップグレードする必要があります。

      <pre>
      1. 新しいカーネルを再構築し、新しいカーネルでブートしてください。
      2. (cd /usr/src && sudo make includes)
      3. (cd /usr/src/libexec/ld.so && make && sudo make install)
      4. 'make build'
      </pre>

      i386 アーキテクチャだけが mquery を使用しますので、これ以外のアーキテクチャでは、
      このような厳密な構築順序に従う必要はありません。

    <a name="3.3.3"></a>
    <h3>
      3.3.3: i386 の記念日、実行形式のアドレス/MAXDSIZ の変更 (2003/05/05)
    </h3>

    <p>MAXDSIZ を 1G に戻せるようにするため、すべての実行形式のベースアドレスを
      0 から 0x1c000000 に変更しました。これらの一連の変更のため、
      スナップショットからのアップグレードが必要となります。
      ソースからのアップグレードはサポートされません。これは i386 にのみ影響します。
    </p>

    <a name="3.3.4"></a>
    <h3>
      3.3.4: KerberosIV 認証の削除 (2003/05/13)
    </h3>

    <p>KerberosIV ベースの認証が削除されました。その結果、
       <tt>/etc/login.conf</tt> の中のすべての <tt>krb4</tt> 
       への参照を削除する必要があります。
    </p>

    <a name="3.3.5"></a>
    <h3>
      3.3.5: <tt>config</tt> の変更 (2003/05/23)
    </h3>

    <p>swapgeneric.c の移動により、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
      の変更が必要になりました。新しいカーネルを構築する前に、まず、以下のように、
      更新された config(8) の構築とインストールを行わなければなりません。
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean
  # make obj
  # make
  # make install
</pre>
      そして、<a href="#1.5">上記</a>の詳細に従って、カーネル設定の
      <tt>config</tt> を行い、カーネルのコンパイル用ディレクトリで、
      "<tt>make depend</tt>" を行ってください。

    <a name="3.3.6"></a>
    <h3>
     3.3.6: ある種の関数への __attribute__((bounded)) の使用 (2003/06/26)
    </h3>

    <p>
      __attribute__((bounded)) は、そのパラメータのひとつとしてバッファ長を取る
      関数への不正な引数を検出するため、使用されるようになります。
      <br><br><tt>make build</tt> に先だって、ミニ FAQ の
      <a href="#1.8">1.8</a> 章に従って、
      gcc を再構築しなければなりません。
    </p>

    <a name="3.3.7"></a>
    <h3>
      3.3.7: 新しいユーザ/グループ _syslogd (2003/07/31)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
      >syslogd(8)</a> デーモンは特権分離モードで実行されるようになり、そのため、新しい
      ユーザとグループ _syslogd が必要になりました。
      以下のように root ユーザで groupadd を実行し、グループを追加してください。
<pre>
  # groupadd -g 73 _syslogd
</pre>
      また、<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して、以下のユーザのエントリを追加してください。
<pre>
  _syslogd:*:73:73::0:0:Syslog Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.3.8"></a>
    <h3>
      3.3.8: カーネル用ヘッダのフォーマット属性 __kprintf__ の使用 (2003/08/23)
    </h3>
    <p>
      カーネル用 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=printf&amp;sektion=9">printf(9)</a>
      のフォーマット拡張に gcc が注意するよう、新しいフォーマット属性 __kprintf__ が
      カーネル用ヘッダファイルで使用されるようになりました。
      <br><br><tt>make build</tt> に先だって、ミニ FAQ の <a href="#1.8">1.8</a>
      章に従って、gcc を再構築しなければなりません。また、<a href="#3.3.5">3.3.5</a>
      章に記述されている __bounded__ 属性もサポートする current のソースからでも、
      一度だけ gcc を再構築すれば良いことになります。
    </p>

    <a name="3.2"></a>
    <h2>
      3.2 から 3.3 へのアップグレード
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: 新しい Perl (2002/11/05)
    </h3>

    <p>Perl がバージョン 5.8.0 に更新されました。<br>
      Perl 5.8.0 では、XS モジュールの API が、stdio から PerlIO (より詳しくは perldelta
      マニュアルを参照してください) への切り替えにともない、変更されました。このことは、
      インストール済のすべての XS モジュール (perl の .so ファイル) が、<strong>リビルド
      されなければならない</strong>ことを意味します。ですので、もし、<em>Undefined symbol
      "perl_get_sv"</em> のようなエラーが発生した場合は、これはあなたの問題だということに
      なります。もし、インストール済のモジュールが packages や ports からインストール
      されたものだけであれば、XS モジュールをチェックするには、次のようにします。
      <pre>
       # grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
      そして、見つかった古いモジュールを <em>pkg_delete -f</em> で消去して、それらを ports
      ツリーから再構築/インストールしてください。

    <a name="3.2.2"></a>
    <h3>
      3.2.2: 新しいグループ _radius、_token および _shadow (2002/11/21)
    </h3>
    <p>以下のいくつかの新しいグループが追加されました。
      <ul>
      <li><em>_radius</em> グループは、
         <tt>/etc/raddb/servers</tt> ファイルに対する読み込み専用のアクセス制御用です。
      <li><em>_token</em> グループは、
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>、
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a> および
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>
         が使用するトークンデータベースに対する読み込み専用のアクセス制御用です。
      <li><em>_shadow</em> グループは、
         シャドウパスワードデータベースに対する読み込み専用のアクセス制御用です。
      </ul>

      これらのグループの追加やいくつかのファイルに対するパーミッションの調整は、
      &quot;make build&quot; の実行前に行う必要があります。root 権限で、
      次のコマンドを実行してください。
       <pre>
         # groupadd -g 63 _radius
         # chgrp _radius /etc/raddb /etc/raddb/servers
         # chmod g+x /etc/raddb
         # chmod g+r /etc/raddb/servers

         # groupadd -g 64 _token
         # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
         # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

         # groupadd -g 65 _shadow
         # chgrp _shadow /etc/spwd.db
         # chmod 0640 /etc/spwd.db
       </pre>

      ファイルが見つからないというエラーメッセージは気にする必要はありません。
      それは単に、<em>token</em> や <em>radius</em> 認証の設定を行っていないことを意味しているだけです。

    <a name="3.2.3"></a>
    <h3>
      3.2.3: 重要なコンパイラの変更 (2002/12/02)
    </h3>
    <p><a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      スタック保護拡張機能が
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1">gcc</a>
      にマージされました。このため、アップグレード手順が以下のように若干異なります。
      <ul>
      <li>まだこの時点では、新しいカーネルを構築しては<b>いけません</b>。
      <li>まだこの時点では、新しい gcc を再構築しては<b>いけません</b>。
      <li>シェアードライブラリを持つシステムの場合、新しい ld.so (ダイナミックローダ)
        を構築し、インストールします。
        <pre>
         # cd /usr/src
         # make obj
          ELF プラットフォーム (alpha, macppc, sparc, sparc64) の場合、
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
          a.out プラットフォーム (amiga, hp300, i386, mac68k, mvme68k) の場合、
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
       </pre>
      <li><i>make build</i> からの、最初の少しのコマンドに従って libc を再構築し、
        インストールします。
        <pre>
          # cd /usr/src/include
          # make prereq &amp;&amp; make includes
          # cd /usr/src/lib/libc
          # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
        </pre>
        使用中のコンパイラが古過ぎる場合、libc を構築することができない可能性があることに注意が必要です。
        その場合には、snapshot を使用したバイナリアップグレードを実行する必要があります。
      <li><a href="#1.8">1.8</a> 章に従って gcc を再構築し、インストールします。
      <li>ここで、カーネルの再コンパイルを行うことができます。
        カーネル用の Makefile を再生成するために、確実に
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config</a>
        を再実行してください。
      <li>新しいカーネルでリブートし、スタック保護の効果を得るため、
        <i>make build</i> を実行します。
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: 新しいユーザ/グループ _spamd (2002/12/24)
    </h3>
    <p>新しいユーザ/グループ _spamd が
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a>
      デーモン用に追加されました。root で以下を実行してグループを追加します。
<pre>
  # groupadd -g 62 _spamd
</pre>
      また、
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
      を使用して次のユーザのエントリを追加してください。
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: ipv6-icmp 用のエイリアス (2002/12/30)
    </h3>

    <p>ipv6-icmp 用の新しいエイリアス、<em>icmp6</em> が、
      <tt>/etc/protocols</tt> に追加されました。<em>icmp6</em> エイリアスを使用する場合 (
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
      のリグレッションテストで使用)、
      <tt>/etc/protocols</tt> ファイル中の <em>ipv6-icmp</em> の行を、# の前に <em>icmp6</em> 
      を追加して変更しなければなりません。
      この行は以下のようにしておくべきです。
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: 新しいグループ _lkm (2003/01/05)
    </h3>

    <p><tt>/dev/lkm</tt> へのアクセスを制御するためのグループ
         <em>_lkm</em> が追加されました。
         <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
         は _lkm に setgid されるようになりました。
    <p>
      &quot;make build&quot; の実行前に、このグループを追加し、
      <tt>/dev/lkm</tt> のパーミッションを調整する必要があります。
      次のコマンドを root で実行することで、これが行われます。
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: 新しい libpthread (2003/01/14)
    </h3>

     <p><em>libc_r</em> と <em>libnpthread</em> が除去され、<em>libpthread</em>
     で置換されました。スレッドを使用するプログラムは、やはり <em>-pthread</em>
     オプションを使用してコンパイルしてください。コンパイラの方で正しく処理
     を行います。

     <p><em>libc_r</em> と <em>libnpthread</em> とを消去する前に、スレッドを使用する
     アプリケーションは <em>libpthread</em> を使用して再コンパイルしておかなければ
     なりません。推奨再構築手順は以下のようになります。

    <ol>
      <li>
         <p><a href="#1.8">1.8</a> 章に従って、gcc を再構築してください。
      <li>
         <p><a href="#1.5">1.5</a> 章に従って、システムを再構築してください。
      <li>
         <p>すべてのスレッドを使用する ports を再構築してください。
      <li>
         <p>使用されなくなったライブラリを消去してください。
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: ELF アーキテクチャ用のリンカの変更 (2003/01/17)
    </h3>

    <p>binutils/ld は、ELF 実行形式に新しいセキュリティ機能を導入するために
       変更されました。これは、実行形式ならびにシェアードライブラリのデータ
       セクションがリンカによってマークされた実行形式になるのを許容する代わりに、
       実行形式としてのプログラムイメージを適切なセクションのみマークされるよう
       レイアウトが変更されたものです。この変更は、ELF アーキテクチャである
       alpha、sparc、sparc64、macppc に対してのみ影響があります。
    <p>
     binutils は、残りのシステムの再構築前に構築しておくことをお勧めします。
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    そして、<a href="#1.5">1.5</a> 章に従って、システムを再構築してください。

    <a name="3.2.9"></a>
    <h3>
      3.2.9: /var/at の削除と crontab の変更 (2003/02/19)
    </h3>

    <p><em>at</em> が <em>cron</em> と統合されたことにともない、<tt>/var/at</tt>
    のコンテンツは <tt>/var/cron</tt> にマージされました。さらに、POSIX に準拠するため、
    および at.allow と at.deny との一貫性の維持のため、<em>cron</em> の allow および
    deny ファイルは、それぞれ cron.allow および cron.deny にリネームされました。
    <p>
    まず、<a href="#1.5">1.5</a> 章に従って、システムを再構築してください。
    そして、次のように既存のファイルを移動させて cron を再起動してください。
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
    allow および deny ファイルがなくなったことによる一切の警告メッセージは無視してください。
    それらのすべてがデフォルトでインストールされるものというわけではないからです。
    <p>
    もし、まだ cron.deny ファイルがない場合で (このファイルは OpenBSD 3.3 以前の
    バージョンではインストールされません)、<em>crontab</em> をスーパーユーザ以外の
    ユーザ権限で実行したい場合には、このファイルが必要となります。
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <hr>

    <address>
      <p>
	<small>
Originally [OpenBSD: upgrade-minifaq.html,v 1.198 ]
<br>
$Translation: upgrade-minifaq.html,v 1.79 2004/04/15 02:20:30 toshi Exp $
<br>
$OpenBSD: upgrade-minifaq.html,v 1.60 2004/04/17 19:33:21 jufi Exp $
	</small>
	<br>
	Copyright &copy; 1998-2004, Kjell Wooding.<br>
	御感想、御質問、御提案等は、
	  <a href="mailto:kjell@openbsd.org">kjell@openbsd.org</a> までお願いします。</p>
    </address>
  </body>
</html>
