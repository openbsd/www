<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>14.0 - Nastavení disku</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2001 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>14.0 - Nastavení disku</font><hr></h2>
</p>

<p>
<ul><h3>Obsah</h3>
<li><a href="#14.1">14.1 - Pou¾ívání disklabel v OpenBSD</a></li>
<li><a href="#14.2">14.2 - Pou¾ívání fdisku v OpenBSD</a></li>
<li><a href="#14.3">14.3 - Pøidávání diskù v OpenBSD</a></li>
<li><a href="#14.4">14.4 - Jak nastavit swapování do souboru</a></li>
<li><a href="#14.5">14.5 - Soft-updaty</a></li>
<li><a href="#14.6">14.6 - Kdy¾ nabootuji po instalaci OpenBSD/i386, zastaví se na 
"Using partition 3 id 0".</a></li>
<li><a href="#14.7">14.7 - Jak dostanu dmesg z bootovací diskety?</a></li>
<li><a href="#14.8">14.8 - Instalace Bootblocks - specifické pro i386</a></li>
<li><a href="#14.9">14.9 - Pøíprava na katastrofu: Zálohování a obnova z pásky.</a></li>
<li><a href="#14.10">14.10 - Mountování disk images v OpenBSD</a></li>
<li><a href="#14.11">14.11 - Pomoc! Dostávám chyby s PCIIDE!</a></li>
</ul>
</p> 
<hr>

<a name="14.1"></a>
<h2>Pou¾ívání disklabel v OpenBSD</h2>
<p>
<h3>Table of Contents</h3>
<ul>
<li><a href="#14.1.1">Co to je disklabel?</a>
<li><a href="#14.1.2">Pou¾ití disklabel bìhem instalace OpenBSD</a>
<li><a href="#14.1.3">Bì¾né pou¾ití disklabel(8).</a>
</ul>
</p>
   
<p>
<a name="14.1.1"></a>
<h3>Co to je disklabel?</h3>
 
<p>
Nejprve se ujistìte, ¾e jste si pøeèetli manuálovou stránku 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html">disklabel(8)</a>.
</p>
  
<p>
Disklabely jsou vytváøeny k tomu, aby existovalo rozhraní mezi diskem a
diskovými drivery obsa¾enými v kernelu. Labely dr¾í urèitou informaci o va¹em
disku , napø. geometrii disku a informaci o filesytémech. To je vyu¾ito
bootstrap programem k inicializaci disku a k tomu aby se vìdìlo kd eje který
filesystém v rámci disku. Labely jsou navíc vyu¾ívány ve spojení se
filesystémy k vytvoøení efektivnìj¹ího prosøedí. Detailnìj¹í informace o
diklabelu jsou obsa¾eny v manuálové stránce 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=5&format=html">disklabel(5)</a>.
</p> 

<p>
Disklabel umo¾òuje navíc pøekonat omezení diskových oddílù dané architekturou.
Napøíklad na i386 mù¾ete mít pouze 4 primární diskové oddíly (partitons).
(Diskové oddíly které jsou vidìt na ostatních systémech jako napø. na WindowsNT nebo DOS) S <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html">disklabel(8),</a>
 mù¾ete vyu¾ít jednen z tìchto primárních oddílù k
ulo¾ení *v¹ech* oddílù OpenBSD. (napø. 'swap', '/', '/usr' and '/var'). A
stále vám zùstávají 3 oddíly pro jiné operaèní systémy!
</p>

<a name="14.1.2"></a>
<h3>Pou¾ití disklabel bìhem instalace OpenBSD</h3>

<p>
Jedna z hlavních èástí instalace OpenBSD je vytvoøení labelù. To následuje
(pro architekturu i386) hned po pou¾ití <a href="#14.2">fdisk(1)</a>u.
Bìhem instalace vyu¾ijete disklabel na vytvoøení jednotlivých labelù v rámci
jednoho diskového oddílu, která budou obsahovat mimojiné i názvy
pøípojných bodù. Bìhem instalace mù¾ete nastavit
va¹e pøípojné body v <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html">disklabel(8),</a> ale to není úplnì nezbytné, proto¾e pozdìji
budete vy¾ádání abyste potvrdili va¹e volby. Pøesto to dìlá instalaèní
proceduru rychlej¹í.
</p>

<p>
První label, který vytvoøíte bude 'a'. Tento label by mìl být namountován jako
/. Doporuèené oddíly a jejich velikosti si mù¾ete prohlédnout v  <a
href="faq4.html#4.3">faq4.3</a>. Pro servery je doporuèené abyste vytvoøili
tyto diskové oddíly separátnì. Pro bì¾né u¾ivatele bude staèit vytvoøení
mounpointu /. Ne¾ vytvoøíte vá¹ root diskový oddíl, uvìdomte si, ¾e budete
je¹tì potøebovat nìjaké místo pro label swap. Tím jsme vysvìtlili základy
diskalbelu a mù¾eme pøistoupit k pøíkladùm bìhem instalace. V prvním pøíkladu
pøedpokládáme, ¾e OpenBSD bude jediný operaèní systém na tomto poèítaèi a ¾e
budete rovádìt plnou instalaci. 
</p>

<ul><pre>
Pokud je disk sdílen s jinými operaèními systémy, mìly by tyto mít BIOS oddíl,
který rozdìluje prostor, který pokrývájí. Pro bezpeènost se pøesvìdète, ¾e
Oddíl s OpenBSD je v rozmezí offsetù a velikosti daných v 'A6' tabulce BIOSu.
(Defaultnì se bude disklabel sna¾it toto vnutit). Pokud si nejste jisti, jak
rozdìlit korektnì nìkolik oddílù, (napø. rozdìlení /,  /usr, /tmp, /var,
/usr/local a jiných) jednodu¹e prozatím rozdìlte místo mezi oddíly root a swap.  

# using MBR partition 3: type A6 off 63 (0x3f) size 4991553 (0x4c2a41) 

Treating sectors 63-16386300 as the OpenBSD portion of the disk.
You can use the 'b' command to change this.

Initial label editor (enter '?' for help at any prompt)
&gt; <strong>d a</strong>
&gt; <strong>a a</strong>
offset: [63] <strong>&lt;Enter&gt;</strong>
size: [16386237] <strong>64M</strong>
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
&gt; <strong>a b</strong>
offset: [131103] <strong>&lt;Enter&gt;</strong>
size: [16255197] <strong>64M</strong>
Rounding to nearest cylinder: 131040
FS type: [swap] <strong>&lt;Enter&gt;</strong>
</pre></ul>

<p>
V této chvíli jsme vytvoøili 64M root diskový oddíl na /, a 64Megový oddíl pro
swap. V¹imnìte si, ¾e offset zaèíná na sektoru 63. To je pøesnì to co chcete.
Disklabel ukazuje velikost v sektorech, nicménì nemusíte vkládat velikosti
pouze v sektorech. Jako v pøíkladu vý¹e mù¾ete vkládat velikosti napø. jako
<i>64 Megabytes = 64M</i> a <i>2 Gigabytes = 2G</i>. Disklabel toto zaokrouhlí
na nebli¾¹í cylindr. V pøíkladu vý¹e mù¾ete také zaznamenat, ¾e disklabel
pøedpokládá, ¾e label 'b' bude oddíl pro swap. To je správný pøedpoklad a
jádro GENERIC je nastaveno aby se dívalo po swapu v labelu 'b' a vy bystì mìli
pou¾ít 'b' jako label pro swap standartnì.
</p>

<p>
Dal¹í pøíklad vás provede vytvoøením dal¹ích dvou labelù. To znamená, ¾e to
není kompletní instalace, proto¾e velikost tìchto labelù by nestaèila na
plnou instalaci OpenBSD. 
</p>

<ul><pre>
&gt; <strong>a d</strong>
offset: [262143] <strong>&lt;Enter&gt;</strong>
size: [16124157] <strong>64M</strong>
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/tmp</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
&gt; <strong>a e</strong>
offset: [393183] <strong>&lt;Enter&gt;</strong>
size: [15993117] <strong>64M</strong>
Rounding to nearest cylinder: 131040
FS type: [4.2BSD] <strong>&lt;Enter&gt;</strong>
mount point: [none] <strong>/var</strong>
fragment size: [1024] <strong>&lt;Enter&gt;</strong>
block size: [8192] <strong>&lt;Enter&gt;</strong>
cpg: [16] <strong>&lt;Enter&gt;</strong>
</pre></ul>

<p>
V pøíkladì uvedeném vý¹e byste si mìli v¹imnout dvou vìcí. Jedna z nich je
fakt, ¾e offset se poèítá automaticky, tak aby byl dal¹í v poøadí. Pokud
budete provádìt instalaci tohoto typu, vùbec se nebudete muset s offsety
zabývat. Dal¹í rozdíl, kterého si mù¾ete v¹imnout je, ¾e label 'c' byl
pøeskoèen. To bylo provedeno z toho dùvodu, ¾e label 'c' representuje celý
disk, tak¾e s labelem 'c' byste nemìli operovat.
</p>

<p>
Pokud jste vytvoøili v¹echny labely, které jste chtìli, je èas zapsat tyto
informace na disk a pokraèovat v instalaèním procesu. Abyste zapsali v¹echno
na disk a ukonèili disklabel (a pokraèovali s instalací) udìlejte:
</p>

<ul><pre>
&gt; <strong>w</strong>
&gt; <strong>q</strong>
</ul></pre>

<p>
<strong>*POZOR!*</strong> - Pro u¾ivatele s velkými disky: Pokud vá¹ bios
nemumí rozpoznat správnout velikost va¹eho disku, OpenBSD to nebude umìt taky.
V opaèném pøípadì si OpenBSD poradí s diskem normálnì. Pokud jste v situaci,
kdy vá¹ bios nepodporuje vá¹ disk, zkuste produkty typu Maxtor EZ-Drive.
</p>


<a name="14.1.3"></a>
<h3>Bì¾né pou¾ití disklabel(8)u</h3>

<p>
Pokud je vá¹ systém nainstalován, nìmeli byste pou¾ívat disklabel moc èasto.
Budete ho ale potøeba v pøípadì, ¾e budete chtít pøidat, odebrat nebo
restruktorovat va¹e disky. Jedna z prvních vìcí které budete potøebovat udìlat
je vypsat si stávající disklabel, jednodu¹e napi¹te:
</p>

<ul><pre>
# <strong>disklabel wd0</strong> &gt;----- Podle toho jaký device si budete
# chtít prohlédnout

# using MBR partition 3: type A6 off 64 (0x40) size 16777152 (0xffffc0)
# /dev/rwd0c:
type: ESDI
disk:
label: TOSHIBA MK2720FC
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 16
sectors/cylinder: 1008
cylinders: 2633
total sectors: 2654064
rpm: 3600
interleave: 1
trackskew: 0
cylinderskew: 0
headswitch: 0           # millisekundy
track-to-track seek: 0  # millisekundy
drivedata: 0 

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:  2071440    65583    4.2BSD     1024  8192    16   # (Cyl.   65*- 2120)
  b:    65520       63      swap                        # (Cyl.    0*- 65)
  c:  2654064        0    unused        0     0         # (Cyl.    0 - 2632)
  j:   512001  2137023    4.2BSD     1024  8192    16   # (Cyl. 2120*- 2627*)
</pre></ul>

<p>
Vý¹e uvedený pøíkaz vám jednodu¹e dovolí vypsat stávající disklabel a ujistit
se, ¾e nic nepokazíte. (Co¾ v¹ichni nìkdy potøebujeme.) Abyste byli schopni
udìlat zmìny, musíte disklabel vyvolat s op¹nou -E.
</p>

<ul><pre>
# <strong>disklabel -E wd0</strong>
</pre></ul>

<p>
To vám hodí prompt, ten samý jaký jste pou¾ívali pøi instalaci OpenBSD.
NEjdùle¾itìj¹í pøíkaz na tomto promptu je asi '?'. To vám vylistuje v¹echny
mo¾nosti. Dokonce se mù¾ete podívat na kompletní manuálovou stránku
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html">disklabel(8)</a>
 pomocí pøíkazu 'M'. Z toho promptu budete dìlat vìci jako
pøidávat, mazat nebo mìnit diskové oddíly. Pro více informací si pøeètìte
manuálovou stránku 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&sektion=8&format=html">disklabel(8)</a>.
</p>

<p>
<a name="14.2"></a>
<h2>14.2 - Pou¾ívání utility fdisk</h2>
</p>
<p>
Nejprve se ujistìte, ¾e jste si pøeèetli hlavní manuálovou stránku fdisku
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&arch=i386&format=html">fdisk(8)</a>
</p>
<p>
Fdisk je program, který má pomáhat s údr¾bou va¹ich diskových oddílù. Tento
program je pou¾it pøi instalaci k nastavení va¹eho diskového oddílu s OpenBSD.
(tento dikový oddíl mù¾e obsahovat <u>nìkolik</u> labelù, ka¾dý s
filesystémem/swapem/atd.).
Mù¾e rozdìlit prostor na va¹ich discích a nastavit jeden aktivní. Tento
program je obvykle pou¾íván v Single Boot Módu ( boot -s ). Fdisk dále
nastavuje MBR na va¹ich rùzných discích.
</p>

<p>
Pro potøeby instalce budete potøebovat pouze <b>JEDEN</b> diskový oddíl s
OpenBSD a pak pou¾ijete disklabel abyste na nìm nastavili prostor pro swap a
filesystem.
</p>

<p>
Abyste si prohlédli tabulku va¹ich diskových oddílù: <br> 
<ul>
<pre># <strong>fdisk fd0</strong><br>
</pre>
</ul>

Co¾ vám dá výstup podobný tomuto:
</p>

<ul>
<pre>
         Disk: fd0       geometry: 80/2/18 [2880 sectors]
         Offset: 0       Signatures: 0xAA55,0x0
                  Starting        Ending
          #: id  cyl  hd sec -  cyl  hd sec [     start -       size]
----------------------------------------------------------------------
         *0: A6    0   0   1 -   79   1  18 [         0 -       2880] OpenBSD
          1: 00    0   0   0 -    0   0   0 [         0 -          0] unused
          2: A7    0   0   2 -   79   1  18 [         1 -       2879] NEXTSTEP
          3: 00    0   0   0 -    0   0   0 [         0 -          0] unused
</pre>
</ul>

<p>
V tomto pøíkladì ukazujeme výstup fdisku bez floppy drajvu. Mù¾eme nastavit
diskový oddíl OpenBSD (A6) a jeho velikost. * nám ríká, ¾e diskový oddíl s
OpenBSD je bootovatelný.
</p>

<p>
V pøedchozí ukázce jsem jenom vypisovali informaci. Co kdy¾ budeme chtít
editovat tabulku na¹ich diskových oddílù? Abysme tak mohli uèinit, budeme
potøebovat pou¾ít <b>-e</b> flag. To nás dostane do promptu pro interakci s
fdiskem.
</p>

<ul>
<PRE>
# <strong>fdisk -e wd0</strong>
Enter 'help' for information
fdisk: 1&gt; <strong>help</strong>
        help            Command help list
        manual          Show entire OpenBSD man page for fdisk
        reinit          Re-initialize loaded MBR (to defaults)
        disk            Edit current drive stats
        edit            Edit given table entry
        flag            Flag given table entry as bootable
        update          Update machine code in loaded MBR
        select          Select extended partition table entry MBR
        print           Print loaded MBR partition table
        write           Write loaded MBR to disk
        exit            Exit edit of current MBR, without saving changes
        quit            Quit edit of current MBR, saving current changes
        abort           Abort program without saving current changes
fdisk: 1&gt; 
</PRE>
</ul>

<p> 
Je naprosto bezpeèné podívat se a prozkoumat co vás zajímá, jenom se ujistìte,
¾e odpovíte <Strong>N</strong> na dotaz o ukládání zmìn a *NEPOU®ÍVEJTE*
pøíkaz <strong>write</strong>.
</p>

<p>Zde je pøehled pøíkazù které mù¾ete pou¾ít s volbou <b>-e</b>.<br>
<ul>
<li><strong>help</strong>    Vypí¹e seznam pøíkazù, kterým disk rozumí v
interaktivním módu.</li>
<li><strong>reinit</strong>  Zinicializuje aktuálnì vybranou, v pamìti
ulo¾enou kopii boot bloku.</li>
<li><strong>disk</strong>    Zobrazí aktuální geometrii disku kterou detekoval
fdisk. Budete moci zvolit ji editovat pokud budete chtít.</li>
<li><strong>edit</strong>    Edituje danou polo¾ku v kopii boot bloku, která je ulo¾ena
v pamìti. Mù¾ete buï editovat v BIOS geometry módu nebo v offestech sektorù a
velikostech.</li>
<li><strong>flag</strong>    Nastaví danou tabulku diskoých oddílù
bootovatelnou. Pouze jeden záznam mù¾e být nastaven jako bootovatelný. Pokud
chcete bootovat z extended diskového oddílu, budete potøebovat oznaèit záznam
v tabulce pro extended diskový oddíl jako bootovatelný.</li>
<li><strong>update</strong>  Updatne strojový kód v pamìti v kopii aktuálnì
vybraného boot bloku.</li>
<li><strong>select</strong>  Nastaví a nahraje do pamìti boot blok, na který
ukazuje extended diskový oddíl v tabulce v rámci aktuálního boot bloku.</li>
<li><strong>print</strong>   Vytiskne na terminál akuálnì nastavený boot bloku, který je
ulo¾en v pamìti a jeho MBR tabulku.</li>
<li><strong>write</strong>   Zapí¹e kopii aktuálního boot bloku ulo¾enou v
pamìti  na disk. Budete dotázáni, abyste tuto operaci potvrdili.</li>
<li><strong>exit</strong>    Vyleze ze stávající urovnì fdisku, buï se vrátí
k pøedchozí kopii boot bloku ulo¾ené v pamìti nebo ukonèí program, pokud
nezbývá ¾ádná fdal¹í úroveò.</li>
<li><strong>quit</strong>    Ukonèí aktuální úroveò fdisku, buï se vrátí
pøedchozí kopii boot bloku ulo¾ené v pamìti nebo ukonèí program, pokud nezbývá
¾ádná fdal¹í úroveò. Na rozdíl od fdisku zapí¹e aktuální zmìny  v bloku na
disk. </li>
<li><strong>abort</strong>   Ukonèí program bez ulo¾ení zmìn.</li>
</ul>
</p>
<br>

<p>
<a name="14.3"></a>
<h2>14.3 - Pøidávání dal¹ích diskù v OpenBSD</h2>
</p>

<p>
Jakmile jste instalovali vá¹ disk <strong>SPRÁVNÌ</strong> budete potøebovat
pou¾ít 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&arch=i386&format=html">fdisk(8)</a>
(<i>pouze pro i386</i
>) a 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html">
disklabel(8)</a> k nastavení va¹eho disku v OpenBSD. 
<P>
Lidi s i386  by mìli zaèít s fdiskem. Dal¹í architektury toto mohou ignorovat. 
<ul><pre>
# <Strong>fdisk -i sd2</strong>
</pre></ul>
Toto nainicializuje "skuteènou" tabulku diskových oddílù pro exkluzivní
pou¾ití OpenBSD. Pak pro ni budete potøebovat vytvoøit disklabel. To se mù¾e
zdát zmatené. 
<ul><pre>
# <strong>disklabel -e sd2</strong>

<i>(obrazovka bude prázdná, spustí se vá¹ $EDITOR)</i>
type: SCSI
<i>...bla...</i>
sectors/track: 63
total sectors: 6185088
<i>...bla...</i>
16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  c:  6185088        0    unused        0     0         # (Cyl.    0 - 6135)
  d:  1405080       63    4.2BSD     1024  8192    16   # (Cyl.    0*- 1393*)
  e:  4779945  1405143    4.2BSD     1024  8192    16   # (Cyl. 1393*- 6135)
</pre></ul>
Nejdøíve, ignorujte diskový oddíl 'c', ten je obsa¾en v¾dy a existuje proto
aby programy jako disklabel vùbec mohly fungovat!
Pro normální pou¾ití by mìla být fsize v¾dy 1024,  bsize 8192 a cpg 16. Fstype
je 4.2BSD. Total sectors je celková velikost disku. Toto je disk o velikosti 3
gigabyty. Tøi gigabyty je v termínech výrobce 3000 megabytù. Tak¾e vydìlte
6185088/3000 (pou¾ijte bc(1)). Dostanete 2061. Tak¾e abyste vytvoøili velikost
diskosti diskových oddílù pro a, d, e, f, g, ... jednodu¹e vynásobte X*2061
abyste dostali X megabytù místa na daném diskovém oddílu. Ofset pro vá¹ první
diskoý oddíl bude ten samý jako "sectors/track" vypsaný ve výstupu disklabelu
vý¹e. Pro nás je to 63. Ofset pro ka¾dý dal¹í diskový oddíl by mìl být
kombinace velikosti ka¾dého diskového oddílu a ofsetu ka¾dého diskového
oddílu. (Kromì diskového oddílu C, ten v této rovnici nehraje ¾ádnou roli.)
<P>
Jiná mo¾nost je ta, ¾e budete chtít jeden diskové oddíl na disku, øeknìme ¾e
budete pou¾ívat celý disk pro web nebo jako adresáø home nebo tak nìco, pak
vezmìte celkovou velikost disku a odeètìte od ní poèet sektorù na stopu.
6185088-63 = 6185025.  Vá¹ diskový oddíl je
<UL><PRE>
    d:  6185025       63    4.2BSD     1024  8192    16 
</PRE></UL>
<P>
<b>
Pokud se vám toto v¹e zdá zbyteènì slo¾ité, mù¾ete pou¾ít disklabel -E abyste
dostali ten samý mód diskového oddílu, který jste dostali na instalaèním
disku!</b> Mù¾ete zadat "96M" abyste øekli "96 megabytù". (Nebo pokud máte tak
velký disk, tak 96G pro 96 giga!) Nane¹tìstí mód -E pou¾ívá diskovou geonetrii
z BIOSu a ne tu reálnou a èasto se tyto dvì li¹í. Abyste toto omezení obe¹li,
napi¹te 'g d' pro 'geometry disk'. (Jiné mo¾nosti jsou  'g b' pro 'geometry
bios' a 'g u' pro geometry user, nebo jednodu¹e pro to, co label øíkal pøedtím
ne¾ disklabel ulo¾il zmìny.)
<P>
To je docela dost, ale je¹tì nejsme u konce. Nakonec budete potøebovat
vytvoøit filesystem na disku tím, ¾e pou¾ijete
<a href=
"http://www.openbsd.org/cgi-bin/man.cgi?query=newfs
&apropos=0&sektion=8&format=html">newfs(8)</a>.
</p>

<p>
<ul><pre>
bsd# <strong>newfs wd1a </strong></pre></ul>
</p>

<p>
Podle toho jak byl vá¹ disk pojmenován v rámci schematu OpenBSD. (Podívejte se
na výstup z dmesg(1) abyste vidìli jak byl vá¹ disk pojmenován.)
</p>

<p>
Ted zjistìte kam budete tento právì vytvoøený diskový oddíl montovat. Øeknìme,
¾e ho budete chtít montovat pod /u. Nejprve vytvoøte adresáø /u. Pak jej
namontujte.
</p>

<UL><PRE>
mount /dev/wd1a /u
</PRE></UL>

<P>
Nakonec ho pøidejte do /etc/fstab
</p>
<UL><PRE>/dev/wd1a /u ffs rw 1 1</PRE></UL>

<p>
Co kdy¾ budete pøemístit ji¾ existující adresáø jako napø. /usr/local? Mìli
byste namontovat nový disk do /mnt a pak pou¾ít cpio -pdum abyste nakopírovali
/usr/local do adresáøe v /mnt. Zeditujte soubor /etc/fstab aby ukazoval, ¾e
diskový oddíl s /usr/local je teï /dev/wd1a (vá¹ novì naformátovaný diskový
oddíl.)
Pøíklad:
</p>

<ul>
<strong>/dev/wd1a /usr/local ffs rw 1 1</strong>
</ul>

<p>
Rebootujte do single módu..<strong>boot -s</strong> Pøemístìte existující
/usr/local do /usr/local-backup (nebo ho sma¾te, jestli se na to cítíte) a
vytvoøte prázdný adresáø /usr/local. Pak rebootujte systém a voila!! soubory
jsou tam!
</p>

<br>

<p>
<a name="14.4"></a>
<h2>14.4 - Jak swapovat do souboru</h2>
</p>

<p>
(Poznámka: jestli¾e chcete swapovat do souboru proto, ¾e dostáváte hlá¹ky jako
&quot;virtual memory exhausted&quot; mìli byste nejdøíve zkusit zvý¹it limity
na proces pomocí 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=unlimit&sektion=1&format=html">unlimit(1)</a>
v csh,
nebo
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ulimit&sektion=1&format=html">ulimit(1)</a>
v sh.)
</p>

<p>
Po vydání OpenBSD 2.5  pøi¹lo
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html">swapctl(8)</a>,
co¾ pøineslo zpùsob jak nakládat se swap zaøízeními je¹tì jednou¹eji. Pokud
pou¾íváte systém OpenBSD 2.5, vymìòte swapctl za swapon a pou¾ijte pstat -s k
vylistování zaøízení pro swap. Swapování do souboru nevy¾aduje kernel se
zvlá¹tní konfigurací, aèkoliv to klidnì mù¾ete udìlat, tento faq vám uká¾e jak
to udìlat obìma zpùsoby.
</p>

<h3>Swapování do souboru.</h3>

<p>
Swapování do souboru je nejjedodu¹¹í a nejrychlej¹í cesta jak dostat dal¹í
prostor pro swap. To neplatí pro u¾ivatele, kteøí pou¾ívají Softupdates. (Není
nastaveno jako default).
Abyste mohli zaèít, podívejte se kolik swapu v souèasné chvíli pou¾íváte, tím
¾e se podíváte pomocí utility
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=swapctl&sektion=8&format=html">swapctl(8)</a>
To mù¾ete udìlat tak, ¾e spustíte:
</p>

<ul><pre>
ericj@oshibana&gt; <strong>swapctl -l</strong>
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
</pre></ul>

<p>
To ukazuje zaøízení a jejich statistiky které jsou aktuálnì pou¾ívány pro
swapování. V pøíkladu uvedeném vý¹e existuje pouze jedno zaøízení pojmenováné
&quot;swap_device&quot;.&quot;swap_device&quot;. To je pøeddefinovaná oblast
na disku která je pou¾ita pro swapování. (Ukazuje se jako dikový oddíl b kdy¾
si prohlí¾íte disklabely). Jak mù¾ete v pøíkladu dále vidìt, toto zaøízení e v
souèasné dobì moc nepou¾ívá. Ale pro úèely tohoto dokumentu budeme dìlat, ¾e
potøebujeme dal¹ích 32M.
</p>
<p>
První krok jak nastavit soubor jako swapovací zaøízení je vytvoøení souboru.
To je nejlep¹í udìlat pomocí utility
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dd&sektion=1&format=html">dd(1)</a>
Tady je pøíklad vytvoøení souboru <i>/var/swap</i> který má velikost 32M.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>sudo dd if=/dev/zero of=/var/swap bs=1k count=32768</strong>
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)
</pre></ul>

<p>
Jakmile je toto hotovo, mù¾eme zapnout swapování do tohoto zaøízení. Pou¾ijte
následující pøíkaz k tomu abyste zapnuli swapování na toto zaøízení.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>sudo chmod 600 /var/swap</strong>
ericj@oshibana&gt; <strong>sudo swapctl -a /var/swap</strong>
</ul></pre>

<p>
Teï budeme potøebovat zjistit, jestli bylo korektnì pøidáno do seznamu
zaøízení pro swap.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>swapctl -l</strong>
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/var/swap        65536        0    65536     0%    0
Total           131056        8   131048     0%
</pre></ul>

<p>
Teï kdy¾ jste nastavili a zapnuli swapování do souboru, budete potøebovat
pøidat øádku do va¹eho souboru <i>/etc/fstab</i> aby se konfigurace provedla
pøi ka¾dém bootu. Pokud tuto øádku nepøidáte, nebude zaøízení zkonfigurováno.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>cat /etc/fstab</strong>
/dev/wd0a / ffs rw 1 1
/var/swap /var/swap swap sw 0 0
</ul></pre>

<h3>Swapování pomocí zaøízení vnode</h3>

<p>
Toto je více dlouhodobé øe¹ení jak pøidat více prostoru pro swap. Abyste
swapovali do souboru trvale, nejdøíve vytvoøte kernel s vnd0c jako swap. Pokud
máte wd0a jako root filesystem, wd0b je pøedchozí swap, pou¾ijte tento øádek
ve va¹em souboru s konfigurací jádra (souvisí s kompilaci jádra): 
</p>

<ul><pre>
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b
</pre></ul>

<p>
Jakmile je toto hotovo, budete potøebovat vytvoøit soubor, který bude pou¾íván
ke swapování. Mìli byste to udìlat pomocí toto samého pøíkazu uvedeného v
pøíkladech vý¹e.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>sudo dd if=/dev/zero of=/var/swap bs=1k count=32768</strong>
32768+0 records in
32768+0 records out
33554432 bytes transferred in 20 secs (1677721 bytes/sec)
</pre></ul>

<p>
Teï je vá¹ soubor na místì, budete potøebovat pøidat tento soubor do
<i>/etc/fstab</i>. Zde je pøíklad jak nabootovat s tímto zaøízení jako
swapovacím.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>cat /etc/fstab</strong>
/dev/wd0a / ffs rw 1 1
/dev/vnd0c none swap sw 0 0 
</pre></ul>

<p>
V tomto bodì budete muset rebootovat vá¹ poèítaè aby se projevily zmìny v
jádøe. Jakmile je to hotovo, je èas nakonfigurovat toto zaøízení jako
swapovací. Abyste to udìlali, pou¾ijte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&sektion=8&format=html">vnconfig(8)</a>.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>sudo vnconfig -c -v vnd0 /var/swap</strong>
vnd0: 33554432 bytes on /var/swap
</pre></ul>

<p>
Posledním krok je zapnutí  swapování do tohoto zaøízení. Udìláme to stejnì
jako v pøíkladech uvedených vý¹e, pou¾ijeme k tomu  swapctl(8). Pak zjistíme
jestli bylo korektnì pøidáno do na¹eho listu swapovacích zaøízení.
</p>

<ul><pre>
ericj@oshibana&gt; <strong>sudo swapctl -a /dev/vnd0c</strong>
ericj@oshibana&gt; <strong>swapctl -l</strong>
Device      512-blocks     Used    Avail Capacity  Priority
swap_device      65520        8    65512     0%    0
/dev/vnd0c       65536        0    65536     0%    0
Total           131056        8   131048     0%
</pre></ul>



<p><a name="14.5"></a>
<h2>14.5 - Soft-updaty</h2>
</p>

<p>
Posledních pár let pracoval Kirk McKusick na nìèem nazývaném "soft updaty".
Celé je to zalo¾eno na idei navrhované Greg Gangerem a Yale Pattem kterøí
navrhli èásteèné uspoøádání operací v buffer cache které by dovolily
odstranìní po¾adavkù na synchronní zapisování adresáøovách polo¾ek z kódu FFS.
Tím se rapidnì zvý¹í rychlost zápisu na disk.
</p>

<p>
Pro pou¾ívání Softupdates potøebujete mít jádro zkompilované s volbou
</p>

<p>
<strong>FFS_SOFTUPDATES</strong>
</p>

<p>
Tato volba se nachází v jádrech GENERIC poèínaje OpenBSD 2.9. Finálnì v¹ak je¹tì musíte
soft updates zapnout na jednotlivých diskových oddílech.

</p>

<p>
Poèínaje OpenBSD 2.9 mù¾ete provést zapnutí soft updates volbou pøíkazu mount, namísto
pou¾ití <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tunefs&sektion=8">tunefs(8)</a>.
Dnes ji¾ mù¾ete specifikovat pøi pøipojení jednotlivého diskového oddílu pomocí pøíkazu
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&sektion=8">mount(8)</a> specifikovat,
zda mají být na tomto oddílu soft updates zapnuty nebo vypnuty. Následuje ukázka èásti souboru  <i>/etc/fstab</i>,
kde chceme oddíl <i>sd0a</i> pøipojit se zapnutými soft updates.
</p>
<ul><pre>
/dev/sd0a / ffs rw,softdep 1 1
</pre></ul>
<p>
Pokud pou¾íváte OpenBSD verzi men¹í ne¾ 2.9, musíte nabootovat do single-módu:
</p>

<ul>
<pre>
        boot> boot -s
        [snip]
        bsd# tunefs -s enable &lt;raw device&gt;
        bsd# reboot -n
</pre>
</ul>

<p>
Poznámka pro u¾ivatele na platformì sparc. Nezapínejte softupdates na strojích sun4 nebo sun4k. Tyto architektury
podporují pouze omezené mno¾ství pamìti jádra a nemohou pou¾ívat tuto volbu. Stroje sun4m tímto omezením netrpí.
</p>


<p>
<a name="14.6"></a>
<h2>14.6 -  Kdy¾ nabootuji po instalaci OpenBSD/i386, zastaví se na
"Using partition 3 id 0".</h2>
</p>
<p>
To znamená, ¾e vá¹ MBR (Master Boot Record) nebyl nainstalován správnì nebo ¾e
nastavení geometri disku v BIOSu neodpovídá nastavení ulo¾eném v MBR.
Abyste to vyøe¹ili, zkuste nejdøíve reinstalovat boot bloky OpenBSD. To
udìláte pomocí 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&sektion=8&arch=i386&format=html">fdisk(8)</a> a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=installboot&sektion=8&arch=i386&format=html">installboot(8)</a>.
<P>
Nejdøíve abyste toto zprovoznili, budete potøebovat pou¾ít vá¹ disk jako
bootstrap. Po vlo¾ení instalaèního disku a pøedtím ne¾ se nahraje kernel a
ramdisk, dostanete 
<tt>boot&gt;</tt> prompt z floppy disku.  Pou¾ijte jej abyste nabootovali
OpenBSD z va¹eho disku. 
<UL><PRE>
booting...
OpenBSD boot 1.2.3
probing hd0 fd0...
boot&gt; <b>boot hd0a:/bsd</b>
</UL></PRE>
Teï kdy¾ jste nabootvali, pøedpokládejme, ¾e jste vyhradili celoý disk pro
OpenBSD, reinicializujte Master Boot Record pomocí fdisk(8)u. (Pokud pou¾íváte
nìjaké dal¹í diskové oddíly na va¹em disku pro jiné operaèní systémy, nemù¾ete
pou¾ít <tt>installboot</tt>, musíte se podívat na jinou volbu jako napø.
OS-BS, jak je popsáno dále.)
<UL><PRE>
# <b>fdisk -i wd0</b>
</PRE></UL>
Teï budete potøebovat znovu zapsat boot bloky.
<UL><PRE>
# <strong>cp /usr/mdec/boot /boot</strong>
# <strong>/usr/mdec/installboot -v /boot /usr/mdec/biosboot wd0</strong>
</PRE></UL>
Nakonec rebootujte a otestujte to.
<p>
Pokud to nepracuje, poøád máte je¹tì nìkolik mo¾ností. První mo¾nost je pou¾ít
bootloader jako napø. BS-OS. Ten je zahrnut na instalaèním CD v adresáøi
tools. Pokud jste nezakoupili instalaèní CD-ROM, mù¾ete si stáhnout os-bs z
nìkterého OpenBSD ftp serverù. Soubor, který potøebuje je
<tt>pub/OpenBSD/2.8/tools/osbs135.exe</tt>
</p>

<p>
Dále si pøeètìte stránky na 
<a href= "http://www.prz.tu-berlin.de/~wolf/os-bs.html">
          http://www.prz.tu-berlin.de/~wolf/os-bs.html</a>
</p>

<p>
Existují také dal¹í komerèní bootloadery nebo lilo, které mù¾ete také pro
pou¾ít pro 
multi-booting.
</p>

<p>
Zde je jednoduchý návod jak nainstalovat lilo na vá¹ systém.
</p>

<p>
<ul>
<li>Nabootojte DOSovou disketu a spus»te fdisk /MBR. Ujistìte se, ¾e to dìláte
na disku, z kterého budete bootovat.
</li>
<li>Nabootojte z linuxového disku a nainstalujte LILO &amp; sva¾te to s va¹ík
OpenBSD
boot blokem.</li>
</ul>
</p>

<p>
Dal¹í intrukce si mù¾ete pøeèíst v
<a href="ftp://ftp.openbsd.org/pub/OpenBSD/2.8/i386/INSTALL.linux">INSTALL.linux</a>
</p>

<br>

<p>
<a name="14.7"></a>
<h2>14.7 - Jak dostanu dmesg z bootovací diskety?</h2>
</p>
<p>
RAMDISK images (bootovací diskety) neobsahují utilitu <i>dmesg</i>. Nicménì
mají namontovaný filesystém <code>/kern</code>. Abyste zkopírovali informaci
dmesg do souboru, udìlejte:
</p>

<ul><pre>
# <strong>cat /kern/msgbuf >mydmesg</strong>
</pre></ul>
<P>
Bootovací diskety dále mají 'more' abyste mohli stránkovat výstup:
<pre><ul>
# <strong>more /kern/msgbuf</strong>
</ul></pre>

Podívejte se do <a href= "faq4.html#4.5">sekce 4.5</a>

<p>
<a name="14.8"></a>
<h2>14.8 - Instalace Bootblokù - pouze pro i386</h2>
</p>

<p>
Starèí verze MS-DOSu mohou pracovat pouze disky, které mají geometrii 1024
cylinderù nebo ménì. Proto¾e v¹echny nové disky mají více ne¾ 1024 cylindrù,
vìt¹ina SCSI BIOSù (které jsou na SCSI øadièi) a IDE BIOSù (které jsou èástí
BIOSU PC) mají volbu (nìkdy je defaultní) urèenou k "pøekladu" skuteèné
geometrie disku do neèeho co je v rámci mo¾ností MS-DOSu. Nicménì ne v¹echny
BIOSy provádìjí tento pøeklad stejnì. Pokud zmìníte vá¹ BIOS (buï s novou
základní deskou nebo SCSI BIOSem) a ten nový pou¾ívá rozdílný "pøeklad"
geometrie, nebudete schopni nahrát stage boot loader (tím pádem nebudete
schopni nahrát kernel). (To je proto, ¾e first stage boot loader obsahuje
seznam blokù které skládají /boot v rámci originální "pøelo¾ené" geometrie.)
Pokud pou¾íváte IDE disky, a provedete zmìny ve va¹em nastavení BIOSu, mù¾ete
nechtìnì) zmìnit také pøeklady (vìt¹ina IDE diskù nabízí 3 rùzné pøeklady.)
Abyste spravili váas boot block abyste mohli nabootovat normálnì, napi¹te "b
hd0a:/bsd", èím¾ vynutíte boot z prvního hard disku (a ne z floppy). Va¹e
ma¹ina by mìla nabìhnout normálnì. Teï budete potøebovat updatovat first stage
boot loader abyste vidìli novou geometrii (a znovu zapsat boot blok podle
toho).
<br>
Ná¹ pøíklad bude pøedpokládat ¾e boot disk je sd0 (ale pro IDE disky to bude
wd0, atd..):
</p>
<ul>
<pre>
# <strong>cd /usr/mdec; ./installboot /boot biosboot sd0</strong>
</pre>
</ul>
<p>
Pokud si installboot stì¾uje ¾e nemù¾e èíst geometrii BIOS, v boot&gt; promptu
mù¾ete zadat &quot;machine diskinfo&quot; (nebo krátce &quot;ma di&quot;) aby
se vytiskla po¾adovaná informace. Vyplòte hodnoty &quot;heads&quot; a
&quot;secs&quot; pomocí flagù -h a -s, repsektive modifikujte installboot
pøíkaz tak, aby vypadal následovnì:
</p>
<ul><pre>
#<strong> cd /usr/mdec; ./installboot -h &lt;heads&gt; -s &lt;secs&gt; /boot biosboot sd0</strong>
</pre></ul>

<p>
Pokud ne vy¾adovaná nová verze bootblockù, budete potøebovat zkompilovat tyto
sami. To udìláte jednodu¹e:
</p>

<ul><pre>
# <strong>cd /sys/arch/i386/stand/</strong>
# <strong>make && make install </strong>
# <strong>cd /usr/mdec; cp ./boot /boot</strong>
# <strong>./installboot /boot biosboot sd0</strong> (or whatever device your hard disk is)
</pre></ul>

<p>
<a name="14.9"></a>
<h2>14.9 - Pøíprava na katastrofu: Zálohování a obnova z pásky.</h2>
</p>

<h3>Úvod:</h3>

<p>
Pokdu plánujete provozovat nìco co se dá nazvat produkèní server, je rozumné
mít nìjakou formu zálohování v pøípadì, ¾e nìkterý z va¹ich pevných diskù
padne.
</p>

<p>
Tato informace vám pom¾e v pou¾ívání standartních utilit
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a>/<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>
dodávaných s OpenBSD. Lep¹í utilita nazvaná "Amanda" lze pou¾ít pro více
serverù sdíljících jednu páskovou jednotku. V vìt¹inì prostøedí je kombinace
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a>/<a
href=http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>
dostaèující. Nicménì jestli¾e potøebujete zálohovat více strojù na jednu
pásku, mù¾e stát výzkum Amandy za to.
</p>

<p>
Pøíklady pro zaøízení v tomto dokumentu jsou pro konfiguraci která zahrnuje
SCSI disky a pásku. V produèním prostøedí jsou SCSI disky doporuèovány kvùli
zpùsobù jakým zacházejí se ¹patnými bloky. Tím nechceme øíci, ¾e tyto
informace budou zbyteèné v pøípadì ¾e pou¾íáte IDE disky, jenom se situace
bude mírnì li¹it. Napøíklad sd0a by bylo v IDE systému wd0a.
</p>

<h3>Zálohování na pásku:</h3>

<p>
Zálohování na pásku vy¾aduje znalost místa, kde jsou namontovány filesystémy.
To mù¾ete zjistit pomocí pøíkazu "mount" v shellu. Mìli byste dostat výstup
podobný tomuto:
</p>

<ul><pre>
shell# <b>mount</b>
/dev/sd0a on / type ffs (local)
/dev/sd0h on /usr type ffs (local)  
</ul></pre>

<p>
V tomto pøíkladì je root (/) filesystem umístìn fyzicky na sd0a, co¾ indikuje
pevná disk SCSI 0, diskový oddíl a. Filesystém /usr je na sd0h, co¾ je pevný
disk SCSI 0, diskový oddíl h.
</p>

<p>
Dal¹í pøíklad více komplikované tabulky by mohl být:
</p>

<ul><pre>
shell# <b>mount</b>
/dev/sd0a on / type ffs (local)
/dev/sd0d on /var type ffs (local)
/dev/sd0e on /home type ffs (local)
/dev/sd0h on /usr type ffs (local)  
</ul></pre>

<p>
V tomto komplikovanìjèím pøíkladì je  root (/) filesystem fyzicky na sd0a.
Filesystém /var je na sd0d, /home je na sd0e a koneènì /usr je na sd0h.
</p>

<p>
Abyste zálohovali vá¹ stroj budete potøebovat dodat dumpu jméno ka¾dého
pevného diskového oddílu. Zde je pøíklad pøíkazù potøebných pro jednodu¹¹í
mount tabulku uvedenou vý¹e:
</p>

<ul><pre>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h</b>
# <b>mt -f /dev/rst0 rewind  </b>
</ul></pre>

<p>
Pro slo¾itìj¹í tabulku, byste pou¾ili n¹co jako:
</p>

<ul><pre>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0d</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0e</b>
# <b>/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h  </b>
# <b>mt -f /dev/rst0 rewind  </b>
</ul></pre>

<p>
Mù¾ete si pøeèíst manuálovou stránku abyste se dozvìdìli co pøesnì dìlá který
pøepínaè. Zde je krátký popis parametrù popsaných vý¹e:
</p>

ul>
<li><b>0</b> - Provede dump úrovnì 0, na v¹echno
<li><b>a</b> - Pokusí se automaticky zjistit délku páskového media
<li><b>u</b> - Updatne soubor /etc/dumpdates, který slou¾í k indikaci data
poslední zálohy
<li><b>f</b> - Které páskové zaøízení se má pou¾ít (v tomto pøípadì /dev/nrst0)
</ul>

<p>
Nakonec který¾ diskový oddíl chcete zálohovat (/dev/rsd0a, atd.)
</p>

<p>
Pøíkaz mt je pou¾it k pøetoèení pásky. Pøeètìte si manuálovou stránku abyste
se dozvìdìli více options. (jako napø. eject).
</p>

<p>
Pokud si nejste jistí jménem páskového zaøízení, pou¾ijte dmesg k tomu, abyste
jej lokalizovali. Pøíklad záznamu páskového zaøízení v dmesg by vypadal asi
takto:
</p>

<ul><pre>
st0 at scsibus0 targ 5 lun 0: &lt;ARCHIVE, Python 28388-XXX, 5.28&gt;
</ul></pre>

<p>
Mo¾ná jste zaznamenali, ¾e kdy¾ zálohujete je k páskovému zaøízení 
pøistupováno jako k "nrst0" namísto "st0", co¾ je jméno které je uvedeno v
dmesg. Kdy¾ pøistupujete k st0 jako k nrst0, pøistupujete k tomu samému
fyzickému zaøízení, ale øíkáte tím, aby se jednotka nepøevinula a¾ dojde na
konec a aby se k ní pøistupovalo v raw modu. Abyste zálohovali více systémù na
jednu pásku, ujistìte se, ¾e pou¾íváte non-rewind zaøízení, proto¾e kdybyste
pou¾ili rewind zaøízení (rst0) na zálohování více systémù, dopadlo by to tak,
¾e byste si pøepsali filesystém s dal¹ím dumpem na pásku. Pøíslu¹ný popis
rùzných rozhraní k páskovým zaøízením mù¾ete najít v manuálové stránce dumpu. 
</p>

<p>
Pkud jste chtìli napsat malý skript nazvaný "backup", mohl by vypadat nìjak
takto:
</p>

<ul><pre>
echo "  Startuji Plnou Zálohu..."
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0a
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0d
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0e
/sbin/dump -0au -f /dev/nrst0 /dev/rsd0h
echo
echo -n "  Pøetáèím pásku, èekejte prosím..."
mt -f /dev/rst0 rewind
echo "Hotovo."
echo                      
</ul></pre>

<p>
Pokud po¾adujete zálohy ka¾dou noc, pou¾ijte 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&sektion=8&format=html">cron(8)</a>
pro automatický start zálohovacího skriptu.
</p>

<p>
Dále vám mù¾e pomoci napsat si (na kus papíru) jak velké by mìly být
jednotlivé filesystémy. Mù¾ete pou¾ít df -h na zji¹tìní kolik místa zabírají
jednotlivé dikoé oddíly. To bude u¾iteèné kdy¾ disk spadne a vy budete
potøebovat znovuvytvoøit tabulku diskových oddílù na novém disku.
</p>

<p>
Znovuobnovení va¹ich dat vám pomù¾e zmen¹it fragmentaci. Abyste se ujistili,
¾e dostanete v¹echny soubory, nejlep¹í zpùsob jak zálohovat je rebootovat vás
sytem v single módu. File systémy nepotøebují být namontovány k tomu aby mohly
být zálohovány. Nezapomeòte namontovat root (/) r/w po rebootu v single modu
nebo vá¹ dump spadne kdy¾ se bude pokou¹et zapsat data dumpu. Napi¹te bsd -s v
boot> promptu abyste se dostali do single modu. 
</p>

<h3>Prohlí¾ení obsahu pásky:</h3>


<p>
Poté co jste zálohovali va¹e filesystémy poprvé, byl by dobrý nápad otestovat
va¹i pásku a ujistit se, ¾e na ní jsou data ve stavu v jakém jste oèekávali.
</p>

<p>
Mù¾ete pou¾ít následující pøíklad k tomu abyste si prohlédli seznam souborù na
pásce:
</p>

<ul><pre>
# <b>/sbin/restore -tvs 1 -f /dev/rst0</b>
</ul></pre>

<p>
To vylistuje seznam souborù které jsou na prvním diskovém oddílu pásky. S
informacemi uvedenými vý¹e mù¾eme øíct, ¾e 1 bude vá¹ root (/) file system.
</p>

<p>
Abyste si prohlédli co je ulo¾eno na druhém diskovém oddílu, pøesmìrujte
výstup do souboru, pou¾ijte nìco jako:
</p>

<ul><pre>
# <b>/sbin/restore -tvs 2 -f /dev/rst0 > /home/me/list.txt</b>
</ul></pre>

<p>
Pokud máte mount tabulku podobnou té v jednodu¹¹ím pøíkladu, 2ka by byla /usr,
pokud je va¹e slo¾itìj¹í, tak 2ka by mohla být /var nebo jiný fs. Sekvenèní
èílo se shoduje s poøadím vkterém jsou file systémy azapisovány na pásku.  
</p>


<h3>Obnova z pásky:</h3>

<p>
Pøíklad scénáøe vypsaného dále by mohl být u¾iteèný pokud vám spadl disk
kompletnì. V pøípadì ¾e budete chtít obnovit pouze jeden soubor, podívejte se
na manuálovou stránku a vìnujte pozor instrukcím pro interaktvní mod. 
</p>

<p>
Pokud jste se poøádnì pøipravili, výmìna disku a obnova dat bude velmi rychlý
proces. Standartní instalèní/bootovací disketa s OpenBSD u¾ obsahuje
po¾adovanou utilitu restore stejnì jako binárky nutné k tomu abyste udìlali
nový disk bootovatelný. Ve vìt¹ine pøípadù jsou tato disketa a páska se
zálohou v¹e co potøebujete abyste obnovili data a znovu se rozjeli.
</p>

<p>
Jakmile jste fyzicky vymìnili disk, základní kroky jak obnovit va¹e data by
byly:
</p>

<ul>
<li>
<p>
Nabootujte OpenBSD instalaèní/bootovací disketu. V selekci menu zvolte Shell.
Ochraòte disketu proti zápisu a vlo¾te va¹i poslední pásku se zálohou do
jednotky.
<br>
</p>

<li>
<p>
Pou¾ijte pøíkaz <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&sektion=8&arch=i386&format=html">fdisk(8)</a>,
vytvoøte priární diskovou oblast pro OpenBSD na tomto novì nainstalovaném
disku. Pøíklad:
</p>

<ul><pre>
shell# <b>fdisk -e sd0</b>
</ul></pre>

<p>
Více informací je v <a href="#14.2">fdisk FAQ</a>.
</p>

<li>
<p>  
Pou¾ijte pøíkaz disklabel, vytvoøte znovu tabulku va¹ch diskových oddílù pro
OpenBSD, kterou jste právì vytvoøili fdiskem. Pøíklad:
</p>

<ul><pre>
shell# <b>disklabel -E sd0</b>
</ul></pre>

<p>
(Nezapomeòte na swap, pøeètìte si <a href="#14.1">disklabel FAQ</a>)
</p>

<li>
<p>
Pu¾ijte pøíkaz newfs pro vytvoøení èistého filesystémy na ka¾dém diskovém
oddílu který jste vytvoøili v pøedchozím kroku. Pøíklad:
</p>

<ul><pre>
shell# <b>newfs /dev/rsd0a</b>
shell# <b>newfs /dev/rsd0h</b>
</ul></pre>

<li>
<p>
Namontujte vá¹ novì pøipravený root (/) file system do /mnt. Pøíklad:
</p>

<ul><pre>
shell# <b>mount /dev/sd0a /mnt</b>
</ul></pre>

<li>
<p>

Pøesuòte se do toho namontovaného file systemu a zaènìte restore proces.
Pøíklad:
</p>

<ul><pre>
shell# <b>cd /mnt</b>
shell# <b>restore -rs 1 -f /dev/rst0</b>
</ul></pre>

<li>
<p>
Budete chtít aby vás disk byl bootovatelný, pou¾ijte následující k tomu,
abyste zapsali nový MBR na disk. Pøíklad:
</p>

<ul><pre>
shell# <b>fdisk -i sd0</b>
</ul></pre>

<li>
<p>
Dále budete potøebovat instalovat nové boot bloky k tomu, abyste mohli z
tohoto MBR nabootovat. Následující krátký pøíklad to provede:
</p>

<ul><pre>
shell# <b>cp /usr/mdec/boot /mnt/boot</b>
shell# <b>/usr/mdec/installboot -v /mnt/boot /usr/mdec/biosboot sd0</b>
</ul></pre>

<li>
<p>
Vá¹ nový root file system na pevném disku by mìl být dostateènì pøipraven na
to, abyste z nìj mohli nabootovat a pokraèovat v obnovì zbytku va¹ich file
systémù. Proto¾e operaèní systém není je¹tì kompletní, ujistìte se, ¾e zpátky
nabootujete v single módu. V promto zadejte následující pøíkazy k tomu abyste
odmontovali a haltovali systém:
</p>

<ul><pre>
shell# <b>umount /mnt</b>
shell# <b>halt</b>
</ul></pre>

<li>
<p>
Vyndejte instalaèní/bootovací disketu z drajvu a rebootujte vás systém. V
boot&gt; promptu OpenBSD zadejte následující pøíkaz:
</p>

<ul><pre>
boot&gt; <b>bsd -s</b>
</ul></pre>

<p>
bsd -s nastartuje systém v single módu, co¾ vy¾aduje pouze root (/) file
system.
</p>

<li>
<p>
Pøedpokládejme, ¾e jste provedli v¹echny kroky uvedené vý¹e správnì a nestalo
se nic ¹patnì, tj. ¾e jste dostali prompt s tím abyste zadali cestu k shellu a
zadali return. Zadejte return a dostanete se do shellu. Dále budete chtít
remountovat root v r/w modu, to udìláte následujícím pøíkazem:
</p>

<ul><pre>
shell# <b>mount -u -w /</b>
</ul></pre>

<li>
<p>
Jakmile jste remountovali v r/w módu, mù¾e pokraèovat s obnovou va¹ich
filesystémù. Pøíklad:
</p>

<ul><pre>
(jednoduchá mount table)
shell# <b>mount /dev/sd0h /usr; cd /usr; restore -rs 2 -f /dev/rst0</b>

(slo¾itìj¹í mount table)
shell#	<b>mount /dev/sd0d /var; cd /var; restore -rs 2 -f /dev/rst0</b>
shell#	<b>mount /dev/sd0e /home; cd /home; restore -rs 3 -f /dev/rst0</b>
shell#	<b>mount /dev/sd0h /usr; cd /usr; restore -rs 4 -f /dev/rst0</b>
</ul></pre>

<p>
mohli byste pou¾ít "<b>restore rvsf</b>" namísto pouhého rsf k tomu, abyste
vidìli obnovování objektù z dumpu. 
</p>

<li>
<p>
Nakonec poté co jste dokonèili obnovu v¹ech filesystémù na disk, rebotojte do
multiuser módu. Pokud ¹lo v¹echno tak jak jste plánovali, bude vá¹ systém
zpátky ve stavu v jakém byla provedena poslední záloha a bude pøipraven k
dal¹ímu pou¾ití.
</p>
</ul>

<p>
<a name=14.10></a>
<h2>14.10 - Mountování disk images v OpenBSD</h2>
</p>

<p>
Abyste namontovali v OpenBSD disk image (ISO images, diskové images vytvoøené pomocí dd,
atd.) musíte konfigurovat zaøízení
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnd&sektion=4">vnd(4)</a>.
Na pøíklad pokud máte ISO image v <i>/tmp/ISO.image</i>, následující kroky vám
tento image namontují.
</p>

<ul>
<table border=0 width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<pre>
# <strong>vnconfig svnd0 /tmp/ISO.image</strong>
# <strong>mount -t cd9660 /dev/svnd0c /mnt</strong>
</pre>
                </td>
        </tr>
</table>
</ul>

<p>
V¹imnìte si, ¾e toto je CD image, tak¾e pøi montování musíte specifikovat typ
<i>cd9660</i>. To platí nezávisle na typu, napøíklad musíte zadat typ ffs
pokud montujete diskové images.
</p>

<p>
K tomu abyste odmontovali image, pou¾ijte následující príkazy:
</p>

<ul>
<table border=0 width="800">
        <tr>
                <td nowrap bgcolor="#EEEEEE">
<pre>
# <strong>umount /mnt</strong>
# <strong>vnconfig -u svnd0</strong>
</pre>
                </td>
        </tr>
</table>
</ul>

<p>
Více informací naleznete v manuálové stránce
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnconfig&sektion=8">vnconfig(8)</a>.
</p>


<p>
<a name=14.11></a>
<h2>14.11 - Pomoc! Dostávám chyby s PCIIDE!</h2>
</p>


<p>
PCI IDE DMA je nespolehlivá, to je také dùvod proè ji Microsoft vypíná na svých operaèních
systémech, které prodává.
</p>

<p>
OpenBSD je agresivní a poukou¹í se pou¾ít nejvy¹¹í DMA mód, který mù¾e konfigurovat.
Tímto ale dochází k naru¹ení pøenosù dat u nìkterých nastavení, kvùli chybovému chipsetu
zakládní desky, chybovým driverùm a/nebo ¹umu na kabelu. Na¹tìstí Ultra-DMA mód pøidává k
datùm CRC pro detekci tìchto naru¹ení. Pokud Ultra-DMA CRC je chybná, OpenBSD vypí¹e chybovou
hlá¹ku a zkou¹í transfer provést je¹tì jednou.
</p>
<ul><pre>
wd2a:  aborted command, interface CRC error reading fsbn 64 of 64-79 (wd2 bn 127; cn 0 tn 2 sn 1), retrying
</pre></ul>

<p>
Po nìkolikerém selhání  OpenBSD sní¾í konfiguraci na pomalej¹í (doufejme, ¾e spolehlivìj¹í) Ultra-DMA mód.
Pokud je dosa¾eno Ultra-DMA módu 0, øadiè disku downgraduje na PIO mód.
</p>

<p>
Pokud va¹e OpenBSD úspì¹nì nedowngraduje konfiguraci pøenosového módu nebo tento proces zpùsobí, ¾e stroj
natvrdo zatuhne, napi¹te prosím <a href="../../cs/report.html">zprávu o chybì</a>.
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Zpìt na Hlavní Index]</a>
<a href= "faq13.html">[Na Sekci 13.0 - IPsec]</a>
</font>
</p>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[zpìt]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq14.html,v 1.45 ]
<br>
$Translation: faq14.html,v 1.3 2001/08/29 12:57:59 certik Exp $
<br>
$OpenBSD: faq14.html,v 1.3 2001/08/29 17:58:44 jufi Exp $
</small>

</body>
</html>
