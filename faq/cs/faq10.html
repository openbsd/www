<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>10.0 - System Management</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>10.0 - System Management</font><hr></h2>
</p>

<p>
<ul><h3>Obsah</h3>
<li><a href="#wheel">10.1 - Pøíkaz 'su root' hlásí, ¾e jsem ve ¹patné skupinì</a>
<li><a href="#DupFS">10.2 - Jak zálohovat filesystem?</a>
<li><a href="#rc">10.3 - Jak spustit démona spolu se systémem? (pøehled rc(8))</a>
<li><a href="#RelayingDenied">10.4 - Proè dostanu hlá¹ku relaying
	access denied  pøi posílání mailu pøes OpenBSD systém?</a>
<li><a href="#POP">10.5 - Nastavil jsem POP, ale dostávám chybová
	hlá¹ení pøi získávání mailu pøes POP. Co dìlat?</a>
<li><a href="#HTTPS">10.6 - Proè Sendmail ignoruje /etc/hosts?</a>
<li><a href="#HTTPS">10.7 - Nastavení Secure HTTP Serveru pou¾itím SSL(8)</a>
<li><a href="#vipw">10.8 - Zmìnil jsem /etc/passwd  pomoci vi(1), ale
	vypadá to, ¾e se nic nezmìnilo. Proè?</a>
<li><a href="#AddDelUser">10.9 - Jak pøidat/smazat u¾ivatele?</a>
<li><a href="#FTPOnly">10.10 - Jak vytvoøit ftp-only úèet?</a>
<li><a href="#Quotas">10.11 - Nastavení diskových kvót</a>
<li><a href="#Kerberos">10.12 - Nastavení Kerberos klient/server</a>
<li><a href="#AnonFTP">10.13 - Nastavení anonymního FTP Serveru</a>
<li><a href="#ftpchroot">10.14 - Omezení u¾ivatele na jeho domovský adresáø v fptd(8)</a>
<li><a href="#Patches">10.15 - Aplikování patchù v OpenBSD.</a>
</ul>
</p>
<hr>

<br>

<p>
<a name= "wheel"></a>
<h2>10.1 - Proè to hlásí, ¾e jsem ve ¹patné skupinì, kdy¾ dám su root?</h2>
</p>

<p>
U¾ivatel musí být dopsán ruènì do skupiny  <kbd>&quot;wheel&quot;</kbd>.
Je to pøedev¹ím z bezpeènostních dùvodù a mìli byste být opatrní v
otázce, koho do této skupiny dopí¹ete. U¾ivatelé, kteøí jsou na OpenBSD
ve skupinì <kbd>wheel</kbd> mohou pou¾ívat pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html">su(1)</a>
k tomu, aby se stali superu¾ivatelem. U¾ivatelé, kteøí nejsou v této
skupinì nemohou pou¾ít su(1). 
Pøíklad odpovídajícího øádku z <kbd>/etc/group</kbd> , kde je u¾ivatel
<strong>ericj</strong> ve skupinì <kbd>&quot;wheel&quot;</kbd>.

<p>
Pokud pøidáváte nového u¾ivatele pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html">adduser(8)</a>,
mù¾ete ho doplnit do skupiny wheel tak, ¾e na dotaz <tt>Invite
<i>user</i> into other groups:</tt> odpovíte wheel.
</p>

<ul>
<pre>
wheel:*:0:root,ericj
</pre>
</ul>

<p>
Jiný zpùsob , jak dát u¾ivatelùm omezený pøístup k superu¾ivatelovým
privilegiim, bez pøipsání do /etc/group je pou¾ití pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html">sudo(8)</a>.
</p>

<p>
<a name= "DupFS"></a>
<h2>10.2 - Jak zálohovat filesystém?</h2>
</p>

<p>
Pro zálohování pou¾ijte 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a>
a pro obnovení
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>.
Kombinací obou tìchto pøíkazù mù¾ete provádìt duplikování adresáøové
hierarchie. Napø. chcete-li duplikovat v¹e pod adresáøem <kbd>SRC</kbd>
do adresáøe <kbd>DST</kbd> zadejte: </p>

<ul>
<pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre>
</ul>
<p>
dump dává mnoho mo¾ností jak zálohovat a mù¾e být zbyteèné pou¾ít tento
silný pøíkaz, pokud chcete duplikovat jenom èást filesystému.
Pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html">tar(1)</a>
bývá pro tyto operace výhodnìj¹í. Formát je velmi podobný:
<ul>
<pre>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</pre>
</ul>
<br>

<p>
<a name= "rc"></a>
<a name="10.3"></a>
<h2>10.3 - Jak spustit démona spolu se systémem? ( Pøehled rc(8))</h2>
</p>

<p>
OpenBSD pou¾ívá narozdíl od napø. linuxu startovací skripty ve stylu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">rc(8)</a> .
Tento pøístup pou¾ívá jen nìkolik klíèových souborù.
</p>

<ul>
    <li>/etc/rc - Hlavní skript. Nemìl by být editován.
    <li>/etc/rc.conf - Konfiguraèní skirpt pou¾ívaný <i>/etc/rc</i> pro
      získání informací o tom, které démony nastartovat.
    <li>/etc/netstart - Skript pro inicializaci sítì. Nemìl by se editovat.
    <li>/etc/rc.local - Skript pou¾ívaný pro lokální administraci.
      Obsahuje lokálnì specifické informace.
    <li>/etc/rc.securelevel - Skript spou¹tìjící pøíkazy pøed zmìnou
      security levelu. 
      Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a>
    <li>/etc/rc.shutdown - Skript spou¹tìný pøi shutdownu. Sem umístìte
      v¹e co uznáte za vhodné k provedení pøi ukonèení systému.
      Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html">rc.shutdown(8)</a>
</ul>

<h3>Jak pracuje rc(8) ?</h3>
<p>
Hlavní soubory pro administrátora jsou  <i>/etc/rc.conf</i>,
<i>/etc/rc.local</i> a <i>/etc/rc.shutdown</i>. Prùbìh procedury  rc(8)
je následující:
</p>

<ul>Po nabootování jádra se startuje <i>/etc/rc</i>.
    <li>Kontrola filesystému. Je pøeskoèeno, pokud exituje soubor
      /etc/fastboot , co¾ není ale obecnì dobrý nápad.
    <li>Konfiguraèní promìnné se naèítají z <i>/etc/rc.conf</i>
    <li>Filesystémy jsou pøipojeny
    <li>Je smazáno <i>/tmp</i> a uchovají se v¹echny soubory od editorù
    <li>Konfigurace sítì pomocí <i>/etc/netstart</i>
        <ul>
        <li>Nastavení sí»ových rozhraní.
        <li>Nastavení hostname, domainname, atd.
        </ul>
    <li>Start systémových démonù
    <li>Rùzné kontroly. (quoty, savecore, atd.)
    <li>Spou¹tìjí se lokální démoni z <i>/etc/rc.local</i>
</ul>

<h3>Startování démonù a slu¾eb, které pøicházejí spolu s OpenBSD</h3>

<p>
Vìt¹ina démonù a slu¾eb, které pøicházejí pùvodnì s OpenBSD se startuje
pøi bootu po editování souboru <i>/etc/rc.conf</i> . Nejprve se
podívejte na standardní
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">/etc/rc.conf</a>.
Vidíte øádky jako tento:
</p>

<ul><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>
Tento øádek øíká, ¾e ftpd nebude startovat pøi bootu. (pøinejmen¹ím ne z
rc(8), pøeètìte si <a href="faq10.html#AnonFTP">Anonymous FTP FAQ</a> o
ftpd). Pro ka¾dý pøípad má ka¾dý øádek také komentáø spolu s volbami
pro <b>NORMALNÍ</b> pou¾ití démona nebo slu¾by. To neznamená, ¾e musíte
spou¹tìt démona s tìmito volbami. Pou¾ijte man(1) a zjistíte jaké volby
pro tu kterou slu¾bu pou¾ít, aby splòovala dané po¾adavky. Napø. pùvodní
øádka pro httpd(8).
</p>

<ul><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></ul>
<p>
Jak vidíte, obvykle pøi startu httpd nepotøebujete ¾ádné dal¹í volby.
Proto je øádek &quot;<b> httpd_flags=""</b>&quot; v podstatì zbyteèný.
Ale jakmile budete chtít httpd s ssl podporou (více viz.
<a href="#HTTPS">SSL FAQ</a> nebo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>),
pak budete muset doplnit volbu  &quot;httpd_flags="-DSSL"&quot;.
</p>

<h3>Spou¹tìní lokálních démonù a konfigurace</h3>

<p>
Pro démony, které pøiinstalujete do systému pomocí portù nebo jiným
zpùsobem pou¾ijte soubor <i>/etc/rc.local</i>. Napø. jste nainstalovali
démona, který se nachází v  /usr/local/sbin/daemonx, a chcete ho pou¹tìt
pøi bootu. Pøidejte do souboru  <i>/etc/rc.local</i> øádek:
</p>

<ul><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></ul>

<p>
Od této chvíle bude démon pou¹tìn pøi startu. Rovnì¾ uvidíte v¹echny
chybová hlá¹ení, které démon vyrobí. Normální start bez chyb bude
vypadat takto:
</p>

<ul><pre>
Starting local daemons: daemonx.
</pre></ul>

<h3>rc.shutdown</h3>

<p>
<i>/etc/rc.shutdown</i> je skript pou¹tìný pøi ukonèení systému. Pokud
máte apm, mù¾ete nastavit &quot;powerdown=YES&quot;. Dostanete
ekvivalent &quot;shutdown -p&quot;.  </p>

<p>
<a name= "RelayingDenied"></a>
<a name="10.4"></a>
<h2>10.4 - Proè dostanou u¾ivatelé posílající pøes OpenBSD zvenku emaily
hlá¹ku relaying access denied?</h2>
</p>

<p>
Zkuste dát:
</p>
<ul>
<pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre>
</ul>
<p>
Výstup by mìl vypadat asi takto:
</p>
<ul>
<pre>
FR-o /etc/mail/relay-domains
</pre>
</ul>
<p>
Pokud tento soubor neexistuje, vytvoøte ho. Budete do nìj dále muset
pøidat stroje, které budou posílat vzdálenì emaily:
</p>
<ul>
<pre>
.domain.com    #Povol relay pro/z stroje v domain.com
sub.domain.com #Povol relay pro/z sub.domain.com a v¹echny stroje v této doménì
10.2           #Povol relay ze v¹ech strojù z IP sítì 10.2.*.*
</pre>
</ul>
<p>
Nezapomeòte poslat démonu sendmail signál 'HangUP', (signál, který pro
vìt¹inu démonù znamená znovunaètení jejich konfiguraèního souboru):

</p>
<ul><pre>
# <Strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre></ul>
<p>

<h3>Související odkazy</h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">http://www.sendmail.org/antispam.html</a>
</ul>
</p>

<p>
<a name= "POP"></a>
<a name="10.5"></a>
<h2>10.5 - Nastavil jsem POP, ale dostávám chybová hlá¹ení pøi získávání
mailu pøes POP.</h2>
</p>

<p>
Vìt¹ina problému s POP jsou v doèasných souborech a lock souborech.
Pokud vám pop server po¹le chybovou hlá¹ku jako:
</p>
<ul>
<pre>
-ERR Couldn't open temporary file, do you own it?
</pre>
</ul>
<p>
Zkuste nastavit práva takto:
<ul>
<pre>
práva ve  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


práva ve /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre>
</ul>
<p>
Jiná vìc, kterou zkontrolujte je, zda u¾ivatel skuteènì vlastní sobì
odpovídající soubor ve /var/mail. Samozøejmì, ¾e by tomu tak mìlo být,
ale pokud ne, tak i toto mù¾e být problém!
<P>
Samozøejmì, tím ¾e udìláte /var/mail zapisovatelný pro skupinu mail,
otevírá se zde prostor pro jisté bezpeènostní problémy. Pravdìpodobnì s
tím ale nebudete mít problémy. Ov¹em mohly by nastat (máte-li napø.
velmi nav¹tìvovaný server nebo jste-li ISP,...)!  Zkuste spustit cucipop
nelbo jiný POP démon z OpenBSD sbírky portù. Nebo mù¾ete mít ¹patnì
nastavené volby pro va¹eho démona (napø. dot locking). Nebo staèí kdy¾
jenom zmìníte adresáø, ve kterém démon vytváøí lock soubory (aèkoliv pak
by lock souborù byl hodnotný pouze pro POP démona.)
</p>

<p>
<b>PS:</b> V¹imnìte si, ¾e OpenBSD nemá skupinu se jménem
&quot;mail&quot;. Musíte ji vytvoøit v souboru <i>/etc/group</i>. Napø.
øádek jako:

<ul><pre>
mail:*:6:
</pre></ul>

je naprosto dostaèující.
</p>

<a name="SendmailDNS"></a>
<h2>10.6 - Proè Sendmail ignoruje <tt>/etc/hosts</tt>?</h2>
Defaultnì Sendmail pou¾ívá pro pøeklad jmen DNS, ne soubor
<tt>/etc/hosts</tt>. Toto chování je mo¾né zmìnit pomocí souboru
<tt>/etc/mail/service.switch</tt>.

<p>
Pokud chcete prohledat soubor hosts pøed dotazem DNS serveru, vytvoøte
soubor <tt>/etc/mail/service.switch</tt> obsahující následující øádek:
<pre>
  hosts	  files dns
</pre>
Pokud chcete prohledávat JENOM soubor hosts, pou¾ijte následující:
<pre>
  hosts   files
</pre>
Po¹lete Sendmailu signál HUP následujícím pøíkazem:
<pre>
  $ <b>sudo kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre>
a zmìna se projeví.

<p>
<a name= "HTTPS"></a>
<a name="10.6"></a>
<h2>10.7 - Nastavení Secure HTTP serveru s SSL(8)</h2>
</p>

<p>
OpenBSD je dodáváno s httpd pøipraveným pro SSL a RSA knihovnami. 

Pro pou¾ití 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>,
musíte nejprve vytvoøit certifikát. Ten pak ulo¾it do
<i>/etc/ssl/private</i>. Následujicí ukázky najdete také v manuálové
stránce
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.
Tam mù¾ete také nalézt dal¹í informace. Zde se jen omezíme na ukázku
toho, jak vytvoøit RSA certifikát pro web server, ne DSA certifikát.
Chcete-li vìdìt více, podívejte se do manuálové stránky
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a> .

<p>
Pro secure HTTP potøebujete nejprve vytvoøit pro démona
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>
bezpeènostní certifikát. Následující kroky jsou vybrány z manálové
stránky týkající se
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.
V ní nadjete dal¹í informace. FAQ pouze uká¾e jak vytvoøit RSA
certifikát pro web server, nikoliv DSA server certifikát. Pro jeho
vytvoøení si pøeètìte manuálovou stránku
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.
</p>

<p>
Nejprve musíte vytvoøit pro vá¹ server klíè a certifikát. Chcete-li
pou¾ívat RSA, musíte upgradovat va¹i libssl. Nyní vytvoøte klíè.
Pou¾ijte OpenSSL:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
Nebo, pokud si pøejete, aby byl klíè za¹ifrován heslem, které budete
muset zadat pøi startu serveru
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
Dal¹ím krokem je vygenerovat Certificate Signing Request, který pou¾ívá
Certifikaèní Autorita (CA) , která podepí¹e vá¹ certifikát. Pou¾ijte
pøíkaz:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p>
Soubor <i>server.csr</i> mù¾ete pak pøedat Certifikaèní Autoritì, která
podepí¹e klíè. Jedna taková CA je  <b>Thawte Certification</b>, která je
k dispozici na <a href="http://www.thawte.com/">http://www.thawte.com/</a>.
Thawte mù¾e v souèasnosti podepisovat va¹e RSA klíèe. Procedura pro DSA
klíèe je ve vývoji.
</p>

<p>
Pokud si to nemù¾ete dovolit, nebo vám staèí podepsat si certifikát
sami, mù¾ete pou¾ít následujcí.
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p>
Se soubory <i>/etc/ssl/server.crt</i> a
<i>/etc/ssl/private/server.key</i> na svých místech, byste mìli být
schopni nastartovat démona  <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>
s volbou  <b>-DSSL</b>, èím¾ umo¾níte https transakce na port 443.
</p>

<p>
<a name= "vipw"></a>
<a name="10.7"></a>
<h2>10.7 - Zeditoval jsem /etc/passwd, ale vypadá to, ¾e se nic
nezmìnilo. Proè?  </h2>
</p>

<p>
Pokud editujete /etc/passwd, zmìny které provedete budou ztraceny.
OpenBSD generuje /etc/passwd dynamicky programem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0">pwd_mkdb(8)</a>.
Hlavní soubor s hesly je v OpenBSD /etc/master.passwd. Dle pwd_mkdb(8),
<ul>
<pre>
FILES
	/etc/master.passwd  	souèasný soubor s hesly
	/etc/passwd		soubor s hesly ve formátu Verze 7
	/etc/pwd.db		databázový soubor s hesly (nezabezpeèený)
	/etc/pwd.db.tmp		doèasný soubor
	/etc/spwd.db		databázový soubor s hesly (zabezpeèený)
	/etc/spwd.db.tmp	doèasný soubor
</pre>
</ul>

<p>
V tradièním Unixovém souboru s hesly, jako je /etc/passwd, jsou v¹echny
informace vèetnì u¾ivatelova za¹ifrovaného hesla k dispozici pro ka¾dého
kdo má do systému pøístup (a /etc/passwd je pak vynikajícím cílem pro
programy jako napø. Crack.) 4.4BSD pøi¹lo s novým souborem
master.passwd, který má roz¹íøený formát (navíc dal¹í vlastnosti spolu s
tìmi, které obsahovalo staré /etc/passwd), a který je èitelný pouze pro
superu¾ivatele. Pro rychlej¹í pøístup k datùm  v tìchto souborech
pou¾ívají knihovní funkce obvykle soubory /etc/pwd.db a /etc/spwd.db.

<p>
OpenBSD pøidává navíc prostøedek, kterým lze editovat soubor s hesly.
Jmenuje se vipw(8). Vipw pou¾ívá vi (nebo vá¹ oblíbený editor
specifikovaný v promìnné $EDITOR) k editování souboru /etc/master.passwd
. Poté co provedete editaci, vipw(8) znovu vytvoøí soubory /etc/passwd,
/etc/pwd.db a /etc/spwd.db na základì zmìn, které udìláte. Vipw rovnì¾
provádí zamknutí tìchto souborù, aby nikdo jiný nemohl mìnit tyto
soubory ve stejnou chvíli.
</p>

<p>
<a name= "AddDelUser"></a>
<a name="10.8"></a>
<h2>10.9 - Jaký je nejlep¹í zpùsob pro pøidávání / odstraòování
u¾ivatelù?</h2> </p>

<p>
OpenBSD poskytuje dva pøíkazy pro snadné pøidávání u¾ivatelù do systému:
<ul>
    <li><a href="#adduser">adduser(8)</a>
    <li><a href="#user">user(8)</a>
</ul>

<a name="adduser"></a>
<p>
Nejjednodu¹¹í zpùsob jak pøidat v OpenBSD u¾ivatele je pou¾ít skript
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>.
Konfiguraci tohoto programu mù¾ete zmìnit v
<strong>/etc/adduser.conf</strong>.  Ruènì pøidávat u¾ivatele lze také
programem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&sektion=8&format=html">vipw(8)</a>,
tento pøíkaz je ale urèen pøedev¹ím pro pøidávání u¾ivatelù. adduser(8)
provádí kontroly konzistence souborù <strong>/etc/passwd</strong>,
<strong>/etc/group</strong>, a shell databáze. Vytváøí také $HOME
adresáøe. Mù¾e dokonce i posílat u¾ivatelùm uvítací zprávy. V¹echny tyto
vlastnosti mohou být zmìneny podle va¹ich po¾adavkù. Následuje
jednoduchá ukázka pou¾ití programu adduser(8). Budeme pøidávat u¾ivatele
<b>testuser</b>. Jeho domovský adresáø $HOME bude umístìn v
<i>/home/testuser</i>, u¾ivatel bude ve skupinì <b>guest</b> a jeho
pøíkazový interpret bude <i>/bin/ksh</i>.
</p>

<ul><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>testuser</strong>
Enter full name []: <strong>Test FAQ User</strong>
Enter shell csh ksh nologin sh [ksh]: <strong>ksh</strong>
Uid [1002]: <strong>&lt;Enter&gt;</strong>
Login group testuser [testuser]: <strong>guest</strong>
Login group is ``guest''. Invite testuser into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Enter password again []:

Name:     testuser
Password: ****
Fullname: Test FAQ User
Uid:      1002
Gid:      31 (guest)
Groups:   guest
HOME:     /home/testuser
Shell:    /bin/ksh
OK? (y/n) [y]: <strong>y</strong>
Added user ``testuser''
Copy files from /usr/share/skel to /home/testuser
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre></ul>

<p>
Pro odstranìní u¾ivatele pou¾ijte pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html">rmuser(8)</a>.
Ten odstraní v¹e co se v systému k u¾ivateli vztahuje. Odstraní polo¾ky v
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&sektion=1&format=html">crontab(1)</a>,
jeho domovský adresáø (pokud je vlastnìn daným u¾ivatelem), a jeho
po¹tu.  Samozøejmì odstraní i jeho záznamy z
<strong>/etc/passwd</strong> a <strong>/etc/group</strong>. Následuje
ukázka odstranìní u¾ivatele, kterého jsme pøidali vý¹e ze systému.
V¹imnìte si výzvy k zadání jména u¾ivatele a zda si pøejete odstranit
jeho domovský adresáø.
</p>

<ul><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></ul>

<a name="user"></a>
<h3>Pøidání u¾ivatele pomocí user(8)</h3>
<p>
Tyto programy jsou ménì interaktivní ne¾ pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>, který zjednodu¹¹uje pou¾ívání tìchto skriptù.
</p>

<ul>Seznam nových pøíkazù:
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&sektion=8&format=html">group(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&sektion=8&format=html">groupadd(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&sektion=8&format=html">groupdel(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&sektion=8&format=html">groupinfo(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&sektion=8&format=html">groupmod(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&sektion=8&format=html">useradd(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&sektion=8&format=html">userdel(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&sektion=8&format=html">userinfo(8)</a>
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&sektion=8&format=html">usermod(8)</a>
</ul>

<h4>Vlastní pøidání u¾ivatele</h4>

<p>
Jak ji¾ bylo naznaèeno, pøíkaz user(8) není interaktivní, proto
nejpohodlnìj¹í zpùsob pøidání u¾ivatele je pøíkaz adduser(8). Pøíkaz
<i>/usr/sbin/user</i> je vlastnì jen frontend pro zbytek pøíkazù
<i>/usr/sbin/user*</i>. Proto pøíkaz <b>user add</b> a <b>useradd</b>
jsou naprosto stejné. Je jen na vás, kterou z
forem pou¾ijete. (Czech note: technicky jsou v¹echny
<i>/usr/sbin/user*</i> implementovány jako hardlinky, skuteènì tedy v¾dy
spou¹títe stejný pøíkaz, ale s jiným jménem a parametry.)
</p>

<p>
V následujícím pøíkladì budeme pøidávat stejného u¾ivatele jako v
pøípadì  <a href="#adduser">vý¹e</a>. useradd(8)  je mnohem jednodu¹¹í
pro èasté pou¾ívání, pokud znáte standardní nastavní pro pøidávání
u¾ivatele. Toto nastavení je ulo¾eno v <i>/etc/usermgmt.conf</i> a
prohlédnout si ho mù¾ete napøíklad takto:
</p>

<ul><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></ul>

<p>
Uvedená nastavení budou pou¾ita jako standardní, pokud nespecifikujete
na pøíkazové øádce vlastní. Napøíklad v pøípadì, ¾e chcete aby u¾ivatel
patøil do skupiny <b>guest</b>, ne <b>users</b>. Jistou nevýhodou pøi
pøidávání u¾ivatelù je, ¾e jejich hesla musí být specifikována na
pøíkazové øádce. Zadat musíte v¹ak za¹ifrované heslo, k tomu pou¾ijte
program
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&sektion=1&format=html">encrypt(1)</a>.
Napøíklad standardním ¹ifrovacím algoritmem hesel pou¾ívaným v OpenBSD
je Blowfish se ¹estmi rundami. Pøíklad pou¾ití useradd(8).
</p>

<ul><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></ul>

<p>
Nyní máme pøipravené za¹ifrované heslo, mù¾ete pokroèit k pøidání
u¾ivatele.
</p>

<ul><pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre></ul>

<p>
<b>Poznámka:</b> Ujistìte se, ¾e jste pou¾ili '' kolem øetìzce s heslem,
ne  &quot;&quot; proto¾e shell bude interpretovat tyto znaky pøedtím ne¾
pøedá parametry programu user(8). Souèasnì se ujistìte, ¾e specifikujete
volbu <b>-m</b>, pokud chcete vytváøet domovské adresáøe u¾ivatelù a
kopírovat do nich soubory <i>/etc/skel</i>.
</p>

<p>
Zda byl u¾ivatel vytvoøen korektnì mù¾ete zkontrolovat nìkolika
programy.  Jejich výèet následuje.
</p>

<ul><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></ul>

<p>
Navíc k tìmto pøíkazùm user(8) disponuje svou vlastní utilitou pro
zobrazení charakteristiky u¾ivatele, nazývá se userinfo(8).
</p>

<ul><pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></ul>

<h4>Odstranìní u¾ivatele</h4>

<p>
Odstranìní u¾ivatele pomocí pøíkazù z okruhu utility user(8) se pou¾ívá
userdel(8). Je to velmi jednoduchý ale pou¾itelný pøíkaz. Pro odstranìní
u¾ivatele z posledního pøíkladu, jednodu¹¹e:
</p>

<ul><pre>
# <strong>userdel -r testuser</strong>
</pre></ul>

<p>
V¹imnìte si volby <b>-r</b>, kterou je nutno specifikovat pokud budete
chtít smazat s u¾ivatelem i jeho domovský adresáø. Jiná mo¾nost je
pou¾ít <b>-p</b> a ne  <b>-r</b>, co¾ uzamkne u¾ivatelský úèet, ale
neodstraní ¾ádné informace.
</p>

<p>
<a name= "FTPOnly"></a>
<a name="10.9"></a>
<h2>10.10 - Jak vytvoøím úèet pouze pro ftp (ne anonymní FTP!)?</h2>
</p>

<p>
Existuje nìkolik zpùsobù, bì¾né je pøidat <i>/usr/bin/false</i> do
<strong>/etc/shells</strong>. Poté pøi vytváøení u¾ivatele nastavte jeho
shell na /usr/bin/false. Takovýto u¾ivatel se nebude moci pøihlásit do
systému interaktivnì, ale bude vyu¾ívat prostøedkù, které bude ftp
poskytovat.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>
dá tomuto u¾ivateli standardnì domovský adresáø
<i>/home/&lt;user&gt;</i>. Pokud vám to vyhovuje nemusíte nic mìnit,
pøesto mù¾ete specifikovat jakýkoliv jiný adresáø.  Mù¾ete zaøídit, aby
u¾ivatel byl schopen vidìt soubory pouze ve svém domovském adresáøi
pøidáním jeho u¾ivatelského jména do <i>/etc/ftpchroot</i>.
Pou¾itím volby the <b>-A</b> démona
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>
mù¾ete dovolit pouze pøihlá¹ení na ftp s provedeným voláním chroot(2),
které zajistí vý¹e uvedenou skuteènost.
</p>

<p>
<a name= "Quotas"></a>
<a name="10.10"></a>
<h2>10.11 - Nastavení kvót</h2>
</p>

<p>
Kvóty jsou pou¾ívány k omezení místa na disku, které mù¾e u¾ivatel
pou¾ít pro své úèely. V situaci s omezenými prostøedky mohou kvóty
výraznì pomoci. Kvóty lze nastavit dvìma rùznými zpùsoby.
</p>

<p>
<ul>
<li>U¾ivatelské kvóty</li>
<li>Skupinové kvóty</li>
</ul>
</p>

<p>
První krok pøi nastavení kvót je uji¹tìní se, ¾e  <tt>volba QUOTA</tt>
nechybí v konfiguraèním souboru jádra. Tato volba je v jádru GENERIC.
Poté musíte oznaèit v souboru  <i>/etc/fstab</i> souborové systémy, pro
které budou nastaveny kvóty. Slova <tt>userquota</tt> a
<tt>groupquota</tt> pou¾ijte pro oznaèení ka¾dého s filesystémù, na
kterém budete kvóty pou¾ívat. Standardnì budou vytvoøeny soubory
<tt>quota.user</tt> a <tt>quota.group</tt> v koøenovém adresáøi ka¾dého
ze souborových systémù. Tento standard lze ovlivnit tak, ¾e napí¹ete
napøíklad userquota=/var/quotas/quota.user. Nebo jakýkoliv jiný soubor
ve kterém chcete mít ulo¾ené informace o kvótách. Pøíklad souboru
/etc/fstab se zapnutými kvótami.
</p>

<ul>
<pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre>
</ul>

<p>
Nyní pøi¹el èas, kdy je tøeba nastavit u¾ivatelské kvóty. Pou¾ijete program
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html">edquota(8)</a>.
Jednoduché pou¾ití je <strong>edquota &lt;user&gt;</strong>. edquota(8)
pou¾ívá editor vi(1) pro editování kvót, pokud není specifikována
promìnná prostøedí EDITOR a není nastavena na jiný editor. Napøíklad:
</p>

<ul>
<pre>
# <strong>edquota ericj</strong>
</pre>
</ul>

<p>
Vytvoøí výstup podobný tomuto:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
    inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
Limity vytvoøíte tak, ¾e zeditujete øádky aby vypadaly napøíklad takto:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
    inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
V tomto pøípadì je softlimit nastaven na 1000 blokù a hardlimit na 1050
blokù.  Softlimit je limit, kdy je u¾ivatel pouze varován pøi jeho
pøekroèení a musí do vypr¹ení jistého èasového období zaøídit, aby
velikost místa, které vyu¾ívá, poklesla pod tento limit. Èasové období
lze nastavit pou¾itím volby <strong>-t</strong> pøíkazu edquota(8).  Po
uplynutí tohoto èasu je softlimit chápán systémem jako hardlimit. Co¾
vìt¹inou vede k znemo¾nìní alokování dal¹ího místa.
</p>

<p>
Nyní po nastavení kvót je potøeba kvóty spustit. Pou¾ijete pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html">quotaon(8)</a>.
Napøíklad:
</p>

<ul>
<pre>
# <strong>quotaon -a</strong>
</pre>
</ul>

<p>
Tento pøíkaz projde /etc/fstab a nastaví kvóty na ka¾dém souborovém
systému, který jsme oznaèili pøíslu¹ným zpùsobem. Nyní jsou kvóty
nastaveny a fungují, prohlédnout si je mù¾ete programem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html">quota(1)</a>.
Pou¾itím pøíkazu <strong>quota &lt;user&gt;</strong> dostanete informaci
pro daného u¾ivatele. Zavoláte-li pøíkaz bez dal¹ích argumentù, vypí¹e
se statistika.
Napøíklad:
</p>

<ul>
<pre>
# <Strong>quota ericj</strong>
</pre>
</ul>

<p>
Vede na výstup jako:
</p>

<ul>
<pre>
Disk quotas for user ericj (uid 1001):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0
</pre>
</ul>

<p>
Standardnì jsou kvóty spu¹tìny pøi bootu. Pro vypnutí kvót pou¾ijte <ul><pre># <strong>quotaoff -a</strong></pre></ul>
</p>

<p>
<a name= "Kerberos"></a>
<a name="10.11"></a>
<h2>10.12 - Jak nastavit klient a server Kerberos na OpenBSD</h2>
</p>

<p>
Jako u¾ivatel/správce systému OpenBSD mù¾ete být rádi, ¾e KerberosIV je
pøed instalovanou souèástí ka¾dé standardní instalace. Zde najdete
ukázku jak nastavit Kerberos realm server, stejnì tak klient.
</p>

<p>
*VELMI*  podstatnou podmínkou je skuteènost, ¾e klienty a servery
Kerberos musí mít synchronizované systémové hodiny. Pokud rozdíl èiní
více jak 5 minut, budete svìdky podivných chyb, které samy o sobì
nevypadají, ¾e jsou zpùsobeny èasovým nesouladem, jako napøíklad:
</p>

<ul>
<pre>
kinit: Can't send request (send_to_kdc)
</pre>
</ul>

Jiná velmi èastá chyba je:

<ul>
<pre>
kauth: Time is out of bounds (krb_rd_req)
</pre>
</ul>

<p>
Jednoduchá cesta jak synchronizovat systémové hodiny je pou¾ít ntpd,
které je k dispozici ve sbírce portù
v <strong>/usr/ports/sysutils/ntp/</strong>.
</p>

V tìchto FAQ pøedpokládejme, ¾e ji¾ znáte koncept systému Kerberos.
Vynikající odkazy snadné na pochopení jsou napø.

<ul>
<li><a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html">The FreeBSD handbook</a></li>
<li>Use the command <strong>info kth-krb</strong></li>
<li><a href="http://web.mit.edu/kerberos/www/dialogue.html">Designing an Authentication System: a Dialogue in Four Scenes</a></li>
<li><a href="http://web.mit.edu/kerberos/www/papers.html#krb4">Papers and Documentation Describing KerberosIV</a></li>
</ul>Nebo kniha<ul>
<li><a href="http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/">Network Security Private Communication in a Public World [Kaufman, Perlman, Speciner, 1995]</a></li>
</ul>

<h3>Jak nastavit Kerberos IV REALM a SERVER</h3>

<p>
Budeme konfigurovat realm CIARASYSTEMS.COM, s avalanche.ciarasystems.com
jako hlavním serverem.
</p>

<p>
Nejprve musíme zeditovat na¹e konfiguraèní soubory. Najdete je v
<tt>/etc/kerberosIV/</tt>.  Soubory které se nás nyní týkají jsou
<i>krb.realms</i> a <i>krb.conf</i>. Zaèneme s <i>krb.conf</i>.
</p>

<ul>
<pre>
# <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
</pre>
</ul>

<p>
Jak vidíte, takto specifikujeme kerberosu, ¾e doména má název
CIARASYSTEMS.COM (nebo logická oblast) a ¾e v rámci této domény je
avalanche jako administraèní server. Nyní se podívejme na
<i>krb.realms</i>. Více informací najdete v
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html">krb.conf</a>.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
krb.realms zprostøedkuje pøeklad názvù strojù na názvy domény Kerberos
(Kerberos realm) pro slu¾by které jsou danými stroji poskytovány.  Ka¾dý
øádek v tomto souboru má jeden z tìchto tvarù (domain_name by mìlo být
ve tvaru .XXX.YYY).  V na¹em pøíkladu je avalanche název stroje v
CIARASYSTEMS.COM oblasti. A .ciarasystems.com je doménové jméno  v
oblasti CIARASYSTEMS.COM. Opìt pro dal¹í informace si pøeètìte
manuálovou stránku
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html">krb.realms</a>.
</p>

<p>
Nyní spustíme <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdb_init&sektion=8&format=html">kdb_init(8)</a>, 
abychom vytvoøili a incializovali databázi Kerberos.
</p>

<ul>
<pre>
# <strong>kdb_init</strong>
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: <strong>neukazuje se</strong>
Verifying password -
Enter Kerberos master password:
</pre>
</ul>

<p>
Nyní pou¾ijeme 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html">kstash(8)</a>,
který slou¾í k ulo¾ení hlavního klíèe databáze Kerberos key distribtion
center (KDC) do hlavního cache souboru.
</p>

<ul>
<pre>
# <strong>kstash</strong>
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
</pre>
Tím jsme ulo¾ili za¹ifrované hlavní heslo (master password) do
/etc/kerberosIV/master_key.<p>

Nyní potøebujeme pøidat do databáze  dva principals pro ka¾dý systém,
který bude zabezpeèen pomocí Kerberos. Jejich jména jsou <i>kpasswd</i>
a <i>rcmd</i>. Tyto principals jsou vytvoøeny pro ka¾dý systém, s
instancemi jejich¾ jména odpovídají jednotlivým systémùm.

Tyto démony,  <i>kpasswd</i> a <i>rcmd</i> dovolí ostatním systémùm
zmìnit hesla Kerberos a spou¹tìt pøíkazy jako  <i>rcp, rlogin</i> a
<i>rsh</i>.


<pre>
# <strong>kdb_edit</strong>
Opening database...

Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>passwd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <strong>&lt;----- Pou¾ijte 'RANDOM' jako heslo</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: <strong>rcmd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <strong>&lt;----- Pou¾ijte 'RANDOM' jako heslo</strong>
Verifying password -
New Password:

Random password [y] ? <Strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <strong>&lt;----- Dejte &lt;ENTER&gt; pro ukonèení</strong>

</pre>
</ul>

<p>
Soubor srvtab obsahuje klíèe jednotlivých slu¾eb. Tyto musí být získány
z Kerberos key distribution center databáze, aby bylo mo¾no slu¾by
autentifikovat pomocí Kerberos. Pro ka¾dý host specifikovaný na
pøíkazové øádce vytvoøí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html">ext_srvtab(8)</a>
soubor hostname-new-srvtab, obsahující v¹echny polo¾ky v databázi
jejich¾ instance odpovídá jménu hostu.
</p>

<ul>
<pre>
# <Strong>ext_srvtab avalanche</strong>

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

# <strong>mv avalanche-new-srvtab srvtab</strong>
# <strong>chmod 600 srvtab</strong>
</pre>
</ul>

<p>
Nyní mù¾ete do databáze pøidat u¾ivatele.
</p>

<ul>
<pre>
# <strong>kdb_edit</strong>
Opening database...

Enter Kerberos master key:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>jeremie</strong>
Instance:

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                &lt;---- zde zadejte zabezpeèené heslo
Verifying password

New Password:                &lt;---- opakujte zadání hesla
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          &lt;---- stisk enteru bez udání dal¹ího zpùsobí ukonèení, nebo mù¾ete zadávat dal¹í polo¾ky
</pre>
</ul>

<p>
Nyní jsou nastaveny v¹echny èásti systému Kerberos. Zbývá zajistit, aby
se kerberos inicializoval pøi startu a byly spu¹tìny démony, které budou
pou¾ívat autentifikaci Kerberos.
</p>

<p>
V /etc/rc.conf nastavte:
<ul>
<tt>kerberos_server=YES</tt>
</ul>

V /etc/inetd.conf odkomentujte:
<UL>
<pre>
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd
</pre>
</ul>

Pak dejte reboot nebo:
<ul>
<pre>
# <Strong>kill -HUP `cat /var/run/inetd.pid`</strong>
# <Strong>/usr/libexec/kerberos &gt;&gt; /var/log/kerberos.log &amp;</strong>
# <strong>/usr/libexec/kadmind -n &gt;&gt; /var/log/kadmind.log &amp;</strong>
</pre>
</ul>
</p>

<p>
Poznámka: ukázali jsme ponìkud jednoduché nastavení. Obvykle jsou
nastaveny také zálo¾ní servery (slave servery), aby v pøípadì, ¾e jeden
server je zastaven nebyly zastaveny také v¹echny slu¾by na Kerberosu
závislé. Je mo¾né dodat také právo 'su' specifickému principal, viz. 
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html#AEN9189">the FreeBSD Handbook</a>.
</p>

<h3>Jak nastavit pro práci s Kerberos pracovní stanici</h3>

<p>
Budeme chtít nastavit pracovní stanici s názvem <i>gatekeeper</i> jako
souèást Kerberos oblasti CIARASYSTEMS.COM s hlavním serverem
avalanche.ciarasystems.com.
</p>

<p>
Nejprve musíme nastavit <i>krb.conf</i> a <i>krb.realms</i> tak jako na
pøedcházejícím stroji. To proto, aby <i>gatekeeper</i> vìdìl, který
sever je KDC a ve kterém doménì se nachází. Opìt tedy:
</p>

<ul>
<pre>
# <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

# <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
Nyní inicializujeme kerberos. Pro získání lístku pou¾ijete
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html">kinit(1)</a>.
</p>

<ul>
$ <Strong>kinit</strong>
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: <strong>jeremie</strong>
Password:
</pre>
</ul>

<p>
Poté co jsme se identifikovali mù¾eme vypsat na¹e lístky pøíkazem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html">klist(1)</a>.
</p>

<ul>
<pre>
$ <strong>klist</strong>
Ticket file:    /tmp/tkt1000
Principal:      jeremie@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@CIARASYSTEMS.COM
</pre>
</ul>

<p>
Nyní se zdá, ¾e je v¹e nastaveno. Zbývá to otestovat. Budeme testovat
rlogin(1) a telnet(1).
</p>

<ul>
<pre>
$ <Strong>telnet avalanche</strong>
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 3.1-current (GENERIC) #4: Wed May  8 09:36:35 EDT 2002
</pre></ul>

a
<ul><pre>
$ <Strong>rlogin avalanche</strong>
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 3.1-current (GENERIC) #4: Wed May  8 09:36:35 EDT 2002
</pre>
</ul>

<p>
Mù¾eme øíci, ¾e pou¾íváme Kerberos pro autentizaci sezení rlogin.
Chcete-li odstranit jakékoliv vydané lístky, pou¾ijte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html">kdestroy(1)</a>.
Napøíklad:
</p>

<ul>
<pre>
$ <strong>kdestroy</strong>
Tickets destroyed.
$ <Strong>rlogin avalanche</strong>
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
</pre>
</ul>

<p>
Neobávejte se hlá¹ky 'Warning: no Kerberos tickets issued.' . Vypisuje
se, proto¾e provádíme pouze kerberos autentizaci, nikoliv ticket
passing. Chcete-li pou¾ívat ticket passing, pou¾ijte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">OpenSSH</a>,
které má pro to podporu.  KerberosIV nepodporuje tgt passing, ten je
podporován pouze v implementaci AFS kaserveru z krb4, proto¾e normální
KerberosIV kdc kontroluje IP adresu uvedenou v tiketu.
</p>

<p>
<a name= "AnonFTP"></a>
<a name="10.12"></a>
<h2>10.13 - Nastavení anonymního FTP.</h2>
</p>

<p>
Anonymní FTP umo¾òuje zpøístupòovat soubory u¾ivatelùm, kteøí nemají
úèet na va¹em poèítaèi, pomocí File Transfer Protokolu. Uvádíme pøehled
krokù pøi nastavení anonymního FTP serveru.
</p>

<h3>Pøidání úètu FTP</h3>

<p>
Nejprve na svém systému musíte mít úèet s názvem "ftp". Na tento úèet by
nemìlo být mo¾né se interaktivnì pøihlásit. Nastavíme domovský adresáø
na /home/ftp, ale mù¾ete specifikovat jaký chcete. Pøi pou¾ití
anonymního ftp bude ftp démon provádìt volání chroot(2) sebe sama do
adresáøe specifikovaného jako domovský adresáø u¾ivatele 'ftp'. Více si
pøeètìte v manuálových stránkách
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a>
a <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html">chroot(2)</a>.
Pøíklad pøidání u¾ivatele <i>ftp</i>. Pou¾ijeme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>.
Musíme také pøidat  /usr/bin/false do <i>/etc/shells</i>, co¾ je
&quot;shell&quot; , který dáme u¾ivateli ftp. To mu znemo¾ní se
pøihlásit, pøesto¾e mu dáme prázdné heslo. Staèí jednodu¹¹e <i>echo
/usr/bin/false &gt;&gt; /etc/shells</i>.  Pokud chcete, aby se tento
shell ukazoval v dotazech programu adduser, modifikujte také
<i>/etc/adduser.conf</i>.
</p>


<ul>
<pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>ftp</strong>
Enter full name []: <strong>anonymous ftp</strong>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <strong>false</strong>
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Set the password so that user cannot logon? (y/n) [n]: <strong>y</strong>

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: <strong>y</strong>
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre>
</ul>

<h3>Nastavení adresáøe</h3>

<p>
Spolu s novým u¾ivatelem jsme zalo¾ili také adresáø <i>/home/ftp</i>.
Pøesnì tak jak jsme chtìli. Musíme ale je¹tì  provést nìkolik zmìn,
abychom v¹e pøipravili pro anonymní ftp. Tyto zmìny jsou opìt vysvìtleny
v manuálové stránce
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a>.
</p>

<ul>
<b>NENÍ</b> nutné vytváøet adresáøe /home/ftp/usr nebo /home/ftp/bin.
<BR>
<li><i>/home/ftp</i> - Hlavní adresáø. Mìl by být vlastnìn u¾ivatelem
  root a práva pøístupu 555.</li>
<li><i>/home/ftp/etc</i> - Volitelné a nedoporuèuje se, slou¾í pøedev¹ím
  pro získání informací o u¾ivatelech, kteøí existují na daném stroji.
  Pokud chcete, aby anonymní ftp adresáø mìl asociován jména soubory s
  odpovídající jmény u¾ivatelù, zkopírujte sem /etc/pwd.db a /etc/group .
  Tento adresáø by mìl mít mód 511 a oba soubory by mìly mít práva 444.
  Slou¾í ke získání jmen vlastníka a skupiny odpovídajících daným id
  èíslùm. V pwd.db nejsou ulo¾ena hesla, ty jsou v spwd.db, který sem
  nekopírujte.</li>
<li><i>/home/ftp/pub</i> - Standardní adresáø, kam se ukládají soubory,
  které chceme sdílet. Tento adresáø by mìl mít mód 555.
</ul>

<p>
Ne v¹echny adresáøe by mìl vlastnit "root". Zde je výpis jak by mìly
adresáøe vypadat po jejich vytvoøení.
</p>

<ul>
<pre>
# pwd
/home
# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre>
</ul>

<h3>Nastartování serveru a pøihlá¹ení</h3>

<p>
Mù¾ete si vybrat mezi spou¹tìním ftpd z inetd nebo z rc skriptù. V na¹em
pøíkladu ho budeme spou¹tìt z
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a>.
Nejprve se musíme seznámit s nìkterými volbami ftpd. Standardní øádek v
<i>/etc/inetd.conf</i> je:
</p>

<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</strong>
</pre></ul>

<p>
Zde je fptd spu¹tìno s volbou <i>-US</i>. Tato volba bude logovat
anonymní spojení do <i>/var/log/ftpd</i> a akutální relace do
<i>/var/run/utmp</i>. Dovolí, aby tyto sezení byly vidìny pomocí who(1).
Chcete-li spustit pouze anonymní server a neumo¾òit ostatním u¾ivatelùm
ftp, pou¾ijte volbu <i>-A</i> option. Následuje startovací øádka démona
ftpd spu¹tìného za úèelem pouze anonymních spojení.  Pou¾ívá také
<i>-ll</i>, které loguje ka¾dou konekci pomocí syslog, spolu s
get,retrieve a dal¹ími pøíkazy ftp.
</p>

<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA</strong>
</pre></ul>

<p>
Poznámka - pro ty z vás, kteøí budete pou¾ívat ftp server s VELKÝM
provozem, bude lépe nespou¹tìt ftpd z inetd.conf . Nejlépe tak docílíte
zakomentování øádku s ftpd v inetd.conf a startováním ftpd z rc.conf s
volbou  <i>-D</i>.  Takto nastartujete ftpd jako démona, pøièem¾ sní¾íte
náklady spojené s èastým startem z inetd. Pøíklad startu z rc.conf.
</p>

<ul><pre>
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>
To samozøejmì funguje, jenom pokud jste odstranili ftpd z
<i>/etc/inetd.conf</i>.
</p>

<h3>Dal¹í podstatné soubory</h3>

<p>
<ul>
<li><i>/etc/ftpwelcome</i> - Obsahuje uvítací zprávu vypsanou u¾ivateli
  po pøipojení.</li>
<li><i>/etc/motd</i> - Obsahuje zprávu vypsanou u¾ivateli po úspì¹ném
  zalogování.</li>
<li><i>.message</i> - Tento soubor lze umístit do libovolného adresáøe.
  Bude vypsán jednou poté, co u¾ivatel vstoupí do tohoto adresáøe.</li>
</ul>


<p>
<a name= "ftpchroot"></a>
<a name="10.13"></a>
<h2>10.14 - Omezení u¾ivatelù na jejich domovský adresáø v ftpd(8).</h2>
</p>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>
v OpenBSD umo¾òuje øe¹it  tento problém velice jednodu¹¹e. Hlavní roli
zde hraje soubor <strong>/etc/ftpchroot</strong>. Proto¾e u¾ivatelùm ne
v¾dy mù¾eme dùvìøovat, je nutné omezit jejich pøístup na domovské
adresáøe. Toto chování NENÍ standardní. Zde je pøíklad toho jak to
vypadá standardnì.
</p>

<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 3.1-current (GENERIC) #7: Sat May 11 23:22:52 EDT 2002
230-
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230-
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230-
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>
Jak je vidìt, pøístup zde je zaji¹tìn k celému serveru. V ideálním
svìtì, kde v¹em u¾ivatelùm mù¾eme dùvìøovat, je v¹e v poøádku, ale
vìt¹inou tomu tak není.  Pro omezení u¾ivatele pøidejte jeho jméno do
souboru <strong>/etc/ftpchroot</strong>. Ukázka omezení u¾ivatele
&quot;ericj&quot;.
</p>

<ul><pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $ OpenBSD: ftpchroot,v 1.3 1996/07/18 12:12:47 deraadt Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre></ul>

<p>
To staèí k tomu, abychom u¾ivateli &quot;ericj&quot; znemo¾nili uniknout
z jeho domovského adresáøe. Jak uvidíte v dal¹ím pøíkladì, adresáø / se
náhle zmìnil na jeho domovský adresáø!
</p>

<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>
<a name= "Patches"></a>
<a name="10.14"></a>
<h2>10.15 - Aplikování patchù v OpenBSD</h2>
</p>

<p>
Strom zdrojového kódu OpenBSD se stále mìní a zlep¹uje, spolu s tím jsou
èasto opraveny bì¾né problémy a veøejnì jsou vydány patche. Tyto opravné
kódy najdete na webové stránce se soupisem chyb
<a href="../../cs/errata.html">http://www.openbsd.org/cs/errata.html</a>,
kde jsou rozdìleny do nìkolika kategorií. Tyto kategorie korespondují s
rozdílnými architekturami na které se mají patche aplikovat.
</p>

<p>
Poznamenejme je¹tì, ¾e patche nejsou vydávány pro novì pøidané kódy do
OpenBSD a jsou k dispozici pouze pro dùle¾ité opravy spolehlivosti nebo
pro opravy bezpeènostních chyb, které by mìly být ihned provedeny,
jejich provedení je v¹ak, jako v ostatních pøípadech, na
administrátorovi systému.
</p>

<p>
Napøíklad budeme patchovat démona
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&sektion=8">talkd(8)</a>
s bezpeènostní opravou z patche, který jsme získali z
<a href="../../cs/errata.html">errata.html</a>.
</p>

<h3>Jak se tyto patche li¹í od tìch, které najdeme v CVS stromu?</h3>

<p>
V¹echny patche oznámené v
<a href="../../cs/errata.html">http://www.openbsd.org/cs/errata.html</a>
jsou patche vztahující se k zdrojovému kódu  posledního vydání systému.
Patche aktuálního CVS stromu by mohly obsahovat dal¹í zmìny, které by na
systému dané verze byly nechtìné.
</p>

<h3>Pøíprava systému pro patch.</h3>

<p>
Patche jsou v OpenBSD distribuovány jako diffy, tj. jako textové
soubory, které obsahují rozdíly mezi pùvodním a opraveným zdrojovým
kódem. <b>NEJSOU</b> distribuovány v binární podobì. To znamená, ¾e pro
patch systému musíte mít k dispozici zdrojový kód nainstalované
<b>VERZE</b> OpenBSD. To neznamená, ¾e musíte mít nainstalovaný CELÝ
zdrojový kód OpenBSD, ale musíte mít zdrojový kód v¹ech  programù, které
chcete patchovat. Napøíklad pokud chcete patchovat jádro, musíte mít
po ruce zdrojové kódy celého jádra.
</p>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a> 
je výhodný prostøedek, který mù¾ete pou¾ít pro získání té èásti
zdrojového kódu, kterou potøebujete, prostøednictvím anonymních cvs
serverù umístìných po celém svìtì. Seznam tìchto serverù najdete zde
<a href="http://www.openbsd.org/cs/anoncvs.html">http://www.openbsd.org/cs/anoncvs.html</a>.
</p>

<p>
Pro sta¾ení zdrojových kódù souèasné verze OpenBSD pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>,
byste pou¾ili následující pøíkaz:
</p>

<div style="margin-left: 2em">
<pre>
$ <b>cvs -d anoncvs@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/</b>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>
Pro získání CVS cesty ke kódu, který potøebujete, se podívejte na øádek
oznaèený jako <i>Index:</i> v souboru patche.  V na¹em  pøípadì byla
cesta v CVS stromu  <i>src/libexec/talkd/</i>.  V¾dy zkontrolujte revizi
OPENBSD_cislo_verze_BASE. Bez  &quot;BASE&quot; budete stahovat stabilní
vìtev, která mù¾e obsahovat jiné zmìny, které mohou pak mít nesprávný
úèinek. Pokud pracujete s patch vìtví v cvs stromu, pak patche by v ní
mìly být u¾ aplikovány, pøesto se v¾dy radìji ujistìte. Mù¾ete se
podívat na
<a href="../../cs/plus.html">http://www.openbsd.org/cs/plus.html</a>,
kde najdete seznam patchù aplikovaných do patch vìtve. Pokud patche
nebyly dosud aplikovány, stáhnìte si zdrojový kód poslední verze, jak
bylo uvedeno vý¹e.
</p>

<p>
Rovnì¾, pro ty z vás, kdo si koupili oficiální OpenBSD CD, mù¾ete
zdrojový kód získat pøímo z CD. Podívejte se na CD jak extrahovat
zdrojové kódy z CD. V tom pøípadì nepotøebujete zdrojové kódy stahovat
za pomoci anoncvs.
</p>

<ul><pre>
Aplikujte patch provedením:
        cd /usr/src
        patch -p0 &lt; 026_talkd.patch
        cd libexec/talkd
        make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install

Index: libexec/talkd/announce.c <b>&lt;------ Path to sources </b>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></ul>

<p>
Poté co obdr¾íte zdrojový kód, stáhnìte si i patch a umístìte ho do
<i>src/</i>.
</p>

<h3>Aplikování patche</h3>

<p>
<div style="margin-left: 2em">
<pre>
$ <b>cd /usr/src</b>
$ <b>patch -p0&lt;/path/to/026_talkd.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 &lt; 026_talkd.patch
|       cd libexec/talkd
|       make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <b>&lt;------------ Patch byl úspì¹ný</b>
done
$ <b>cd /usr/src/libexec/talkd/</b>
$ <b>ls</b>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <b>make obj &amp;&amp; make depend &amp;&amp; make</b>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; talkd.cat8
$ <b>sudo make install</b>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -&gt; /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>
Poté co jste v¹e provedli, byste mìli restartovat danou slu¾bu.
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Zpìt na index]</a>
<a href= "faq9.html">[Do sekce 9.0 - Pøechod od Linuxu]</a>
<a href= "faq11.html">[Do sekce 11.0 - Ladìní výkonu]</a>
</font>
</p>
<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[zpìt]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq10.html,v 1.72 ]
<br>
$Translation: faq10.html,v 1.11 2003/10/29 08:13:12 certik Exp $
<br>
$OpenBSD: faq10.html,v 1.10 2003/10/30 18:00:22 horacio Exp $
</small>

</body>
</html>
