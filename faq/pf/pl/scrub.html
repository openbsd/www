<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub (normalizacja pakietów)</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003, 2004 Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="options.html">Wstecz: Opcje w czasie dzia³ania</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="anchors.html">Dalej: Zakotwiczenia i nazwane zestawy (pod)regu³</a>]

<p>
<h1><font color="#e00000">PF: Scrub (normalizacja pakietów)</font></h1>
<hr>

<h3>Spis tre¶ci</h3>
<ul>
<li><a href="#intro">Wprowadzenie</a>
<li><a href="#options">Opcje</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Wprowadzenie</h2>
<p>
"Scrubbing" jest normalizacj± pakietów, dziêki której nie ma w±tpliwo¶ci co do
ich interpretacji po stronie odbiorcy. Dyrektywa 'scrub' defragmentuje tak¿e
pakiety, chroni±c niektóre systemy przed ró¿nymi formami ataku, oraz odrzuca 
pakiety TCP, które maj± ustawione niepoprawne kombinacje
<a href="filter.html#tcpflags">flag</a>. Najprostsz± form± dyrektywy
scrub jest:
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Co oznacza normalizacjê wszystkich przychodz±cych pakietów na wszystkich
interfejsach sieciowych.

<p>
Jedynym powodem nie normalizowania pakietów na interfejsie sieciowym mo¿e
byæ przepuszczanie NFS przez PF na tym interfejsie. Niektóre, ró¿ne od
OpenBSD, platformy wysy³aj± (i oczekuj± na) dziwne pakiety - sfragmentowane
datagramy z ustawionym bitem "nie fragmentowaæ", które s± (s³usznie)
odrzucane przez <tt>scrub</tt>. Problem ten mo¿e jednak byæ rozwi±zany poprzez
u¿ycie opcji <tt>no-df</tt>. Innym powodem mog± byæ k³opoty z po³±czeniem
w niektórych sieciowych grach komputerowych, których ruch przechodzi
przez PF z w³±czonym <tt>scrub</tt>. Poza tymi, sk±din±d marginalnymi
przypadkami, normalizacja wszystkich pakietów jest <i>bardzo wskazan±</i>
praktyk±.

<p>
Sk³adnia dyrektywy <tt>scrub</tt> jest bardzo podobna do sk³adni dyrektyw
<a href="filter.html">filtruj±cych</a>, która pozwala w prosty sposób
selektywnie normalizowaæ poszczególne pakiety, i nie normalizowaæ innych.
S³owo kluczowe <tt>no</tt> mo¿e byæ u¿yte przed <tt>scrub</tt>, aby
okre¶liæ pakiety, które nie maj± ulegaæ normalizacji.
Podobnie jak w przypadku regu³ <a href="nat.html#except"><tt>nat</tt></a>,
pierwsza pasuj±ca jest jednocze¶nie ostatecznym dopasowaniem.

<p>
Wiêcej o koncepcji i zasadach normalizacji znajdziesz tutaj:
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a>.

<a name="options"></a>
<h2>Opcje</h2>
<tt>scrub</tt> ma nastêpuj±ce opcje:
<dl>
<dt><tt>no-df</tt> 
<dd>Usuwa bit <i>nie fragmentowaæ</i> z nag³ówka pakietu IP.
Niektóre systemy znane s± z generowania sfragmentowanych pakietów
z ustawionym bitem <i>nie fragmentowaæ</i>. Jest to szczególnie
prawdziwe dla NFS. <tt>Scrub</tt> bêdzie porzucaæ takie pakiety,
chyba ¿e jest ustawiona opcja <tt>no-df</tt>. Poniewa¿ niektóre
systemy operacyjne generuj± <i>nie fragmentowalne</i> pakiety z
zerowym nag³ówkiem identyfikacyjnym IP, jest zalecane u¿ywanie
<tt>no-df</tt> wraz z <tt>random-id</tt>.

<dt><tt>random-id</tt> 
<dd>Zastêpuje pole identyfikacyjne IP wychodz±cych pakietów losow± 
warto¶ci±. Opcja ta odnosi siê jedynie do wychodz±cych pakietów,
które nie s± fragmentowane po opcjonalnym zdefragmentowaniu.

<dt><tt>min-ttl <i>num</i></tt> 
<dd>Wymusza minimalne Time To Live (TTL) dla nag³ówków pakietów IP.

<dt><tt>max-mss <i>num</i></tt> 
<dd>Wymusza maksymalne Maximum Segment Size (MSS) dla nag³ówków pakietów TCP.

<dt><tt>fragment reassemble</tt> 
<dd>Buforuje przychodz±ce fragmenty pakietów i defragmentuje je do ca³ych
pakietów przed przekazaniem ich do filtra pakietów. Zalet± tego rozwi±zania
jest to, i¿ regu³y filtruj±ce operuj± jedynie na kompletnych pakietach i mog±
ignorowaæ pojedyñcze fragmenty. Wad± jest zwiêkszone zu¿ycie pamiêci,
niezbêdne do przechowywania fragmentów pakietów. Jest to domy¶lne zachowanie,
je¶li ¿adna opcja <tt>fragment</tt> nie jest podana. Jest to zarazem jedyna
opcja <tt>fragment</tt>, która wspó³pracuje z NAT.

<dt><tt>fragment crop</tt> 
<dd>Powoduje, ¿e duplikaty fragmentów s± porzucane, a nak³adaj±ce siê
s± kadrowane. W odró¿nieniu do <tt>fragment reassemble</tt>, fragmenty
nie s± buforowane, lecz s± przekazywane dalej jak tylko dotr±.

<dt><tt>fragment drop-ovl</tt> 
<dd>Ta opcja jest podobna do <tt>fragment crop</tt>, z t± ró¿nic±, ¿e
wszystkie zduplikowane i nak³adaj±ce siê fragmenty bêd± porzucane, ³±cznie
z wszystkimi powi±zanymi z nimi fragmentami.

<dt><tt>reassemble tcp</tt>
<dd>Normalizuj po³±czenia TCP w trybie ¶ledzenia stanów. 
Korzystaj±c z <tt>scrub reassemble tcp</tt>, kierunek (wchodz±cy/wychodz±cy)
(ang. in/out) nie musi byæ okre¶lony. 
Nastêpuj±ce normalizacje maj± miejsce:
	<ul>
	<li>¯adna ze stron po³±czenia nie jest uprawniona do zredukowania swojego
	TTL nag³ówka IP. Dzieje siê tak, aby zabezpieczyæ nas przed napastnikami
	wysy³aj±cymi pakiet, który dociera do firewall`a, ma wp³yw na przechowywane
	w pamiêci informacje o po³±czeniu stanowym, a nastêpnie jego TTL jest
	niewystarczaj±ce aby dotrzeæ do wêz³a docelowego.
	Warto¶æ TTL dla wszystkich pakietów jest podnoszona do najwy¿szej
	odnotowanej dla danego po³±czenia warto¶ci.
	<li>Modulowanie 
	<a href="http://www.geektools.com/rfc/rfc1323.txt">RFC1323</a>
	znaczników czasowych w nag³ówkach pakietów TCP przy pomocy liczb losowych.
	Mo¿e to zapobiec domy¶leniu siê przez obserwatora czasu pracy maszyny
	(ang. uptime) lub zgadniêciu ile maszyn jest za bramk± NAT.
	</ul>
</dl>

<p>
Przyk³ady:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp

</tt>
</blockquote>

<p>
[<a href="options.html">Wstecz: Opcje w czasie dzia³ania</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="anchors.html">Dalej: Zakotwiczenia i nazwane zestawy (pod)regu³</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[wstecz]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: scrub.html,v 1.10 ]<br>
$Translation: scrub.html,v 1.6 2004/11/13 16:19:46 pl-team Exp $<br>
$OpenBSD: scrub.html,v 1.6 2004/11/14 20:02:44 jufi Exp $
</small>

</body>
</html> 
