<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Scrub (Normalisation de Paquets)</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--

Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003-2005, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="options.html">Précédent : Options de
Fonctionnement</a>]
[<a href="index.html">Index</a>]
[<a href="anchors.html">Suivant : Ancres</a>]

<p>
<h1><font color="#e00000">PF : Scrub (Normalisation de Paquets)</font></h1>
<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#options">Options</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
Le "scrubbing" est la normalisation de paquets utilisée pour
supprimer toute ambiguïté dans l'interprétation d'un
paquet qui sera effectuée par la destination finale de ce
dernier. La directive <tt>scrub</tt> réassemble aussi des paquets
fragmentés, afin de protéger certains systèmes
d'exploitation de quelques types d'attaques. Cette directive rejette
aussi les paquets TCP contenants des combinaisons invalides de 
<a href="filter.html#tcpflags">drapeaux</a>. Voici un exemple simple
d'utilisation de la directive scrub :
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Ceci aura pour effet d'appliquer le "scrub" sur tous les paquets en
entrée de chaque interface.

<p>
Il existe des cas où il ne faut pas appliquer le "scrub". Par
exemple, une interface qui véhicule du trafic NFS à
travers PF. Certaines plates-formes non basées sur OpenBSD
envoient (et s'attendent à recevoir) des paquets étranges
-- des paquets fragmentés avec le bit "do not fragment" (ne pas
fragmenter) positionné, qui sont rejetés (comportement
normal) par <tt>scrub</tt>. On peut résoudre ce problème
en utilisant l'option <tt>no-df</tt>. Un autre exemple est l'utilisation
de jeux multi-joueurs qui ont des problèmes de connexion à
travers PF lorsque <tt>scrub</tt> est activé. Mis à part
ces cas quelque peu inhabituels, la normalisation de paquets "scrub" est
une pratique <i>hautement recommandée</i>.

<p>
La syntaxe de la directive <tt>scrub</tt> est très similaire
à la syntaxe de <a href="filter.html">filtrage</a> ce qui rend
aisé la normalisation de certains paquets et pas les autres.
Le mot-clé <tt>no</tt> peut être utilisé devant la directive
<tt>scrub</tt> pour ne pas normaliser certains paquets.
La première règle correspondante est appliquée, comme pour les
<a href="nat.html#except">règles <tt>nat</tt></a>.

<p>
Vous pouvez trouver plus d'informations concernant le principe et les
concepts de la normalisation de paquets dans l'article
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a>.

<a name="options"></a>
<h2>Options</h2>
Les options de <tt>scrub</tt> sont les suivantes :
<dl>
<dt><tt>no-df</tt> 
<dd>Supprime le bit <i>don't fragment</i> de l'en-tête du paquet
    IP. Quelques systèmes d'exploitation sont connus pour
    générer des paquets fragmentés avec le bit
    <i>don't fragment</i> positionné. Ceci est
    particulièrement vrai dans le cas de NFS. <tt>scrub</tt> va
    bloquer tous les paquets qui sont dans ce cas sauf si l'option
    <tt>no-df</tt> est spécifiée. Vu que certains
    systèmes d'exploitation génèrent des paquets
    <i>don't fragment</i> avec un champ d'identification à
    zéeo au niveau de l'en-tête IP, il est
    recommandé d'utiliser <tt>no-df</tt> conjointement avec
    l'option <tt>random-id</tt>.

<dt><tt>random-id</tt> 
<dd>Remplace le champ d'identification IP des paquets sortants avec des
    valeurs aléatoires pour contourner les valeurs
    prévisibles utilisées par certains systèmes
    d'exploitation. Cette option s'applique uniquement pour les paquets
    sortants qui ne sont pas fragmentés après le
    réassemblage optionnel des paquets.

<dt><tt>min-ttl <i>num</i></tt> 
<dd>S'assure que le Time To Live (TTL) est au moins égal à
    la valeur donnée en argument dans les en-têtes des
    paquets IP.

<dt><tt>max-mss <i>num</i></tt> 
<dd>S'assure que le Maximum Segment Size (MSS) est au plus égal
    à la valeur donnée en argument dans les en-têtes
    des paquets TCP.

<dt><tt>fragment reassemble</tt> 
<dd>Met dans une mémoire tampon les fragments de paquets et les
    réassemble en paquet complet avant de les transmettre au
    moteur de filtrage. Les règles de filtrage peuvent ainsi se
    charger de filtrer le paquet complet sans se soucier des fragments.
    L'inconvénient est la mémoire additionnelle
    nécessaire pour le tampon contenant les fragments de paquets.
    C'est le comportement par défaut lorsqu'aucune option
    <tt>fragment</tt> n'est spécifiée. C'est aussi la
    seule option <tt>fragment</tt> qui fonctionne avec la NAT.

<dt><tt>fragment crop</tt> 
<dd>Supprime les fragments dupliqués et tout chevauchement entre
    fragment. Contrairement à <tt>fragment reassemble</tt>, les
    fragments ne sont pas gardés en mémoire tampon mais
    sont transmis dès leur arrivée.

<dt><tt>fragment drop-ovl</tt> 
<dd>Assez similaire à <tt>fragment crop</tt>. Tous les paquets
    fragments de paquets dupliqués et se chevauchant sont
    supprimés ainsi que tous les fragments suivants qui
    correspondent à ces fragments.

<dt><tt>reassemble tcp</tt>
<dd>Normalise de manière "stateful" les connexions TCP. Lorsque
    <tt>scrub reassemble tcp</tt> est utilisée, une direction
    (in/out) peut ne pas être spécifiée. Les
    normalisations suivantes sont effectuées :
        <ul>
        <li>Aucune extrêmité de la connexion n'est
            autorisée à réduire le TTL IP. Cette
            normalisation est appliquée pour assurer une
            protection contre un attaquant qui envoie un paquet de telle
            façon à ce que ce dernier atteigne le
            pare-feu, affecte les informations d'état
            mémorisées pour cette connexion, et expire
            avant d'atteindre sa destination finale. Le TTL de tous les
            paquets est positionné à la valeur la plus
            haute observée pour la connexion.
        <li>Module les "timestamps" RFC 1323 dans l'en-tête des
            paquets TCP avec un nombre aléatoire. Ceci peut
            empêcher un observateur de déduire le "uptime"
            d'un hôte ou de deviner combien de hôtes sont
            derrière une passerelle NAT.
        </ul>
</dl>

<p>
Exemples :
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp
</tt>
</blockquote>

<p>
[<a href="options.html">Précédent : Options de
Fonctionnement</a>]
[<a href="index.html">Index</a>]
[<a href="anchors.html">Suivant : Ancres</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: scrub.html,v 1.12 ]<br>
$Translation: scrub.html,v 1.12 2005/02/13 16:52:29 svincent Exp $<br>
-->
$OpenBSD: scrub.html,v 1.11 2005/02/13 17:41:41 saad Exp $
</small>

</body>
</html> 
