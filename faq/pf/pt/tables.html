<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Tabelas</title><link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="macros.html">Anterior: Listas e Macros</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="filter.html">Próximo: Filtragem de Pacotes</a>]

<p>
<h1><font color="#e00000">PF: Tabelas</font></h1>

<hr>

<h3>Conteúdo</h3>
<ul>
<li><a href="#intro">Introdução</a>
<li><a href="#config">Configuração</a>
<li><a href="#manip">Manipulação com o <tt>pfctl</tt></a>
<li><a href="#addr">Especificação de Endereços</a>
<li><a href="#match">Correspondência de Endereços</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introdução</h2>
Uma tabela é usada para armazenar um grupo de endereços IPv4 e/ou IPv6. 
Pesquisas em tabelas são muito rápidas e consumem menos memória e tempo de
processamento do que as <a href="macros.html#lists">listas</a>.
Por essa razão, uma tabela é ideal para armazenar uma grande quantidade
de endereços, já que o tempo de pesquisa em uma tabela com
50.000 endereços é apenas ligeiramente maior do que em uma contendo
50 endereços.  Tabelas podem ser usadas nos seguintes caminhos:
<ul>
<li>endereço de origem e/ou destino em regras de filtragem. 
<li>endereços de tradução e redirecionamento com regras de 
<tt>nat-to</tt> e <tt>rdr-to</tt>, reespectivamente.
<li>endereço de destino em opções <tt>route-to</tt>, <tt>reply-to</tt>
    e <tt>dup-to</tt> das regras de filtragem.
</ul>

<p>
Tabelas são criadas no
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.0"><tt>pf.conf</tt></a>
ou utilizando o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
>pfctl(8)</a>.

<a name="config"></a>
<h2>Configuração</h2>
No <tt>pf.conf</tt>, tabelas são criadas usando a diretiva <tt>table</tt>.
Os atributos a seguir podem ser especificados para cada tabela:
<ul>
<li><tt>const</tt> - uma vez criada, o conteúdo da tabela não pode ser
    alterado. Quando esse atributo não é especificado,
    o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
    >pfctl(8)</a> pode ser usado para adicionar ou remover endereços da
    tabela a qualquer momento, mesmo quando o sistema estiver
    em execução no nível de segurança
    (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7">securelevel(7)</a>)
    dois ou maior.
<li><tt>persist</tt> - faz com que o kernel mantenha a tabela na memória
    mesmo quando nenhuma regra faz referência a ela. Sem esse atributo,
    o kernel removerá automaticamente a tabela quando a última regra
    referenciando-a for liberada.
</ul>

<p>
Exemplo:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Endereços também podem ser especificados usando o modificador de negação
(ou "not") desta forma:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
A tabela <tt>goodguys</tt> agora corresponde a todos os endereços na
rede 192.0.2.0/24, exceto 192.0.2.5.

<p>
Note que nomes de tabelas são sempre colocados entre &lt; &gt;.

<p>
Tabelas também podem ser populadas via arquivos de texto contendo uma
lista de endereços IP e redes:
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
O arquivo <tt>/etc/spammers</tt> deve conter uma lista de endereços IP
e/ou blocos de rede
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>,
um por linha.
Toda linha começando com <tt>#</tt> é tratada como um comentário e é
ignorada.

<a name="manip"></a>
<h2>Manipulação com o <tt>pfctl</tt></h2>
Tabelas podem ser manipuladas em tempo real usando o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
>pfctl(8)</a>.
Por exemplo, para adicionar entradas à tabela &lt;spammers&gt; criada
acima:
<blockquote>
<tt># pfctl -t spammers -T add 218.70.0.0/16</tt>
</blockquote>

<p>
Caso a tabela &lt;spammers&gt; ainda não exista, ela será criada.
Para listar os endereços na tabela:
<blockquote>
<tt># pfctl -t spammers -T show</tt>
</blockquote>
O argumento <tt>-v</tt> também pode ser usado com <tt>-Tshow</tt>
para mostrar as estatísticas de cada entrada da tabela. Para remover
endereços de uma tabela:
<blockquote>
<tt>
# pfctl -t spammers -T delete 218.70.0.0/16
</tt>
</blockquote>

<p>
Para mais informações sobre manipulação de tabelas com o <tt>pfctl</tt>,
por favor leia a página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
>pfctl(8)</a>.

<a name="addr"></a>
<h2>Especificação de Endereços</h2>
Além de especificar máquinas através de endereços IP, elas também podem
ser referenciadas pelo nome da máquina. Quando o nome da máquina é
resolvido para um endereço IP, todos os endereços IPv4 e IPv6
resultantes são inseridos na tabela. Endereços IP também podem ser
inseridos na tabela especificando-se um nome de interface válido ou a
palavra-chave <tt>self</tt>.
A tabela conterá então todos os endereços IP atribuídos àquela interface
ou à máquina, respectivamente (incluindo endereço de loopback).<br>
<br>
Uma limitação ao especificar endereços é que <tt>0.0.0.0/0</tt> e
<tt>0/0</tt> não funcionam em tabelas.
A alternativa é escrever esses endereços manualmente ou fazer uso de uma
<a href="macros.html#macros">macro</a>.

<a name="match"></a>
<h2>Correspondência de Endereços</h2>
Uma pesquisa de endereço em uma tabela retorna a entrada que corresponda
mais precisamente ao endereço. Isso permite a criação de tabelas como:
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt;<br>
</tt>
</blockquote>

<p>
Qualquer pacote chegando em <tt>dc0</tt> terá seu endereço de origem
comparado aos endereços da tabela <tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - o correspondente mais próximo é 172.16.0.0/16; o
    pacote corresponde à tabela e será aceito
<li>172.16.1.25 - a entrada mais próxima é !172.16.1.0/24; o pacote
    corresponde a uma entrada na tabela, mas essa entrada está negada
    (usa o modificador "!"); portanto o pacote não corresponde à tabela
    e será bloqueado
<li>172.16.1.100 - corresponde exatamente a 172.16.1.100; o pacote
    corresponde à tabela e será aceito
<li>10.1.4.55 - não corresponde a nenhuma entrada na tabela e, portanto,
    será bloqueado
</ul>

<p>
[<a href="macros.html">Anterior: Listas e Macros</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="filter.html">Próximo: Filtragem de Pacotes</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: tables.html,v 1.30 ]<br>
$Translation: tables.html,v 1.14 2012/01/02 16:38:56 renato Exp $<br>
-->
$OpenBSD: tables.html,v 1.14 2012/01/03 08:19:10 ajacoutot Exp $
</small>

</body>
</html>
