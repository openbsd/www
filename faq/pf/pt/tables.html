<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Tabelas</title><link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq,pf">
<meta name="distribution" content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="macros.html">Anterior: Listas e Macros</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="filter.html">Pr&oacute;ximo: Filtragem de Pacotes</a>]

<p>
<h1><font color="#e00000">PF: Tabelas</font></h1>

<hr>

<h3>Conte&uacute;do</h3>
<ul>
<li><a href="#intro">Introdu&ccedil;&atilde;o</a>
<li><a href="#config">Configura&ccedil;&atilde;o</a>
<li><a href="#manip">Manipulando com <tt>pfctl</tt></a>
<li><a href="#addr">Especificando Endere&ccedil;os</a>
<li><a href="#match">Pesquisa de Endere&ccedil;os</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introdu&ccedil;&atilde;o</h2>
Uma tabela &eacute; usada para armazenar endere&ccedil;os IPv4 e/ou IPv6. Pesquisas 
em tabelas s&atilde;o muito r&aacute;pidas, consumindo menos mem&oacute;ria e tempo de 
processamento do que as <a href="macros.html#lists">listas</a>. Por 
esta raz&atilde;o, uma tabela &eacute; ideal para armazenar grandes n&uacute;meros de 
endere&ccedil;os j&aacute; que o tempo de pesquisa numa tabela com 50,000 endere&ccedil;os 
&eacute; apenas ligeiramente maior do que para uma contendo 50 endere&ccedil;os. Tabelas podem 
ser usadas das seguintes maneiras:
<ul>
<li>endere&ccedil;o de origem e/ou destino em regras de 
<a href="filter.html">filtragem</a>, <a href="scrub.html">scrub</a>,
<a href="nat.html">NAT</a> e <a href="rdr.html">redirecionamento</a>.
<li>endere&ccedil;os de tradu&ccedil;&atilde;o em regras <a href="nat.html">NAT</a>.
<li>endere&ccedil;os para redirecionamento em regras de <a href="rdr.html">redirecionamento</a>.
<li>endere&ccedil;os de destino em op&ccedil;&otilde;es <tt>route-to</tt>, <tt>reply-to</tt> e
<tt>dup-to</tt> nas regras de filtragem.
</ul>

<p>
Tabelas s&atilde;o criadas tanto no 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"><tt>pf.conf</tt></a> ou utilizando o 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>pfctl(8)</a>.

<a name="config"></a>
<h2>Configura&ccedil;&atilde;o</h2>
No <tt>pf.conf</tt>, tabelas s&atilde;o criadas usando a diretiva <tt>table</tt>.
Os atributos a seguir podem ser especificados para cada tabela:
<ul>
<li><tt>const</tt> - o conte&uacute;do da tabela n&atilde;o pode ser alterado, uma vez que 
ela tenha sido criada. Quando este atributo n&atilde;o &eacute; especificado, o 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>pfctl(8)</a> pode ser usado para adicionar ou remover endere&ccedil;os da tabela
a qualquer momento, mesmo quando o sistema estiver usando 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7&amp;manpath=OpenBSD+3.7">securelevel(7)</a> no n&iacute;vel dois ou maior.
<li><tt>persist</tt> - faz com que o kernel mantenha a tabela em mem&oacute;ria
mesmo quando nenhuma regra fa&ccedil;a refer&ecirc;ncia a mesma. Sem esse atributo, o kernel 
remover&aacute; a tabela automaticamente quando a &uacute;ltima regra referenciando a tabela 
for removida. 
</ul>

<p>
Exemplo:
</p><blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Endere&ccedil;os tamb&eacute;m podem ser especificados usando o modificador de nega&ccedil;&atilde;o
dessa forma:
</p><blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
A tabela <tt>goodguys</tt> agora casar&aacute; com todos endere&ccedil;os na rede 
192.0.2.0/24 exceto 192.0.2.5.

<p>
Note que nomes de tabelas s&atilde;o sempre colocados entre &lt; &gt;. 

<p>
Tabelas tamb&eacute;m podem ser populadas via arquivos texto contendo listas 
de endere&ccedil;os IP e redes:
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
O arquivo <tt>/etc/spammers</tt> deve conter uma lista de endere&ccedil;os IP 
e/ou blocos de rede <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>, 
um por linha.
Qualquer linha come&ccedil;ando com <tt>#</tt> &eacute; tratado como coment&aacute;rio e ignorada.

<a name="manip"></a>
<h2>Manipulando com <tt>pfctl</tt></h2>
Tabelas podem ser manipuladas em tempo real usando o 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>pfctl(8)</a>. Por
exemplo, para adicionar entradas a tabela &lt;spammers&gt; criada acima:
<blockquote>
<tt># pfctl -t spammers -T add 218.70.0.0/16</tt>
</blockquote>

<p>
Caso a tabela &lt;spammers&gt; ainda n&atilde;o exista ela ser&aacute; criada.
Para listar os endere&ccedil;os na tabela:
<blockquote>
<tt># pfctl -t spammers -T show</tt>
</blockquote>
O argumento <tt>-v</tt> tamb&eacute;m pode ser usado com <tt>-Tshow</tt> 
para mostrar estat&iacute;sticas para cada entrada da tabela. Para remover 
endere&ccedil;os de uma tabela:
<blockquote>
<tt>
# pfctl -t spammers -T delete 218.70.0.0/16
</tt>
</blockquote>

<p>
Para mais informa&ccedil;oes sobre manipula&ccedil;&atilde;o de tabelas com <tt>pfctl</tt>,
por favor consulte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>pfctl(8)</a>.

<a name="addr"></a>
</p><h2>Especificando Endere&ccedil;os</h2>
Al&eacute;m de especificar hosts por endere&ccedil;o, eles tamb&eacute;m podem ser 
referenciados pelo nome de host.  Quando o nome de host &eacute; resolvido para 
um endere&ccedil;o IP, todos os endere&ccedil;os IPv4 e IPv6 resultantes s&atilde;o 
inseridos na tabela. Endere&ccedil;os IP tamb&eacute;m podem ser inseridos na 
tabela especificando-se um nome de interface v&aacute;lido ou a 
palavra-chave <tt>self</tt>.
A tabela conter&aacute; ent&atilde;o todos endere&ccedil;os IP atribu&iacute;dos aquela 
interface ou &agrave; m&aacute;quina respectivamente (incluindo endere&ccedil;o de loopback).<br>
<br>
Uma limita&ccedil;&atilde;o ao se especificar endere&ccedil;os &eacute; que <tt>0.0.0.0/0</tt> e
<tt>0/0</tt> n&atilde;o funcionar&atilde;o em tabelas.
A alternativa &eacute; escrever esse endere&ccedil;o manualmente ou fazer uso de uma 
<a href="macros.html#macros">macro</a>.

<a name="match"></a>
<h2>Pesquisa de Endere&ccedil;os</h2>
Uma pesquisa de endere&ccedil;o numa tabela retornar&aacute; a entrada que combine mais
precisamente com o endere&ccedil;o. Isso permite a cria&ccedil;&atilde;o de tabelas como:
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0 all<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Qualquer pacote chegando em <tt>dc0</tt> ter&aacute; seu endere&ccedil;o de origem 
comparado com a tabela <tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - a entrada mais pr&oacute;xima &eacute; 172.16.0.0/16; o pacote 
casa com a tabela e ser&aacute; aceito
<li>172.16.1.25 -  a entrada mais pr&oacute;xima &eacute; !172.16.1.0/24; o 
pacote casa com uma entrada na tabela, mas essa entrada &eacute; uma nega&ccedil;&atilde;o
(usa o modificador "!"); portanto o pacote n&atilde;o casa com a tabela e 
ser&aacute; bloqueado
<li>172.16.1.100 - casa exatamente com 172.16.1.100; o pacote casa com a
tabela e ser&aacute; aceito
<li>10.1.4.55 - n&atilde;o combina com nenhuma entrada na tabela, portanto 
ser&aacute; bloqueado
</ul>

<p>
[<a href="macros.html">Anterior: Listas e Macros</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="filter.html">Pr&oacute;ximo: Filtragem de Pacotes</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: tables.html,v 1.15 ]<br>
$Translation: tables.html,v 1.2 2005/05/27 15:11:33 dsantos Exp $<br>
$OpenBSD: tables.html,v 1.2 2005/05/30 13:52:07 saad Exp $ 
</small>

</body>
</html>
