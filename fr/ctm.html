<!DOCTYPE HTML PUBLIC  "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>CTM</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD/CTM page">
<meta name="keywords" content="openbsd,ctm">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-2004 by OpenBSD.">
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">

<center>
<img alt="CTM for OpenBSD" src="../images/bsdctm.gif" width=401 height=126>
</center>

<h3><font color="#0000e0">Qu'est ce que CTM ? </font></h3>

<p>
CTM est un système conçu par Poul-Henning Kamp pour
distribuer, de façon régulière et par courrier
électronique, les changements effectués sur une
arborescence de sources. C'est un bon moyen de rester à jour avec
les sources actuelles ou l'arbre CVS si vous avez une mauvaise connexion
Internet (par exemple un modem).

<p>
Le CTM d'OpenBSD distribue tous les modules du dépôt CVS
OpenBSD ainsi que des versions extraites de plusieurs de ces modules.
CTM utilise très peu de bande passante pour distribuer les
changements dans les sources et les compresse en utilisant <tt><b>gzip
-9</b></tt>. En comparaison avec <a href="cvsup.html">CVSup</a>, CTM est
écrit en langage C et est donc dispnible pour toutes les plates-
formes supportées par OpenBSD.

<p>
Pour <b>tous</b> problèmes, suggestions et questions ayant un
rapport avec CTM, veuillez contacter le mainteneur de CTM
<a href="mailto:hgw@d1906.inka.de">Hans Günter Weigand</a>.
<small>(Veuillez ne pas demander à d'autres personnes du projet
OpenBSD une aide sur CTM, elles sont occupées à d'autres
choses. Merci).</small>


<h3><font color="#0000e0">Comment est-ce que cela fonctionne&nbsp;?
    </font></h3>

<p>
L'idée de CTM est que vous vous inscrivez à une liste de
discussion spécifique à un module CVS ou à une
arborescence donnée. Chaque jour, vous recevez un message
électronique contenant les changements sur l'arbre pendant cette
période. Une série de différences est appelé
un <b>delta</b>. Le serveur de CTM génère des deltas
toutes les douzes heures.

<p>
Vous commencer avec une série de base sur laquelle vous
appliquerez les deltas ultérieurs. Pour commencer avec CTM vous
devez télécharger la dernière série de base
ainsi que tous les deltas générés après
elle. Une fois que vous avez traité tout ça, vous pouvez
appliquer les deltas ultérieurs au fur et à mesure de leur
réception. La série de base est découpée en
morceaux de 1400k chacun pour permettre un téléchargement
aisé au travers des mauvaises connexions.

<p>
Les séries de base sont générées environ
tous les 50 deltas, ce qui fait que vous n'avez jamais plus de 50 deltas
à récupérer.

<p>
Il y a pour l'instant deux types de fichiers de base. Pendant un certain
temps, nous avons fait des fichiers <tt><b>tar.gz</b></tt> à la
main, mais nous sommes maintenant revenus à de vrais deltas CTM
de base. Ceux- ci contiennent une somme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=md5&amp;sektion=1">md5(1)</a>
et sont générés automatiquement, les rendants donc
plus sûrs. Vous pouvez distinguer les deux types de sets de base
grâce à leurs noms. Un example pour un fichier
<tt><b>tar.gz</b></tt> est <tt><b>OpenBSD-cvs.1450.tar.gz</b></tt> alors
qu'un delta CTM de base serait nommé <tt><b>OpenBSD-
cvs.1500A.gz</b></tt>. Voir ci-dessous pour des instructions
détaillées.

<h3><font color="#0000e0">Quel est la bande passante utilisée par
    CTM ? </font></h3>

<p>
Vous obtenez la série de base ainsi que tous les deltas par ftp
depuis les sites donnés ci-dessous. Les tailles sont :

<ul>
<li>Environ 215 Mo pour OpenBSD-cvs
<li>Environ 40 Mo pour OpenBSD-cvs-x11
<li>Environ 65 Mo pour OpenBSD-cvs-xf4
<li>Environ 83 Mo pour OpenBSD-src
<li>Environ 36 Mo pour OpenBSD-src-x11
<li>Environ 4 Mo pour OpenBSD-ports
<li>Gardez à l'esprit qu'il s'agit de tailles compressées.
    Comptez environ 5 fois ces valeurs pour les fichiers
    décompressés.
<li>La taille des deltas varie de 10k à 100k et parfois quelques
    Mo.
<li>CTM découpe les deltas en messages de 100k qui sont ré-
    assemblés automatiquement.
<li>Si un delta est plus gros que 5MB, il n'est pas envoyé par
    courrier éléctronique. À la plce, vous recevrez des
    instructions sur comment le récupèrer par FTP. De
    larges mises à jour par CTM sont rares et ne se produisent
    que lorsqu'un composant majeur du système est mis à
    jour, tel que binutils, Perl, XFree86, etc, ou lorsqu'un tag CVS est
    appliqué au dépôt CVS.
</ul>

<h3><font color="#0000e0">Comment utiliser CTM ?</font></h3>

<ul>
<li>Inscrivez vous aux listes de diffusion CTM pour les séries
    que vous voulez.
<p>
   Il y a plusieurs listes de diffusion pour CTM. Il y a une liste pour
   les mises à jour des mises à jour de l'arborescence
   cvs, une liste pour l'arborescence des sources, deux pour X11
   (sources et cvs), une pour les ports et une pour les messages du
   générateur de delta ctm.
   <p>
   Les commandes suivantes vous inscrirons aux listes appropriées
   :
<p>
Pour l'arborescence CVS (les modules CVSROOT, ports, src et www, mais
sans les modules X11 et XF4) :
<pre>
      echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org
</pre>
Pour le module X11 de l'arborescence CVS :
<pre>
      echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org
</pre>
Pour le module XF4 du dépôt CVS :
<pre>
      echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org       
</pre>
Pour une copie du module src :
<pre>
      echo subscribe-OpenBSD-src | mail majordomo@OpenBSD.org
</pre>
Pour une copie du module X11 :
<pre>
      echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org
</pre>
Pour une copie du module des ports :
<pre>
      echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org
</pre>
Pour les journaux CTM :
<pre>
      echo subscribe ctm-log | mail majordomo@OpenBSD.org
</pre>


<p>
<li>Installez le programme CTM depuis un package ou depuis les ports.
    Vous trouverez le port dans
<tt><b>/usr/ports/devel/ctm</b></tt>.

</ul>
<b>Remarque :</b> Les exemples ci-dessous ne couvrent que OpenBSD-cvs
   pour plus de clarté. Les autres sources sont à
   gérer de la même façon.

<p><ul>

<li>Récupérez la série de base depuis un site FTP.
    Vous le trouverez dans le sous répertoire <b>base/OpenBSD-
    cvs</b>. Récupérez tous les fichiers dans ce
    répertoire, et une fois que vous les avez tous, vous pouvez
    créer votre arborescence des sources avec les commandes
    suivantes en fonction du type de fichier que vous avez :

<pre>
       cat split/OpenBSD-cvs.1500A.gz.* &gt; OpenBSD-cvs.1500A.gz
       cd cible
       ctm -v -v -v .../OpenBSD-cvs.1500A.gz
</pre>
 <p>
ou

<pre>
       cat split/OpenBSD-cvs.1500.tar.gz.* &gt; OpenBSD-cvs.1500.tar.gz
       cd cible
       tar -xzvf .../OpenBSD-cvs.1500.tar.gz
</pre>

<p>
où <tt><b>split</b></tt> est le répertoire dans lequel
vous aurez placé les fichiers téléchargés et
<tt><b>cible</b></tt> est l'endroit choisit pour décompresser les
sources.

<p>
Il n'est pas nécessaire de garder ces fichiers, si vous
êtes sur d'avoir une arborescence complète. Mais vous
pouvez garder les fichiers de base pour des besoins de sauvegarde.
Cependant, assurez vous de noter le numéro de la base avant de
continuer.

<p>
<li>Maintenant, vous avez besoin de récupérer les deltas
    qui ont été générés depuis la
    création de la série de base. Allez sur des sites FTP
    listés çi-dessous, dans le sous-répertoire 
    <tt><b>OpenBSD-cvs</b></tt> et récupérez tous les
    fichiers dont le numéro est <it>plus grand</it> que le
    numéro de la base utilisée. Ensuite appliquer ces
    deltas :

<pre>
       cd cible
       ctm -v -v -v deltas/OpenBSD-cvs.*
</pre>

<p>
où <tt><b>cible</b></tt> est le répertoire où se
trouvent vos sources, et <tt><b>deltas</b></tt> l'endroit où vous
avez placé vos deltas.


<p>
<li>Attendez d'obtenir votre premier delta de la liste.
<p>
<li>Décompressez, assemblez et appliquez le delta CTM en
    utilisant <tt><b>ctm_rmail</b></tt>.
<p>

<pre>
       ctm_rmail -p /tmp -d deltas -b cible folder
</pre>

<p>
où <tt><b>folder</b></tt> est le répertoire de mails
contenant les messages de delta. Ceci va décoder les deltas CTM
et les sauvegardera dans le répertoire <tt><b>deltas</b></tt>. Un
delta ser aun fichier de la forme <tt><b>OpenBSD-
cvs.<var>XXXX</var>.gz</b></tt>, où <var>XXXX</var> est le
numéro du delta. Ensuite le delta sera apppliqué dans
l'arbre local situé dans <tt><b>target</b></tt>, l'endroit
où vous avez décompressé le set de base.

<p>
Répetez cette opération à chaque fois que vous
recevez un delta de la liste. Si vous voulez, vous pouvez automatiser
cette tâche à l'aide de procmail, maildrop où tout
autre programme similaire de la <a href="ports.html">collection des
ports</a>.
</ul>

<p>
Voici la liste des serveurs FTP contenant les deltas CTM :

<ul>
<li>Le serveur FTP primaire est :
<p>
<a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
ftp://togetic.kd85.com:/pub/OpenBSD-ctm/
</a>.
Ce serveur est automatiquement mis à jour par le processus de
génération des deltas. Les sets de base sont disponibles
en tant que gros fichiers dans le répertoire
<tt><b>base</b></tt>. Les fichiers éclatés sont dans
<tt><b>base-split</b></tt>.
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
Ce serveur est mis à jour par les deltas CTM reçus par la
liste de discussion. De plus, il possède les deltas de base dans
le sous-répertoire <tt><b>base</b></tt>, dupliqué à
partir de
<a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
ftp://togetic.kd85.com:/pub/OpenBSD-ctm/</a>.
</ul>

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
est identique à
<p>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
et est un miroir de
<a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org
</a>
.
</ul>

<p>
<b>REMARQUE</B> <a href="mailto:hgw@d1906.inka.de">Je suis</a>
   très interessé pour trouver d'autres sites à
   travers le monde qui voudraient faire un miroir de ces deltas.
<p>

<h3><font color="#0000e0">Dois-je utiliser l'arborescence src ou
    cvs ? </font> </h3>

<p>
Cela dépend de votre place disque entre autre. Étant donné
que CTM n'agit pas sur des fichiers qui ont été
modifié en dehors du processus ctm, le meilleur choix est sans
doute l'arborescence <a href="anoncvs.html">CVS</a>. De cette
façon, vous pouvez récupérer une arborescence src
depuis votre arborescence CVS, suivre une branche stable et conserver
vos modifications locales dans votre arborescence des sources. CVS est
assez "intelligent" pour intégrer vos changements locaux. Vous
pouvez aussi utiliser toutes les commandes CVS à l'exception des
commandes telles que <tt><b>cvs commit</b></tt> et <tt><b>cvs
tag</b></tt>.

<p>
Le désavantage par contre, est la quantité de place disque
que cela prend. Une arborescence des sources est d'environ 370Mo, mais
si vous avez une arborescence CVS, vous aurez besoin de 1Go pour celle-
ci, <b>en plus</b> des 370Mo pour les sources. Ceci ne compte pas les
100Mo pour les fichiers gérérés lors d'une
compilation (cela dépend de l'architecture).

<p>
Si vous venez juste d'obtenir l'arborescence des source, vous aurez
besoin de gérer les modifications locales. Une manière de
faire ceci est d'utiliser le système de fichiers <b>union</b>
(voir
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&amp;sektion=8">mount_union(8)</a>),
bien qu'il ait été rapporté que le système
de fichiers <b>union</b> peut être instable si les couches
inférieures et supérieures résident sur le
même système de fichiers physique. Si vous placez vos
couches supérieures et inférieures sur des systèmes
de fichiers différents vous ne devriez avoir aucun
problème. Un exemple :

<p>
Supposons que votre arborescence mise à jour de CTM se trouve
dans <tt><b>/usr/src-ctm</b></tt> et que votre véritable
arborescence des sources (à partir de laquelle vous faites vos
modifications et compilations) se trouve dans <tt><b>/usr/src</b></tt>.
<tt><b>/usr/src</b></tt> doit initialement être un
répertoire vide. La commande suivante va configurer votre union
mount :

<pre>
       mount -t union -o -b /usr/src-ctm /usr/src
<pre>

<p>
Les modifications faites aux fichiers se trouvant dans
<tt><b>/usr/src</b></tt> deviendront un fichier contenu dans
<tt><b>/usr/src</b></tt>, masquant celui dans
<tt><b>src-ctm</b></tt>. Si des changements sont faits via CTM dans
l'arborescence <tt><b>src-ctm</b></tt> sous jacente, ces changements
ne seront <b>pas</b> vus s'il y a un fichier dans la couche
supérieure les masquant.

<p>
Vous devriez démonter périodiquement l'union et chercher
les fichiers locaux au système de fichiers union.
<pre>
    umount /usr/src
    find /usr/src -type f
<pre>
Les commandes <tt><b>ls -W</b></tt> et <tt><b>rm -W</b></tt> seront
utiles aussi, car les objets nommés "whiteouts" dans
<tt><b>/usr/src</b></tt> cacheront aussi des fichiers dans
<tt><b>src-ctm</b></tt>. 

<p>
Si vous avez l'arborescence CVS, vous pouvez utiliser la commande
<tt><b>cvs checkout</b></tt> pour en récupérer une
arborescence des sources, et à chaque fois que vous mettez
à jour avec CTM, vous pouvez utiliser <tt><b>cvs update</b></tt>
pour mettre à jour votre arborescence des sources.
 
<p>
Pour obtenir votre arborescence src originelle :
<pre>
    cd /usr
    cvs -qd VOTRE_DEPOT_CVS checkout -P src
</pre>
<p>
après chaque mise à jour CTM :
<pre>
    cd /usr/src
    cvs -q update -Pd
</pre>

<h3><font color="#0000e0">Est-ce que ctm est stable sous OpenBSD ?
    </font></h3>

CTM est utilisé depuis plus de cinq ans par OpenBSD, et par
FreeBSD depuis encore plus longtemps. CTM est stable et solide.

<h3><font color="#0000e0">Quel futur pour CTM ? </font></h3>

Il y a un certain nombre de changements et optimisations possibles
(bien que petits). Parmi ceux-ci :

<ul>
<li> CTM n'envoie jamais un delta de plus de 5Mo par email. Cela
     pourrait être changé de deux façons : la taille
     maximale des deltas pourrait être changées, ou une
     file pourrait être installée, depuis laquelle, seuls
     un certain nombre de messages seraient envoyés
     journalièrement. Par exemple, si un delta a une taille de
     6Mo, il est découpé en 96 emails. Le premier jour,
     les 50 premiers messages sont envoyés, et le second jour,
     les 46 restants sont envoyés, ainsi que les 4 messages du
     delta suivant.
<li> Le logiciel CTM pourrait être réécrit, ou au
     moins corrigé. Sa mise ne oeuvre en C n'est pas un exemple
     de bonne programmation. Ça serait de plus une bonne
     opportunité pour ajouter de nouvelles fonctionnalités
     comme la signature des deltas CTM avec PGP.
</ul>

Envoyez <a href="mailto:hgw@d1906.inka.de">moi</a> un courrier
électronique pour me donner vos avis et souhaits&nbsp;!


<h3><font color="#0000e0">Plus d'informations</font></h3>

Si vous voulez en savoir plus sur CTM, un bon endroit pour
démarrer est le manuel FreeBSD :

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

Il y a aussi des pages de manuel pour les utilitaires CTM.

<h3><font color="#0000e0">Résumé&nbsp;: </font></h3>

<p>

<ul>
<li> Listes de discussion :

   <ul>
   <li> <tt>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</tt>
   <li> <tt>echo subscribe ctm-log | mail majordomo@OpenBSD.org</tt>
   </ul>

<li> FTP (pour la série de base et les deltas)

   <ul>
   <li> <a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
        ftp://togetic.kd85.com:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
         ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
        ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
         ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   </ul>
</ul>

<p>
Les annonces et remarques importantes à propos de CTM seront
postées sur la liste de diffusion announce@OpenBSD.org.

<p>

<h3><font color="#0000e0">Remerciements</font></h3>

<ul>
<li> Poul-Henning Kamp (phk@FreeBSD.org) pour avoir rendu CTM possible
     et avoir aidé dans le processus de génération
     de deltas.

<li> Theo de Raadt (deraadt@theos.com) pour avoir rendu OpenBSD possible
     et avoir donné les ressources nécessaires pour
     créer les premiers deltas ctm sur cvs.OpenBSD.org
     (maintenant ils sont générés ailleurs) et pour
     la magie du serveur de noms.

<li> Todd C. Miller (millert@OpenBSD.org) pour la mise en place et
     l'entretien des listes de discussion CTM.

<li> Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmberg (mho@OpenBSD.org) et Wolfram Schneider
     (wosch@FreeBSD.org) pour la mise en place de l'espace ftp pour les
     séries de base et les deltas sur ctm.*OpenBSD.org

<li>  Thomas Graichen (graichen@OpenBSD.org) pour avoir commencé
      CTM pour OpenBSD et l'avoir maintenu pendant des années

<li> Wim Vandeputte (wvdputte@OpenBSD.org) pour l'hébergement de
     CTM

<li> ... et tous les autres qui ont contribué indirectement
</ul>

<p>
Le logo OpenBSD/CTM a été dessiné pour le projet
OpenBSD par <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD"
 /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: ctm.html,v 1.27 ]<br>
$Translation: ctm.html,v 1.23 2005/05/11 03:42:22 aanriot Exp $<br>
-->
$OpenBSD: ctm.html,v 1.19 2005/05/12 06:42:19 saad Exp $
</small>

</body>
</html>
