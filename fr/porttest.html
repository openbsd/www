<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
    <meta name="resource-type" content="document">
    <meta name="description" content="Guide de Tests des Ports d'OpenBSD">
    <meta name="keywords" content="openbsd,ports, test">
    <meta name="distribution" content="global">
    <meta name="copyright" content="copyright 2002-2004 par OpenBSD.">
    <title>Guide de Tests des Ports d'OpenBSD</title>
  </head>

  <body text="#000000" bgcolor="#FFFFFF" link="#23238E">
    <a href="index.html"><img alt="[OpenBSD]" height="30" width="141" 
    src="../images/smalltitle.gif" border="0"></a> 

    
<h2><font color="#e00000">Guide de Tests des Ports</font></h2>
    <hr>

    <h2><font color="#0000e0">Sommaire</font></h2>

    <ul>
      <li><a href="#Introduction">Introduction</a>

      <li><a href="#How">Comment</a>

      <li><a href="#First">Premier pas</a>

      <li><a href="#Testing">Tests</a>

      <li><a href="#Commenting">Commentaires</a>

      <li><a href="#More">Plus de tests</a>
    </ul>
    <hr>

    <h2><a name="Introduction"><font color=
    "#0000e0">Introduction</font></a></h2>

    
<p>
L'arborescence <a href="ports.html">des ports</a> est un dispositif
conséquent qui permet aux utilisateurs d'OpenBSD d'utiliser des
applications tierces sans perdre du temps à appliquer des correctifs,
configurer ces applications et les installer séparement. Tout ce travail
est effectué par un groupe de volontaires qui passent leur temps à
porter et à tester des applications sur les différentes plates-formes
supportées par OpenBSD. Beaucoup de gens pensent qu'ils ne peuvent pas
contribuer à ce processus car ils n'ont pas les connaissances
suffisantes; c'est faux car ils peuvent toujours aider les responsables
de ports à travailler mieux et plus vite.
</p>

<h2><a name="How"><font color="#0000e0">Comment</font></a></h2>

    
<p>
Tester les nouveautés ou les nouveaux ports soumis sur la <a
href="mail.html">liste de diffusion des ports</a>. En faisant cela, vous
réduisez la latence des changements effectués et vous augmentez
également le nombre de ports qui vont être rajoutés (beaucoup de ports
ne sont pas rajoutés car ils ne sont pas assez testés !).
</p>

<h2><a name="First"><font color="#0000e0">Premier pas</font></a></h2>

    
<p>
L'arborescence des ports est developpée pour
<a href="../plus.html">OpenBSD-current</a>; il n'y a aucune garantie que
les nouveaux ports fonctionneront correctement sur les autres branches.
Cela signifie également que vous devez mettre à jour votre système ainsi
que l'arborescence des ports en -current (des instructions pour savoir
comment faire peuvent être trouvées dans les pages <a
href="anoncvs.html">anoncvs</a> et <a href="../faq/current.html">Suivre
la branche current</a>. Il est également recommandé de vous abonner aux
<a href="mail.html">listes de diffusion</a> ports et ports-changes. De
cette façon vous serez averti des nouveaux ports ou des ports mis à jour
ainsi que des changements effectués dans l'arborescence des ports.</p>
        
<h2><a name="Testing"><font color="#0000e0">Tests</font></a></h2>

    
<p>
Il y a deux types de soumission dans les listes de diffusion; les
nouveaux ports et les mises à jour. Les nouveux ports sont généralement
postés comme pièces jointes ou des urls. Le plus facile est d'extraire
les ports dans le répertoire <tt>/usr/ports/mystuff/</tt> et de les
tester là. Les mises à jour sont habituellement des changements
effectués dans l'arborescence -current des ports, le mieux est donc de
copier le port dans <tt>mystuff/</tt> et d'appliquer les changements
afin d'éviter tous problèmes dans l'arborescence des ports.</p>

<p>
La conception pas-à-pas de ports est indispensable afin de vérifier que
chaque étape, voir
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ports&amp;sektion=7&amp;">ports(7)</a>, est accomplie correctement :</p>

<ul>
  <li><i>fetch</i>
    <ul>
      <li>Nécessaire afin de vérifier que le(s) fichier(s) devant être
          installé(s) se télécharge(nt) correctement. Essayez de tester
          tous les <tt>MASTER_SITES</tt> spécifiés afin de s'assurer que
          ce sont des sources valides.
    </ul>

  <li><i>checksum</i>
    <ul>
      <li>Verifiez que le(s) fichier(s) devant être installé(s)
          correspond(ent) aux 'checksums' pré-enregistrées dans le
          fichier <tt>distinfo</tt>.
    </ul>

  <li><i>extract</i>
    <ul>
      <li>Chaque fichier devant être installé doit installer au
          préalable tout (tous) programme(s) dont il dépend (bzip2 par
          exemple).

    </ul>

  <li><i>patch</i>
    <ul>
      <li>Les correctifs doivent s'appliquer sans produire
          d'avertissements.
      <li>Plus aucun fichier <tt>.orig</tt> ne doit rester dans le
          répertoire <tt>patches/</tt>.
      <li>Une erreur habituelle est d'inclure les balises RCS dans un
          correctif; cela entrainera des problèmes lors de l'ajout du
          port dans l'arborescence et de l'expansion de la balise RCS.
    </ul>

  <li><i>configure</i>
    <ul>
      <li>Vérifiez que les scripts de configuration détectent
          correctement les spécificités de votre plate-forme.
      <li>GNU libtool est célèbre pour des 'options' non-désirées sur
          OpenBSD, dès lors veillez à ce que le port utilise une version
          récente qui crée des librairies correctes sur votre
          architecture.
      <li>Le script de configuration ne doit pas détecter les applications 
        installées au préalable sur votre système sans en 
        avoir spécifier les dépendences dans le port. 
    </ul>

  <li><i>build</i>
    <ul>
      <li>Vérifiez d'éventuelles erreurs de conceptions et
          d'avertissements suspects.
      <li>Les avertissements à propos de problèmes avec
          <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=tmpnam&amp;sektion=3&amp;"> tmpnam(3)</a>
          doivent pouvoir se résoudre à en utilisant 
          <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkstemp&amp;sektion=3&amp;"> mkstemp(3)</a>.
      <li>Essayez de définir la variable <tt>SEPARATE_BUILD</tt> à
          'concurrent' et testez si le port se compile toujours.
      <li>Assurez vous que les dépendences avec GNU make sont vraiment
          nécessaires.
    </ul>

  <li><i>regress</i>
    <ul>
      <li>Vérifiez d'éventuelles erreurs (les tests vides signifient que
          tout est bon).
    </ul>

  <li><i>fake</i>
    <ul>
      <li>Cette option instalel l'application dans un faux répertoire
          afin d'être certain que les fichiers peuvent être empaquetés
          sans affecter le système de base.
      <li>Le port ne doit <b>jamais</b> installer de fichiers en dehors
          du faux répertoire (comme dans <tt>/usr/local</tt> par
          exemple).
      <li>GNU libtool a occasionellement des problèmes quant il s'agit
          de lier des librairies pendant la procédure de fausse
          installation sur certaines architectures.
    </ul>

  <li><i>package</i>
    <ul>
      <li>La création d'un 'package' peut échouer si pkg/PLIST* et/ou
          pkg/PFRAG* sont incorrects.
    </ul>

  <li><i>install</i>
    <ul>
      <li>Les packages doivent installer avec succès et avec les bonnes
          permissions tous les fichiers figurant dans leur liste de
          conditionnement. Soyez extrêmement prudent avec les fichiers
          ayant le bit suid défini.
      <li> Assurez vous que le script<tt> INSTALL</tt> du packag'
           fonctionne correctement et n'écrase aucun fichier dans
           <tt>/etc</tt>.
    </ul>

  <li><i>deinstall</i>
    <ul>
      <li>Ceci devrait enlever tous les fichiers installés par le
          package, excepté ceux présent dans <tt>/etc</tt>.
      <li>Soyez certain que le script<tt> DEINSTALL</tt> fonctionne
          comme prévu.
    </ul>

</ul>

<p>
Les fichiers restant dans <tt>pkg/</tt> comme DESCR et MESSAGE 
doivent être vérifiés au niveau de la grammaire et de l'orthographe. Les
paragraphes doivent être formattés en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fmt&amp;sektion=1&amp;format=html">fmt(1)</a> et limités à 70 caractères.</p>

<h2><a name="Commenting"><font color="#0000e0">Commentaires</font></a></h2>

<p>
Une fois les tests terminés vient la chose la plus importante : les
commentaires. Même si le port fonctionne parfaitement, des commentaires
doivent être effectués. Si nous avons dix personnes rapportant que le
port fonctionne correctement sur plusieurs architectures différentes,
son incorporation dans l'arborescence est effectuée plus rapidement. Si
il ne fonctionne pas, certaines informations doivent être fournies.
Certains outils existent et peuvent vous aider dans cette tâche, comme
par exemple
<a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/infrastructure/build/portslogger">portslogger</a> 
qui est une sorte de "tee intelligent" et redirige les données dans un
fichier journal.</p>

<p>Exemple :<br>

<div style="margin-left: 2em">
  <table border="0" cellpadding="3" width="90%">
    <tr>
      <td nowrap bgcolor="#EEEEEE">
<pre>
    # make install 2&gt;&amp;1 | /usr/ports/infrastructure/build/portslogger .
</pre>
      </td>
    </tr>
  </table>
</div>
<br>
<br>
     
<p>
Ceci va rediriger les données dans un fichier journal se trouvant dans
le répertoire courant.</p>

<h2><a name="More"><font color="#0000e0">Plus de tests</font></a></h2>

<p>
Vérifiez le Makefile du port au niveau des fautes de typographie, des
liens incorrects, des variables inutiles ou manquantes, des licences
correctes et des catégories. Pour ceux qui possèdent plus de
compétences, d'autres options peuvent être testées comme
<i>lib-depends-check</i>, examiner les correctifs, ainsi que fournir des
fichiers diff pour corriger des bogues, rajouter des saveurs ('flavors')
au port ou encore d'autres améliorations.</p>
    
<p>
Ces fichiers diff doivent être crées avec les options
<tt>-uNr --exclude=CVS</tt>. <tt>cvs diff -uN</tt> peut également être
employé pour générer des correctifs par rapport dépôt CVS.</p>
<hr>
<a href="index.html"><img src="../back.gif" height="24" width="24" alt="OpenBSD" border="0"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a><br>
<small>
<!--
Originally [OpenBSD: porttest.html,v 1.19 ]<br>
$Translation: porttest.html,v 1.11 2005/07/16 15:53:06 saad Exp $<br>
-->
$OpenBSD: porttest.html,v 1.9 2005/07/17 16:06:31 saad Exp $
</small>
</body>
</html>
